import{j as e,S as p,p as l,n as c,r as y,B as b,A as v,y as C}from"./Toast-BHa6H2vo.js";import{T as A,P as I}from"./TopicPicker-CkSMDfVV.js";import{S as w,A as B}from"./SentimentDissatisfiedRounded-wtY0HGs0.js";import{a as T,A as k,S as D}from"./ScrollArea-DhcySWlB.js";import{b as E,c as F,d as R,e as z}from"./AttachFileRounded-D5OZdfHF.js";import{r as M}from"./routes-Dr3OAPvi.js";import{S as L}from"./SortRounded-JJ1ufZVv.js";import{A as N}from"./ArrowUpwardRounded-CmBpJzpE.js";import{i as _,h as O,j as W,C as H}from"./post-G91tkUxX.js";import{u as h}from"./url-DNIOgc-m.js";import{F as U}from"./FormControlLabel-sOiZWAxF.js";import{S as $}from"./Switch-CZfIIWkJ.js";import{T as q,a as G}from"./Tabs-Br4LFR0i.js";import{T as S}from"./DarkModeRounded-ClUe3rit.js";import{E as g,a as J}from"./ExpandedPost-CAMQCUyJ.js";import{S as K}from"./Skeleton-BEnW33Sy.js";import{D as f}from"./ExpandMoreRounded-BMh3EQbx.js";import"./fuse-Cgz5ob0E.js";import"./ClearRounded-B0zBpQyl.js";import"./Badge-YjZjNQKQ.js";import"./ErrorOutlineRounded-BlUf4-Yx.js";import"./ForumRounded-Dnbv8A1b.js";import"./RefreshRounded-BjYIpzaP.js";import"./tryCatch-BBzpVnFF.js";import"./SQLiteClient-C_we9YKq.js";import"./Toolbar-DJTOY0l_.js";import"./PersonRounded-Dur0M3Il.js";import"./Avatar-omF-2-08.js";import"./OpenInNewRounded-BeqRiqVq.js";import"./index-mSkvzYyn.js";import"./NotificationsRounded-BharbQcf.js";import"./MenuItem-DZHRXEh1.js";import"./dividerClasses-C8p-C6NL.js";import"./useMutation-aRGPUM_6.js";import"./MoreHorizRounded-CCFYSdP5.js";import"./ArrowOutwardRounded-BQWKxApa.js";import"./formatters-C9bWSe0O.js";import"./ErrorRounded-ZEFnCPX_.js";import"./with-selector-B34yPTxP.js";import"./SwitchBase-B2x_YcbF.js";import"./KeyboardArrowRight-D6lRhLs3.js";import"./CommentRounded-Y9zUGOPn.js";import"./PersonPinCircleRounded-3XZ5wmdk.js";import"./PostHeader-BpjWzzdO.js";const Q=()=>{const{authenticated:t}=_(),{searchParams:o,updateSearchParams:s}=h(),i=o.get("followPrior")==="true",n=(m,r)=>{s({followPrior:r.toString()})},a=t&&i;return e.jsx(U,{disabled:!t,control:e.jsx($,{size:"small",checked:a,onChange:n}),sx:{m:0,"& .MuiFormControlLabel-label":{fontSize:"0.875rem"}},label:t?"優先顯示追蹤者":"登入後可優先顯示追蹤對象"})},u=["title","createdAt","updatedAt","commentCount","viewCount","likeCount"],V=["標題","建立時間","更新時間","回覆數","瀏覽數","讚數"],X=()=>{const{searchParams:t,updateSearchParams:o}=h(),s=t.get("orderBy")||u[0],i=t.get("orderDesc")==="true";let n=u.findIndex(r=>r===s);n===-1&&(n=1);const a=(r,d)=>{o({orderBy:u[d],orderDesc:i.toString()})},m=r=>()=>{n===r&&o({orderBy:u[r],orderDesc:(!i).toString()})};return e.jsxs(p,{children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(L,{sx:{color:"inherit"}}),e.jsx(c,{variant:"subtitle1",component:"h2",sx:{lineHeight:1},children:"排序依據"})]}),e.jsx(Q,{})]}),e.jsx(q,{value:n,onChange:a,variant:"scrollable",allowScrollButtonsMobile:!0,sx:{"& button:hover":{bgcolor:"action.hover"}},children:V.map((r,d)=>e.jsx(G,{onClick:m(d),label:e.jsx(S,{title:"再次點擊可以切換升冪或降冪排序",arrow:!0,placement:"top",children:e.jsxs(p,{direction:"row",sx:{alignItems:"center"},children:[e.jsx(c,{variant:"subtitle1",component:"span",children:r}),n===d&&e.jsx(N,{fontSize:"small",sx:{transform:i?"rotate(180deg)":"none",transition:"all 0.2s ease"}})]})})},d))})]})},Y=()=>{const{searchParams:t,updateSearchParams:o}=h(),[s,i]=y.useState(null),n=r=>i(r.currentTarget),a=()=>i(null),m=r=>{o({topic:r}),a()};return e.jsxs(e.Fragment,{children:[e.jsx(S,{title:"換一個主題",arrow:!0,children:e.jsxs(c,{variant:"h6",component:"h2",sx:{color:"text.secondary","&:hover":{cursor:"pointer",textDecoration:"underline",color:"text.primary"}},onClick:n,children:["#",t.get("topic")??"全部"]})}),e.jsx(A,{type:"query",open:!!s,anchorEl:s,onClose:a,onConfirm:m})]})},Z=["title","createdAt","updatedAt","commentCount","viewCount","likeCount"],ee=t=>Z.includes(t),te=()=>{const{searchParams:t}=h(),o=t.get("topic")??void 0,s=t.get("orderBy")??"title",i=t.get("orderDesc")==="true",n=t.get("followPrior")==="true",{data:a,isLoading:m,isFetchingNextPage:r,hasNextPage:d,fetchNextPage:P}=W({topic:o,orderBy:ee(s)?s:"createdAt",order:i?"desc":"asc",prioritizeFollowers:n});return m||!a?e.jsx(p,{sx:{alignItems:"stretch",mb:1.5},children:[...Array(3)].map((j,x)=>e.jsx(g,{},x))}):a.pages[0].posts.length===0?e.jsxs(l,{sx:{py:6,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[e.jsx(w,{sx:{fontSize:"6rem",color:"action.disabled"}}),e.jsx(c,{variant:"body1",component:"p",sx:{color:"text.secondary",textAlign:"center"},children:"沒有符合條件的貼文"})]}):e.jsxs(p,{sx:{alignItems:"stretch",mb:1.5},children:[a.pages.map(j=>j.posts.map(x=>e.jsx(J,{postId:x},x))),r&&e.jsx(p,{sx:{alignItems:"stretch"},children:[...Array(3)].map((j,x)=>e.jsx(g,{},x))}),d?r?e.jsx(c,{sx:{color:"text.secondary",textAlign:"center",mt:3},children:"載入中..."}):e.jsxs(l,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mt:3,gap:1},children:[e.jsx(c,{sx:{color:"text.secondary"},children:"滾動以載入更多，或點擊"}),e.jsx(b,{onClick:()=>P(),children:"載入更多"})]}):e.jsx(c,{sx:{color:"text.secondary",textAlign:"center",mt:3},children:"已經到底了"})]})},re=()=>{const{searchParams:t}=h(),o=t.get("topic")??void 0,{data:s}=O({topic:o});return s?e.jsxs(c,{variant:"body2",component:"span",sx:{color:"text.secondary"},children:["共 ",s," 篇"]}):e.jsx(K,{variant:"rounded",animation:"wave",children:e.jsx(c,{variant:"body2",component:"span",sx:{color:"text.secondary"},children:"共 0 篇"})})},oe=()=>{const{searchParams:t}=h(),o=t.get("topic")??"全部";return e.jsx("title",{children:`論壇樣板 | 貼文 #${o}`})};function se(){const{isMd:t,isSm:o}=T();return e.jsxs(k,{children:[e.jsx(oe,{}),e.jsx(E,{}),e.jsxs(D,{children:[t?e.jsx(F,{}):e.jsx(R,{}),e.jsx(H,{maxWidth:"lg",sx:{position:"relative",my:10,px:0},children:e.jsxs(v,{sx:{py:3,borderRadius:3,border:"1px solid",borderColor:"divider"},elevation:1,children:[e.jsxs(l,{sx:{display:"flex",gap:1,alignItems:"center",pr:{xs:3,md:5},pl:2},children:[o&&e.jsx(p,{sx:{alignItems:"flex-start",flex:1},children:e.jsx(b,{href:M.forum_home,startIcon:e.jsx(B,{}),variant:"outlined",sx:{textWrap:"nowrap"},children:t?"返回首頁":"首頁"})}),e.jsxs(l,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(I,{className:"mode-light",sx:{fontSize:48,mr:1,bgcolor:"primary.main",borderRadius:1,color:"background.default",p:1,opacity:.8}}),e.jsx(c,{variant:"h5",component:"h2",children:"貼文列表"}),e.jsx(Y,{})]}),e.jsx(p,{sx:{alignItems:"flex-end",flex:1},children:e.jsx(re,{})})]}),e.jsx(f,{sx:{mt:2}}),e.jsxs(l,{sx:{position:"relative",px:1},children:[e.jsx(l,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35,pointerEvents:"none"}}),e.jsx(X,{})]}),e.jsx(f,{}),e.jsx(te,{})]})}),e.jsx(z,{})]})]})}C.createRoot(document.getElementById("root")).render(e.jsx(y.StrictMode,{children:e.jsx(se,{})}));
