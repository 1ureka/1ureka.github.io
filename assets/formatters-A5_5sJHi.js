import{u}from"./useQuery-GDYZV5d2.js";import{o as g}from"./forum-DB1wLXRP.js";import{a as b,e as w}from"./datahub_home-Cb1RDfKe.js";import{aV as d,j as y,T as m}from"./routes-BF-Brp0S.js";import{d as T}from"./dayjs.min-g6VTRZSP.js";import{T as x}from"./useMutation-C8meJFDJ.js";function h(t,e=.9){if(!Array.isArray(t)||t.length===0)return null;if(e<0||e>1)throw new Error("Ratio must be between 0 and 1");const n=t.reduce((r,i)=>(r[i]=(r[i]||0)+1,r),{});let s=t[0],o=0;for(const[r,i]of d(n))i>o&&(s=r,o=i);return o/t.length>=e?s:null}const c=()=>{const{client:t}=b.getState();if(!t)throw new Error("SQLite client is not initialized.");return t},S=async()=>await c().getDatabaseSize(),p=async t=>{const e=c(),n=[];return await Promise.all(t.map(async s=>{(await e.exec("SELECT name FROM sqlite_master WHERE type = $type AND name NOT LIKE 'sqlite_%';",{$type:s})).forEach(r=>{typeof r.name=="string"&&n.push({type:s,name:r.name})})})),n},j=async t=>{const e=c(),n={},s=await p(t);return await Promise.all(s.map(async({name:o})=>{const a=`SELECT COUNT(*) as count FROM ${o};`,r=await e.exec(a);r.length>0?n[o]=Number(r[0].count??0):n[o]=0})),n},F=t=>{if(t==null)return"empty";if(typeof t=="number"&&Number.isInteger(t))return"integer";if(typeof t=="number")return"real";if(typeof t!="string")return"unknown";if(t.trim()==="")return"empty";if(/^[0-9a-f]{8}-[0-9a-f]{4}/.test(t))return"uuid";if(["true","false","0","1"].includes(t.toLowerCase()))return"boolean";if(T(t).isValid())return"date";const n=g(()=>JSON.parse(t));if(n.error)return"text";const s=n.data;return Array.isArray(s)?"json_array":typeof s=="object"&&s!==null?"json_object":"text"},q=async(t,e,n)=>{const s=c(),o=`SELECT "${e}" FROM "${t}" LIMIT 20;`,a=await s.exec(o);if(a.length===0)return n;const r=a.map(f=>F(f[e])).filter(f=>f!=="empty"),i=h(r,.9);return!i||i==="unknown"?n:i},C=async t=>{const e=c(),n=`PRAGMA table_info(${t});`,s=await e.exec(n);if(s.length===0)return null;const a=(await Promise.all(s.map(r=>q(t,r.name,r.type)))).map(r=>r.toLowerCase());return s.map((r,i)=>({...r,type:a[i]}))},l=0,N=()=>u({queryKey:["dbBytes"],queryFn:()=>S(),staleTime:l}),E=({types:t})=>u({queryKey:["objects",...t.toSorted()],queryFn:()=>p(t),staleTime:l}),$=({types:t})=>u({queryKey:["rowCounts",...t.toSorted()],queryFn:()=>j(t),staleTime:l}),z=({types:t})=>{const{data:e=[],isFetching:n}=E({types:t}),{data:s,isFetching:o}=u({queryKey:["tableInfos",...e.map(a=>a.name)],queryFn:async()=>(await Promise.all(e.map(({name:a})=>C(a)))).filter(a=>a!==null),enabled:e.length>0,staleTime:l});return{data:s,isFetching:n||o}},K=({children:t,...e})=>y.jsx(x,{followCursor:!0,slotProps:{transition:{timeout:{appear:250,enter:250,exit:0}}},...e,children:t}),P=({children:t,sx:e,...n})=>y.jsx(m,{variant:"subtitle1",component:"h3",sx:{color:"text.secondary",textWrap:"nowrap",...e},...n,children:t}),_=({children:t,sx:e,...n})=>y.jsx(m,{variant:"h5",component:"p",sx:{...w,...e},...n,children:t});function R(t,e="en-US"){return t.toLocaleString(e)}function D(t,e=2){if(t<=0)return"0 Bytes";if(!Number.isFinite(t))return"N/A";const n=1024,s=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(t)/Math.log(n)),a=t/Math.pow(n,o),r=parseFloat(a.toFixed(e)),i=s[o];return`${R(r)} ${i}`}export{K as T,z as a,P as b,_ as c,N as d,E as e,R as f,D as g,$ as u};
