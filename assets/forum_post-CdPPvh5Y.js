import{r as v,k as xt,l as ut,m as pt,j as t,s as mt,n as ht,o as f,p as jt,q as gt,t as U,v as ft,g as S,T as i,a as n,h as bt,B as vt,e as Z,i as yt,f as Bt}from"./Toast-CaubaWG6.js";import{A as It}from"./ArrowBackIosRounded-B_MJn8vE.js";import{e as Ct,f as $t,B as x,S as w,g as tt,h as W,T as wt,a as Rt,A as St,b as kt}from"./ScrollArea-zAV9zyXX.js";import{u as F,D as h,C as _,U as et,f as At,b as Pt,c as Et,d as zt,e as Lt}from"./url-B1cCZAlV.js";import{a as O,S as Ft,u as Nt}from"./post-BgksSCnm.js";import{B as Tt,F as Mt,S as Wt,E as K,a as Ot}from"./ExpandedPost-C3RI3K48.js";import{L as Dt,T as D,V as st,P as Vt,a as qt,A as Q,b as Gt}from"./PostHeader-BqpFcTQZ.js";import{T as P,I as nt,C as Ht}from"./DarkModeRounded-DhOzHgDY.js";import{a as Ut}from"./session-Db8uXD_G.js";import{E as _t}from"./EmojiMenu-DxJGSg4b.js";import{T as J,a as L}from"./Tabs-C6vGX54i.js";import"./CommentRounded-DfdPurT9.js";function Kt(e){return v.Children.toArray(e).filter(s=>v.isValidElement(s))}function Qt(e){return ut("MuiButtonGroup",e)}const a=xt("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","horizontal","vertical","colorPrimary","colorSecondary","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]),Jt=(e,s)=>{const{ownerState:o}=e;return[{[`& .${a.grouped}`]:s.grouped},{[`& .${a.grouped}`]:s[`grouped${f(o.orientation)}`]},{[`& .${a.grouped}`]:s[`grouped${f(o.variant)}`]},{[`& .${a.grouped}`]:s[`grouped${f(o.variant)}${f(o.orientation)}`]},{[`& .${a.grouped}`]:s[`grouped${f(o.variant)}${f(o.color)}`]},{[`& .${a.firstButton}`]:s.firstButton},{[`& .${a.lastButton}`]:s.lastButton},{[`& .${a.middleButton}`]:s.middleButton},s.root,s[o.variant],o.disableElevation===!0&&s.disableElevation,o.fullWidth&&s.fullWidth,o.orientation==="vertical"&&s.vertical]},Yt=e=>{const{classes:s,color:o,disabled:r,disableElevation:l,fullWidth:d,orientation:m,variant:g}=e,j={root:["root",g,m,d&&"fullWidth",l&&"disableElevation",`color${f(o)}`],grouped:["grouped",`grouped${f(m)}`,`grouped${f(g)}`,`grouped${f(g)}${f(m)}`,`grouped${f(g)}${f(o)}`,r&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return jt(j,Qt,s)},Xt=mt("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:Jt})(gt(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{variant:"contained"},style:{boxShadow:(e.vars||e).shadows[2]}},{props:{disableElevation:!0},style:{boxShadow:"none"}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${a.lastButton},& .${a.middleButton}`]:{borderTopRightRadius:0,borderTopLeftRadius:0},[`& .${a.firstButton},& .${a.middleButton}`]:{borderBottomRightRadius:0,borderBottomLeftRadius:0}}},{props:{orientation:"horizontal"},style:{[`& .${a.firstButton},& .${a.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${a.lastButton},& .${a.middleButton}`]:{borderTopLeftRadius:0,borderBottomLeftRadius:0}}},{props:{variant:"text",orientation:"horizontal"},style:{[`& .${a.firstButton},& .${a.middleButton}`]:{borderRight:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${a.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},{props:{variant:"text",orientation:"vertical"},style:{[`& .${a.firstButton},& .${a.middleButton}`]:{borderBottom:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${a.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},...Object.entries(e.palette).filter(U()).flatMap(([s])=>[{props:{variant:"text",color:s},style:{[`& .${a.firstButton},& .${a.middleButton}`]:{borderColor:e.vars?`rgba(${e.vars.palette[s].mainChannel} / 0.5)`:ft(e.palette[s].main,.5)}}}]),{props:{variant:"outlined",orientation:"horizontal"},style:{[`& .${a.firstButton},& .${a.middleButton}`]:{borderRightColor:"transparent","&:hover":{borderRightColor:"currentColor"}},[`& .${a.lastButton},& .${a.middleButton}`]:{marginLeft:-1}}},{props:{variant:"outlined",orientation:"vertical"},style:{[`& .${a.firstButton},& .${a.middleButton}`]:{borderBottomColor:"transparent","&:hover":{borderBottomColor:"currentColor"}},[`& .${a.lastButton},& .${a.middleButton}`]:{marginTop:-1}}},{props:{variant:"contained",orientation:"horizontal"},style:{[`& .${a.firstButton},& .${a.middleButton}`]:{borderRight:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${a.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},{props:{variant:"contained",orientation:"vertical"},style:{[`& .${a.firstButton},& .${a.middleButton}`]:{borderBottom:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${a.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}}}},...Object.entries(e.palette).filter(U(["dark"])).map(([s])=>({props:{variant:"contained",color:s},style:{[`& .${a.firstButton},& .${a.middleButton}`]:{borderColor:(e.vars||e).palette[s].dark}}}))],[`& .${a.grouped}`]:{minWidth:40,boxShadow:"none",props:{variant:"contained"},style:{"&:hover":{boxShadow:"none"}}}}))),Zt=v.forwardRef(function(s,o){const r=pt({props:s,name:"MuiButtonGroup"}),{children:l,className:d,color:m="primary",component:g="div",disabled:j=!1,disableElevation:c=!1,disableFocusRipple:u=!1,disableRipple:p=!1,fullWidth:b=!1,orientation:y="horizontal",size:C="medium",variant:$="outlined",...E}=r,k={...r,color:m,component:g,disabled:j,disableElevation:c,disableFocusRipple:u,disableRipple:p,fullWidth:b,orientation:y,size:C,variant:$},B=Yt(k),I=v.useMemo(()=>({className:B.grouped,color:m,disabled:j,disableElevation:c,disableFocusRipple:u,disableRipple:p,fullWidth:b,size:C,variant:$}),[m,j,c,u,p,b,C,$,B.grouped]),G=Kt(l),dt=G.length,ct=z=>{const A=z===0,H=z===dt-1;return A&&H?"":A?B.firstButton:H?B.lastButton:B.middleButton};return t.jsx(Xt,{as:g,role:"group",className:ht(B.root,d),ref:o,ownerState:k,...E,children:t.jsx(Ct.Provider,{value:I,children:G.map((z,A)=>t.jsx($t.Provider,{value:ct(A),children:z},A))})})}),N=S(t.jsx("path",{d:"m11.71 15.29 2.59-2.59c.39-.39.39-1.02 0-1.41L11.71 8.7c-.63-.62-1.71-.18-1.71.71v5.17c0 .9 1.08 1.34 1.71.71"}),"ArrowRightRounded"),T=S(t.jsx("path",{d:"M12.29 8.71 9.7 11.3c-.39.39-.39 1.02 0 1.41l2.59 2.59c.63.63 1.71.18 1.71-.71V9.41c0-.89-1.08-1.33-1.71-.7"}),"ArrowLeftRounded"),R={display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",textTransform:"none"},te=()=>{const{searchParams:e,updateSearchParams:s}=F(),o=e.get("postId"),r=o&&/^\d+$/.test(o)&&Number(o)>0?Number(o):-1,{data:l,isFetching:d}=O({postId:r-1});return d&&!l?t.jsx(x,{startIcon:t.jsx(T,{}),loading:!0,children:t.jsx(i,{variant:"button",sx:R,children:"載入中..."})}):l?t.jsx(x,{startIcon:t.jsx(T,{}),onClick:()=>s({postId:(r-1).toString()}),children:t.jsxs(i,{variant:"button",sx:R,children:["上一篇：",l.title]})}):t.jsx(x,{startIcon:t.jsx(T,{}),disabled:!0,children:t.jsx(i,{variant:"button",sx:R,children:"沒有上一篇了"})})},ee=()=>{const{searchParams:e,updateSearchParams:s}=F(),o=e.get("postId"),r=o&&/^\d+$/.test(o)&&Number(o)>0?Number(o):-1,{data:l,isFetching:d}=O({postId:r+1});return d&&!l?t.jsx(x,{endIcon:t.jsx(N,{}),loading:!0,children:t.jsx(i,{variant:"button",sx:R,children:"載入中..."})}):l?t.jsx(x,{endIcon:t.jsx(N,{}),onClick:()=>s({postId:(r+1).toString()}),children:t.jsxs(i,{variant:"button",sx:R,children:["下一篇：",l.title]})}):t.jsx(x,{endIcon:t.jsx(N,{}),disabled:!0,children:t.jsx(i,{variant:"button",sx:R,children:"沒有下一篇了"})})},se=S(t.jsx("path",{d:"m21.41 11.41-8.83-8.83c-.37-.37-.88-.58-1.41-.58H4c-1.1 0-2 .9-2 2v7.17c0 .53.21 1.04.59 1.41l8.83 8.83c.78.78 2.05.78 2.83 0l7.17-7.17c.78-.78.78-2.04-.01-2.83M6.5 8C5.67 8 5 7.33 5 6.5S5.67 5 6.5 5 8 5.67 8 6.5 7.33 8 6.5 8"}),"Sell"),ne=e=>Array.from({length:e},()=>Math.random()*.7+.3),oe=()=>t.jsxs(n,{sx:{pt:1.5},children:[t.jsx(h,{}),t.jsxs(n,{sx:{position:"relative",py:1.5,height:"fit-content"},children:[t.jsx(n,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35,pointerEvents:"none"}}),t.jsx(n,{sx:{px:2.5},children:t.jsx(Dt,{sx:{m:0}})})]}),t.jsx(h,{sx:{mb:2.5}}),t.jsxs(n,{sx:{px:2.5,position:"relative"},children:[t.jsx(w,{variant:"rounded",animation:"wave",sx:{mb:1},children:t.jsx(i,{variant:"h4",component:"h2",sx:{textAlign:"start"},gutterBottom:!0,children:"正在載入標題... 正在載入"})}),ne(4).map((e,s)=>t.jsx(w,{variant:"text",animation:"wave",width:`${e*100}%`},s)),t.jsx(bt,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}),t.jsx(h,{sx:{mt:2.5}}),t.jsxs(n,{sx:{p:1.5,py:1,display:"flex",gap:1.5,alignItems:"center",position:"relative",color:"text.secondary"},children:[t.jsx(n,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),t.jsx(x,{color:"inherit",startIcon:t.jsx(D,{}),size:"small",loading:!0,children:t.jsx(i,{variant:"caption",component:"span",children:"100 個讚"})}),t.jsx(x,{color:"inherit",startIcon:t.jsx(Tt,{}),size:"small",loading:!0,children:t.jsx(i,{variant:"caption",component:"span",children:"收藏該貼文"})}),t.jsx(n,{sx:{flex:1}}),t.jsx(x,{color:"inherit",startIcon:t.jsx(st,{}),size:"small",loading:!0,children:t.jsx(i,{variant:"caption",component:"span",children:"1000 次瀏覽"})})]}),t.jsx(h,{})]}),re=({post:e})=>t.jsxs(n,{sx:{pt:1.5},children:[t.jsx("title",{children:`論壇樣板 | ${e.title}`}),t.jsx(h,{}),t.jsxs(n,{sx:{position:"relative",py:1.5,height:"fit-content"},children:[t.jsx(n,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35,pointerEvents:"none"}}),t.jsx(n,{sx:{px:2.5},children:t.jsx(Vt,{post:e,sx:{m:0}})})]}),t.jsx(h,{sx:{mb:2.5}}),t.jsxs(n,{sx:{px:2.5},children:[t.jsx(i,{variant:"h4",component:"h2",sx:{textAlign:"start"},gutterBottom:!0,children:e.title}),t.jsx(i,{variant:"body2",component:"p",sx:{whiteSpace:"pre-line"},children:e.content}),e.photos&&e.photos.length>0&&t.jsx(n,{sx:{display:"grid",gap:1,mt:2,gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))"},children:e.photos.map(({name:s,url:o},r)=>t.jsx(P,{title:"查看圖片",arrow:!0,placement:"top",children:t.jsx(vt,{sx:{position:"relative",aspectRatio:"1 / 1",bgcolor:"divider",borderRadius:1,overflow:"hidden"},children:t.jsx(n,{sx:{position:"absolute",inset:"auto 0 0 0",pb:1,display:"grid",placeItems:"center"},children:t.jsx(n,{sx:{maxWidth:150},children:t.jsx(_,{label:s,size:"small"})})})})},`${o}${r}`))}),t.jsxs(Ft,{sx:{gap:1.5,flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap-reverse",mt:2},children:[t.jsxs(n,{sx:{display:"flex",gap:1.5,flexWrap:"wrap",alignItems:"center"},children:[t.jsxs(i,{variant:"subtitle2",sx:{color:"text.secondary",display:"flex",alignItems:"center",gap:.5},children:[t.jsx(se,{fontSize:"small"}),"標籤："]}),t.jsx(qt,{post:e,displayCount:99})]}),e.attachments&&e.attachments.length>0&&t.jsxs(n,{sx:{display:"flex",gap:1,flexWrap:"wrap",alignItems:"center"},children:[t.jsxs(i,{variant:"subtitle2",sx:{color:"text.secondary",display:"flex",alignItems:"center",gap:.5},children:[t.jsx(Q,{fontSize:"small"}),"附件："]}),e.attachments.map((s,o)=>t.jsx(P,{title:"下載附件",arrow:!0,placement:"top",children:t.jsx(_,{label:`${s.name} (${(s.size/1024).toFixed(1)}KB)`,clickable:!0,icon:t.jsx(Q,{fontSize:"small"})})},o))]})]})]}),t.jsx(h,{sx:{mt:2.5}}),t.jsxs(n,{sx:{px:2.5,py:1,display:"flex",gap:1.5,alignItems:"center",position:"relative",color:"text.secondary"},children:[t.jsx(n,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),t.jsx(Gt,{postId:e.id,likeCount:e.likeCount}),t.jsx(Mt,{postId:e.id}),t.jsx(n,{sx:{flex:1}}),t.jsx(x,{startIcon:t.jsx(st,{}),disabled:!0,size:"small",sx:{"button&.Mui-disabled":{color:"text.secondary",opacity:.8}},children:t.jsxs(i,{variant:"caption",component:"span",children:[e.viewCount," 次瀏覽"]})})]}),t.jsx(h,{flexItem:!0})]}),ot=async e=>{const s=e.postId!==void 0,o=`
      SELECT
        id
      FROM
        comments
      WHERE
        ${s?"postId = $id AND parentId IS NULL":"parentId = $id"}
      ORDER BY
        createdAt DESC
    `,r={$id:s?e.postId:e.parentId};return(await tt.exec(o,r)).map(d=>d.id)},ae=async({commentId:e})=>{const o=await tt.exec(`
      SELECT
        c.id,
        c.postId,
        c.parentId,
        c.content,
        c.userId,
        u.name as userName,
        COALESCE(cic.likeCount, 0) as likeCount,
        c.createdAt,
        c.updatedAt
      FROM
        comments c
      JOIN
        users u ON c.userId = u.id
      LEFT JOIN
        comment_interaction_counts cic ON c.id = cic.commentId
      WHERE
        c.id = $commentId
    `,{$commentId:e});if(o.length===0)return null;const r=o[0];return{...r,id:r.id,postId:r.postId,parentId:r.parentId,content:r.content,userId:r.userId,userName:r.userName,likeCount:r.likeCount,createdAt:new Date(r.createdAt),updatedAt:new Date(r.updatedAt)}},V=1e3*60*10,ie=e=>W({queryKey:["commentsByPost",e],queryFn:()=>ot({postId:e}),staleTime:V}),rt=e=>W({queryKey:["commentsByParent",e],queryFn:()=>ot({parentId:e}),staleTime:V}),le=e=>W({queryKey:["comment",e],queryFn:()=>ae({commentId:e}),staleTime:V}),at=S(t.jsx("path",{d:"M10 9V7.41c0-.89-1.08-1.34-1.71-.71L3.7 11.29c-.39.39-.39 1.02 0 1.41l4.59 4.59c.63.63 1.71.19 1.71-.7V14.9c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"}),"ReplyRounded"),it=S(t.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),Y=S(t.jsx("path",{d:"M8.12 9.29 12 13.17l3.88-3.88c.39-.39 1.02-.39 1.41 0s.39 1.02 0 1.41l-4.59 4.59c-.39.39-1.02.39-1.41 0L6.7 10.7a.996.996 0 0 1 0-1.41c.39-.38 1.03-.39 1.42 0"}),"KeyboardArrowDownRounded"),M=({sx:e,onCancel:s,...o})=>{const{user:r,authenticated:l,loading:d}=Ut(),m=v.useRef(null),[g,j]=v.useState(""),c=u=>{j(p=>{const b=m.current;if(b){const y=b.selectionStart||0,C=b.selectionEnd||0,$=p.substring(0,y)+u+p.substring(C);return setTimeout(()=>{b.focus(),b.setSelectionRange(y+u.length,y+u.length)},0),$}return p+u})};return t.jsx(n,{sx:{position:"relative",py:1,px:2,...e},...o,children:t.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[l&&r?t.jsx(et,{name:r.name,sx:{mt:1.5}}):t.jsx(At,{sx:{width:"2rem",height:"2rem",mt:1.5}}),t.jsxs(n,{sx:{flex:1},component:"form",children:[t.jsx(wt,{inputRef:m,variant:"standard",size:"small",name:"comment",label:l?"發表你的想法":"登入後即可發表留言",fullWidth:!0,type:"text",value:g,onChange:u=>j(u.target.value),disabled:!l||d}),t.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mt:1,alignItems:"center",gap:1},children:[t.jsx(_t,{onEmojiClick:c,disabled:!l||d}),t.jsxs(n,{sx:{display:"flex",gap:1},children:[t.jsx(x,{size:"small",disabled:!l||d,sx:{color:"text.secondary"},onClick:()=>{j(""),s!==void 0&&s()},children:"取消"}),t.jsx(x,{size:"small",disabled:!l||d||g.trim().length===0,variant:"contained",children:"留言"})]})]})]})]})})},de=()=>Math.floor(Math.random()*100),lt=({commentId:e,nestedLevel:s,sx:o,...r})=>{if(s<0)throw new Error("nestedLevel must be greater than 0");const[l,d]=v.useState(!1),[m,g]=v.useState(de),j=()=>{d(!l),g(I=>l?I-1:I+1)},{data:c,isFetching:u}=le(e),{data:p,isFetching:b}=rt(e),[y,C]=v.useState(!1),$=()=>C(I=>!I),[E,k]=v.useState(!1),B=()=>k(I=>!I);return u||!c||b?t.jsx(q,{nestedLevel:s,sx:o,...r}):t.jsx(n,{sx:{position:"relative",py:1,pb:s>0?0:1,pl:2,borderLeft:s>0?"2px solid":"none",borderColor:"divider",...o},...r,children:t.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[t.jsx(et,{name:c.userName,sx:{mt:1}}),t.jsxs(n,{sx:{flex:1},children:[t.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(i,{variant:"subtitle2",component:"a",sx:{"&:hover":{textDecoration:"underline"},color:"text.primary"},href:`${Z.forum_users}?user=${c.userName}`,children:c.userName}),t.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[t.jsx(i,{variant:"caption",color:"text.secondary",children:c.createdAt.toLocaleString()}),c.createdAt.getTime()!==c.updatedAt.getTime()&&t.jsx(P,{title:`最後編輯於 ${c.updatedAt.toLocaleString()}`,arrow:!0,children:t.jsx(i,{variant:"caption",color:"text.secondary",children:"(已編輯)"})}),t.jsx(P,{title:"更多選項",arrow:!0,children:t.jsx(nt,{size:"small",children:t.jsx(it,{fontSize:"small"})})})]})]}),t.jsx(i,{variant:"body2",sx:{mt:.5,whiteSpace:"pre-line"},children:c.content}),t.jsxs(n,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[t.jsx(x,{size:"small",startIcon:t.jsx(D,{}),onClick:j,color:l?"primary":"inherit",sx:{color:l?void 0:"text.secondary"},children:t.jsx(i,{variant:"caption",children:m>0?m:"讚"})}),t.jsx(x,{size:"small",startIcon:t.jsx(at,{}),sx:{color:"text.secondary"},onClick:B,children:t.jsx(i,{variant:"caption",children:E?"取消回覆":"回覆"})})]}),E&&t.jsx(M,{onCancel:()=>k(!1)}),p&&p.length>0&&t.jsx(x,{startIcon:y?t.jsx(Y,{sx:{transform:"rotate(180deg)",transition:"transform 0.2s ease",transformOrigin:"center"}}):t.jsx(Y,{}),sx:{mt:1},size:"small",onClick:$,children:y?"隱藏回覆":`顯示 ${p.length||0} 則回覆`}),y&&p&&t.jsx(ce,{commentId:e})]})]})})},q=({nestedLevel:e,sx:s,...o})=>t.jsx(n,{sx:{position:"relative",py:1,pb:e>0?0:1,pl:2,borderLeft:e>0?"2px solid":"none",borderColor:"divider",...s},...o,children:t.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[t.jsx(w,{variant:"circular",width:"2rem",height:"2rem",sx:{mt:1},animation:"wave"}),t.jsxs(n,{sx:{flex:1},children:[t.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(w,{variant:"rounded",animation:"wave",children:t.jsx(i,{variant:"subtitle2",component:"span",children:"載入名稱中..."})}),t.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[t.jsx(w,{variant:"rounded",animation:"wave",children:t.jsx(i,{variant:"caption",color:"text.secondary",children:"0000-00-00 00:00:00"})}),t.jsx(P,{title:"更多選項",arrow:!0,children:t.jsx("span",{children:t.jsx(nt,{size:"small",disabled:!0,children:t.jsx(it,{fontSize:"small"})})})})]})]}),t.jsx(w,{variant:"rounded",animation:"wave",children:t.jsx(i,{variant:"body2",sx:{mt:.5,whiteSpace:"pre-line"},children:"佔位文字，佔位文字，佔位文字，佔位文字，佔位文字，佔位文字，"})}),t.jsxs(n,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[t.jsx(x,{size:"small",startIcon:t.jsx(D,{}),sx:{color:"text.secondary"},loading:!0,children:t.jsx(i,{variant:"caption",children:"讚"})}),t.jsx(x,{size:"small",startIcon:t.jsx(at,{}),sx:{color:"text.secondary"},loading:!0,children:t.jsx(i,{variant:"caption",children:"回覆"})})]})]})]})}),ce=({commentId:e})=>{const{data:s,isFetching:o}=rt(e);return o?t.jsx(n,{children:[...Array(1)].map((r,l)=>t.jsx(q,{nestedLevel:1},l))}):s?t.jsx(n,{children:s.map(r=>t.jsx(lt,{commentId:r,nestedLevel:1},r))}):null},X={content:'""',display:"block",position:"absolute",inset:0,bgcolor:"divider",opacity:.2,pointerEvents:"none",mr:-2},xe=({totalComments:e})=>{const{searchParams:s,updateSearchParams:o}=F(),r=s.get("postId"),l=r&&/^\d+$/.test(r)&&Number(r)>0?Number(r):-1,{data:d,isFetching:m}=ie(l),j=(s.get("orderBy")||"latest")==="likes"?"likes":"latest",c=(u,p)=>{o({orderBy:p===0?"latest":"likes"})};return m?t.jsxs(t.Fragment,{children:[t.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[t.jsx(w,{variant:"rounded",animation:"wave",sx:{mx:2},children:t.jsx(i,{variant:"subtitle1",component:"h3",children:"0 則留言"})}),t.jsx(h,{flexItem:!0,orientation:"vertical",variant:"middle"}),t.jsxs(J,{value:j==="latest"?0:1,onChange:c,children:[t.jsx(L,{label:"最新",disabled:!0}),t.jsx(L,{label:"最多人按讚",disabled:!0})]})]}),t.jsx(h,{}),t.jsx(n,{sx:{pr:2,"& > .comment:nth-of-type(odd):before":X},children:[...Array(3)].map((u,p)=>t.jsx(q,{nestedLevel:0,className:"comment"},p))})]}):!d||d.length===0?t.jsxs(t.Fragment,{children:[t.jsx(n,{sx:{pr:2},children:t.jsx(M,{})}),t.jsx(n,{sx:{pb:2},children:t.jsx(i,{variant:"body2",sx:{color:"text.secondary",textAlign:"center",mt:2},children:"還沒有留言，快來發表你的看法吧！"})})]}):t.jsxs(t.Fragment,{children:[t.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[t.jsxs(i,{variant:"subtitle1",component:"h3",sx:{px:2},children:[e," 則留言"]}),t.jsx(h,{flexItem:!0,orientation:"vertical",variant:"middle"}),t.jsxs(J,{value:j==="latest"?0:1,onChange:c,children:[t.jsx(L,{label:"最新"}),t.jsx(L,{label:"最多人按讚"})]})]}),t.jsx(h,{}),t.jsxs(n,{sx:{pr:2,"& > .comment:nth-of-type(odd):before":X},children:[t.jsx(M,{className:"comment"}),d.map(u=>t.jsx(lt,{commentId:u,nestedLevel:0,className:"comment"},u))]})]})},ue=()=>{const{data:e,isFetching:s}=Nt({limit:2,orderBy:"likeCount",order:"desc"});return s||!e?t.jsxs(n,{children:[t.jsx(K,{}),t.jsx(K,{})]}):t.jsx(n,{children:e.map(o=>t.jsx(Ot,{postId:o},o))})},pe=()=>{const{searchParams:e}=F(),s=e.get("postId"),o=s&&/^\d+$/.test(s)&&Number(s)>0?Number(s):-1,{data:r,isFetching:l}=O({postId:o,incrementViewCount:!0});return l&&!r?t.jsx(oe,{}):r?t.jsxs(t.Fragment,{children:[t.jsx(re,{post:r}),t.jsx(xe,{totalComments:r.commentCount})]}):t.jsxs(n,{sx:{pt:1.5},children:[t.jsx(h,{}),t.jsxs(n,{sx:{py:6,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[t.jsx(Wt,{sx:{fontSize:"6rem",color:"action.disabled"}}),t.jsx(i,{variant:"body1",component:"p",sx:{color:"text.secondary",textAlign:"center"},children:"貼文不存在或已被刪除"})]}),t.jsx(h,{}),t.jsxs(n,{sx:{position:"relative"},children:[t.jsx(n,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),t.jsx(i,{variant:"h6",sx:{p:2},children:"我們找不到這篇貼文...但你可能會喜歡這些！"})]}),t.jsx(h,{}),t.jsx(ue,{})]})};function me(){const{isMd:e}=Rt();return t.jsxs(St,{children:[t.jsx(Pt,{}),t.jsxs(kt,{children:[e?t.jsx(Et,{}):t.jsx(zt,{}),t.jsx(Ht,{maxWidth:"lg",sx:{position:"relative",my:10},children:t.jsxs(yt,{sx:{pb:3,borderRadius:3,border:"1px solid",borderColor:"divider"},elevation:1,children:[t.jsxs(n,{sx:{display:"flex",justifyContent:"center",mt:2,mx:2},children:[t.jsx(x,{href:Z.forum_home,startIcon:t.jsx(It,{}),variant:"outlined",sx:{textWrap:"nowrap"},children:e?"返回首頁":"首頁"}),t.jsx(n,{sx:{flex:1}}),t.jsxs(Zt,{variant:"text",children:[t.jsx(te,{}),t.jsx(ee,{})]})]}),t.jsx(pe,{})]})}),t.jsx(Lt,{})]})]})}Bt.createRoot(document.getElementById("root")).render(t.jsx(v.StrictMode,{children:t.jsx(me,{})}));
