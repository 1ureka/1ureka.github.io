import{h as k,j as e,r as h,B as o,T as u,A,S as y,o as P,I as D,n as C,w as F}from"./routes-DSS9LKLr.js";import{b as L,n as R}from"./post-FMo2HOjY.js";import{u as I}from"./fuse-SvuQAZ8A.js";import{B as E}from"./NotificationsRounded-D6OdW2xh.js";import{C as S}from"./Chip-CZDJKnuP.js";import{I as M,D as T}from"./ExpandMoreRounded-He5Ma60b.js";const Y=k(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V18c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-1.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05.02.01.03.03.04.04 1.14.83 1.93 1.94 1.93 3.41V18c0 .35-.07.69-.18 1H22c.55 0 1-.45 1-1v-1.5c0-2.33-4.67-3.5-7-3.5"})),U=k(e.jsx("path",{d:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"})),V=({children:a})=>e.jsx(o,{sx:{borderRadius:99,bgcolor:"primary.main",width:"0.9rem",aspectRatio:"1/1",display:"grid",placeItems:"center",mr:.5},children:e.jsx(u,{variant:"caption",sx:{position:"absolute",color:"background.paper",fontSize:"0.6rem"},children:a})}),Z=h.memo(({title:a,hint:l,tags:c,onSelect:t,showAfter:m=1})=>e.jsxs(o,{children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5,justifyContent:"space-between"},children:[e.jsx(u,{variant:"subtitle1",sx:{color:"text.secondary"},children:`${a}:`}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(E,{badgeContent:10,color:"primary",variant:"dot",overlap:"circular",children:e.jsx(o,{sx:{width:0,height:0}})}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:`為${l}`})]})]}),e.jsx(o,{sx:{mt:1.5,display:"flex",flexWrap:"wrap",gap:1.5},children:c.map(({name:i,count:d})=>e.jsx(S,{size:"small",label:i,clickable:!0,onClick:()=>t(i),deleteIcon:e.jsx(V,{children:d}),onDelete:d>m?()=>t(i):void 0},i))})]})),q=()=>e.jsx(o,{sx:{height:300,display:"grid",placeItems:"center"},children:e.jsx(F,{size:"1.5rem",sx:{color:"divider"}})}),H=({type:a,onConfirm:l,onClose:c})=>{const{data:t,isFetching:m}=L(),{data:i,isFetching:d}=R(),x=m||!t||d||!i,[r,g]=h.useState(""),j=I((t==null?void 0:t.map(s=>({...s,count:s.count.toString()})))??[],["name"]),f=I((i==null?void 0:i.map(s=>({...s,count:s.count.toString()})))??[],["name"]),w=h.useMemo(()=>{if(!t)return[];let s=t,p=i??[];r.trim()&&(s=j(r).map(n=>({...n.item,count:Number(n.item.count)})),p=f(r).map(n=>({...n.item,count:Number(n.item.count)})));const B={title:"最近使用的標籤",hint:"你使用過的次數",tags:p,showAfter:0},v=[{title:"A ~ Z",hint:"總使用次數",tags:s.filter(n=>/^[a-zA-Z]/.test(n.name))},{title:"0 ~ 9",hint:"總使用次數",tags:s.filter(n=>/^[0-9]/.test(n.name))},{title:"中文",hint:"總使用次數",tags:s.filter(n=>!/^[a-zA-Z0-9]/.test(n.name))}];return a==="add"?[B,...v]:v},[t,i,a,j,f,r]),b=x||r.trim()===""||a==="query"&&!t.map(({name:s})=>s).includes(r.trim()),z=s=>{b||s.key==="Enter"&&l(r)};return e.jsxs(y,{onKeyDown:z,children:[e.jsx(o,{sx:{p:2,pt:1},children:e.jsx(P,{value:r,onChange:s=>g(s.target.value),disabled:x,size:"small",label:a==="add"?"查詢或新增標籤":"查詢標籤",variant:"standard",fullWidth:!0,autoFocus:!0,slotProps:{input:{endAdornment:e.jsx(M,{position:"end",children:e.jsx(D,{onClick:()=>g(""),disabled:!r,children:e.jsx(U,{})})})}}})}),e.jsx(T,{}),x?e.jsx(q,{}):e.jsx(o,{sx:{maxHeight:300,overflowY:"auto",overflowX:"hidden"},children:e.jsxs(y,{sx:{gap:2,p:2},children:[a==="query"&&e.jsx(S,{label:"全部主題",clickable:!0,onClick:()=>l(null)}),w.map((s,p)=>s.tags.length>0&&e.jsx(Z,{...s,onSelect:l},p))]})}),e.jsx(T,{}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",p:2,gap:1,justifyContent:"flex-end"},children:[e.jsx(C,{size:"small",variant:"outlined",disabled:x,onClick:c,children:"取消"}),e.jsx(C,{size:"small",variant:"contained",disabled:b,onClick:()=>l(r),children:a==="add"?"新增":"前往"})]})]})},G=({type:a,onConfirm:l,onClose:c,...t})=>e.jsx(A,{...t,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},elevation:6,slotProps:{paper:{sx:{borderRadius:2,width:320}}},onClose:c,children:e.jsx(H,{type:a,onConfirm:l,onClose:c})});export{Y as P,G as T};
