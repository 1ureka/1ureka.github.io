import{o as S,j as e,q as d,T as c,B as i,A as ee,D as te,r as v,t as se,y as _,P as ne,z as ie}from"./routes-jbxUH8QT.js";import{S as re,E as P,a as oe,A as ae}from"./ExpandedPost-D21p8KLh.js";import{d as C,a as ce,A as le,S as de}from"./ScrollArea-DiRp_vtc.js";import{u as E,L as xe,T as N,B as me,V as W,P as ue,b as pe,h as z,c as he,F as je,U as H,i as ye,d as ge,e as fe,f as Ie,g as be}from"./PostHeader-s041GrQE.js";import{a as $,j as K,u as ve,c as Ce}from"./CommentRounded-CMvdhNcI.js";import{D as u,C as q}from"./SearchRounded-CrC0lK0i.js";import{S as I,u as A,a as V}from"./forum-C0vRpnmV.js";import{T as k,u as Se}from"./useMutation-vC97ERmO.js";import{S as ke,I as Q}from"./DarkModeRounded-HuAMr60S.js";import{E as we}from"./EmojiMenu-BQZoyxL2.js";import{T as D,a as w}from"./Tabs-xoVJ8fi3.js";import{B as Ee}from"./ButtonGroup-BEnv_69Y.js";import"./ForumRounded-C1zGxzNM.js";import"./NotificationsRounded-eSRFzgjg.js";import"./ExpandMoreRounded-DegD5TrJ.js";const L=S(e.jsx("path",{d:"m11.71 15.29 2.59-2.59c.39-.39.39-1.02 0-1.41L11.71 8.7c-.63-.62-1.71-.18-1.71.71v5.17c0 .9 1.08 1.34 1.71.71"})),R=S(e.jsx("path",{d:"M12.29 8.71 9.7 11.3c-.39.39-.39 1.02 0 1.41l2.59 2.59c.63.63 1.71.18 1.71-.71V9.41c0-.89-1.08-1.33-1.71-.7"})),b={display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",textTransform:"none"},Ae=()=>{const{searchParams:t,updateSearchParams:n}=E(),s=t.get("postId"),r=s&&/^\d+$/.test(s)&&Number(s)>0?Number(s):-1,{data:o,isFetching:a}=$({postId:r-1});return a&&!o?e.jsx(d,{startIcon:e.jsx(R,{}),loading:!0,children:e.jsx(c,{variant:"button",sx:b,children:"載入中..."})}):o?e.jsx(d,{startIcon:e.jsx(R,{}),onClick:()=>n({postId:(r-1).toString()}),children:e.jsxs(c,{variant:"button",sx:b,children:["上一篇：",o.title]})}):e.jsx(d,{startIcon:e.jsx(R,{}),disabled:!0,children:e.jsx(c,{variant:"button",sx:b,children:"沒有上一篇了"})})},Le=()=>{const{searchParams:t,updateSearchParams:n}=E(),s=t.get("postId"),r=s&&/^\d+$/.test(s)&&Number(s)>0?Number(s):-1,{data:o,isFetching:a}=$({postId:r+1});return a&&!o?e.jsx(d,{endIcon:e.jsx(L,{}),loading:!0,children:e.jsx(c,{variant:"button",sx:b,children:"載入中..."})}):o?e.jsx(d,{endIcon:e.jsx(L,{}),onClick:()=>n({postId:(r+1).toString()}),children:e.jsxs(c,{variant:"button",sx:b,children:["下一篇：",o.title]})}):e.jsx(d,{endIcon:e.jsx(L,{}),disabled:!0,children:e.jsx(c,{variant:"button",sx:b,children:"沒有下一篇了"})})},Re=S(e.jsx("path",{d:"m21.41 11.41-8.83-8.83c-.37-.37-.88-.58-1.41-.58H4c-1.1 0-2 .9-2 2v7.17c0 .53.21 1.04.59 1.41l8.83 8.83c.78.78 2.05.78 2.83 0l7.17-7.17c.78-.78.78-2.04-.01-2.83M6.5 8C5.67 8 5 7.33 5 6.5S5.67 5 6.5 5 8 5.67 8 6.5 7.33 8 6.5 8"})),Be=t=>Array.from({length:t},()=>Math.random()*.7+.3),Ne=()=>e.jsxs(i,{sx:{pt:1.5},children:[e.jsx(u,{}),e.jsxs(i,{sx:{position:"relative",py:1.5,height:"fit-content"},children:[e.jsx(i,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35,pointerEvents:"none"}}),e.jsx(i,{sx:{px:2.5},children:e.jsx(xe,{sx:{m:0}})})]}),e.jsx(u,{sx:{mb:2.5}}),e.jsxs(i,{sx:{px:2.5,position:"relative"},children:[e.jsx(I,{variant:"rounded",animation:"wave",sx:{mb:1},children:e.jsx(c,{variant:"h4",component:"h2",sx:{textAlign:"start"},gutterBottom:!0,children:"正在載入標題... 正在載入"})}),Be(4).map((t,n)=>e.jsx(I,{variant:"text",animation:"wave",width:`${t*100}%`},n)),e.jsx(ee,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}),e.jsx(u,{sx:{mt:2.5}}),e.jsxs(i,{sx:{p:1.5,py:1,display:"flex",gap:1.5,alignItems:"center",position:"relative",color:"text.secondary"},children:[e.jsx(i,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),e.jsx(d,{color:"inherit",startIcon:e.jsx(N,{}),size:"small",loading:!0,children:e.jsx(c,{variant:"caption",component:"span",children:"100 個讚"})}),e.jsx(d,{color:"inherit",startIcon:e.jsx(me,{}),size:"small",loading:!0,children:e.jsx(c,{variant:"caption",component:"span",children:"收藏該貼文"})}),e.jsx(i,{sx:{flex:1}}),e.jsx(d,{color:"inherit",startIcon:e.jsx(W,{}),size:"small",loading:!0,children:e.jsx(c,{variant:"caption",component:"span",children:"1000 次瀏覽"})})]}),e.jsx(u,{})]}),$e=({post:t})=>e.jsxs(i,{sx:{pt:1.5},children:[e.jsx("title",{children:`論壇樣板 | ${t.title}`}),e.jsx(u,{}),e.jsxs(i,{sx:{position:"relative",py:1.5,height:"fit-content"},children:[e.jsx(i,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35,pointerEvents:"none"}}),e.jsx(i,{sx:{px:2.5},children:e.jsx(ue,{post:t,sx:{m:0}})})]}),e.jsx(u,{sx:{mb:2.5}}),e.jsxs(i,{sx:{px:2.5},children:[e.jsx(c,{variant:"h4",component:"h2",sx:{textAlign:"start"},gutterBottom:!0,children:t.title}),e.jsx(c,{variant:"body2",component:"p",sx:{whiteSpace:"pre-line"},children:t.content}),t.photos&&t.photos.length>0&&e.jsx(i,{sx:{display:"grid",gap:1,mt:2,gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))"},children:t.photos.map(({name:n,url:s},r)=>e.jsx(k,{title:"查看圖片",arrow:!0,placement:"top",children:e.jsx(te,{sx:{position:"relative",aspectRatio:"1 / 1",bgcolor:"divider",borderRadius:1,overflow:"hidden"},children:e.jsx(i,{sx:{position:"absolute",inset:"auto 0 0 0",pb:1,display:"grid",placeItems:"center"},children:e.jsx(i,{sx:{maxWidth:150},children:e.jsx(q,{label:n,size:"small"})})})})},`${s}${r}`))}),e.jsxs(ke,{sx:{gap:1.5,flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap-reverse",mt:2},children:[e.jsxs(i,{sx:{display:"flex",gap:1.5,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(c,{variant:"subtitle2",sx:{color:"text.secondary",display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Re,{fontSize:"small"}),"標籤："]}),e.jsx(pe,{post:t,displayCount:99})]}),t.attachments&&t.attachments.length>0&&e.jsxs(i,{sx:{display:"flex",gap:1,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(c,{variant:"subtitle2",sx:{color:"text.secondary",display:"flex",alignItems:"center",gap:.5},children:[e.jsx(z,{fontSize:"small"}),"附件："]}),t.attachments.map((n,s)=>e.jsx(k,{title:"下載附件",arrow:!0,placement:"top",children:e.jsx(q,{label:`${n.name} (${(n.size/1024).toFixed(1)}KB)`,clickable:!0,icon:e.jsx(z,{fontSize:"small"})})},s))]})]})]}),e.jsx(u,{sx:{mt:2.5}}),e.jsxs(i,{sx:{px:2.5,py:1,display:"flex",gap:1.5,alignItems:"center",position:"relative",color:"text.secondary"},children:[e.jsx(i,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),e.jsx(he,{postId:t.id,likeCount:t.likeCount}),e.jsx(je,{postId:t.id}),e.jsx(i,{sx:{flex:1}}),e.jsx(d,{startIcon:e.jsx(W,{}),disabled:!0,size:"small",sx:{"button&.Mui-disabled":{color:"text.secondary",opacity:.8}},children:e.jsxs(c,{variant:"caption",component:"span",children:[t.viewCount," 次瀏覽"]})})]}),e.jsx(u,{flexItem:!0})]}),U=async t=>{const n=t.postId!==void 0,s=n?"c.postId = $id AND c.parentId IS NULL":"c.parentId = $id",o=(t.orderBy||"latest")==="latest"?"datetime(c.createdAt) DESC":"COALESCE(cic.likeCount, 0) DESC, datetime(c.createdAt) DESC",a=`
      SELECT c.id FROM comments c
      LEFT JOIN comment_interaction_counts cic ON c.id = cic.commentId
      WHERE ${s} ORDER BY ${o}
    `,l={$id:n?t.postId:t.parentId};return(await C.exec(a,l)).map(x=>x.id)},Fe=async({commentId:t})=>{const s=await C.exec(`
      SELECT
        c.id,
        c.postId,
        c.parentId,
        c.content,
        c.userId,
        u.name as userName,
        COALESCE(cic.likeCount, 0) as likeCount,
        c.createdAt,
        c.updatedAt
      FROM
        comments c
      JOIN
        users u ON c.userId = u.id
      LEFT JOIN
        comment_interaction_counts cic ON c.id = cic.commentId
      WHERE
        c.id = $commentId
    `,{$commentId:t});if(s.length===0)return null;const r=s[0];return{...r,id:r.id,postId:r.postId,parentId:r.parentId,content:r.content,userId:r.userId,userName:r.userName,likeCount:r.likeCount,createdAt:new Date(r.createdAt),updatedAt:new Date(r.updatedAt)}},F=1e3*60*1,Te=({postId:t,orderBy:n})=>A({queryKey:["commentsByPost",t,n],queryFn:()=>U({postId:t,orderBy:n}),staleTime:F}),J=t=>A({queryKey:["commentsByParent",t],queryFn:()=>U({parentId:t,orderBy:"latest"}),staleTime:F}),Pe=t=>A({queryKey:["comment",t],queryFn:()=>Fe({commentId:t}),staleTime:F}),G=S(e.jsx("path",{d:"M10 9V7.41c0-.89-1.08-1.34-1.71-.71L3.7 11.29c-.39.39-.39 1.02 0 1.41l4.59 4.59c.63.63 1.71.19 1.71-.7V14.9c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"})),Y=S(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),O=S(e.jsx("path",{d:"M8.12 9.29 12 13.17l3.88-3.88c.39-.39 1.02-.39 1.41 0s.39 1.02 0 1.41l-4.59 4.59c-.39.39-1.02.39-1.41 0L6.7 10.7a.996.996 0 0 1 0-1.41c.39-.38 1.03-.39 1.42 0"})),B=({sx:t,onCancel:n,...s})=>{const{user:r,authenticated:o,loading:a}=K(),l=v.useRef(null),[p,x]=v.useState(""),j=m=>{x(h=>{const y=l.current;if(y){const f=y.selectionStart||0,g=y.selectionEnd||0,Z=h.substring(0,f)+m+h.substring(g);return setTimeout(()=>{y.focus(),y.setSelectionRange(f+m.length,f+m.length)},0),Z}return h+m})};return e.jsx(i,{sx:{position:"relative",py:1,px:2,...t},...s,children:e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[o&&r?e.jsx(H,{name:r.name,sx:{mt:1.5}}):e.jsx(ye,{sx:{width:"2rem",height:"2rem",mt:1.5}}),e.jsxs(i,{sx:{flex:1},component:"form",children:[e.jsx(se,{inputRef:l,variant:"standard",size:"small",name:"comment",label:o?"發表你的想法":"登入後即可發表留言",fullWidth:!0,type:"text",value:p,onChange:m=>x(m.target.value),disabled:!o||a}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mt:1,alignItems:"center",gap:1},children:[e.jsx(we,{onEmojiClick:j,disabled:!o||a}),e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(d,{size:"small",disabled:!o||a,sx:{color:"text.secondary"},onClick:()=>{x(""),n!==void 0&&n()},children:"取消"}),e.jsx(d,{size:"small",disabled:!o||a||p.trim().length===0,variant:"contained",children:"留言"})]})]})]})]})})},ze=async({commentId:t,userId:n})=>{const s=`
      SELECT 1 as liked
      FROM comment_interactions
      WHERE commentId = $commentId
        AND userId = $userId
        AND type = 'like'
      LIMIT 1
    `,r=`
      SELECT COALESCE(likeCount, 0) as likeCount
      FROM comment_interaction_counts
      WHERE commentId = $commentId
    `,o=await C.exec(s,{$commentId:t,$userId:n}),a=await C.exec(r,{$commentId:t}),l=o.length>0;return!a[0]||!Number.isInteger(a[0].likeCount)?null:{liked:l,likeCount:a[0].likeCount}},qe=async({commentId:t,userId:n,type:s,value:r})=>{r?await C.exec(`
        INSERT OR IGNORE INTO comment_interactions (userId, commentId, type)
        VALUES ($userId, $commentId, $type)
      `,{$userId:n,$commentId:t,$type:s}):await C.exec(`
        DELETE FROM comment_interactions
        WHERE userId = $userId
          AND commentId = $commentId
          AND type = $type
      `,{$userId:n,$commentId:t,$type:s})},De=0,Oe=(t,n,s)=>{const r=V(),o=v.useRef(0);return Se({mutationFn:a=>{if(n===void 0)throw new Error("未登入");return qe({commentId:t,userId:n,type:s,value:a})},onMutate:()=>(o.current++,o.current),onSettled:(a,l,p,x)=>{if(x===o.current){const j=["commentLikeStatus",t,n];r.invalidateQueries({queryKey:j})}},onError:()=>{console.error("評論按讚操作失敗")}})},Me=t=>{const n=V(),{user:s,authenticated:r,loading:o}=K(),{data:a,isLoading:l}=A({staleTime:De,queryKey:["commentLikeStatus",t,s==null?void 0:s.id],enabled:!o&&r&&(s==null?void 0:s.id)!==void 0,queryFn:async()=>ze({commentId:t,userId:s.id})}),p=o||l,x=!r||p||a===void 0||a===null,j=(a==null?void 0:a.liked)??!1,m=(a==null?void 0:a.likeCount)??null,{mutate:h}=Oe(t,s==null?void 0:s.id,"like");return{liked:j,likeCount:m,handleLike:async()=>{x||(await n.cancelQueries({queryKey:["commentLikeStatus",t,s.id]}),n.setQueryData(["commentLikeStatus",t,s.id],f=>{const g=!f.liked;return h(g),{liked:g,likeCount:f.likeCount+(g?1:-1)}}))},disabled:x,loading:p}},_e=({commentId:t,likeCount:n})=>{const{liked:s,likeCount:r,handleLike:o,disabled:a,loading:l}=Me(t);return e.jsx(d,{size:"small",startIcon:e.jsx(N,{}),onClick:o,color:s?"primary":"inherit",sx:{color:s?void 0:"text.secondary"},disabled:a,loading:l,children:e.jsx(c,{variant:"caption",children:r!==null?r>0?r:"讚":n})})},X=({commentId:t,nestedLevel:n,sx:s,...r})=>{if(n<0)throw new Error("nestedLevel must be greater than 0");const{data:o,isFetching:a}=Pe(t),{data:l,isFetching:p}=J(t),[x,j]=v.useState(!1),m=()=>j(g=>!g),[h,y]=v.useState(!1),f=()=>y(g=>!g);return a||!o||p?e.jsx(T,{nestedLevel:n,sx:s,...r}):e.jsx(i,{sx:{position:"relative",py:1,pb:n>0?0:1,pl:2,borderLeft:n>0?"2px solid":"none",borderColor:"divider",...s},...r,children:e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[e.jsx(H,{name:o.userName,sx:{mt:1}}),e.jsxs(i,{sx:{flex:1},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(c,{variant:"subtitle2",component:"a",sx:{"&:hover":{textDecoration:"underline"},color:"text.primary"},href:`${_.forum_users}?user=${o.userName}`,children:o.userName}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(c,{variant:"caption",color:"text.secondary",children:o.createdAt.toLocaleString()}),o.createdAt.getTime()!==o.updatedAt.getTime()&&e.jsx(k,{title:`最後編輯於 ${o.updatedAt.toLocaleString()}`,arrow:!0,children:e.jsx(c,{variant:"caption",color:"text.secondary",children:"(已編輯)"})}),e.jsx(k,{title:"更多選項",arrow:!0,children:e.jsx(Q,{size:"small",children:e.jsx(Y,{fontSize:"small"})})})]})]}),e.jsx(c,{variant:"body2",sx:{mt:.5,whiteSpace:"pre-line"},children:o.content}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[e.jsx(_e,{commentId:t,likeCount:o.likeCount}),e.jsx(d,{size:"small",startIcon:e.jsx(G,{}),sx:{color:"text.secondary"},onClick:f,children:e.jsx(c,{variant:"caption",children:h?"取消回覆":"回覆"})})]}),h&&e.jsx(B,{onCancel:()=>y(!1)}),l&&l.length>0&&e.jsx(d,{startIcon:x?e.jsx(O,{sx:{transform:"rotate(180deg)",transition:"transform 0.2s ease",transformOrigin:"center"}}):e.jsx(O,{}),sx:{mt:1},size:"small",onClick:m,children:x?"隱藏回覆":`顯示 ${l.length||0} 則回覆`}),x&&l&&e.jsx(We,{commentId:t})]})]})})},T=({nestedLevel:t,sx:n,...s})=>e.jsx(i,{sx:{position:"relative",py:1,pb:t>0?0:1,pl:2,borderLeft:t>0?"2px solid":"none",borderColor:"divider",...n},...s,children:e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[e.jsx(I,{variant:"circular",width:"2rem",height:"2rem",sx:{mt:1},animation:"wave"}),e.jsxs(i,{sx:{flex:1},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(I,{variant:"rounded",animation:"wave",children:e.jsx(c,{variant:"subtitle2",component:"span",children:"載入名稱中..."})}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(I,{variant:"rounded",animation:"wave",children:e.jsx(c,{variant:"caption",color:"text.secondary",children:"0000-00-00 00:00:00"})}),e.jsx(k,{title:"更多選項",arrow:!0,children:e.jsx("span",{children:e.jsx(Q,{size:"small",disabled:!0,children:e.jsx(Y,{fontSize:"small"})})})})]})]}),e.jsx(I,{variant:"rounded",animation:"wave",children:e.jsx(c,{variant:"body2",sx:{mt:.5,whiteSpace:"pre-line"},children:"佔位文字，佔位文字，佔位文字，佔位文字，佔位文字，佔位文字，"})}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[e.jsx(d,{size:"small",startIcon:e.jsx(N,{}),sx:{color:"text.secondary"},loading:!0,children:e.jsx(c,{variant:"caption",children:"讚"})}),e.jsx(d,{size:"small",startIcon:e.jsx(G,{}),sx:{color:"text.secondary"},loading:!0,children:e.jsx(c,{variant:"caption",children:"回覆"})})]})]})]})}),We=({commentId:t})=>{const{data:n,isFetching:s}=J(t);return s?e.jsx(i,{children:[...Array(1)].map((r,o)=>e.jsx(T,{nestedLevel:1},o))}):n?e.jsx(i,{children:n.map(r=>e.jsx(X,{commentId:r,nestedLevel:1},r))}):null},M={content:'""',display:"block",position:"absolute",inset:0,bgcolor:"divider",opacity:.2,pointerEvents:"none",mr:-2},He=({totalComments:t})=>{const{searchParams:n,updateSearchParams:s}=E(),r=n.get("postId"),o=r&&/^\d+$/.test(r)&&Number(r)>0?Number(r):-1,l=(n.get("orderBy")||"latest")==="likes"?"likes":"latest",{data:p,isFetching:x}=Te({postId:o,orderBy:l}),j=(m,h)=>{s({orderBy:h===0?"latest":"likes"})};return x?e.jsxs(e.Fragment,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(I,{variant:"rounded",animation:"wave",sx:{mx:2},children:e.jsx(c,{variant:"subtitle1",component:"h3",children:"0 則留言"})}),e.jsx(u,{flexItem:!0,orientation:"vertical",variant:"middle"}),e.jsxs(D,{value:l==="latest"?0:1,onChange:j,children:[e.jsx(w,{label:"最新",disabled:!0}),e.jsx(w,{label:"最多人按讚",disabled:!0})]})]}),e.jsx(u,{}),e.jsx(i,{sx:{pr:2,"& > .comment:nth-of-type(odd):before":M},children:[...Array(3)].map((m,h)=>e.jsx(T,{nestedLevel:0,className:"comment"},h))})]}):!p||p.length===0?e.jsxs(e.Fragment,{children:[e.jsx(i,{sx:{pr:2},children:e.jsx(B,{})}),e.jsx(i,{sx:{pb:2},children:e.jsx(c,{variant:"body2",sx:{color:"text.secondary",textAlign:"center",mt:2},children:"還沒有留言，快來發表你的看法吧！"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsxs(c,{variant:"subtitle1",component:"h3",sx:{px:2},children:[t," 則留言"]}),e.jsx(u,{flexItem:!0,orientation:"vertical",variant:"middle"}),e.jsxs(D,{value:l==="latest"?0:1,onChange:j,children:[e.jsx(w,{label:"最新"}),e.jsx(w,{label:"最多人按讚"})]})]}),e.jsx(u,{}),e.jsxs(i,{sx:{pr:2,"& > .comment:nth-of-type(odd):before":M},children:[e.jsx(B,{className:"comment"}),p.map(m=>e.jsx(X,{commentId:m,nestedLevel:0,className:"comment"},m))]})]})},Ke=()=>{const{data:t,isFetching:n}=ve({limit:2,orderBy:"likeCount",order:"desc"});return n||!t?e.jsxs(i,{children:[e.jsx(P,{}),e.jsx(P,{})]}):e.jsx(i,{children:t.map(s=>e.jsx(oe,{postId:s},s))})},Ve=()=>{const{searchParams:t}=E(),n=t.get("postId"),s=n&&/^\d+$/.test(n)&&Number(n)>0?Number(n):-1,{data:r,isFetching:o}=$({postId:s,incrementViewCount:!0});return o&&!r?e.jsx(Ne,{}):r?e.jsxs(e.Fragment,{children:[e.jsx($e,{post:r}),e.jsx(He,{totalComments:r.commentCount})]}):e.jsxs(i,{sx:{pt:1.5},children:[e.jsx(u,{}),e.jsxs(i,{sx:{py:6,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[e.jsx(re,{sx:{fontSize:"6rem",color:"action.disabled"}}),e.jsx(c,{variant:"body1",component:"p",sx:{color:"text.secondary",textAlign:"center"},children:"貼文不存在或已被刪除"})]}),e.jsx(u,{}),e.jsxs(i,{sx:{position:"relative"},children:[e.jsx(i,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),e.jsx(c,{variant:"h6",sx:{p:2},children:"我們找不到這篇貼文...但你可能會喜歡這些！"})]}),e.jsx(u,{}),e.jsx(Ke,{})]})};function Qe(){const{isMd:t}=ce();return e.jsxs(le,{children:[e.jsx(ge,{}),e.jsxs(de,{children:[t?e.jsx(fe,{}):e.jsx(Ie,{}),e.jsx(Ce,{maxWidth:"lg",sx:{position:"relative",my:10,px:0},children:e.jsxs(ne,{sx:{pb:3,borderRadius:3,border:"1px solid",borderColor:"divider"},elevation:1,children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"center",mt:2,mx:2},children:[e.jsx(d,{href:_.forum_home,startIcon:e.jsx(ae,{}),variant:"outlined",sx:{textWrap:"nowrap"},children:t?"返回首頁":"首頁"}),e.jsx(i,{sx:{flex:1}}),e.jsxs(Ee,{variant:"text",children:[e.jsx(Ae,{}),e.jsx(Le,{})]})]}),e.jsx(Ve,{})]})}),e.jsx(be,{})]})]})}ie.createRoot(document.getElementById("root")).render(e.jsx(v.StrictMode,{children:e.jsx(Qe,{})}));
