import{j as e,r as g,S as y,B as t,T as m,w as I,ar as b,al as T,y as H,A as _,M as q,h as W,l as K,n as U,t as X,ac as Y}from"./routes-DSS9LKLr.js";import{a as G}from"./ArrowDropDownRounded-C-bqklcR.js";import{u as J,n as A,s as j,c as w,a as L,t as Q,m as Z,b as ee,d as te,l as O}from"./main-CPn0Bo9Z.js";import{T as C,a as se,b as S}from"./TileText-DpHzd1YR.js";import{S as M}from"./Skeleton-DNNkVTV4.js";import{M as k}from"./MenuItem-DAsKIElH.js";import{C as re}from"./Chip-CZDJKnuP.js";import{a as oe,b as ne,i as ae,M as ie,T as le,B as ce,g as de}from"./style-DRZZNKOB.js";import{b as pe}from"./formatters-C9bWSe0O.js";import{F as xe,S as he}from"./Switch-Cy6kNsQh.js";import"./RefreshRounded-Cbc-M9dA.js";import"./SQLiteClient-CAvm5Amv.js";import"./DataExplorationRounded-BB4c2e-V.js";import"./NotificationsRounded-D6OdW2xh.js";import"./ExpandMoreRounded-He5Ma60b.js";import"./DarkModeRounded-Dwbm1YBu.js";import"./fuse-SvuQAZ8A.js";import"./useMutation-52fvlAR0.js";import"./dayjs.min-DumrRsId.js";import"./Tooltip-4_5Bwrwa.js";import"./DownloadRounded-COxy94Ud.js";import"./DatasetRounded-j-QIoIvE.js";import"./with-selector-DgkZje48.js";import"./SwitchBase-IYU4KGFu.js";function B(r){if(!r)return;const x=r.match(/^([a-z]+)(?:\.(\w+))?$/);if(x){const[,o,c]=x,u=["--mui-palette",o];return c&&u.push(c),`var(${u.join("-")})`}return r}const E=({color1:r="white",color2:x="transparent",angle:o=45,stripeWidth:c=10,backgroundSize:u,zIndex:i=0,className:n="",style:s={}})=>{const a=B(r),d=B(x),h=u??c*2,l=`repeating-linear-gradient(
    ${o}deg,
    ${a},
    ${a} ${c}px,
    ${d} ${c}px,
    ${d} ${h}px
  )`;return e.jsx("div",{className:n,style:{position:"absolute",inset:0,zIndex:i,background:l,pointerEvents:"none",...s}})},ue=({value:r,onClick:x})=>{const[o,c]=g.useState(null),u=s=>c(a=>a?null:s.currentTarget),i=()=>c(null),n=s=>()=>{x(s),i()};return e.jsxs(t,{sx:{display:"flex",gap:j,justifyContent:"space-between",alignItems:"center",p:j},children:[e.jsx(m,{variant:"h5",component:"h3",children:"紀錄數"}),e.jsxs(H,{sx:{"&:hover":{bgcolor:"action.hover"},p:1,pr:0,borderRadius:1},onClick:u,children:[e.jsxs(m,{sx:{color:"text.secondary"},children:["前 ",r," 筆"]}),e.jsx(G,{sx:{color:"text.secondary"}})]}),e.jsx(_,{anchorEl:o,anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"},open:!!o,onClose:i,children:e.jsxs(q,{dense:!0,children:[e.jsx(k,{onClick:n(3),selected:r===3,children:"前 3 筆"}),e.jsx(k,{onClick:n(5),selected:r===5,children:"前 5 筆"}),e.jsx(k,{onClick:n(7),selected:r===7,children:"前 7 筆"})]})})]})},me=(r,x)=>{if(r===null)return{dataArray:[...Array(x)].map((l,p)=>({label:"載入中"+p,records:0,percentage:0,loading:!0,noData:!1})),averageAmount:0,averagePercentages:0};const o=Object.entries(r).sort(([,l],[,p])=>p-l).slice(0,x),c=o.map(([l])=>l),u=o.map(([,l])=>l),i=1.75,n=Object.values(u).reduce((l,p)=>l+p,0),s=Math.round(n/x),a=Math.round(s/n*100*i),d=u.map(l=>Math.round(l/n*100*i)),h=c.map((l,p)=>({label:l,records:u[p],percentage:d[p],loading:!1,noData:!1}));if(h.length<x){const l=[...Array(x-h.length)].map(()=>({label:"",records:0,percentage:0,loading:!1,noData:!0}));return{dataArray:[...h,...l],averageAmount:s,averagePercentages:a}}return{dataArray:h,averageAmount:s,averagePercentages:a}},je=()=>{const[r,x]=g.useState(5),{data:o,isFetching:c}=J({types:["table","view"]}),{dataArray:u,averageAmount:i,averagePercentages:n}=me(c?null:o??null,r);return e.jsxs(y,{sx:{aspectRatio:{xs:"2/1",ml:"2/1.2"},borderTop:"1px solid",borderColor:"divider"},children:[e.jsx(ue,{value:r,onClick:x}),e.jsxs(t,{sx:{position:"relative",flex:1,display:"flex",gap:j,p:j,py:A,justifyContent:"space-around",alignItems:"stretch"},children:[u.map(({label:s,records:a,percentage:d,loading:h,noData:l},p)=>e.jsx(C,{title:h||l?null:e.jsxs(t,{children:[e.jsx(m,{variant:"subtitle2",children:s}),e.jsxs(m,{children:[a," 筆紀錄"]})]}),children:e.jsxs(t,{sx:{position:"relative",flex:1,borderRadius:2,overflow:"clip",transition:"all 0.2s ease-in-out","&:hover":{bgcolor:"action.hover","& .bar-content":{opacity:1}}},children:[e.jsx(E,{color1:"divider",color2:"#fff0",angle:-20,stripeWidth:5}),e.jsx(t,{sx:{position:"absolute",inset:`${h||l?100:Math.max(0,100-d)}% 0 0 0`,borderRadius:2,overflow:"hidden",bgcolor:"background.paper",transition:w},children:e.jsx(t,{className:"bar-content",sx:{position:"absolute",inset:0,bgcolor:"primary.main",opacity:p===0?.9:.65,transition:"all 0.2s ease-in-out"}})})]})},p)),e.jsx(t,{sx:{position:"absolute",inset:`0 0 ${c?0:n}% 0`,borderBottom:"4px dashed",borderColor:"divider",pointerEvents:"none",mx:j,scale:"1.02 1",transition:w,"&:before":{content:`"平均 ${c?0:i} 筆"`,position:"absolute",right:0,bottom:0,fontSize:"1rem",color:"text.secondary",opacity:.75}}}),c&&e.jsx(t,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center",pointerEvents:"none"},children:e.jsx(I,{})})]}),e.jsx(t,{sx:{display:"flex",gap:j,p:j,justifyContent:"space-around",alignItems:"center"},children:u.map(({label:s,loading:a,noData:d},h)=>a?e.jsx(M,{variant:"rounded",animation:"wave",children:e.jsx(m,{variant:"body1",component:"p",sx:{flex:1,textAlign:"center"},children:"載入中"})},h):d?e.jsx(m,{variant:"body1",component:"p",sx:{flex:1,color:"text.secondary",...b,textAlign:"center"},children:"---"},h):e.jsx(C,{title:e.jsx(m,{children:s}),children:e.jsx(m,{variant:"body1",component:"p",sx:{flex:1,color:"text.secondary",...T,...b,textAlign:"center"},children:s})},h))})]})},ge=W([e.jsx("path",{d:"M3 6c-.55 0-1 .45-1 1v13c0 1.1.9 2 2 2h13c.55 0 1-.45 1-1s-.45-1-1-1H4V7c0-.55-.45-1-1-1"},"0"),e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-3.54 12.01-.63-1.82H12.2l-.65 1.82c-.1.29-.38.48-.68.48-.51 0-.86-.51-.68-.98l2.73-7.27c.16-.44.6-.74 1.08-.74s.92.3 1.09.75l2.73 7.27c.18.47-.17.98-.68.98-.31 0-.58-.19-.68-.49"},"1"),e.jsx("path",{d:"m13.96 7.17-1.31 3.72h2.69l-1.3-3.72z"},"2")]),D=({children:r,loading:x,...o})=>x?e.jsx(M,{variant:"rounded",animation:"wave",...o,children:r}):r,fe=()=>{const{data:r,isFetching:x}=L({types:["table","view"]}),o=g.useMemo(()=>{if(!r||x)return null;const n={};let s=0;r.forEach(({columns:l})=>{l.forEach(({type:p})=>{n[p]=(n[p]||0)+1,s+=1})});const a=[],d=new Set;let h=0;for(const[l,p]of Object.entries(n).sort((f,v)=>v[1]-f[1])){const f=p/s;a.length<3||f>=.1?a.push([l,p]):(h+=p,d.add(l))}if(h>0){const l=Array.from(d).slice(0,5),p=l.join(", ")+(l.length>5?", ...":"");a.push([`其他 (${p})`,h])}return a.map(([l,p])=>({type:l,count:p,percentage:p/s}))},[r,x]),c=o===null,u=!c&&o.length<3,i=!c&&!u;return e.jsxs(y,{sx:{aspectRatio:{xs:"2/1",ml:"2/1.2"},borderTop:"1px solid",borderColor:"divider",position:"relative"},children:[e.jsxs(t,{sx:{display:"flex",gap:j,justifyContent:"space-between",alignItems:"flex-start",p:j},children:[e.jsxs(y,{sx:{gap:1},children:[e.jsx(se,{children:"最常使用的型別"}),e.jsx(D,{loading:c,children:e.jsx(S,{variant:"h4",sx:{textTransform:"uppercase"},children:c?"載入中":u?"N/A":o[0].type})})]}),e.jsx(ge,{sx:{...Q,mt:.5}})]}),e.jsxs(t,{sx:{flex:1,position:"relative"},children:[e.jsxs(t,{sx:{position:"absolute",inset:"auto 0 0 0",p:1.5,borderRadius:9,overflow:"clip"},children:[e.jsx(E,{color1:"divider",color2:"#fff0",angle:-35,stripeWidth:4}),i&&e.jsx(t,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"stretch",zIndex:1},children:o.map(({type:n,count:s,percentage:a},d)=>e.jsx(C,{title:e.jsxs(S,{variant:"body1",sx:{textTransform:"uppercase"},children:[n," 型別使用了 ",s," 次"]}),children:e.jsx(t,{sx:{width:a,"&:hover":{bgcolor:"divider"},opacity:.9,transition:"all 0.2s ease-in-out"}})},d))})]}),e.jsx(t,{sx:{position:"absolute",inset:"auto 0 0 0",my:1.5,display:"grid",placeItems:"center"},children:e.jsx(t,{sx:{position:"absolute",width:1,display:"flex",alignItems:"center",scale:i?"1 1":"0 1",opacity:i?1:0,transition:w},children:i&&o.map(({percentage:n},s)=>e.jsx(t,{sx:{width:n,px:.5,pl:s===0?1:.5,pr:s===o.length-1?1:.5},children:e.jsx(t,{sx:{py:.5,borderRadius:9,bgcolor:"primary.main",filter:`hue-rotate(-${s*30+10}deg)`}})},s))})}),e.jsx(t,{sx:{position:"absolute",inset:0,display:"flex",transformOrigin:"left",scale:i?"1 1":"1 0",transition:w},children:i&&o.map(({type:n,percentage:s},a)=>e.jsx(t,{sx:{width:s,height:1,position:"relative"},children:e.jsx(t,{sx:{position:"absolute",inset:0,ml:a===0?1:0,mb:3,borderLeft:4,borderColor:"divider"},children:e.jsxs(t,{sx:{position:"absolute",inset:"0 auto auto 0"},children:[e.jsx(m,{variant:"body2",sx:{textTransform:"uppercase",color:"text.secondary",ml:1,...b},children:n}),e.jsxs(S,{sx:{textTransform:"uppercase",opacity:.8,ml:1},children:[Math.round(s*100),"%"]})]})})},a))}),c&&e.jsx(t,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center",pointerEvents:"none"},children:e.jsx(I,{})}),u&&e.jsx(t,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center",pointerEvents:"none"},children:e.jsx(re,{sx:{p:3,borderRadius:99},label:e.jsx(m,{variant:"h6",component:"p",sx:{color:"text.secondary"},children:"資料不足"})})})]}),e.jsx(t,{sx:{display:"flex",gap:Z,p:j,alignItems:"center",justifyContent:"space-around",width:"fit-content",minWidth:.5},children:i?o.map(({type:n},s)=>e.jsxs(t,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(t,{sx:{borderRadius:99,width:"1rem",height:"1rem",bgcolor:"primary.main",filter:`hue-rotate(-${s*30+10}deg)`}}),e.jsx(m,{variant:"body1",component:"p",sx:{color:"text.secondary",textTransform:"uppercase",...b},children:n})]},s)):[...Array(3)].map((n,s)=>e.jsxs(t,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(t,{sx:{borderRadius:99,width:"1rem",height:"1rem",bgcolor:"primary.main",filter:`hue-rotate(-${s*30+10}deg)`}}),e.jsx(D,{loading:!0,children:e.jsx(m,{variant:"body1",component:"p",children:"載入中"})})]},s))})]})},be=W(e.jsx("path",{d:"M6 7c0 .55.45 1 1 1h7.59l-8.88 8.88c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0L16 9.41V17c0 .55.45 1 1 1s1-.45 1-1V7c0-.55-.45-1-1-1H7c-.55 0-1 .45-1 1"})),ye={tableNode:le};function ve({nodes:r,edges:x,isFetching:o}){const{mode:c}=K(),[u,i]=g.useState(r),[n,s]=g.useState(x),[a,d]=g.useState(!1);g.useEffect(()=>{if(a)return;let p,f=0;const v=R=>{if(R-f<200){p=requestAnimationFrame(v);return}if(f=R,!u.every(F=>{var $,z;return(($=F.measured)==null?void 0:$.width)&&((z=F.measured)==null?void 0:z.height)})){p=requestAnimationFrame(v);return}const{nodes:P,edges:V}=de(u,n,"horizontal");i(P),s(V),d(!0)};return p=requestAnimationFrame(v),()=>cancelAnimationFrame(p)},[u,n,a]),g.useEffect(()=>{o||(i(r),s(x),d(!1))},[r,x,o]);const h=g.useCallback(p=>i(f=>oe(p,f)),[i]),l=g.useCallback(p=>s(f=>ne(p,f)),[s]);return e.jsxs(e.Fragment,{children:[e.jsx(t,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center",bgcolor:"action.hover"},children:e.jsx(I,{})}),e.jsx(ae,{nodes:u,nodeTypes:ye,edges:n,onNodesChange:h,onEdgesChange:l,deleteKeyCode:null,colorMode:c,defaultViewport:{x:10,y:10,zoom:.7},defaultEdgeOptions:{type:"smoothstep",animated:!0,selectable:!1,style:{strokeWidth:2,stroke:"#b1b1b7"},markerEnd:{type:ie.Arrow,width:20,height:20}},style:{position:"relative",opacity:!a||o?0:1,transition:!a||o?void 0:"opacity 0.5s ease",background:"var(--mui-palette-background-paper)"},nodesDraggable:!1,nodesConnectable:!1,nodesFocusable:!1,panOnDrag:!1,panOnScroll:!1,zoomOnPinch:!1,zoomOnDoubleClick:!1,zoomOnScroll:!1,children:e.jsx(ce,{bgColor:"var(--mui-palette-action-hover)"})})]})}const we=g.memo(ve),Ce=()=>{const{updatePath:r}=ee(),x=()=>r(X.datahub_schema),{nodes:o,edges:c,isFetching:u}=te(),i=g.useMemo(()=>o.map(n=>({id:n.tableName,type:"tableNode",data:n,position:{x:0,y:0}})),[o]);return e.jsxs(y,{sx:{aspectRatio:{xs:"2/1",ml:"2/1.2"},borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(t,{sx:{display:"flex",gap:j,alignItems:"flex-end",p:j},children:[e.jsx(m,{variant:"h5",component:"h3",sx:{textWrap:"noWrap"},children:"資料表關聯圖"}),e.jsx(m,{variant:"body1",sx:{opacity:.8,...b},children:"透過視覺化的節點與連線，探索資料表彼此的結構與關聯。"})]}),e.jsx(t,{sx:{flex:1,width:1,position:"relative"},children:e.jsx(t,{sx:{position:"absolute",inset:0,p:j,pt:A},children:e.jsxs(t,{sx:{position:"relative",width:1,height:1,borderRadius:3,border:3,borderColor:"divider",borderStyle:"dashed"},children:[e.jsxs(t,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center"},children:[e.jsx(t,{sx:{position:"absolute",inset:0,zIndex:1}}),e.jsx(we,{nodes:i,edges:c,isFetching:u})]}),e.jsx(t,{sx:{position:"absolute",inset:"auto 0 0 auto",color:"secondary.dark",translate:"1rem 50%",zIndex:2},children:e.jsx(U,{color:"inherit",size:"large",variant:"outlined",onClick:x,endIcon:e.jsx(be,{}),sx:{"&:hover":{scale:"1.02"},scale:"1.001",transition:"all 0.2s ease-in-out",bgcolor:"background.paper"},children:"查看完整關聯圖"})})]})})})]})},N=({children:r,loading:x,...o})=>x?e.jsx(M,{variant:"rounded",animation:"wave",...o,children:r}):r,Ie=r=>{const x=r.toLowerCase();return["id","create","update","delete","timestamp","modif"].some(c=>x.includes(c))},Se=1.375,ke=()=>{const[r,x]=g.useState(!1),{data:o,isFetching:c}=L({types:["table","view"]}),u=g.useMemo(()=>{if(!o||c)return[...Array(5)].map(()=>({field:"",count:0,percentage:0,loading:!0,noData:!1}));const i={};o.forEach(({columns:d})=>{d.forEach(({name:h})=>{i[h]=(i[h]||0)+1})});const n=Object.entries(i).filter(([d])=>r||!Ie(d)).toSorted((d,h)=>h[1]-d[1]).slice(0,5),s=n.reduce((d,[h,l])=>d+l,0),a=n.map(([d,h])=>({field:d,count:h,percentage:h/s,loading:!1,noData:!1}));if(a.length<5){const d=[...Array(5-a.length)].map(()=>({field:"",count:0,percentage:0,loading:!1,noData:!0}));return[...a,...d]}return a},[o,c,r]);return e.jsxs(y,{sx:{aspectRatio:{xs:"2/1",ml:"2/1.2"},borderTop:"1px solid",borderColor:"divider",position:"relative"},children:[e.jsxs(t,{sx:{display:"flex",gap:j,justifyContent:"space-between",alignItems:"flex-start",p:j},children:[e.jsx(m,{variant:"h5",component:"h3",children:"使用的欄位名稱"}),e.jsxs(y,{sx:{alignItems:"flex-end"},children:[e.jsx(xe,{checked:r,onChange:({target:i})=>x(i.checked),control:e.jsx(he,{}),labelPlacement:"start",label:e.jsx(m,{variant:"body1",sx:{opacity:.9},children:"包含系統欄位"})}),e.jsx(Y,{children:"(id, createdAt, updatedAt, ...)"})]})]}),e.jsxs(t,{sx:{position:"relative",maxWidth:1,flex:1,overflowX:"auto",overflowY:"hidden"},children:[e.jsxs(t,{sx:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:j,placeItems:"center","& > :nth-of-type(3n + 1)":{justifySelf:"flex-start"},p:j,pt:A,width:1,height:1},children:[e.jsx(t,{children:e.jsx(m,{variant:"body1",sx:{color:"text.secondary"},children:"最常使用"})}),e.jsx(t,{}),e.jsx(t,{children:e.jsx(m,{variant:"body1",sx:{color:"text.secondary"},children:"出現次數"})}),u.map(({field:i,count:n,percentage:s,loading:a,noData:d},h)=>e.jsxs(g.Fragment,{children:[e.jsx(t,{children:a?e.jsx(N,{loading:!0,children:e.jsx(m,{variant:"body1",sx:{...b,...T,width:"6rem"},children:"載入中"})}):d?e.jsx(m,{variant:"body1",sx:{...b,width:"6rem"},children:"---"}):e.jsx(C,{title:e.jsx(m,{children:i}),children:e.jsx(m,{variant:"body1",sx:{...b,...T,width:"6rem"},children:i})})}),e.jsx(C,{title:a||d?null:e.jsxs(t,{children:[e.jsx(m,{variant:"subtitle2",children:i}),e.jsxs(m,{children:["所有欄位名稱中的 ",`${Math.round(s*100)}%`]})]}),children:e.jsxs(t,{sx:{width:1,height:"1rem",borderRadius:99,position:"relative",overflow:"clip",display:"flex",alignItems:"center","&:hover":{bgcolor:"action.hover","& .bar-content":{opacity:1}},transition:"all 0.2s ease-in-out"},children:[e.jsx(E,{color1:"divider",color2:"#fff0",angle:-35,stripeWidth:5}),e.jsx(t,{sx:{position:"absolute",width:Math.max(0,Math.min(s*Se,1)),height:1,borderRadius:9,overflow:"clip",bgcolor:"background.paper",transition:w},children:e.jsx(t,{className:"bar-content",sx:{position:"absolute",inset:0,bgcolor:"primary.main",opacity:h===0?.9:.65,transition:"all 0.2s ease-in-out"}})})]})}),e.jsx(t,{children:e.jsx(N,{loading:a,children:e.jsx(m,{variant:"body1",sx:{...b,maxWidth:"10rem"},children:a?"載入中":d?"---":pe(n)})})})]},h))]}),c&&e.jsx(t,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center",pointerEvents:"none"},children:e.jsx(I,{})})]})]})},Qe=()=>e.jsxs(t,{sx:{position:"relative",mt:O,display:"grid",gap:O,gridTemplateColumns:{xs:"1fr",ml:"repeat(2, 1fr)"},width:1},children:[e.jsx(je,{}),e.jsx(fe,{}),e.jsx(Ce,{}),e.jsx(ke,{})]});export{Qe as LargeTiles};
