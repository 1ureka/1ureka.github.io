import{r as x,u as I,as as X,a9 as Oe,a3 as Ne,j as o,s as S,c as R,d as $,y as fe,ap as Ae,m as O,J as B,V as U,l as h,aT as oe,g as L,a as F,b as k,aL as Ue,aM as De,n as Ee,aU as re,I as he,o as T,P as We,ab as Ve,v as ve,F as _e,t as Ce,S as Ge,B as q}from"./routes-BL4F7qe0.js";import{a as je}from"./ArrowDropDownRounded-2T1gHcX8.js";import{g as Je,l as N,F as Te,L as K}from"./FilterAltRounded-BMbVHeVs.js";import{e as qe,a as Ke,g as Qe}from"./main-CyrqF8C9.js";import{u as Z}from"./url-DQDR-2Is.js";import{t as we,u as Ye}from"./SQLiteClient-DK8bI8dR.js";import{t as Xe}from"./array-l11GhOAf.js";import{z as se}from"./index-mSkvzYyn.js";import{T as ee}from"./DarkModeRounded-Cxep-z7o.js";import{C as z}from"./Checkbox-BUhQaxGM.js";import{a as Ze,l as G,M as ae}from"./MenuItem-D8U_jw-0.js";import{D as te,I as et}from"./ExpandMoreRounded-CTn9USNx.js";import{A as tt}from"./AddRounded-CNDGOfwE.js";import{S as ot}from"./SortRounded-Cm1UgJ1_.js";import{S as E}from"./Skeleton-ClxZthIi.js";import"./RefreshRounded-izmRgbbI.js";import"./DataExplorationRounded-DXV--3LE.js";import"./NotificationsRounded-D3H6RF3j.js";import"./fuse-4KCAGGP5.js";import"./useMutation-CDZIunGl.js";import"./dayjs.min-BIf5hiFv.js";import"./Badge-D5tNnhU_.js";import"./DownloadRounded-BhbGJTPc.js";import"./SwitchBase-CUctRf5z.js";const rt=(e,t)=>{const{ownerState:r}=e;return[t.root,r.dense&&t.dense,r.alignItems==="flex-start"&&t.alignItemsFlexStart,r.divider&&t.divider,!r.disableGutters&&t.gutters]},st=e=>{const{alignItems:t,classes:r,dense:s,disabled:i,disableGutters:n,divider:a,selected:l}=e,c=$({root:["root",s&&"dense",!n&&"gutters",a&&"divider",i&&"disabled",t==="flex-start"&&"alignItemsFlexStart",l&&"selected"]},Je,r);return{...r,...c}},at=S(fe,{shouldForwardProp:e=>Ae(e)||e==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:rt})(O(({theme:e})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${N.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:B(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${N.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:B(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${N.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:B(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:B(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${N.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${N.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},variants:[{props:({ownerState:t})=>t.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:t})=>!t.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:t})=>t.dense,style:{paddingTop:4,paddingBottom:4}}]}))),ne=x.forwardRef(function(t,r){const s=I({props:t,name:"MuiListItemButton"}),{alignItems:i="center",autoFocus:n=!1,component:a="div",children:l,dense:d=!1,disableGutters:c=!1,divider:p=!1,focusVisibleClassName:u,selected:f=!1,className:m,...y}=s,v=x.useContext(X),g=x.useMemo(()=>({dense:d||v.dense||!1,alignItems:i,disableGutters:c}),[i,v.dense,d,c]),b=x.useRef(null);Oe(()=>{n&&b.current&&b.current.focus()},[n]);const C={...s,alignItems:i,dense:g.dense,disableGutters:c,divider:p,selected:f},j=st(C),P=Ne(b,r);return o.jsx(X.Provider,{value:g,children:o.jsx(at,{ref:P,href:y.href||y.to,component:(y.href||y.to)&&a==="div"?"button":a,focusVisibleClassName:R(j.focusVisible,u),ownerState:C,className:R(j.root,m),...y,classes:j,children:l})})}),nt=e=>{const{classes:t,inset:r,primary:s,secondary:i,dense:n}=e;return $({root:["root",r&&"inset",n&&"dense",s&&i&&"multiline"],primary:["primary"],secondary:["secondary"]},Ze,t)},it=S("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[{[`& .${G.primary}`]:t.primary},{[`& .${G.secondary}`]:t.secondary},t.root,r.inset&&t.inset,r.primary&&r.secondary&&t.multiline,r.dense&&t.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${oe.root}:where(& .${G.primary})`]:{display:"block"},[`.${oe.root}:where(& .${G.secondary})`]:{display:"block"},variants:[{props:({ownerState:e})=>e.primary&&e.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:e})=>e.inset,style:{paddingLeft:56}}]}),ie=x.forwardRef(function(t,r){const s=I({props:t,name:"MuiListItemText"}),{children:i,className:n,disableTypography:a=!1,inset:l=!1,primary:d,primaryTypographyProps:c,secondary:p,secondaryTypographyProps:u,slots:f={},slotProps:m={},...y}=s,{dense:v}=x.useContext(X);let g=d??i,b=p;const C={...s,disableTypography:a,inset:l,primary:!!g,secondary:!!b,dense:v},j=nt(C),P={slots:f,slotProps:{primary:c,secondary:u,...m}},[V,Le]=U("root",{className:R(j.root,n),elementType:it,externalForwardedProps:{...P,...y},ownerState:C,ref:r}),[Fe,_]=U("primary",{className:j.primary,elementType:h,externalForwardedProps:P,ownerState:C}),[He,ze]=U("secondary",{className:j.secondary,elementType:h,externalForwardedProps:P,ownerState:C});return g!=null&&g.type!==h&&!a&&(g=o.jsx(Fe,{variant:v?"body2":"body1",component:_!=null&&_.variant?void 0:"span",..._,children:g})),b!=null&&b.type!==h&&!a&&(b=o.jsx(He,{variant:"body2",color:"textSecondary",...ze,children:b})),o.jsxs(V,{...Le,children:[g,b]})}),Re=x.createContext();function lt(e){return L("MuiTable",e)}F("MuiTable",["root","stickyHeader"]);const ct=e=>{const{classes:t,stickyHeader:r}=e;return $({root:["root",r&&"stickyHeader"]},lt,t)},dt=S("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.stickyHeader&&t.stickyHeader]}})(O(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:t})=>t.stickyHeader,style:{borderCollapse:"separate"}}]}))),le="table",pt=x.forwardRef(function(t,r){const s=I({props:t,name:"MuiTable"}),{className:i,component:n=le,padding:a="normal",size:l="medium",stickyHeader:d=!1,...c}=s,p={...s,component:n,padding:a,size:l,stickyHeader:d},u=ct(p),f=x.useMemo(()=>({padding:a,size:l,stickyHeader:d}),[a,l,d]);return o.jsx(Re.Provider,{value:f,children:o.jsx(dt,{as:n,role:n===le?null:"table",ref:r,className:R(u.root,i),ownerState:p,...c})})}),J=x.createContext();function ut(e){return L("MuiTableBody",e)}F("MuiTableBody",["root"]);const xt=e=>{const{classes:t}=e;return $({root:["root"]},ut,t)},mt=S("tbody",{name:"MuiTableBody",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-row-group"}),yt={variant:"body"},ce="tbody",gt=x.forwardRef(function(t,r){const s=I({props:t,name:"MuiTableBody"}),{className:i,component:n=ce,...a}=s,l={...s,component:n},d=xt(l);return o.jsx(J.Provider,{value:yt,children:o.jsx(mt,{className:R(d.root,i),as:n,ref:r,role:n===ce?null:"rowgroup",ownerState:l,...a})})});function bt(e){return L("MuiTableCell",e)}const ft=F("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),ht=e=>{const{classes:t,variant:r,align:s,padding:i,size:n,stickyHeader:a}=e,l={root:["root",r,a&&"stickyHeader",s!=="inherit"&&`align${k(s)}`,i!=="normal"&&`padding${k(i)}`,`size${k(n)}`]};return $(l,bt,t)},vt=S("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],t[`size${k(r.size)}`],r.padding!=="normal"&&t[`padding${k(r.padding)}`],r.align!=="inherit"&&t[`align${k(r.align)}`],r.stickyHeader&&t.stickyHeader]}})(O(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?Ue(B(e.palette.divider,1),.88):De(B(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${ft.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:t})=>t.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),w=x.forwardRef(function(t,r){const s=I({props:t,name:"MuiTableCell"}),{align:i="inherit",className:n,component:a,padding:l,scope:d,size:c,sortDirection:p,variant:u,...f}=s,m=x.useContext(Re),y=x.useContext(J),v=y&&y.variant==="head";let g;a?g=a:g=v?"th":"td";let b=d;g==="td"?b=void 0:!b&&v&&(b="col");const C=u||y&&y.variant,j={...s,align:i,component:g,padding:l||(m&&m.padding?m.padding:"normal"),size:c||(m&&m.size?m.size:"medium"),sortDirection:p,stickyHeader:C==="head"&&m&&m.stickyHeader,variant:C},P=ht(j);let V=null;return p&&(V=p==="asc"?"ascending":"descending"),o.jsx(vt,{as:g,ref:r,className:R(P.root,n),"aria-sort":V,scope:b,ownerState:j,...f})});function Ct(e){return L("MuiTableContainer",e)}F("MuiTableContainer",["root"]);const jt=e=>{const{classes:t}=e;return $({root:["root"]},Ct,t)},Tt=S("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(e,t)=>t.root})({width:"100%",overflowX:"auto"}),wt=x.forwardRef(function(t,r){const s=I({props:t,name:"MuiTableContainer"}),{className:i,component:n="div",...a}=s,l={...s,component:n},d=jt(l);return o.jsx(Tt,{ref:r,as:n,className:R(d.root,i),ownerState:l,...a})});function Rt(e){return L("MuiTableHead",e)}F("MuiTableHead",["root"]);const St=e=>{const{classes:t}=e;return $({root:["root"]},Rt,t)},kt=S("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-header-group"}),It={variant:"head"},de="thead",$t=x.forwardRef(function(t,r){const s=I({props:t,name:"MuiTableHead"}),{className:i,component:n=de,...a}=s,l={...s,component:n},d=St(l);return o.jsx(J.Provider,{value:It,children:o.jsx(kt,{as:n,className:R(d.root,i),ref:r,role:n===de?null:"rowgroup",ownerState:l,...a})})});function Mt(e){return L("MuiTableRow",e)}const pe=F("MuiTableRow",["root","selected","hover","head","footer"]),Bt=e=>{const{classes:t,selected:r,hover:s,head:i,footer:n}=e;return $({root:["root",r&&"selected",s&&"hover",i&&"head",n&&"footer"]},Mt,t)},Pt=S("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.head&&t.head,r.footer&&t.footer]}})(O(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${pe.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${pe.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:B(e.palette.primary.main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:B(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity)}}}))),ue="tr",H=x.forwardRef(function(t,r){const s=I({props:t,name:"MuiTableRow"}),{className:i,component:n=ue,hover:a=!1,selected:l=!1,...d}=s,c=x.useContext(J),p={...s,component:n,hover:a,selected:l,head:c&&c.variant==="head",footer:c&&c.variant==="footer"},u=Bt(p);return o.jsx(Pt,{as:n,ref:r,className:R(u.root,i),role:n===ue?null:"row",ownerState:p,...d})}),Lt=Ee(o.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}));function Ft(e){return L("MuiTableSortLabel",e)}const Q=F("MuiTableSortLabel",["root","active","icon","iconDirectionDesc","iconDirectionAsc","directionDesc","directionAsc"]),Ht=e=>{const{classes:t,direction:r,active:s}=e,i={root:["root",s&&"active",`direction${k(r)}`],icon:["icon",`iconDirection${k(r)}`]};return $(i,Ft,t)},zt=S(fe,{name:"MuiTableSortLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.active&&t.active]}})(O(({theme:e})=>({cursor:"pointer",display:"inline-flex",justifyContent:"flex-start",flexDirection:"inherit",alignItems:"center","&:focus":{color:(e.vars||e).palette.text.secondary},"&:hover":{color:(e.vars||e).palette.text.secondary,[`& .${Q.icon}`]:{opacity:.5}},[`&.${Q.active}`]:{color:(e.vars||e).palette.text.primary,[`& .${Q.icon}`]:{opacity:1,color:(e.vars||e).palette.text.secondary}}}))),Ot=S("span",{name:"MuiTableSortLabel",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.icon,t[`iconDirection${k(r.direction)}`]]}})(O(({theme:e})=>({fontSize:18,marginRight:4,marginLeft:4,opacity:0,transition:e.transitions.create(["opacity","transform"],{duration:e.transitions.duration.shorter}),userSelect:"none",variants:[{props:{direction:"desc"},style:{transform:"rotate(0deg)"}},{props:{direction:"asc"},style:{transform:"rotate(180deg)"}}]}))),Nt=x.forwardRef(function(t,r){const s=I({props:t,name:"MuiTableSortLabel"}),{active:i=!1,children:n,className:a,direction:l="asc",hideSortIcon:d=!1,IconComponent:c=Lt,slots:p={},slotProps:u={},...f}=s,m={...s,active:i,direction:l,hideSortIcon:d,IconComponent:c},y=Ht(m),v={slots:p,slotProps:u},[g,b]=U("root",{elementType:zt,externalForwardedProps:v,ownerState:m,className:R(y.root,a),ref:r}),[C,j]=U("icon",{elementType:Ot,externalForwardedProps:v,ownerState:m,className:y.icon});return o.jsxs(g,{disableRipple:!0,component:"span",...b,...f,children:[n,d&&!i?null:o.jsx(C,{as:c,...j})]})}),W={xs:.5,sm:1},Y={xs:1,md:1.5},At={xs:1.5,md:2},D=e=>({position:"relative",border:"none",bgcolor:"color-mix(in srgb, var(--mui-palette-divider) 80%, transparent 20%)",...e==="first"?{borderRadius:3,borderBottomLeftRadius:"calc(1 * var(--mui-shape-borderRadius))",borderTopRightRadius:0,borderBottomRightRadius:0}:e==="last"?{borderRadius:3,borderBottomRightRadius:"calc(1 * var(--mui-shape-borderRadius))",borderTopLeftRadius:0,borderBottomLeftRadius:0}:{borderRadius:0}}),A={checkboxCell:{borderRadius:2,borderTopRightRadius:0,borderBottomRightRadius:0},checkbox:e=>({color:e?re("text-primary","primary-main",30):void 0}),row:(e,t)=>({"& td, & th":{border:0},position:"relative",borderRadius:2,bgcolor:e?re("action-hover","primary-light",80):t%2===0?"color-mix(in srgb, var(--mui-palette-action-hover), transparent)":"action.hover"}),rowCellFull:{py:8,borderRadius:2},rowCell:e=>({py:3,...e?{borderRadius:2,borderTopLeftRadius:0,borderBottomLeftRadius:0}:{}})},Ut=se.array(se.number().int()),Se=()=>{const{data:e,isFetching:t}=qe({types:["table","view"]}),{searchParams:r,updateSearchParams:s}=Z(),i=r.get("table")??null,n=x.useCallback(c=>{if(!e)return 0;const p=e.findIndex(({name:u})=>u===c);return p!==-1?p:0},[e]),[a,l]=x.useState(0),d=c=>{e&&s({table:e[n(c.target.value)].name,hiddenColumns:null,orderBy:null,order:null})};return x.useEffect(()=>{e&&l(n(i??e[0].name))},[i,e,n]),{data:e,selected:e&&e.length>0?e[a]:null,handleChange:d,isFetching:t}},ke=()=>{const{searchParams:e,updateSearchParams:t}=Z(),r=e.get("hiddenColumns")??null,s=x.useMemo(()=>{if(!r)return[];const{data:a,error:l}=we(()=>JSON.parse(r));if(l)return[];const d=Ut.safeParse(a);return d.success?Array.from(new Set(d.data)):[]},[r]),i=x.useCallback(a=>()=>{const l=s.length?[]:Array.from({length:a},(d,c)=>c);t({hiddenColumns:JSON.stringify(l)},{skipTransition:!0})},[s,t]),n=x.useCallback(a=>()=>{const l=Xe(s,a);t({hiddenColumns:JSON.stringify(l)},{skipTransition:!0})},[s,t]);return{hiddenColumns:s,createToggleAllColumns:i,createToggleHandler:n}},Ie=()=>{const{selected:e,isFetching:t}=Se(),{data:r,isFetching:s}=Ke({types:["table","view"]}),i=s||!r||t||!e,{hiddenColumns:n}=ke(),a=x.useMemo(()=>{if(!r||!e)return null;const d=r.find(({table:u})=>u===e.name);if(!d)return null;const{columns:c}=d;return c.map(u=>({...u,hidden:n.includes(u.cid)})).toSorted((u,f)=>u.cid-f.cid)},[r,e,n]),l=x.useMemo(()=>a?a.filter(p=>!p.hidden).map(({hidden:p,...u})=>{const f=u.pk>=1,m=u.type!=="text"&&!f?"right":"left";return{...u,align:m}}).toSorted((p,u)=>p.pk!==u.pk?u.pk-p.pk:p.type==="text"&&u.type!=="text"?-1:p.type!=="text"&&u.type==="text"?1:p.cid-u.cid):null,[a]);return{isFetching:i,selectedTable:e,columnsForSelect:a,columnsForTable:l}},$e=e=>{const{searchParams:t,updateSearchParams:r}=Z(),s=x.useMemo(()=>{if(!e)return 0;const a=t.get("orderBy")??null;if(!a)return 0;const l=parseInt(a,10);return!Number.isInteger(l)||l<0||l>=e?0:l},[t,e]),i=x.useMemo(()=>{const a=t.get("order")??null;return a&&["asc","desc"].includes(a)?a:"asc"},[t]),n=x.useCallback(a=>()=>{const l=a,d=s===a&&i==="asc"?"desc":"asc";r({orderBy:l.toString(),order:d},{skipTransition:!0})},[s,i,r]);return{orderBy:s,order:i,createToggleHandler:n}},xe={edge:"start",tabIndex:-1,disableRipple:!0,size:"small",sx:{py:0}},Me={bgcolor:"FilledInput.disabledBg","&:hover":{bgcolor:"FilledInput.hoverBg"},borderRadius:1,height:1,width:"auto",aspectRatio:1},Dt=()=>o.jsx(ee,{title:"篩選欄位",arrow:!0,children:o.jsxs("span",{style:{position:"relative"},children:[o.jsx(he,{loading:!0,centerRipple:!1,size:"small",sx:Me,children:o.jsx(Te,{fontSize:"small"})}),o.jsx(T,{sx:{position:"absolute",top:0,bgcolor:"FilledInput.disabledBg",borderRadius:1,height:1,width:"auto",aspectRatio:1}})]})}),Et=({columns:e})=>{const[t,r]=x.useState(null),s=c=>r(p=>p?null:c.currentTarget),i=()=>r(null),{createToggleAllColumns:n,createToggleHandler:a}=ke(),l=e.every(c=>!c.hidden),d=e.every(c=>c.hidden);return o.jsxs(o.Fragment,{children:[o.jsx(ee,{title:"篩選欄位",arrow:!0,children:o.jsx("span",{children:o.jsx(he,{onClick:s,centerRipple:!1,size:"small",sx:Me,children:o.jsx(Te,{fontSize:"small"})})})}),o.jsx(We,{open:!!t,anchorEl:t,onClose:i,elevation:3,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{sx:{maxHeight:350}}},children:o.jsxs(Ve,{dense:!0,children:[o.jsx(K,{children:o.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:"篩選欄位"})}),o.jsx(K,{disablePadding:!0,children:o.jsxs(ne,{role:void 0,onClick:n(e.length),dense:!0,children:[o.jsx(z,{...xe,checked:l,indeterminate:!l&&!d}),o.jsx(ie,{primary:"顯示所有"})]})}),o.jsx(te,{sx:{my:.5}}),e.map(c=>o.jsx(K,{disablePadding:!0,children:o.jsxs(ne,{role:void 0,onClick:a(c.cid),dense:!0,children:[o.jsx(z,{...xe,checked:!c.hidden}),o.jsx(ie,{sx:{display:"flex",width:1,gap:W,justifyContent:"space-between",my:.5},primary:c.name,secondary:c.type.toUpperCase()})]})},c.cid))]})})]})},Wt=()=>{const{columnsForSelect:e,isFetching:t}=Ie();return t?o.jsx(Dt,{}):o.jsx(Et,{columns:e??[]})},Be={borderRadius:1,overflow:"hidden","&::before":{borderBottom:0},"&:hover:not(.Mui-disabled, .Mui-error):before":{borderBottom:0},"& input":{p:W},"& div[role='combobox']":{p:W}},Pe={sx:{width:"18rem"},size:"small",variant:"filled"},Vt=()=>o.jsxs(T,{sx:{position:"relative"},children:[o.jsx(ve,{...Pe,disabled:!0,slotProps:{input:{sx:Be}}}),o.jsx(T,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center",color:"text.secondary"},children:o.jsx(_e,{color:"inherit",size:16})})]}),_t=()=>{const{data:e,selected:t,handleChange:r,isFetching:s}=Se();return!e||!t||s?o.jsx(Vt,{}):o.jsxs(ve,{select:!0,value:t.name,onChange:r,...Pe,slotProps:{select:{IconComponent:je,MenuProps:{slotProps:{paper:{sx:{maxHeight:350}}},elevation:3}},input:{sx:{...Be,"& #tables-ias":{color:"text.secondary",m:0}},startAdornment:o.jsx(et,{position:"start",id:"tables-ias",children:o.jsx(h,{variant:"caption",color:"inherit",sx:{p:.5,borderRadius:1,bgcolor:"divider",textTransform:"uppercase"},children:t.type})})}},children:[o.jsxs(ae,{dense:!0,onClickCapture:i=>i.stopPropagation(),children:[o.jsx(tt,{fontSize:"small",sx:{mr:.5}})," 新增資料表"]}),o.jsx(te,{}),e.map(({name:i},n)=>o.jsx(ae,{value:i,dense:!0,children:i},n))]})},me={p:.5,borderRadius:1,bgcolor:"divider"},ye={textTransform:"uppercase",lineHeight:1,color:"text.secondary"},Gt=({isPk:e,type:t})=>o.jsxs(T,{sx:{display:"flex",alignItems:"center",gap:W,color:"text.secondary"},children:[e&&o.jsx(h,{variant:"caption",sx:{...me,...ye},children:"PK"}),o.jsx(T,{sx:me,children:o.jsx(h,{variant:"caption",sx:{...ye,...Ce},children:t})})]}),Jt=({columns:e})=>{const{order:t,orderBy:r,createToggleHandler:s}=$e((e==null?void 0:e.length)??0),i=Math.random()>.5,n=Math.random()>.5,a=!i&&!n;return o.jsxs(H,{children:[o.jsx(w,{padding:"checkbox",sx:D("first"),children:o.jsx(z,{color:"default",indeterminate:n,checked:i,size:"small",sx:{color:a?void 0:"color-mix(in srgb, var(--mui-palette-text-primary) 30%, var(--mui-palette-primary-main) 70%)"}})}),e.map((l,d)=>{const{cid:c,name:p,type:u,align:f}=l,m=l.pk>=1,y=r===d,v=y&&t==="desc"?1:-1,g=f==="right"?"flex-end":"flex-start",b=d===e.length-1;return o.jsx(w,{sx:{minWidth:"10rem",...D(b?"last":"middle")},children:o.jsxs(T,{sx:{display:"flex",alignItems:"center",justifyContent:g},children:[o.jsx(Nt,{active:y,direction:y?t:"asc",IconComponent:ot,slotProps:{icon:{sx:{transform:`scaleY(${v})`}}},onClick:s(d),children:o.jsx(h,{variant:"body2",children:p})}),o.jsx(Gt,{isPk:m,type:u})]})},c)})]})},qt=e=>{if(e==null)return"";if(typeof e=="string"||typeof e=="number")return e;const{data:t,error:r}=we(()=>String(e));if(r)throw new Error(`無法將資料轉換為有效格式: ${r.message}`);return t},Kt=e=>{const t={};for(const r in e)t[r]=qt(e[r]);return t},Qt=async({table:e,page:t=0,limit:r=10,orderBy:s,order:i="asc"})=>{const n=Qe(),a=`SELECT COUNT(*) as total FROM ${e}`,l=await n.exec(a);if(!l||!l.length)throw new Error(`無法獲取 ${e} 表的資料總數，可能是表名錯誤或表不存在`);const d=l[0].total,c=Number(d);if(!Number.isInteger(c)||c<0)throw new Error(`無法解析 ${e} 表的總行數為有效整數`);t<0&&(t=0);const p=t*r,u=Math.ceil(c/r),f=t+1<u?t+1:null;let m=`SELECT * FROM ${e}`;s&&(m+=` ORDER BY ${String(s)} ${i.toUpperCase()}`),m+=` LIMIT ${r} OFFSET ${p}`;const v=(await n.exec(m)).map(Kt);return{table:e,rows:v,nextPage:f,totalPages:u,totalRows:c}},Yt=1*60*1e3,Xt=({table:e,columns:t})=>{const{orderBy:r,order:s}=$e(t.length),i=t[r].name,n={table:e,order:s,orderBy:i},{data:a,isFetched:l}=Ye({queryKey:["getRows",n],queryFn:()=>Qt(n),staleTime:Yt,enabled:t.length>0});return{isFetching:!l,data:a}},Zt=({rows:e,columns:t})=>({sortedRows:x.useMemo(()=>{if(!e)return[];const s=t.map(({name:n})=>n);return e.map(n=>s.map((a,l)=>({column:a,value:n[a],align:t[l].align})))},[t,e])}),M=A,ge=({checked:e,...t})=>o.jsx(w,{padding:"checkbox",sx:M.checkboxCell,children:o.jsx(z,{color:"default",size:"small",sx:M.checkbox(e??!1),checked:e,...t})}),eo=e=>{const{columns:t}=e,{data:r,isFetching:s}=Xt(e),{sortedRows:i}=Zt({rows:(r==null?void 0:r.rows)??null,columns:t});return s||!r?o.jsx(o.Fragment,{children:[...Array(10)].map((n,a)=>o.jsxs(H,{sx:M.row(!1,a),children:[o.jsx(ge,{disabled:!0}),t.map((l,d)=>o.jsx(w,{sx:M.rowCell(d===t.length-1),children:o.jsx(E,{animation:"wave",variant:"rounded",sx:{width:1,maxWidth:"none"},children:o.jsx(h,{children:"載入中..."})})},d))]},a))}):i.length?o.jsx(o.Fragment,{children:i.map((n,a)=>o.jsxs(H,{sx:M.row(!1,a),children:[o.jsx(ge,{checked:!1}),n.map(({value:d,align:c},p)=>o.jsx(w,{align:c,sx:M.rowCell(p===t.length-1),children:o.jsx(h,{sx:Ce,children:d})},p))]},`data${a}`))}):o.jsx(H,{sx:M.row(!1,1),children:o.jsx(w,{sx:M.rowCellFull,colSpan:t.length+1,children:o.jsx(h,{sx:{color:"text.secondary",textAlign:"center"},children:"該資料表 / 檢視表目前沒有任何資料"})})})},to=()=>o.jsxs(H,{children:[o.jsx(w,{padding:"checkbox",sx:D("first"),children:o.jsx(z,{disabled:!0,size:"small"})}),o.jsx(w,{sx:D("middle"),children:o.jsx(E,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:o.jsx(h,{variant:"body2",children:"載入中. . ."})})}),[...Array(4)].map((e,t)=>o.jsx(w,{sx:D(t===3?"last":"middle"),children:o.jsx(T,{sx:{display:"flex",justifyContent:"flex-end"},children:o.jsx(E,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:o.jsx(h,{variant:"body2",children:"載入中. . ."})})})},t))]}),oo=()=>o.jsx(o.Fragment,{children:[...Array(5)].map((e,t)=>o.jsxs(H,{sx:A.row(!1,t),children:[o.jsx(w,{padding:"checkbox",sx:A.checkboxCell,children:o.jsx(z,{disabled:!0,size:"small"})}),o.jsx(w,{sx:A.rowCell(!1),children:o.jsx(E,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:o.jsx(h,{children:"載入中. . ."})})}),[...Array(4)].map((r,s)=>o.jsx(w,{sx:A.rowCell(s===3),children:o.jsx(T,{sx:{display:"flex",justifyContent:"flex-end"},children:o.jsx(E,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:o.jsx(h,{children:"載入中. . ."})})})},s))]},t))}),ro=()=>{const{isFetching:e,selectedTable:t,columnsForTable:r}=Ie(),s=e||!t||!r;return o.jsx(wt,{sx:{mt:At},children:o.jsxs(pt,{sx:{borderSpacing:"0 0.3rem",borderCollapse:"separate"},children:[o.jsx($t,{sx:{position:"relative"},children:s?o.jsx(to,{}):o.jsx(Jt,{columns:r})}),o.jsx(gt,{children:s?o.jsx(oo,{}):o.jsx(eo,{table:t.name,columns:r})})]})})},be=e=>({"--temporary-color":e,bgcolor:"color-mix(in srgb, var(--temporary-color) 30%, transparent 70%)","&:hover":{bgcolor:"color-mix(in srgb, var(--temporary-color) 40%, transparent 60%)"},color:"color-mix(in srgb, var(--temporary-color) 40%, var(--mui-palette-text-primary) 60%)",px:1.5}),so=e=>({"--temporary-color":e,bgcolor:"color-mix(in srgb, var(--temporary-color) 90%, var(--mui-palette-text-primary) 10%)","&:hover":{bgcolor:"color-mix(in srgb, var(--temporary-color) 80%, var(--mui-palette-text-primary) 20%)"},color:"color-mix(in srgb, var(--temporary-color) 5%, var(--mui-palette-background-paper) 95%)",px:1.5}),Mo=()=>o.jsxs(Ge,{children:[o.jsxs(T,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:Y},children:[o.jsxs(T,{sx:{display:"flex",alignItems:"stretch",gap:Y},children:[o.jsx(_t,{}),o.jsx(Wt,{})]}),o.jsxs(T,{sx:{display:"flex",alignItems:"center",gap:Y},children:[o.jsx(h,{sx:{color:"text.secondary"},children:"已選取 0 個:"}),o.jsxs(T,{sx:{display:"flex",alignItems:"center",gap:W},children:[o.jsx(ee,{title:"以指定值覆蓋選取資料的某個欄位",arrow:!0,children:o.jsx(q,{sx:be("var(--mui-palette-primary-main)"),children:"覆蓋欄位"})}),o.jsx(q,{sx:be("var(--mui-palette-error-main)"),children:"刪除紀錄"})]}),o.jsx(te,{flexItem:!0,orientation:"vertical"}),o.jsx(q,{sx:so("var(--mui-palette-primary-main)"),endIcon:o.jsx(je,{}),children:"標準化"})]})]}),o.jsx(ro,{})]});export{Mo as default};
