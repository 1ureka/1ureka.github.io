import{o as S,j as e,q as d,T as c,B as r,A as ee,D as te,r as v,t as se,y as _,P as ne,z as re}from"./routes-CadzfG2E.js";import{S as ie,A as oe}from"./SentimentDissatisfiedRounded-CYS_arGA.js";import{d as C,a as ae,A as ce,S as le}from"./ScrollArea-EdinM5Pg.js";import{u as E,B as de,F as xe,U as W,f as me,b as ue,c as pe,d as he,e as je}from"./url-DTt2Bjh-.js";import{a as N,i as H,u as ye,C as ge}from"./post-CLX4ZffY.js";import{E as P,a as fe}from"./ExpandedPost-DBEH2cyI.js";import{L as Ie,T as $,V as K,P as be,a as ve,A as z,S as Ce,b as Se}from"./PostHeader-DeGR_Wzm.js";import{D as u}from"./Divider-DVObFO2h.js";import{S as I}from"./Skeleton-Pg_F8lei.js";import{T as k,u as ke}from"./useMutation-Ctl-1Wtr.js";import{C as q}from"./Chip-DcZTGwOD.js";import{S as we,I as V}from"./DarkModeRounded-BeOhhBQh.js";import{u as A}from"./useQuery-ItHSqdRD.js";import{E as Ee}from"./EmojiMenu-DkXYFkc9.js";import{u as Q}from"./forum-J-R9UQLq.js";import{T as D,a as w}from"./Tabs-BzKjxJww.js";import{B as Ae}from"./ButtonGroup-4Ac2dBnu.js";import"./ForumRounded-CcKh2deb.js";import"./ExpandMoreRounded-EvpBNzDo.js";import"./OpenInNewRounded-D66UK4vw.js";import"./NotificationsRounded-DSSC8er_.js";import"./Collapse-BUSepr5J.js";import"./with-selector-DbUq2SiO.js";import"./CommentRounded-B_Jl-FgD.js";const L=S(e.jsx("path",{d:"m11.71 15.29 2.59-2.59c.39-.39.39-1.02 0-1.41L11.71 8.7c-.63-.62-1.71-.18-1.71.71v5.17c0 .9 1.08 1.34 1.71.71"})),R=S(e.jsx("path",{d:"M12.29 8.71 9.7 11.3c-.39.39-.39 1.02 0 1.41l2.59 2.59c.63.63 1.71.18 1.71-.71V9.41c0-.89-1.08-1.33-1.71-.7"})),b={display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",textTransform:"none"},Le=()=>{const{searchParams:t,updateSearchParams:n}=E(),s=t.get("postId"),i=s&&/^\d+$/.test(s)&&Number(s)>0?Number(s):-1,{data:o,isFetching:a}=N({postId:i-1});return a&&!o?e.jsx(d,{startIcon:e.jsx(R,{}),loading:!0,children:e.jsx(c,{variant:"button",sx:b,children:"載入中..."})}):o?e.jsx(d,{startIcon:e.jsx(R,{}),onClick:()=>n({postId:(i-1).toString()}),children:e.jsxs(c,{variant:"button",sx:b,children:["上一篇：",o.title]})}):e.jsx(d,{startIcon:e.jsx(R,{}),disabled:!0,children:e.jsx(c,{variant:"button",sx:b,children:"沒有上一篇了"})})},Re=()=>{const{searchParams:t,updateSearchParams:n}=E(),s=t.get("postId"),i=s&&/^\d+$/.test(s)&&Number(s)>0?Number(s):-1,{data:o,isFetching:a}=N({postId:i+1});return a&&!o?e.jsx(d,{endIcon:e.jsx(L,{}),loading:!0,children:e.jsx(c,{variant:"button",sx:b,children:"載入中..."})}):o?e.jsx(d,{endIcon:e.jsx(L,{}),onClick:()=>n({postId:(i+1).toString()}),children:e.jsxs(c,{variant:"button",sx:b,children:["下一篇：",o.title]})}):e.jsx(d,{endIcon:e.jsx(L,{}),disabled:!0,children:e.jsx(c,{variant:"button",sx:b,children:"沒有下一篇了"})})},Be=S(e.jsx("path",{d:"m21.41 11.41-8.83-8.83c-.37-.37-.88-.58-1.41-.58H4c-1.1 0-2 .9-2 2v7.17c0 .53.21 1.04.59 1.41l8.83 8.83c.78.78 2.05.78 2.83 0l7.17-7.17c.78-.78.78-2.04-.01-2.83M6.5 8C5.67 8 5 7.33 5 6.5S5.67 5 6.5 5 8 5.67 8 6.5 7.33 8 6.5 8"})),Ne=t=>Array.from({length:t},()=>Math.random()*.7+.3),$e=()=>e.jsxs(r,{sx:{pt:1.5},children:[e.jsx(u,{}),e.jsxs(r,{sx:{position:"relative",py:1.5,height:"fit-content"},children:[e.jsx(r,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35,pointerEvents:"none"}}),e.jsx(r,{sx:{px:2.5},children:e.jsx(Ie,{sx:{m:0}})})]}),e.jsx(u,{sx:{mb:2.5}}),e.jsxs(r,{sx:{px:2.5,position:"relative"},children:[e.jsx(I,{variant:"rounded",animation:"wave",sx:{mb:1},children:e.jsx(c,{variant:"h4",component:"h2",sx:{textAlign:"start"},gutterBottom:!0,children:"正在載入標題... 正在載入"})}),Ne(4).map((t,n)=>e.jsx(I,{variant:"text",animation:"wave",width:`${t*100}%`},n)),e.jsx(ee,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})]}),e.jsx(u,{sx:{mt:2.5}}),e.jsxs(r,{sx:{p:1.5,py:1,display:"flex",gap:1.5,alignItems:"center",position:"relative",color:"text.secondary"},children:[e.jsx(r,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),e.jsx(d,{color:"inherit",startIcon:e.jsx($,{}),size:"small",loading:!0,children:e.jsx(c,{variant:"caption",component:"span",children:"100 個讚"})}),e.jsx(d,{color:"inherit",startIcon:e.jsx(de,{}),size:"small",loading:!0,children:e.jsx(c,{variant:"caption",component:"span",children:"收藏該貼文"})}),e.jsx(r,{sx:{flex:1}}),e.jsx(d,{color:"inherit",startIcon:e.jsx(K,{}),size:"small",loading:!0,children:e.jsx(c,{variant:"caption",component:"span",children:"1000 次瀏覽"})})]}),e.jsx(u,{})]}),Fe=({post:t})=>e.jsxs(r,{sx:{pt:1.5},children:[e.jsx("title",{children:`論壇樣板 | ${t.title}`}),e.jsx(u,{}),e.jsxs(r,{sx:{position:"relative",py:1.5,height:"fit-content"},children:[e.jsx(r,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35,pointerEvents:"none"}}),e.jsx(r,{sx:{px:2.5},children:e.jsx(be,{post:t,sx:{m:0}})})]}),e.jsx(u,{sx:{mb:2.5}}),e.jsxs(r,{sx:{px:2.5},children:[e.jsx(c,{variant:"h4",component:"h2",sx:{textAlign:"start"},gutterBottom:!0,children:t.title}),e.jsx(c,{variant:"body2",component:"p",sx:{whiteSpace:"pre-line"},children:t.content}),t.photos&&t.photos.length>0&&e.jsx(r,{sx:{display:"grid",gap:1,mt:2,gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))"},children:t.photos.map(({name:n,url:s},i)=>e.jsx(k,{title:"查看圖片",arrow:!0,placement:"top",children:e.jsx(te,{sx:{position:"relative",aspectRatio:"1 / 1",bgcolor:"divider",borderRadius:1,overflow:"hidden"},children:e.jsx(r,{sx:{position:"absolute",inset:"auto 0 0 0",pb:1,display:"grid",placeItems:"center"},children:e.jsx(r,{sx:{maxWidth:150},children:e.jsx(q,{label:n,size:"small"})})})})},`${s}${i}`))}),e.jsxs(we,{sx:{gap:1.5,flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap-reverse",mt:2},children:[e.jsxs(r,{sx:{display:"flex",gap:1.5,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(c,{variant:"subtitle2",sx:{color:"text.secondary",display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Be,{fontSize:"small"}),"標籤："]}),e.jsx(ve,{post:t,displayCount:99})]}),t.attachments&&t.attachments.length>0&&e.jsxs(r,{sx:{display:"flex",gap:1,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(c,{variant:"subtitle2",sx:{color:"text.secondary",display:"flex",alignItems:"center",gap:.5},children:[e.jsx(z,{fontSize:"small"}),"附件："]}),t.attachments.map((n,s)=>e.jsx(k,{title:"下載附件",arrow:!0,placement:"top",children:e.jsx(q,{label:`${n.name} (${(n.size/1024).toFixed(1)}KB)`,clickable:!0,icon:e.jsx(z,{fontSize:"small"})})},s))]})]})]}),e.jsx(u,{sx:{mt:2.5}}),e.jsxs(r,{sx:{px:2.5,py:1,display:"flex",gap:1.5,alignItems:"center",position:"relative",color:"text.secondary"},children:[e.jsx(r,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),t.isSelf?e.jsx(Ce,{post:t}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{postId:t.id,likeCount:t.likeCount}),e.jsx(xe,{postId:t.id})]}),e.jsx(r,{sx:{flex:1}}),e.jsx(d,{startIcon:e.jsx(K,{}),disabled:!0,size:"small",sx:{"button&.Mui-disabled":{color:"text.secondary",opacity:.8}},children:e.jsxs(c,{variant:"caption",component:"span",children:[t.viewCount," 次瀏覽"]})})]}),e.jsx(u,{flexItem:!0})]}),U=async t=>{const n=t.postId!==void 0,s=n?"c.postId = $id AND c.parentId IS NULL":"c.parentId = $id",o=(t.orderBy||"latest")==="latest"?"datetime(c.createdAt) DESC":"COALESCE(cic.likeCount, 0) DESC, datetime(c.createdAt) DESC",a=`
      SELECT c.id FROM comments c
      LEFT JOIN comment_interaction_counts cic ON c.id = cic.commentId
      WHERE ${s} ORDER BY ${o}
    `,l={$id:n?t.postId:t.parentId};return(await C.exec(a,l)).map(x=>x.id)},Te=async({commentId:t})=>{const s=await C.exec(`
      SELECT
        c.id,
        c.postId,
        c.parentId,
        c.content,
        c.userId,
        u.name as userName,
        COALESCE(cic.likeCount, 0) as likeCount,
        c.createdAt,
        c.updatedAt
      FROM
        comments c
      JOIN
        users u ON c.userId = u.id
      LEFT JOIN
        comment_interaction_counts cic ON c.id = cic.commentId
      WHERE
        c.id = $commentId
    `,{$commentId:t});if(s.length===0)return null;const i=s[0];return{...i,id:i.id,postId:i.postId,parentId:i.parentId,content:i.content,userId:i.userId,userName:i.userName,likeCount:i.likeCount,createdAt:new Date(i.createdAt),updatedAt:new Date(i.updatedAt)}},F=1e3*60*1,Pe=({postId:t,orderBy:n})=>A({queryKey:["commentsByPost",t,n],queryFn:()=>U({postId:t,orderBy:n}),staleTime:F}),J=t=>A({queryKey:["commentsByParent",t],queryFn:()=>U({parentId:t,orderBy:"latest"}),staleTime:F}),ze=t=>A({queryKey:["comment",t],queryFn:()=>Te({commentId:t}),staleTime:F}),G=S(e.jsx("path",{d:"M10 9V7.41c0-.89-1.08-1.34-1.71-.71L3.7 11.29c-.39.39-.39 1.02 0 1.41l4.59 4.59c.63.63 1.71.19 1.71-.7V14.9c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"})),Y=S(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),O=S(e.jsx("path",{d:"M8.12 9.29 12 13.17l3.88-3.88c.39-.39 1.02-.39 1.41 0s.39 1.02 0 1.41l-4.59 4.59c-.39.39-1.02.39-1.41 0L6.7 10.7a.996.996 0 0 1 0-1.41c.39-.38 1.03-.39 1.42 0"})),B=({sx:t,onCancel:n,...s})=>{const{user:i,authenticated:o,loading:a}=H(),l=v.useRef(null),[p,x]=v.useState(""),j=m=>{x(h=>{const y=l.current;if(y){const f=y.selectionStart||0,g=y.selectionEnd||0,Z=h.substring(0,f)+m+h.substring(g);return setTimeout(()=>{y.focus(),y.setSelectionRange(f+m.length,f+m.length)},0),Z}return h+m})};return e.jsx(r,{sx:{position:"relative",py:1,px:2,...t},...s,children:e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[o&&i?e.jsx(W,{name:i.name,sx:{mt:1.5}}):e.jsx(me,{sx:{width:"2rem",height:"2rem",mt:1.5}}),e.jsxs(r,{sx:{flex:1},component:"form",children:[e.jsx(se,{inputRef:l,variant:"standard",size:"small",name:"comment",label:o?"發表你的想法":"登入後即可發表留言",fullWidth:!0,type:"text",value:p,onChange:m=>x(m.target.value),disabled:!o||a}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mt:1,alignItems:"center",gap:1},children:[e.jsx(Ee,{onEmojiClick:j,disabled:!o||a}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(d,{size:"small",disabled:!o||a,sx:{color:"text.secondary"},onClick:()=>{x(""),n!==void 0&&n()},children:"取消"}),e.jsx(d,{size:"small",disabled:!o||a||p.trim().length===0,variant:"contained",children:"留言"})]})]})]})]})})},qe=async({commentId:t,userId:n})=>{const s=`
      SELECT 1 as liked
      FROM comment_interactions
      WHERE commentId = $commentId
        AND userId = $userId
        AND type = 'like'
      LIMIT 1
    `,i=`
      SELECT COALESCE(likeCount, 0) as likeCount
      FROM comment_interaction_counts
      WHERE commentId = $commentId
    `,o=await C.exec(s,{$commentId:t,$userId:n}),a=await C.exec(i,{$commentId:t}),l=o.length>0;return!a[0]||!Number.isInteger(a[0].likeCount)?null:{liked:l,likeCount:a[0].likeCount}},De=async({commentId:t,userId:n,type:s,value:i})=>{i?await C.exec(`
        INSERT OR IGNORE INTO comment_interactions (userId, commentId, type)
        VALUES ($userId, $commentId, $type)
      `,{$userId:n,$commentId:t,$type:s}):await C.exec(`
        DELETE FROM comment_interactions
        WHERE userId = $userId
          AND commentId = $commentId
          AND type = $type
      `,{$userId:n,$commentId:t,$type:s})},Oe=0,Me=(t,n,s)=>{const i=Q(),o=v.useRef(0);return ke({mutationFn:a=>{if(n===void 0)throw new Error("未登入");return De({commentId:t,userId:n,type:s,value:a})},onMutate:()=>(o.current++,o.current),onSettled:(a,l,p,x)=>{if(x===o.current){const j=["commentLikeStatus",t,n];i.invalidateQueries({queryKey:j})}},onError:()=>{console.error("評論按讚操作失敗")}})},_e=t=>{const n=Q(),{user:s,authenticated:i,loading:o}=H(),{data:a,isLoading:l}=A({staleTime:Oe,queryKey:["commentLikeStatus",t,s==null?void 0:s.id],enabled:!o&&i&&(s==null?void 0:s.id)!==void 0,queryFn:async()=>qe({commentId:t,userId:s.id})}),p=o||l,x=!i||p||a===void 0||a===null,j=(a==null?void 0:a.liked)??!1,m=(a==null?void 0:a.likeCount)??null,{mutate:h}=Me(t,s==null?void 0:s.id,"like");return{liked:j,likeCount:m,handleLike:async()=>{x||(await n.cancelQueries({queryKey:["commentLikeStatus",t,s.id]}),n.setQueryData(["commentLikeStatus",t,s.id],f=>{const g=!f.liked;return h(g),{liked:g,likeCount:f.likeCount+(g?1:-1)}}))},disabled:x,loading:p}},We=({commentId:t,likeCount:n})=>{const{liked:s,likeCount:i,handleLike:o,disabled:a,loading:l}=_e(t);return e.jsx(d,{size:"small",startIcon:e.jsx($,{}),onClick:o,color:s?"primary":"inherit",sx:{color:s?void 0:"text.secondary"},disabled:a,loading:l,children:e.jsx(c,{variant:"caption",children:i!==null?i>0?i:"讚":n})})},X=({commentId:t,nestedLevel:n,sx:s,...i})=>{if(n<0)throw new Error("nestedLevel must be greater than 0");const{data:o,isFetching:a}=ze(t),{data:l,isFetching:p}=J(t),[x,j]=v.useState(!1),m=()=>j(g=>!g),[h,y]=v.useState(!1),f=()=>y(g=>!g);return a||!o||p?e.jsx(T,{nestedLevel:n,sx:s,...i}):e.jsx(r,{sx:{position:"relative",py:1,pb:n>0?0:1,pl:2,borderLeft:n>0?"2px solid":"none",borderColor:"divider",...s},...i,children:e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[e.jsx(W,{name:o.userName,sx:{mt:1}}),e.jsxs(r,{sx:{flex:1},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(c,{variant:"subtitle2",component:"a",sx:{"&:hover":{textDecoration:"underline"},color:"text.primary"},href:`${_.forum_users}?user=${o.userName}`,children:o.userName}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(c,{variant:"caption",color:"text.secondary",children:o.createdAt.toLocaleString()}),o.createdAt.getTime()!==o.updatedAt.getTime()&&e.jsx(k,{title:`最後編輯於 ${o.updatedAt.toLocaleString()}`,arrow:!0,children:e.jsx(c,{variant:"caption",color:"text.secondary",children:"(已編輯)"})}),e.jsx(k,{title:"更多選項",arrow:!0,children:e.jsx(V,{size:"small",children:e.jsx(Y,{fontSize:"small"})})})]})]}),e.jsx(c,{variant:"body2",sx:{mt:.5,whiteSpace:"pre-line"},children:o.content}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[e.jsx(We,{commentId:t,likeCount:o.likeCount}),e.jsx(d,{size:"small",startIcon:e.jsx(G,{}),sx:{color:"text.secondary"},onClick:f,children:e.jsx(c,{variant:"caption",children:h?"取消回覆":"回覆"})})]}),h&&e.jsx(B,{onCancel:()=>y(!1)}),l&&l.length>0&&e.jsx(d,{startIcon:x?e.jsx(O,{sx:{transform:"rotate(180deg)",transition:"transform 0.2s ease",transformOrigin:"center"}}):e.jsx(O,{}),sx:{mt:1},size:"small",onClick:m,children:x?"隱藏回覆":`顯示 ${l.length||0} 則回覆`}),x&&l&&e.jsx(He,{commentId:t})]})]})})},T=({nestedLevel:t,sx:n,...s})=>e.jsx(r,{sx:{position:"relative",py:1,pb:t>0?0:1,pl:2,borderLeft:t>0?"2px solid":"none",borderColor:"divider",...n},...s,children:e.jsxs(r,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[e.jsx(I,{variant:"circular",width:"2rem",height:"2rem",sx:{mt:1},animation:"wave"}),e.jsxs(r,{sx:{flex:1},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(I,{variant:"rounded",animation:"wave",children:e.jsx(c,{variant:"subtitle2",component:"span",children:"載入名稱中..."})}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(I,{variant:"rounded",animation:"wave",children:e.jsx(c,{variant:"caption",color:"text.secondary",children:"0000-00-00 00:00:00"})}),e.jsx(k,{title:"更多選項",arrow:!0,children:e.jsx("span",{children:e.jsx(V,{size:"small",disabled:!0,children:e.jsx(Y,{fontSize:"small"})})})})]})]}),e.jsx(I,{variant:"rounded",animation:"wave",children:e.jsx(c,{variant:"body2",sx:{mt:.5,whiteSpace:"pre-line"},children:"佔位文字，佔位文字，佔位文字，佔位文字，佔位文字，佔位文字，"})}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",mt:1,gap:1},children:[e.jsx(d,{size:"small",startIcon:e.jsx($,{}),sx:{color:"text.secondary"},loading:!0,children:e.jsx(c,{variant:"caption",children:"讚"})}),e.jsx(d,{size:"small",startIcon:e.jsx(G,{}),sx:{color:"text.secondary"},loading:!0,children:e.jsx(c,{variant:"caption",children:"回覆"})})]})]})]})}),He=({commentId:t})=>{const{data:n,isFetching:s}=J(t);return s?e.jsx(r,{children:[...Array(1)].map((i,o)=>e.jsx(T,{nestedLevel:1},o))}):n?e.jsx(r,{children:n.map(i=>e.jsx(X,{commentId:i,nestedLevel:1},i))}):null},M={content:'""',display:"block",position:"absolute",inset:0,bgcolor:"divider",opacity:.2,pointerEvents:"none",mr:-2},Ke=({totalComments:t})=>{const{searchParams:n,updateSearchParams:s}=E(),i=n.get("postId"),o=i&&/^\d+$/.test(i)&&Number(i)>0?Number(i):-1,l=(n.get("orderBy")||"latest")==="likes"?"likes":"latest",{data:p,isFetching:x}=Pe({postId:o,orderBy:l}),j=(m,h)=>{s({orderBy:h===0?"latest":"likes"})};return x?e.jsxs(e.Fragment,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(I,{variant:"rounded",animation:"wave",sx:{mx:2},children:e.jsx(c,{variant:"subtitle1",component:"h3",children:"0 則留言"})}),e.jsx(u,{flexItem:!0,orientation:"vertical",variant:"middle"}),e.jsxs(D,{value:l==="latest"?0:1,onChange:j,children:[e.jsx(w,{label:"最新",disabled:!0}),e.jsx(w,{label:"最多人按讚",disabled:!0})]})]}),e.jsx(u,{}),e.jsx(r,{sx:{pr:2,"& > .comment:nth-of-type(odd):before":M},children:[...Array(3)].map((m,h)=>e.jsx(T,{nestedLevel:0,className:"comment"},h))})]}):!p||p.length===0?e.jsxs(e.Fragment,{children:[e.jsx(r,{sx:{pr:2},children:e.jsx(B,{})}),e.jsx(r,{sx:{pb:2},children:e.jsx(c,{variant:"body2",sx:{color:"text.secondary",textAlign:"center",mt:2},children:"還沒有留言，快來發表你的看法吧！"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsxs(c,{variant:"subtitle1",component:"h3",sx:{px:2},children:[t," 則留言"]}),e.jsx(u,{flexItem:!0,orientation:"vertical",variant:"middle"}),e.jsxs(D,{value:l==="latest"?0:1,onChange:j,children:[e.jsx(w,{label:"最新"}),e.jsx(w,{label:"最多人按讚"})]})]}),e.jsx(u,{}),e.jsxs(r,{sx:{pr:2,"& > .comment:nth-of-type(odd):before":M},children:[e.jsx(B,{className:"comment"}),p.map(m=>e.jsx(X,{commentId:m,nestedLevel:0,className:"comment"},m))]})]})},Ve=()=>{const{data:t,isFetching:n}=ye({limit:2,orderBy:"likeCount",order:"desc"});return n||!t?e.jsxs(r,{children:[e.jsx(P,{}),e.jsx(P,{})]}):e.jsx(r,{children:t.map(s=>e.jsx(fe,{postId:s},s))})},Qe=()=>{const{searchParams:t}=E(),n=t.get("postId"),s=n&&/^\d+$/.test(n)&&Number(n)>0?Number(n):-1,{data:i,isFetching:o}=N({postId:s,incrementViewCount:!0});return o&&!i?e.jsx($e,{}):i?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{post:i}),e.jsx(Ke,{totalComments:i.commentCount})]}):e.jsxs(r,{sx:{pt:1.5},children:[e.jsx(u,{}),e.jsxs(r,{sx:{py:6,display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[e.jsx(ie,{sx:{fontSize:"6rem",color:"action.disabled"}}),e.jsx(c,{variant:"body1",component:"p",sx:{color:"text.secondary",textAlign:"center"},children:"貼文不存在或已被刪除"})]}),e.jsx(u,{}),e.jsxs(r,{sx:{position:"relative"},children:[e.jsx(r,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),e.jsx(c,{variant:"h6",sx:{p:2},children:"我們找不到這篇貼文...但你可能會喜歡這些！"})]}),e.jsx(u,{}),e.jsx(Ve,{})]})};function Ue(){const{isMd:t}=ae();return e.jsxs(ce,{children:[e.jsx(ue,{}),e.jsxs(le,{children:[t?e.jsx(pe,{}):e.jsx(he,{}),e.jsx(ge,{maxWidth:"lg",sx:{position:"relative",my:10,px:0},children:e.jsxs(ne,{sx:{pb:3,borderRadius:3,border:"1px solid",borderColor:"divider"},elevation:1,children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"center",mt:2,mx:2},children:[e.jsx(d,{href:_.forum_home,startIcon:e.jsx(oe,{}),variant:"outlined",sx:{textWrap:"nowrap"},children:t?"返回首頁":"首頁"}),e.jsx(r,{sx:{flex:1}}),e.jsxs(Ae,{variant:"text",children:[e.jsx(Le,{}),e.jsx(Re,{})]})]}),e.jsx(Qe,{})]})}),e.jsx(je,{})]})]})}re.createRoot(document.getElementById("root")).render(e.jsx(v.StrictMode,{children:e.jsx(Ue,{})}));
