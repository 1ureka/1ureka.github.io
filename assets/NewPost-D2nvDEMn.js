import{o as j,j as e,r,B as l,T as c,t as k,q as _}from"./routes-Crf9tycC.js";import{h as $}from"./PostHeader-Drgz7VMf.js";import{P as q,T as O}from"./TopicAutocomplete-B-g0sES7.js";import{j as V,l as K}from"./CommentRounded-D4aTN9tY.js";import{E as G}from"./EmojiMenu-BV0md6lq.js";import{S as J}from"./Skeleton-DIHwTmsH.js";import{D as T}from"./Divider-BLaT7GpB.js";import{I as m}from"./DarkModeRounded-DrGacEM6.js";import{C as x}from"./Chip-8KLuaQx8.js";import{T as u}from"./useMutation-laxjeK80.js";const Q=j(e.jsx("path",{d:"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1"})),X=j(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.9 13.98l2.1 2.53 3.1-3.99c.2-.26.6-.26.8.01l3.51 4.68c.25.33.01.8-.4.8H6.02c-.42 0-.65-.48-.39-.81L8.12 14c.19-.26.57-.27.78-.02"})),Y=j(e.jsx("path",{d:"M5 5c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1m2.41 9H9v5c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-5h1.59c.89 0 1.34-1.08.71-1.71L12.71 7.7a.996.996 0 0 0-1.41 0l-4.59 4.59c-.63.63-.19 1.71.7 1.71"})),ce=()=>{const{user:A,authenticated:a,loading:i}=V(),[g,P]=r.useState(""),[f,b]=r.useState(""),[d,v]=r.useState([]),[E,y]=r.useState([]),[h,w]=r.useState([]),[p,S]=r.useState([]),F=()=>{console.log({title:g,content:f,tags:d,photos:E,attachments:h})},z=t=>{if(!t.target.files)return;const s=Array.from(t.target.files);y(o=>[...o,...s]);const n=s.map(o=>URL.createObjectURL(o));S(o=>[...o,...n])},U=t=>{if(!t.target.files)return;const s=Array.from(t.target.files);w(n=>[...n,...s])},B=t=>{URL.revokeObjectURL(p[t]),y(s=>s.filter((n,o)=>o!==t)),S(s=>s.filter((n,o)=>o!==t))},L=t=>{w(s=>s.filter((n,o)=>o!==t))},[C,I]=r.useState(null),H=t=>I(t.currentTarget),R=()=>I(null),M=t=>{v([...d,t]),R()},W=t=>{b(s=>{const n=document.querySelector('textarea[placeholder="分享你的想法..."]');if(n){const o=n.selectionStart||0,D=n.selectionEnd||0,N=s.substring(0,o)+t+s.substring(D);return setTimeout(()=>{n.focus(),n.setSelectionRange(o+t.length,o+t.length)},0),N}return s+t})};return e.jsxs(e.Fragment,{children:[e.jsxs(l,{sx:{display:"flex",gap:1,alignItems:"center",px:3},children:[e.jsx(q,{className:"mode-light",sx:{fontSize:48,mr:1,bgcolor:"primary.main",borderRadius:1,color:"background.default",p:1,opacity:.8}}),a?e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"h5",component:"h2",color:"primary",sx:{opacity:.8},children:A.name}),e.jsx(c,{variant:"h5",component:"h2",children:"，你在想些什麼？"})]}):i?e.jsx(J,{variant:"rounded",animation:"wave",children:e.jsx(c,{variant:"h5",component:"h2",children:"登入就能分享你的想法喔 ✨"})}):e.jsx(c,{variant:"h5",component:"h2",children:"登入就能分享你的想法喔 ✨"})]}),e.jsx(T,{sx:{my:2}}),e.jsxs(l,{sx:{px:3},children:[e.jsx(k,{fullWidth:!0,label:"標題",variant:"filled",sx:{mb:.5},value:g,onChange:t=>P(t.target.value),disabled:!a||i}),e.jsx(k,{multiline:!0,fullWidth:!0,placeholder:"分享你的想法...",variant:"filled",minRows:6,maxRows:12,size:"small",sx:{mb:1},value:f,onChange:t=>b(t.target.value),disabled:!a||i}),p.length>0&&e.jsx(l,{sx:{mb:1,display:"flex",flexWrap:"wrap",gap:1},children:p.map((t,s)=>e.jsxs(l,{sx:{position:"relative",width:100,height:100,borderRadius:1,overflow:"hidden"},children:[e.jsx("img",{src:t,alt:`上傳的圖片 ${s+1}`,style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx(m,{size:"small",onClick:()=>B(s),sx:{position:"absolute",top:4,right:4,bgcolor:"divider",color:"white","&:hover":{bgcolor:"error.main"},p:.5},children:e.jsx(K,{fontSize:"small"})})]},s))}),h.length>0&&e.jsxs(l,{sx:{mb:1},children:[e.jsx(c,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"附件檔案："}),h.map((t,s)=>e.jsx(x,{label:`${t.name} (${(t.size/1024).toFixed(1)}KB)`,onDelete:()=>L(s),sx:{mr:1,mb:1}},s))]}),e.jsxs(l,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(c,{variant:"body2",component:"span",sx:{color:"text.secondary"},children:"標籤："}),[...new Set(d)].map(t=>e.jsx(u,{title:"刪除",arrow:!0,placement:"top",children:e.jsx(x,{label:t,clickable:!0,onClick:()=>v(d.filter(s=>s!==t))})},t)),e.jsx(x,{label:"新增標籤",clickable:!0,icon:e.jsx(Q,{}),variant:"outlined",onClick:H,disabled:!a||i}),e.jsx(O,{type:"add",open:!!C,anchorEl:C,onClose:R,onAdd:M})]})]}),e.jsx(T,{sx:{mt:1}}),e.jsxs(l,{sx:{position:"relative",display:"flex",gap:1,alignItems:"center",justifyContent:"space-between",py:1,px:3},children:[e.jsx(l,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),e.jsxs(l,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(G,{onEmojiClick:W,disabled:!a||i}),e.jsx(u,{title:"插入照片",arrow:!0,children:e.jsx("span",{children:e.jsxs(m,{size:"small",onClick:()=>{var t;return(t=document.getElementById("photo-upload"))==null?void 0:t.click()},disabled:!a||i,children:[e.jsx(X,{fontSize:"small"}),e.jsx("input",{type:"file",id:"photo-upload",accept:"image/*",multiple:!0,style:{display:"none"},onChange:z})]})})}),e.jsx(u,{title:"附加檔案",arrow:!0,children:e.jsx("span",{children:e.jsxs(m,{size:"small",onClick:()=>{var t;return(t=document.getElementById("file-upload"))==null?void 0:t.click()},disabled:!a||i,children:[e.jsx($,{fontSize:"small"}),e.jsx("input",{type:"file",id:"file-upload",multiple:!0,style:{display:"none"},onChange:U})]})})})]}),e.jsx(_,{variant:"contained",color:"primary",endIcon:e.jsx(Y,{}),onClick:F,disabled:!a||i,children:"發佈"})]})]})};export{ce as N};
