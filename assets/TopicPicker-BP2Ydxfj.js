import{n as B,j as e,r as h,o,l as u,P,S as y,v as F,I as A,B as C,F as D}from"./routes-BRvtlvXq.js";import{b as R,n as E}from"./post-DnnO_OAo.js";import{u as I}from"./fuse-Bxxm0l84.js";import{C as U}from"./ClearRounded-DxTEK0UC.js";import{B as V,C as S}from"./Badge-DkXiDsZB.js";import{I as Z,D as k}from"./ExpandMoreRounded-DEjStDxu.js";const Y=B(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V18c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-1.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05.02.01.03.03.04.04 1.14.83 1.93 1.94 1.93 3.41V18c0 .35-.07.69-.18 1H22c.55 0 1-.45 1-1v-1.5c0-2.33-4.67-3.5-7-3.5"})),q=({children:a})=>e.jsx(o,{sx:{borderRadius:99,bgcolor:"primary.main",width:"0.9rem",aspectRatio:"1/1",display:"grid",placeItems:"center",mr:.5},children:e.jsx(u,{variant:"caption",sx:{position:"absolute",color:"background.paper",fontSize:"0.6rem"},children:a})}),H=h.memo(({title:a,hint:l,tags:c,onSelect:s,showAfter:p=1})=>e.jsxs(o,{children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5,justifyContent:"space-between"},children:[e.jsx(u,{variant:"subtitle1",sx:{color:"text.secondary"},children:`${a}:`}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(V,{badgeContent:10,color:"primary",variant:"dot",overlap:"circular",children:e.jsx(o,{sx:{width:0,height:0}})}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:`為${l}`})]})]}),e.jsx(o,{sx:{mt:1.5,display:"flex",flexWrap:"wrap",gap:1.5},children:c.map(({name:i,count:d})=>e.jsx(S,{size:"small",label:i,clickable:!0,onClick:()=>s(i),deleteIcon:e.jsx(q,{children:d}),onDelete:d>p?()=>s(i):void 0},i))})]})),K=()=>e.jsx(o,{sx:{height:300,display:"grid",placeItems:"center"},children:e.jsx(D,{size:"1.5rem",sx:{color:"divider"}})}),L=({type:a,onConfirm:l,onClose:c})=>{const{data:s,isFetching:p}=R(),{data:i,isFetching:d}=E(),x=p||!s||d||!i,[r,g]=h.useState(""),j=I((s==null?void 0:s.map(t=>({...t,count:t.count.toString()})))??[],["name"]),f=I((i==null?void 0:i.map(t=>({...t,count:t.count.toString()})))??[],["name"]),T=h.useMemo(()=>{if(!s)return[];let t=s,m=i??[];r.trim()&&(t=j(r).map(n=>({...n.item,count:Number(n.item.count)})),m=f(r).map(n=>({...n.item,count:Number(n.item.count)})));const z={title:"最近使用的標籤",hint:"你使用過的次數",tags:m,showAfter:0},v=[{title:"A ~ Z",hint:"總使用次數",tags:t.filter(n=>/^[a-zA-Z]/.test(n.name))},{title:"0 ~ 9",hint:"總使用次數",tags:t.filter(n=>/^[0-9]/.test(n.name))},{title:"中文",hint:"總使用次數",tags:t.filter(n=>!/^[a-zA-Z0-9]/.test(n.name))}];return a==="add"?[z,...v]:v},[s,i,a,j,f,r]),b=x||r.trim()===""||a==="query"&&!s.map(({name:t})=>t).includes(r.trim()),w=t=>{b||t.key==="Enter"&&l(r)};return e.jsxs(y,{onKeyDown:w,children:[e.jsx(o,{sx:{p:2,pt:1},children:e.jsx(F,{value:r,onChange:t=>g(t.target.value),disabled:x,size:"small",label:a==="add"?"查詢或新增標籤":"查詢標籤",variant:"standard",fullWidth:!0,autoFocus:!0,slotProps:{input:{endAdornment:e.jsx(Z,{position:"end",children:e.jsx(A,{onClick:()=>g(""),disabled:!r,children:e.jsx(U,{})})})}}})}),e.jsx(k,{}),x?e.jsx(K,{}):e.jsx(o,{sx:{maxHeight:300,overflowY:"auto",overflowX:"hidden"},children:e.jsxs(y,{sx:{gap:2,p:2},children:[a==="query"&&e.jsx(S,{label:"全部主題",clickable:!0,onClick:()=>l(null)}),T.map((t,m)=>t.tags.length>0&&e.jsx(H,{...t,onSelect:l},m))]})}),e.jsx(k,{}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",p:2,gap:1,justifyContent:"flex-end"},children:[e.jsx(C,{size:"small",variant:"outlined",disabled:x,onClick:c,children:"取消"}),e.jsx(C,{size:"small",variant:"contained",disabled:b,onClick:()=>l(r),children:a==="add"?"新增":"前往"})]})]})},G=({type:a,onConfirm:l,onClose:c,...s})=>e.jsx(P,{...s,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},elevation:6,slotProps:{paper:{sx:{borderRadius:2,width:320}}},onClose:c,children:e.jsx(L,{type:a,onConfirm:l,onClose:c})});export{Y as P,G as T};
