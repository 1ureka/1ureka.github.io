import{o as V,j as e,r as m,p as o,t as y,n as v,y as H,E as L,z as k}from"./routes-DrAjfNKu.js";import{u as M,T as P,a as D,b as U,c as B,d as F,e as W,f as q,V as T,I as O,F as _,S as G,U as K,g as Q}from"./TreeViewTransition-CXYvlsH3.js";import{V as w}from"./DataExplorationRounded-Dgi2nfzq.js";import{M as X}from"./MoreHorizRounded-7w8-xxPn.js";import{D as A}from"./DatasetRounded-CJxeektx.js";import{T as J}from"./DarkModeRounded-BCapfBw4.js";import{f as Y}from"./main-CqGJt3yr.js";import"./useThemeProps-1rGTWLfh.js";import"./Checkbox-Cma2-Tkx.js";import"./SwitchBase-Dv59f88_.js";import"./proxy-IROFmvxx.js";import"./RefreshRounded-Hlj_ZRjd.js";import"./SQLiteClient-CXu3MqOl.js";import"./url-DVkW8FTa.js";import"./ArrowDropDownRounded-Tv4flcwX.js";import"./NotificationsRounded-BiDZSXSt.js";import"./fuse-DsgKF4xb.js";import"./useMutation-DIYCy1FX.js";import"./dayjs.min-C_kWFe0N.js";import"./MenuItem-pp2hSLjf.js";import"./ExpandMoreRounded-6eRjgqL_.js";import"./Badge-DvMt8Xz0.js";import"./DownloadRounded-D5vdmnua.js";const Z=V(e.jsx("path",{d:"M19 7H9c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2m0 3c0 .55-.45 1-1 1h-8c-.55 0-1-.45-1-1s.45-1 1-1h8c.55 0 1 .45 1 1m-6 5v-2h2v2zm2 2v2h-2v-2zm-4-2H9v-2h2zm6-2h2v2h-2zm-8 4h2v2H9zm8 2v-2h2v2zM6 17H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v1h-2V5H5v10h1z"})),f=4,u={position:"absolute",color:"text.secondary",display:"grid",placeItems:"center"},N={table:l=>e.jsx(o,{sx:u,children:e.jsx(A,{sx:{color:"primary.main",filter:`hue-rotate(${(l??0)*20}deg)`}})}),columns:()=>e.jsx(o,{sx:u,children:e.jsx(w,{})}),column:()=>e.jsx(o,{sx:{...u,opacity:.5},children:e.jsx(w,{})}),indexes:()=>e.jsx(o,{sx:u,children:e.jsx(_,{})}),index:()=>e.jsx(o,{sx:{...u,opacity:.5},children:e.jsx(O,{})}),key:()=>e.jsx(o,{sx:{...u,opacity:.5},children:e.jsx(T,{})}),pk:()=>e.jsx(o,{sx:{...u,color:"info.main"},children:e.jsx(T,{})})},ee=m.forwardRef(function(x,d){const{id:a,itemId:h,label:s,disabled:r,children:c,type:n,hueIndex:j,subtitle:i,caption:p,...b}=x,{getRootProps:I,getContentProps:$,getIconContainerProps:R,getLabelProps:E,getGroupTransitionProps:S,status:z}=M({id:a,itemId:h,children:c,label:s,disabled:r,rootRef:d});return e.jsx(P,{itemId:h,children:e.jsxs(D,{...I(b),children:[e.jsxs(U,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:.5,pl:f/2,pr:1.5,borderRadius:0,boxShadow:"-1px 0 0 var(--mui-palette-divider)"},...$(),children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[!["column","index","pk","key"].includes(n)&&e.jsx(o,{sx:{display:"grid",placeItems:"center",p:f/2},children:e.jsx(B,{sx:{position:"absolute"},...R(),children:e.jsx(F,{status:z})})}),e.jsx(o,{sx:{display:"grid",placeItems:"center",p:f/2},children:N[n](j)}),e.jsx(W,{...E(),sx:{lineHeight:1,pl:f/3,translate:"0 0.07rem",width:"auto",...y}}),i&&e.jsx(o,{sx:{p:.5,bgcolor:"divider",borderRadius:1,ml:1,translate:"0 0.07rem"},children:e.jsx(v,{variant:"caption",sx:{color:"text.secondary",textTransform:"uppercase",lineHeight:1,...y},children:i})})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",position:"relative"},children:[p&&e.jsx(v,{variant:"body2",sx:{mr:1,color:"text.secondary",lineHeight:1,translate:"0 0.07rem",textTransform:"uppercase",fontFamily:'"jf openhuninn"',...y},children:p}),["table","columns","indexes"].includes(n)&&e.jsx(J,{title:e.jsx(v,{variant:"body2",children:"正被其他網站樣板使用中，無法編輯"}),arrow:!0,placement:"right",children:e.jsx(H,{sx:{display:"grid",placeItems:"center",p:f/2,borderRadius:1,"&:hover":{bgcolor:"action.hover"},"&:active":{bgcolor:"action.selected"}},onClick:C=>C.stopPropagation(),children:e.jsx(X,{sx:{color:"text.secondary",position:"absolute"}})})})]})]}),c&&e.jsx(q,{...S(),style:{paddingLeft:`calc(var(--mui-spacing) * ${f})`,boxShadow:"-1px 0 0 var(--mui-palette-divider)"}})]})})}),g=m.memo(ee),t=",_,";function se(){const{data:l,isFetching:x}=Y(),[d,a]=m.useState([]),h=(s,r,c)=>{if(c)if(r.endsWith(t+"table")){const n=[r],j=r.split(t)[0],i=["columns","indexes"].map(p=>`${j}${t}${p}`);a([...n,...i])}else a([...d,r]);else a(d.filter(n=>n!==r))};return m.useEffect(()=>{if(x||!l)return;const s=Object.keys(l)[0],r=`${s}${t}table`,c=`${s}${t}columns`,n=`${s}${t}indexes`;a([r,c,n])},[l,x]),x?e.jsx(o,{sx:{display:"grid",placeItems:"center",height:1},children:e.jsx(L,{})}):e.jsx(G,{slots:{expandIcon:Q,collapseIcon:K},sx:{ml:-4/2},expandedItems:d,onItemExpansionToggle:h,children:k(l).map(([s,{columns:r,indexes:c,type:n,hueIndex:j}])=>e.jsxs(g,{type:"table",itemId:`${s}${t}table`,label:s,hueIndex:j,subtitle:n,children:[e.jsx(g,{type:"columns",itemId:`${s}${t}columns`,label:"欄位",children:r.map(({name:i,type:p,pk:b})=>e.jsx(g,{itemId:`${s}${t}column${t}${i}`,type:b>=1?"pk":i.toLowerCase().includes("id")?"key":"column",label:i,caption:p},`${s}${t}column${t}${i}`))}),e.jsxs(g,{type:"indexes",itemId:`${s}${t}indexes`,label:"索引",children:[c.length===0&&e.jsx(g,{type:"index",itemId:`${s}${t}no${t}index`,label:"無索引"}),c.map(({name:i,unique:p,columns:b})=>e.jsx(g,{itemId:`${s}${t}index${t}${i}`,type:"index",label:b.toSorted((I,$)=>I.seqno-$.seqno).map(({name:I})=>I).join(" → "),caption:p===1?"UNIQUE":void 0},`${s}${t}index${t}${i}`))]})]},s))})}const we=()=>{const[l,x]=m.useState(350),d=m.useRef(null),a=m.useRef(!1),h=()=>{a.current=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none"},s=()=>{a.current=!1,document.body.style.cursor="default",document.body.style.userSelect=""},r=c=>{if(!a.current||!d.current)return;const n=c.clientX-d.current.getBoundingClientRect().left;n>=200&&n<=800&&x(n)};return m.useEffect(()=>(window.addEventListener("mousemove",r),window.addEventListener("mouseup",s),()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",s)}),[]),e.jsxs(o,{ref:d,sx:{width:l,borderRight:1,minHeight:650,borderColor:"divider",position:"relative"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",p:1},children:[e.jsx(Z,{className:"mode-light",sx:{fontSize:"3rem",mr:1.5,bgcolor:"primary.main",borderRadius:1,borderTopLeftRadius:"calc(var(--mui-shape-borderRadius) * 2.5)",color:"background.default",p:1,opacity:.8}}),e.jsx(v,{variant:"h6",sx:y,children:"資料表 & 檢視表"})]}),e.jsx(o,{sx:{position:"absolute",right:0,top:0,bottom:0,width:"1rem",translate:"90% 0",cursor:"ew-resize",zIndex:10,"&:hover":{bgcolor:"action.hover"},"&:active":{bgcolor:"action.selected"}},onMouseDown:h}),e.jsx(se,{})]})};export{we as default};
