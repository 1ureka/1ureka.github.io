import{a as L,g as D,r as s,aP as U,u as q,j as t,s as G,c as Z,b as P,d as K,x as J,m as Q,F as g,e as X,o as b,i as Y,p as v,z as _,n as E,B as ee}from"./Toast-6ncYA_Ld.js";import{B as te}from"./Motion-C-kz0xh0.js";import{b as oe}from"./main-BtIibAsk.js";import{u as se,a as ae,b as le,c as re,i as ne,M as ie,T as ce,B as de,g as pe,P as ue,R as xe}from"./style-BGtAqfzg.js";import{R as ge}from"./RestartAltRounded-COnKimLj.js";import{T as h}from"./DarkModeRounded-BFg7OYNl.js";import{D as ve}from"./Divider-vP51gHCL.js";import"./proxy-DHR4684q.js";import"./ErrorOutlineRounded-BWvTI3f4.js";import"./SQLiteClient-CQZ5EZ1X.js";import"./tryCatch-CD0ybv0K.js";import"./routes-Dr3OAPvi.js";import"./url-BKoQkXLc.js";import"./DataExplorationRounded-tAuyK-5K.js";import"./RefreshRounded-BcOkXO49.js";import"./ArrowDropDownRounded-a6cIAduy.js";import"./NotificationsRounded-BBOwe-i5.js";import"./fuse-BXhxvJKY.js";import"./useMutation-2Qc-kFMN.js";import"./dayjs.min-CkW5XOTE.js";import"./MenuItem-BLYGv0hx.js";import"./ExpandMoreRounded-BeFfyJ0G.js";import"./Badge-D6o4y19V.js";import"./DownloadRounded-CB3mGnoq.js";import"./DatasetRounded-BTkDwVEg.js";import"./with-selector-Bqcg4InP.js";function ye(e){return D("MuiToggleButton",e)}const I=L("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),me=s.createContext({}),be=s.createContext(void 0);function fe(e,o){return o===void 0||e===void 0?!1:Array.isArray(o)?o.includes(e):e===o}const Ce=e=>{const{classes:o,fullWidth:a,selected:n,disabled:r,size:c,color:i}=e,p={root:["root",n&&"selected",r&&"disabled",a&&"fullWidth",`size${P(c)}`,i]};return K(p,ye,o)},he=G(J,{name:"MuiToggleButton",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:a}=e;return[o.root,o[`size${P(a.size)}`]]}})(Q(({theme:e})=>({...e.typography.button,borderRadius:(e.vars||e).shape.borderRadius,padding:11,border:`1px solid ${(e.vars||e).palette.divider}`,color:(e.vars||e).palette.action.active,[`&.${I.disabled}`]:{color:(e.vars||e).palette.action.disabled,border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:g(e.palette.text.primary,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${I.selected}`]:{color:(e.vars||e).palette.text.primary,backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:g(e.palette.text.primary,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:g(e.palette.text.primary,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.selectedOpacity})`:g(e.palette.text.primary,e.palette.action.selectedOpacity)}}}}},...Object.entries(e.palette).filter(X()).map(([o])=>({props:{color:o},style:{[`&.${I.selected}`]:{color:(e.vars||e).palette[o].main,backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:g(e.palette[o].main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:g(e.palette[o].main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette[o].mainChannel} / ${e.vars.palette.action.selectedOpacity})`:g(e.palette[o].main,e.palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:e.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:e.typography.pxToRem(15)}}]}))),j=s.forwardRef(function(o,a){const{value:n,...r}=s.useContext(me),c=s.useContext(be),i=U({...r,selected:fe(o.value,n)},o),p=q({props:i,name:"MuiToggleButton"}),{children:u,className:f,color:k="standard",disabled:y=!1,disableFocusRipple:z=!1,fullWidth:m=!1,onChange:x,onClick:S,selected:B,size:$="medium",value:C,...M}=p,R={...p,color:k,disabled:y,disableFocusRipple:z,fullWidth:m,size:$},T=Ce(R),w=d=>{S&&(S(d,C),d.defaultPrevented)||x&&x(d,C)},l=c||"";return t.jsx(he,{className:Z(r.className,T.root,f,l),disabled:y,focusRipple:!z,ref:a,onClick:w,onChange:x,value:C,ownerState:R,"aria-pressed":B,...M,children:u})}),je=b(t.jsx("path",{d:"M21 8.59V4c0-.55-.45-1-1-1h-4.59c-.89 0-1.34 1.08-.71 1.71l1.59 1.59-10 10-1.59-1.59c-.62-.63-1.7-.19-1.7.7V20c0 .55.45 1 1 1h4.59c.89 0 1.34-1.08.71-1.71L7.71 17.7l10-10 1.59 1.59c.62.63 1.7.19 1.7-.7"})),ke=b(t.jsx("path",{d:"M21.29 4.12 16.7 8.71l1.59 1.59c.63.63.18 1.71-.71 1.71H13c-.55 0-1-.45-1-1v-4.6c0-.89 1.08-1.34 1.71-.71l1.59 1.59 4.59-4.59c.39-.39 1.02-.39 1.41 0 .38.4.38 1.03-.01 1.42M4.12 21.29l4.59-4.59 1.59 1.59c.63.63 1.71.18 1.71-.71V13c0-.55-.45-1-1-1h-4.6c-.89 0-1.34 1.08-.71 1.71l1.59 1.59-4.59 4.59c-.39.39-.39 1.02 0 1.41.4.38 1.03.38 1.42-.01"})),ze=b(t.jsx("path",{d:"M20 10h-7.01V8.21c0-.45-.54-.67-.85-.35l-2.78 2.79c-.19.2-.19.51 0 .71l2.78 2.79c.31.32.85.09.85-.35V12H20v5H4V5h16v2c0 .55.45 1 1 1s1-.45 1-1V5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4v1c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-1h4c1.1 0 2-.9 2-2v-5c0-1.1-.9-2-2-2"})),Se=b(t.jsx("path",{d:"M3 22c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1s1 .45 1 1v18c0 .55-.45 1-1 1M20.5 7h-13C6.67 7 6 7.67 6 8.5S6.67 10 7.5 10h13c.83 0 1.5-.67 1.5-1.5S21.33 7 20.5 7m-6 7h-7c-.83 0-1.5.67-1.5 1.5S6.67 17 7.5 17h7c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5"})),Re=b(t.jsx("path",{d:"M22 3c0 .55-.45 1-1 1H3c-.55 0-1-.45-1-1s.45-1 1-1h18c.55 0 1 .45 1 1M8.5 22c.83 0 1.5-.67 1.5-1.5v-13C10 6.67 9.33 6 8.5 6S7 6.67 7 7.5v13c0 .83.67 1.5 1.5 1.5m7-6c.83 0 1.5-.67 1.5-1.5v-7c0-.83-.67-1.5-1.5-1.5S14 6.67 14 7.5v7c0 .83.67 1.5 1.5 1.5"})),Be=b(t.jsx("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m-8 7c-.55 0-1 .45-1 1v3c0 1.1.9 2 2 2h3c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1-.45-1-1v-2c0-.55-.45-1-1-1m1-9c0-.55.45-1 1-1h2c.55 0 1-.45 1-1s-.45-1-1-1H5c-1.1 0-2 .9-2 2v3c0 .55.45 1 1 1s1-.45 1-1zm14-3h-3c-.55 0-1 .45-1 1s.45 1 1 1h2c.55 0 1 .45 1 1v2c0 .55.45 1 1 1s1-.45 1-1V5c0-1.1-.9-2-2-2m0 15c0 .55-.45 1-1 1h-2c-.55 0-1 .45-1 1s.45 1 1 1h3c1.1 0 2-.9 2-2v-3c0-.55-.45-1-1-1s-1 .45-1 1z"})),$e=({alignDirection:e,selectedNodes:o,onAlign:a,onResetAlign:n,onResetView:r,onFocus:c})=>t.jsx(ue,{position:"top-left",children:t.jsxs(v,{sx:{display:"flex",gap:1,alignItems:"center",borderRadius:1,bgcolor:"background.paper",p:1,px:2,outline:1,outlineColor:"divider",userSelect:"none"},children:[t.jsx(v,{sx:{position:"absolute",inset:0,pointerEvents:"none",borderRadius:1,boxShadow:2,opacity:.35}}),t.jsxs(v,{sx:{display:"flex",gap:1,alignItems:"center"},children:[t.jsx(E,{variant:"subtitle1",color:"text.secondary",children:"布局"}),t.jsx(h,{title:"水平排列",arrow:!0,children:t.jsx(j,{size:"small",value:"horizontal",selected:e==="horizontal",onClick:()=>a("horizontal"),children:t.jsx(Se,{fontSize:"small"})})}),t.jsx(h,{title:"垂直排列",arrow:!0,children:t.jsx(j,{size:"small",value:"vertical",selected:e==="vertical",onClick:()=>a("vertical"),children:t.jsx(Re,{fontSize:"small"})})}),t.jsx(h,{title:"重新排版",arrow:!0,children:t.jsx(j,{size:"small",value:"none",onClick:n,children:t.jsx(ge,{fontSize:"small"})})})]}),t.jsx(ve,{orientation:"vertical",flexItem:!0}),t.jsxs(v,{sx:{display:"flex",gap:1,alignItems:"center"},children:[t.jsx(E,{variant:"subtitle1",color:"text.secondary",children:"視圖"}),t.jsx(h,{title:"重設視圖",arrow:!0,children:t.jsx(j,{size:"small",value:"reset",onClick:r,children:t.jsx(ze,{fontSize:"small"})})}),t.jsx(h,{title:"聚焦至選取元素",arrow:!0,children:t.jsx("span",{children:t.jsx(j,{size:"small",value:"select",onClick:c,disabled:o.length===0,children:t.jsx(Be,{fontSize:"small"})})})})]})]})}),Me={tableNode:ce};function Te({nodes:e,edges:o,isFetching:a}){const{mode:n}=Y(),{fitView:r}=se(),[c,i]=s.useState(e),[p,u]=s.useState(o),[f,k]=s.useState([]),[y,z]=s.useState("horizontal"),[m,x]=s.useState(!1);s.useEffect(()=>{if(m)return;let l,d=0;const O=F=>{if(F-d<200){l=requestAnimationFrame(O);return}if(d=F,!c.every(V=>{var A,N;return((A=V.measured)==null?void 0:A.width)&&((N=V.measured)==null?void 0:N.height)})){l=requestAnimationFrame(O);return}const{nodes:H,edges:W}=pe(c,p,y);i(H),u(W),x(!0)};return l=requestAnimationFrame(O),()=>cancelAnimationFrame(l)},[c,p,m,y,r]),s.useEffect(()=>{a||(i(e),u(o),x(!1))},[e,o,a]);const S=s.useCallback(l=>i(d=>ae(l,d)),[i]),B=s.useCallback(l=>u(d=>le(l,d)),[u]),$=s.useCallback(l=>u(d=>re(l,d)),[u]),C=s.useCallback(({nodes:l})=>k(l),[k]),M=s.useCallback(l=>{z(l),x(!1)},[]),R=s.useCallback(()=>x(!1),[]),T=s.useCallback(()=>r({padding:.2,duration:375}),[r]),w=s.useCallback(()=>r({padding:.2,duration:375,nodes:f}),[r,f]);return t.jsxs(t.Fragment,{children:[t.jsx(v,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center",bgcolor:"action.hover"},children:t.jsx(_,{})}),t.jsxs(ne,{nodes:c,nodeTypes:Me,edges:p,onConnect:$,onNodesChange:S,onEdgesChange:B,onSelectionChange:C,deleteKeyCode:null,colorMode:n,minZoom:.7,maxZoom:1.5,defaultViewport:{x:100,y:100,zoom:.9},defaultEdgeOptions:{type:"smoothstep",animated:!0,selectable:!1,style:{strokeWidth:2,stroke:"#b1b1b7"},markerEnd:{type:ie.Arrow,width:20,height:20}},style:{position:"relative",opacity:!m||a?0:1,transition:!m||a?void 0:"opacity 0.5s ease",background:"var(--mui-palette-background-paper)"},children:[t.jsx(de,{bgColor:"var(--mui-palette-action-hover)"}),t.jsx($e,{alignDirection:y,selectedNodes:f,onAlign:M,onResetAlign:R,onResetView:T,onFocus:w})]})]})}const we=s.memo(Te),lt=()=>{const{nodes:e,edges:o,isFetching:a}=oe(),[n,r]=s.useState(!1),c=s.useMemo(()=>e.map(i=>({id:i.tableName,type:"tableNode",data:i,position:{x:0,y:0}})),[e]);return t.jsxs(te,{sx:{position:n?"fixed":"relative",flex:1,inset:n?0:void 0,zIndex:n?"snackbar":void 0},layout:"position",children:[t.jsx(v,{sx:{position:"absolute",inset:0,bgcolor:"background.paper"},children:t.jsx(xe,{children:t.jsx(we,{isFetching:a,nodes:c,edges:o})})}),t.jsx(v,{sx:{position:"absolute",inset:"0 0 auto auto",color:"text.secondary",display:"flex",gap:1,alignItems:"center",borderRadius:1,bgcolor:"background.paper",p:1,px:2,outline:1,outlineColor:"divider",userSelect:"none",m:"15px"},children:t.jsx(ee,{color:"inherit",sx:{py:.2},endIcon:n?t.jsx(ke,{}):t.jsx(je,{}),loading:a,onClick:()=>r(i=>!i),children:n?"退出全螢幕":"全螢幕"})})]})};export{lt as default};
