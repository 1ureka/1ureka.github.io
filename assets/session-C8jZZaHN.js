import{f as i,j as a}from"./ScrollArea-BEpX462B.js";import{u as l}from"./RefreshRounded-DJszxv1A.js";const n="forum_session",u={id:1,name:"1ureka",description:""},c=async()=>{const e=localStorage.getItem(n);if(!e)return null;const s=await a(Promise.resolve(JSON.parse(e)));return s.error?(console.error("讀取儲存的會話資訊失敗",s.error),null):s.data},f=async e=>{const s=await a(Promise.resolve(localStorage.setItem(n,JSON.stringify(e))));s.error&&console.error("儲存會話資訊失敗",s.error)},m=async()=>{await new Promise(s=>setTimeout(s,Math.random()*1e3));const e=await c();return e&&e.authenticated?e:{authenticated:!1,user:null,loading:!1,error:null}},y=()=>{const{data:e,isFetching:s,error:t}=i({queryKey:["session"],queryFn:m,staleTime:3e5});return s?{authenticated:!1,user:null,loading:!0,error:null}:t?{authenticated:!1,user:null,loading:!1,error:t instanceof Error?t.message:"未知錯誤"}:e||{authenticated:!1,user:null,loading:!1,error:null}},h=()=>{const e=l();return{login:async o=>{if(await new Promise(r=>setTimeout(r,1e3)),o.username&&o.password){const r={authenticated:!0,user:u,loading:!1,error:null};await f(r),e.setQueryData(["session"],r)}else console.error("帳號或密碼未輸入")},logout:async()=>{await new Promise(r=>setTimeout(r,1e3));const o={authenticated:!1,user:null,loading:!1,error:null};localStorage.removeItem(n),e.setQueryData(["session"],o)},refreshSession:()=>{e.invalidateQueries({queryKey:["session"]})}}};export{y as a,h as u};
