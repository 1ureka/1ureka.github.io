import{r as m,j as p,c as lt,b as Y,az as qt,d as Mt,g as Dt,s as nt,u as Ct,a7 as Pt,M as Yt,U as $t,aA as Xt,ac as Bt,ad as tt,an as St,aB as Ut,a as Gt,f as _t,aC as Tt,Q as it,ao as Vt,m as bt,P as Jt,aq as At,$ as Lt,S as xt,aD as Rt,Z as ft,o as kt,p as jt,B as Kt,T as Qt,ay as Nt,ax as Zt}from"./routes-Bsweq7TM.js";import{s as te,u as ee,I as Ht,D as re,M as et}from"./DarkModeRounded-aDICJVAO.js";import{T as ne}from"./Tooltip-DJ_SZ-Ux.js";import{u as gt}from"./forum-DwW5JLUY.js";import{d as rt,e as oe}from"./ScrollArea-Bj92pjCN.js";const se=qt(),ae=te("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[`maxWidth${Y(String(n.maxWidth))}`],n.fixed&&e.fixed,n.disableGutters&&e.disableGutters]}}),ie=t=>ee({props:t,name:"MuiContainer",defaultTheme:se}),ce=(t,e)=>{const n=d=>Dt(e,d),{classes:o,fixed:r,disableGutters:h,maxWidth:s}=t,i={root:["root",s&&`maxWidth${Y(String(s))}`,r&&"fixed",h&&"disableGutters"]};return Mt(i,n,o)};function le(t={}){const{createStyledComponent:e=ae,useThemeProps:n=ie,componentName:o="MuiContainer"}=t,r=e(({theme:s,ownerState:i})=>({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",...!i.disableGutters&&{paddingLeft:s.spacing(2),paddingRight:s.spacing(2),[s.breakpoints.up("sm")]:{paddingLeft:s.spacing(3),paddingRight:s.spacing(3)}}}),({theme:s,ownerState:i})=>i.fixed&&Object.keys(s.breakpoints.values).reduce((d,f)=>{const u=f,C=s.breakpoints.values[u];return C!==0&&(d[s.breakpoints.up(u)]={maxWidth:`${C}${s.breakpoints.unit}`}),d},{}),({theme:s,ownerState:i})=>({...i.maxWidth==="xs"&&{[s.breakpoints.up("xs")]:{maxWidth:Math.max(s.breakpoints.values.xs,444)}},...i.maxWidth&&i.maxWidth!=="xs"&&{[s.breakpoints.up(i.maxWidth)]:{maxWidth:`${s.breakpoints.values[i.maxWidth]}${s.breakpoints.unit}`}}}));return m.forwardRef(function(i,d){const f=n(i),{className:u,component:C="div",disableGutters:y=!1,fixed:b=!1,maxWidth:M="lg",classes:I,...D}=f,j={...f,component:C,disableGutters:y,fixed:b,maxWidth:M},g=ce(j,o);return p.jsx(r,{as:C,ownerState:j,className:lt(g.root,u),ref:d,...D})})}const Ie=le({createStyledComponent:nt("div",{name:"MuiContainer",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[`maxWidth${Y(String(n.maxWidth))}`],n.fixed&&e.fixed,n.disableGutters&&e.disableGutters]}}),useThemeProps:t=>Ct({props:t,name:"MuiContainer"})});function ue(t,e,n){const o=e.getBoundingClientRect(),r=n&&n.getBoundingClientRect(),h=tt(e);let s;if(e.fakeTransform)s=e.fakeTransform;else{const f=h.getComputedStyle(e);s=f.getPropertyValue("-webkit-transform")||f.getPropertyValue("transform")}let i=0,d=0;if(s&&s!=="none"&&typeof s=="string"){const f=s.split("(")[1].split(")")[0].split(",");i=parseInt(f[4],10),d=parseInt(f[5],10)}return t==="left"?r?`translateX(${r.right+i-o.left}px)`:`translateX(${h.innerWidth+i-o.left}px)`:t==="right"?r?`translateX(-${o.right-r.left-i}px)`:`translateX(-${o.left+o.width-i}px)`:t==="up"?r?`translateY(${r.bottom+d-o.top}px)`:`translateY(${h.innerHeight+d-o.top}px)`:r?`translateY(-${o.top-r.top+o.height-d}px)`:`translateY(-${o.top+o.height-d}px)`}function pe(t){return typeof t=="function"?t():t}function ht(t,e,n){const o=pe(n),r=ue(t,e,o);r&&(e.style.webkitTransform=r,e.style.transform=r)}const de=m.forwardRef(function(e,n){const o=Pt(),r={enter:o.transitions.easing.easeOut,exit:o.transitions.easing.sharp},h={enter:o.transitions.duration.enteringScreen,exit:o.transitions.duration.leavingScreen},{addEndListener:s,appear:i=!0,children:d,container:f,direction:u="down",easing:C=r,in:y,onEnter:b,onEntered:M,onEntering:I,onExit:D,onExited:j,onExiting:g,style:W,timeout:X=h,TransitionComponent:O=Yt,...G}=e,x=m.useRef(null),B=$t(Xt(d),x,n),k=l=>w=>{l&&(w===void 0?l(x.current):l(x.current,w))},ot=k((l,w)=>{ht(u,l,f),Ut(l),b&&b(l,w)}),st=k((l,w)=>{const A=St({timeout:X,style:W,easing:C},{mode:"enter"});l.style.webkitTransition=o.transitions.create("-webkit-transform",{...A}),l.style.transition=o.transitions.create("transform",{...A}),l.style.webkitTransform="none",l.style.transform="none",I&&I(l,w)}),N=k(M),a=k(g),$=k(l=>{const w=St({timeout:X,style:W,easing:C},{mode:"exit"});l.style.webkitTransition=o.transitions.create("-webkit-transform",w),l.style.transition=o.transitions.create("transform",w),ht(u,l,f),D&&D(l)}),U=k(l=>{l.style.webkitTransition="",l.style.transition="",j&&j(l)}),S=l=>{s&&s(x.current,l)},V=m.useCallback(()=>{x.current&&ht(u,x.current,f)},[u,f]);return m.useEffect(()=>{if(y||u==="down"||u==="right")return;const l=Bt(()=>{x.current&&ht(u,x.current,f)}),w=tt(x.current);return w.addEventListener("resize",l),()=>{l.clear(),w.removeEventListener("resize",l)}},[u,y,f]),m.useEffect(()=>{y||V()},[y,V]),p.jsx(O,{nodeRef:x,onEnter:ot,onEntered:N,onEntering:st,onExit:$,onExited:U,onExiting:a,addEndListener:S,appear:i,in:y,timeout:X,...G,children:(l,{ownerState:w,...A})=>m.cloneElement(d,{ref:B,style:{visibility:l==="exited"&&!y?"hidden":void 0,...W,...d.props.style},...A})})});function fe(t){return Dt("MuiDrawer",t)}Gt("MuiDrawer",["root","docked","paper","anchorLeft","anchorRight","anchorTop","anchorBottom","paperAnchorLeft","paperAnchorRight","paperAnchorTop","paperAnchorBottom","paperAnchorDockedLeft","paperAnchorDockedRight","paperAnchorDockedTop","paperAnchorDockedBottom","modal"]);const It=(t,e)=>{const{ownerState:n}=t;return[e.root,(n.variant==="permanent"||n.variant==="persistent")&&e.docked,e.modal]},he=t=>{const{classes:e,anchor:n,variant:o}=t,r={root:["root",`anchor${Y(n)}`],docked:[(o==="permanent"||o==="persistent")&&"docked"],modal:["modal"],paper:["paper",`paperAnchor${Y(n)}`,o!=="temporary"&&`paperAnchorDocked${Y(n)}`]};return Mt(r,fe,e)},me=nt(Vt,{name:"MuiDrawer",slot:"Root",overridesResolver:It})(bt(({theme:t})=>({zIndex:(t.vars||t).zIndex.drawer}))),ge=nt("div",{shouldForwardProp:At,name:"MuiDrawer",slot:"Docked",skipVariantsResolver:!1,overridesResolver:It})({flex:"0 0 auto"}),xe=nt(Jt,{name:"MuiDrawer",slot:"Paper",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.paper,e[`paperAnchor${Y(n.anchor)}`],n.variant!=="temporary"&&e[`paperAnchorDocked${Y(n.anchor)}`]]}})(bt(({theme:t})=>({overflowY:"auto",display:"flex",flexDirection:"column",height:"100%",flex:"1 0 auto",zIndex:(t.vars||t).zIndex.drawer,WebkitOverflowScrolling:"touch",position:"fixed",top:0,outline:0,variants:[{props:{anchor:"left"},style:{left:0}},{props:{anchor:"top"},style:{top:0,left:0,right:0,height:"auto",maxHeight:"100%"}},{props:{anchor:"right"},style:{right:0}},{props:{anchor:"bottom"},style:{top:"auto",left:0,bottom:0,right:0,height:"auto",maxHeight:"100%"}},{props:({ownerState:e})=>e.anchor==="left"&&e.variant!=="temporary",style:{borderRight:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="top"&&e.variant!=="temporary",style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="right"&&e.variant!=="temporary",style:{borderLeft:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="bottom"&&e.variant!=="temporary",style:{borderTop:`1px solid ${(t.vars||t).palette.divider}`}}]}))),Wt={left:"right",right:"left",top:"down",bottom:"up"};function _(t){return["left","right"].includes(t)}function ct({direction:t},e){return t==="rtl"&&_(e)?Wt[e]:e}const ye=m.forwardRef(function(e,n){const o=Ct({props:e,name:"MuiDrawer"}),r=Pt(),h=_t(),s={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{anchor:i="left",BackdropProps:d,children:f,className:u,elevation:C=16,hideBackdrop:y=!1,ModalProps:{BackdropProps:b,...M}={},onClose:I,open:D=!1,PaperProps:j={},SlideProps:g,TransitionComponent:W,transitionDuration:X=s,variant:O="temporary",slots:G={},slotProps:x={},...B}=o,k=m.useRef(!1);m.useEffect(()=>{k.current=!0},[]);const ot=ct({direction:h?"rtl":"ltr"},i),N={...o,anchor:i,elevation:C,open:D,variant:O,...B},a=he(N),$={slots:{transition:W,...G},slotProps:{paper:j,transition:g,...x,backdrop:Tt(x.backdrop||{...d,...b},{transitionDuration:X})}},[U,S]=it("root",{ref:n,elementType:me,className:lt(a.root,a.modal,u),shouldForwardComponentProp:!0,ownerState:N,externalForwardedProps:{...$,...B,...M},additionalProps:{open:D,onClose:I,hideBackdrop:y,slots:{backdrop:$.slots.backdrop},slotProps:{backdrop:$.slotProps.backdrop}}}),[V,l]=it("paper",{elementType:xe,shouldForwardComponentProp:!0,className:lt(a.paper,j.className),ownerState:N,externalForwardedProps:$,additionalProps:{elevation:O==="temporary"?C:0,square:!0}}),[w,A]=it("docked",{elementType:ge,ref:n,className:lt(a.root,a.docked,u),ownerState:N,externalForwardedProps:$,additionalProps:B}),[J,pt]=it("transition",{elementType:de,ownerState:N,externalForwardedProps:$,additionalProps:{in:D,direction:Wt[ot],timeout:X,appear:k.current}}),K=p.jsx(V,{...l,children:f});if(O==="permanent")return p.jsx(w,{...A,children:K});const Q=p.jsx(J,{...pt,children:K});return O==="persistent"?p.jsx(w,{...A,children:Q}):p.jsx(U,{...S,children:Q})});function we(t){const{children:e,defer:n=!1,fallback:o=null}=t,[r,h]=m.useState(!1);return Lt(()=>{n||h(!0)},[n]),m.useEffect(()=>{n&&h(!0)},[n]),r?e:o}const Se=nt("div",{shouldForwardProp:At})(bt(({theme:t})=>({position:"fixed",top:0,left:0,bottom:0,zIndex:t.zIndex.drawer-1,variants:[{props:{anchor:"left"},style:{right:"auto"}},{props:{anchor:"right"},style:{left:"auto",right:0}},{props:{anchor:"top"},style:{bottom:"auto",right:0}},{props:{anchor:"bottom"},style:{top:"auto",bottom:0,right:0}}]}))),Te=m.forwardRef(function(e,n){const{anchor:o,classes:r={},className:h,width:s,style:i,...d}=e,f=e;return p.jsx(Se,{className:lt("PrivateSwipeArea-root",r.root,r[`anchor${Y(o)}`],h),ref:n,style:{[_(o)?"width":"height"]:s,...i},ownerState:f,...d})}),mt=3,Et=20;let q=null;function yt(t,e,n){return t==="right"?n.body.offsetWidth-e[0].pageX:e[0].pageX}function wt(t,e,n){return t==="bottom"?n.innerHeight-e[0].clientY:e[0].clientY}function at(t,e){return t?e.clientWidth:e.clientHeight}function vt(t,e,n,o){return Math.min(Math.max(n?e-t:o+e-t,0),o)}function Ce(t,e){const n=[];for(;t&&t!==e.parentElement;){const o=tt(e).getComputedStyle(t);o.getPropertyValue("position")==="absolute"||o.getPropertyValue("overflow-x")==="hidden"||(t.clientWidth>0&&t.scrollWidth>t.clientWidth||t.clientHeight>0&&t.scrollHeight>t.clientHeight)&&n.push(t),t=t.parentElement}return n}function Pe({domTreeShapes:t,start:e,current:n,anchor:o}){const r={scrollPosition:{x:"scrollLeft",y:"scrollTop"},scrollLength:{x:"scrollWidth",y:"scrollHeight"},clientLength:{x:"clientWidth",y:"clientHeight"}};return t.some(h=>{let s=n>=e;(o==="top"||o==="left")&&(s=!s);const i=o==="left"||o==="right"?"x":"y",d=Math.round(h[r.scrollPosition[i]]),f=d>0,u=d+h[r.clientLength[i]]<h[r.scrollLength[i]];return!!(s&&u||!s&&f)})}const be=typeof navigator<"u"&&/iPad|iPhone|iPod/.test(navigator.userAgent),ke=m.forwardRef(function(e,n){const o=Ct({name:"MuiSwipeableDrawer",props:e}),r=Pt(),h={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{anchor:s="left",disableBackdropTransition:i=!1,disableDiscovery:d=!1,disableSwipeToOpen:f=be,hideBackdrop:u,hysteresis:C=.52,allowSwipeInChildren:y=!1,minFlingVelocity:b=450,ModalProps:{BackdropProps:M,...I}={},onClose:D,onOpen:j,open:g=!1,PaperProps:W={},SwipeAreaProps:X,swipeAreaWidth:O=20,transitionDuration:G=h,variant:x="temporary",slots:B={},slotProps:k={},...ot}=o,[st,N]=m.useState(!1),a=m.useRef({isSwiping:null}),$=m.useRef(),U=m.useRef(),S=m.useRef(),V=$t(W.ref,S),l=m.useRef(!1),w=m.useRef();Lt(()=>{w.current=null},[g]);const A=m.useCallback((c,L={})=>{const{mode:T=null,changeTransition:P=!0}=L,R=ct(r,s),E=["right","bottom"].includes(R)?1:-1,F=_(s),H=F?`translate(${E*c}px, 0)`:`translate(0, ${E*c}px)`,Z=S.current.style;Z.webkitTransform=H,Z.transform=H;let v="";if(T&&(v=r.transitions.create("all",St({easing:void 0,style:void 0,timeout:G},{mode:T}))),P&&(Z.webkitTransition=v,Z.transition=v),!i&&!u){const z=U.current.style;z.opacity=1-c/at(F,S.current),P&&(z.webkitTransition=v,z.transition=v)}},[s,i,u,r,G]),J=xt(c=>{if(!l.current)return;if(q=null,l.current=!1,Rt.flushSync(()=>{N(!1)}),!a.current.isSwiping){a.current.isSwiping=null;return}a.current.isSwiping=null;const L=ct(r,s),T=_(s);let P;T?P=yt(L,c.changedTouches,ft(c.currentTarget)):P=wt(L,c.changedTouches,tt(c.currentTarget));const R=T?a.current.startX:a.current.startY,E=at(T,S.current),F=vt(P,R,g,E),H=F/E;if(Math.abs(a.current.velocity)>b&&(w.current=Math.abs((E-F)/a.current.velocity)*1e3),g){a.current.velocity>b||H>C?D():A(0,{mode:"exit"});return}a.current.velocity<-b||1-H>C?j():A(at(T,S.current),{mode:"enter"})}),pt=(c=!1)=>{if(!st){(c||!(d&&y))&&Rt.flushSync(()=>{N(!0)});const L=_(s);!g&&S.current&&A(at(L,S.current)+(d?15:-20),{changeTransition:!1}),a.current.velocity=0,a.current.lastTime=null,a.current.lastTranslate=null,a.current.paperHit=!1,l.current=!0}},K=xt(c=>{if(!S.current||!l.current||q!==null&&q!==a.current)return;pt(!0);const L=ct(r,s),T=_(s),P=yt(L,c.touches,ft(c.currentTarget)),R=wt(L,c.touches,tt(c.currentTarget));if(g&&S.current.contains(c.target)&&q===null){const v=Ce(c.target,S.current);if(Pe({domTreeShapes:v,start:T?a.current.startX:a.current.startY,current:T?P:R,anchor:s})){q=!0;return}q=a.current}if(a.current.isSwiping==null){const v=Math.abs(P-a.current.startX),z=Math.abs(R-a.current.startY),dt=T?v>z&&v>mt:z>v&&z>mt;if(dt&&c.cancelable&&c.preventDefault(),dt===!0||(T?z>mt:v>mt)){if(a.current.isSwiping=dt,!dt){J(c);return}a.current.startX=P,a.current.startY=R,!d&&!g&&(T?a.current.startX-=Et:a.current.startY-=Et)}}if(!a.current.isSwiping)return;const E=at(T,S.current);let F=T?a.current.startX:a.current.startY;g&&!a.current.paperHit&&(F=Math.min(F,E));const H=vt(T?P:R,F,g,E);if(g)if(a.current.paperHit)H===0&&(a.current.startX=P,a.current.startY=R);else if(T?P<E:R<E)a.current.paperHit=!0,a.current.startX=P,a.current.startY=R;else return;a.current.lastTranslate===null&&(a.current.lastTranslate=H,a.current.lastTime=performance.now()+1);const Z=(H-a.current.lastTranslate)/(performance.now()-a.current.lastTime)*1e3;a.current.velocity=a.current.velocity*.4+Z*.6,a.current.lastTranslate=H,a.current.lastTime=performance.now(),c.cancelable&&c.preventDefault(),A(H)}),Q=xt(c=>{var E;if(c.defaultPrevented||c.defaultMuiPrevented||g&&(u||!U.current.contains(c.target))&&!S.current.contains(c.target))return;const L=ct(r,s),T=_(s),P=yt(L,c.touches,ft(c.currentTarget)),R=wt(L,c.touches,tt(c.currentTarget));if(!g){if(f||!(c.target===$.current||(E=S.current)!=null&&E.contains(c.target)&&(typeof y=="function"?y(c,$.current,S.current):y)))return;if(T){if(P>O)return}else if(R>O)return}c.defaultMuiPrevented=!0,q=null,a.current.startX=P,a.current.startY=R,pt()});m.useEffect(()=>{if(x==="temporary"){const c=ft(S.current);return c.addEventListener("touchstart",Q),c.addEventListener("touchmove",K,{passive:!g}),c.addEventListener("touchend",J),()=>{c.removeEventListener("touchstart",Q),c.removeEventListener("touchmove",K,{passive:!g}),c.removeEventListener("touchend",J)}}},[x,g,Q,K,J]),m.useEffect(()=>()=>{q===a.current&&(q=null)},[]),m.useEffect(()=>{g||N(!1)},[g]);const[Ft,zt]=it("swipeArea",{ref:$,elementType:Te,ownerState:o,externalForwardedProps:{slots:B,slotProps:{swipeArea:X,...k}},additionalProps:{width:O,anchor:s}});return p.jsxs(m.Fragment,{children:[p.jsx(ye,{open:x==="temporary"&&st?!0:g,variant:x,ModalProps:{BackdropProps:{...M,ref:U},...x==="temporary"&&{keepMounted:!0},...I},hideBackdrop:u,anchor:s,transitionDuration:w.current||G,onClose:D,ref:n,slots:B,slotProps:{...k,backdrop:Tt(k.backdrop??M,{ref:U}),paper:Tt(k.paper??W,{style:{pointerEvents:x==="temporary"&&!g&&!y?"none":""},ref:V})},...ot}),!f&&x==="temporary"&&p.jsx(we,{children:p.jsx(Ft,{...zt})})]})}),Re=kt(p.jsx("path",{d:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"})),We=()=>{const[t,e]=m.useState(null),n=r=>e(r.currentTarget),o=()=>e(null);return p.jsxs(p.Fragment,{children:[p.jsx(ne,{title:"切換主題",arrow:!0,children:p.jsx(Ht,{onClick:n,children:p.jsx(re,{fontSize:"small"})})}),p.jsx(Ee,{open:!!t,anchorEl:t,onClose:o,anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"}})]})},Ee=({onClose:t,...e})=>{const{mode:n,setMode:o}=jt(),r=h=>()=>{o(h),t()};return p.jsx(Zt,{anchorOrigin:{horizontal:"right",vertical:"top"},onClose:t,...e,children:p.jsxs(Nt,{dense:!0,children:[p.jsx(et,{onClick:r("light"),selected:n==="light",children:"淺色"}),p.jsx(et,{onClick:r("dark"),selected:n==="dark",children:"暗色"}),p.jsx(et,{onClick:r("system"),selected:n==="system",children:"跟隨系統"})]})})},ve=nt("div")(({theme:t})=>({width:30,height:6,backgroundColor:t.palette.divider,borderRadius:3,position:"relative",left:"calc(50% - 15px)",...t.applyStyles("dark",{backgroundColor:t.palette.divider})})),Oe=({onClose:t,...e})=>{const{mode:n,setMode:o}=jt(),r=h=>()=>{o(h),t()};return p.jsxs(ke,{anchor:"top",onClose:t,...e,children:[p.jsxs(Kt,{sx:{p:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[p.jsx(Qt,{variant:"h6",children:"切換主題"}),p.jsx(Ht,{onClick:t,children:p.jsx(Re,{})})]}),p.jsxs(Nt,{dense:!0,children:[p.jsx(et,{onClick:r("light"),selected:n==="light",children:"淺色"}),p.jsx(et,{onClick:r("dark"),selected:n==="dark",children:"暗色"}),p.jsx(et,{onClick:r("system"),selected:n==="system",children:"跟隨系統"})]}),p.jsx(ve,{sx:{mb:2}})]})},Fe=kt(p.jsx("path",{d:"M13.35 20.13c-.76.69-1.93.69-2.69-.01l-.11-.1C5.3 15.27 1.87 12.16 2 8.28c.06-1.7.93-3.33 2.34-4.29 2.64-1.8 5.9-.96 7.66 1.1 1.76-2.06 5.02-2.91 7.66-1.1 1.41.96 2.28 2.59 2.34 4.29.14 3.88-3.3 6.99-8.55 11.76z"})),Me=async({topic:t}={})=>{var s;const e=[],n={};t&&(e.push("EXISTS (SELECT 1 FROM json_each(tags) WHERE value = $topic)"),n.$topic=t);const r=`
      SELECT COUNT(*) as totalCount
      FROM posts
      ${e.length>0?`WHERE ${e.join(" AND ")}`:""}
    `;return((s=(await rt.exec(r,n))[0])==null?void 0:s.totalCount)||0},Ot=async({page:t=0,limit:e=10,topic:n,userId:o,orderBy:r="createdAt",order:h="desc"}={})=>{var g;const s=[],i={};n&&(s.push("EXISTS (SELECT 1 FROM json_each(tags) WHERE value = $topic)"),i.$topic=n),o&&(s.push("userId = $userId"),i.$userId=o);const d=s.length>0?`WHERE ${s.join(" AND ")}`:"";let f="p.createdAt";r==="likeCount"||r==="commentCount"?f=`pic.${r}`:r==="createdAt"||r==="updatedAt"?f=`datetime(p.${r})`:f=`p.${r}`;const u=`
      SELECT COUNT(*) as totalCount
      FROM posts
      ${d}
    `,y=((g=(await rt.exec(u,i))[0])==null?void 0:g.totalCount)||0,b=Math.ceil(y/e),M=t+1<b?t+1:null;i.$limit=e,i.$offset=t*e;const I=`
        SELECT id
        FROM posts p
        LEFT JOIN post_interaction_counts pic ON p.id = pic.postId
        ${d}
        ORDER BY ${f} ${h.toUpperCase()}, p.createdAt DESC
        LIMIT $limit OFFSET $offset
      `;return{posts:(await rt.exec(I,i)).map(W=>W.id),nextPage:M,totalPages:b}},De=async()=>{const e=await rt.exec("SELECT uniqueTags FROM tag_stats");if(e.length===0)return[];const n=e[0].uniqueTags,o=JSON.parse(n);return Array.isArray(o)?o:[]},$e=async({postId:t,incrementViewCount:e=!1})=>{e&&await rt.exec("UPDATE posts SET viewCount = viewCount + 1 WHERE id = $postId",{$postId:t});const o=await rt.exec(`
      SELECT
        p.id,
        p.title,
        p.content,
        p.tags,
        p.photos,
        p.attachments,
        p.viewCount,
        p.createdAt,
        p.updatedAt,
        p.userId,
        u.name as userName,
        COALESCE(pic.likeCount, 0) as likeCount,
        COALESCE(pic.commentCount, 0) as commentCount
      FROM
        posts p
      JOIN
        users u ON p.userId = u.id
      LEFT JOIN
        post_interaction_counts pic ON p.id = pic.postId
      WHERE
        p.id = $postId
    `,{$postId:t});if(o.length===0)return null;const r=o[0];return{...r,tags:JSON.parse(r.tags||"[]"),photos:r.photos?JSON.parse(r.photos):void 0,attachments:r.attachments?JSON.parse(r.attachments):void 0,createdAt:new Date(r.createdAt),updatedAt:new Date(r.updatedAt),likeCount:r.likeCount||0,commentCount:r.commentCount||0}},ut=1*60*1e3,ze=({limit:t,topic:e,userId:n,orderBy:o,order:r}={})=>gt({queryKey:["posts",t,e,n,o,r],queryFn:async()=>(await Ot({page:0,limit:t,topic:e,userId:n,orderBy:o,order:r})).posts,staleTime:ut}),qe=({topic:t}={})=>gt({queryKey:["postCounts",t],queryFn:()=>Me({topic:t}),staleTime:ut}),Ye=({limit:t=6,topic:e,userId:n,orderBy:o,order:r}={})=>{const{data:h,fetchNextPage:s,hasNextPage:i,isFetchingNextPage:d,isLoading:f}=oe({queryKey:["infinitePosts",t,e,n,o,r],queryFn:({pageParam:u})=>Ot({page:u,limit:t,topic:e,userId:n,orderBy:o,order:r}),initialPageParam:0,getNextPageParam:u=>u.nextPage,staleTime:ut});return m.useEffect(()=>{const u=document.getElementById("scroll-area");if(!u)return;const C=()=>{const y=u.scrollHeight,b=u.scrollTop,M=u.clientHeight;b+M>=y-350&&i&&!d&&s()};return u.addEventListener("scroll",C),()=>u.removeEventListener("scroll",C)},[s,i,d]),{data:h,isLoading:f,isFetchingNextPage:d,hasNextPage:i,fetchNextPage:s}},Xe=()=>gt({queryKey:["tags"],queryFn:De,staleTime:ut}),Be=({postId:t,incrementViewCount:e})=>gt({queryKey:["post",t],queryFn:()=>t===void 0||Number.isNaN(t)?null:$e({postId:t,incrementViewCount:e}),enabled:t!==void 0&&!Number.isNaN(t)&&t>=0,staleTime:ut}),Ue=kt(p.jsx("path",{d:"M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4zM17 14H7c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1s-.45 1-1 1m0-3H7c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1s-.45 1-1 1m0-3H7c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1s-.45 1-1 1"}));export{Ue as C,Fe as F,ke as S,We as T,Be as a,Xe as b,Ie as c,qe as d,Ye as e,Re as f,Oe as g,ze as u};
