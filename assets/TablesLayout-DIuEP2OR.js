import{r as m,u as $,as as ve,a9 as bt,a3 as ht,j as o,s as j,c as R,d as L,y as _e,ap as yt,m as N,J as _,V as k,l as f,aT as Ie,n as Te,g as E,a as W,b as D,aL as ft,aM as vt,aa as Ct,I as K,W as Be,al as jt,aU as Tt,aV as Y,aW as ke,o as I,P as wt,ab as St,v as Ge,F as Rt,t as Je,B as oe,S as Pt}from"./routes-BRvtlvXq.js";import{a as Ke}from"./ArrowDropDownRounded-C7zQ0_DO.js";import{g as It,l as X,F as qe,L as he}from"./FilterAltRounded-C8jGX9br.js";import{e as Bt,a as kt,g as Mt}from"./main-xCf6ZRk3.js";import{u as pe}from"./url-CRkyn8d-.js";import{t as Qe,u as $t}from"./SQLiteClient-lcooyUxK.js";import{t as Lt}from"./array-l11GhOAf.js";import{z as Me}from"./index-mSkvzYyn.js";import{T as we}from"./DarkModeRounded-C3T8P242.js";import{C as q}from"./Checkbox-BwGiCVeK.js";import{a as Ft,l as ce,M as Ce}from"./MenuItem-MMlOtQiM.js";import{D as Se,I as Nt}from"./ExpandMoreRounded-DEjStDxu.js";import{A as Ht}from"./AddRounded-CXRyukk2.js";import{S as At}from"./SortRounded-9qcQWqJJ.js";import{S as se}from"./Skeleton-Cf8Gl-YI.js";import{a as zt,K as Ot}from"./KeyboardArrowRight-BW_ZqJFT.js";import{T as Ut}from"./Toolbar-Dov2wVhH.js";import"./RefreshRounded-Dg1hhxAj.js";import"./DataExplorationRounded-CBNK2XNk.js";import"./NotificationsRounded-GyKBo_oY.js";import"./fuse-Bxxm0l84.js";import"./useMutation-DAbBpaTp.js";import"./dayjs.min-BcXpWxsR.js";import"./Badge-DkXiDsZB.js";import"./DownloadRounded-BLjxSu8L.js";import"./SwitchBase-C_P1oZA7.js";const Dt=(e,t)=>{const{ownerState:s}=e;return[t.root,s.dense&&t.dense,s.alignItems==="flex-start"&&t.alignItemsFlexStart,s.divider&&t.divider,!s.disableGutters&&t.gutters]},Et=e=>{const{alignItems:t,classes:s,dense:r,disabled:l,disableGutters:a,divider:n,selected:c}=e,i=L({root:["root",r&&"dense",!a&&"gutters",n&&"divider",l&&"disabled",t==="flex-start"&&"alignItemsFlexStart",c&&"selected"]},It,s);return{...s,...i}},Wt=j(_e,{shouldForwardProp:e=>yt(e)||e==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:Dt})(N(({theme:e})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${X.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:_(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${X.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:_(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${X.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:_(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:_(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${X.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${X.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},variants:[{props:({ownerState:t})=>t.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:t})=>!t.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:t})=>t.dense,style:{paddingTop:4,paddingBottom:4}}]}))),$e=m.forwardRef(function(t,s){const r=$({props:t,name:"MuiListItemButton"}),{alignItems:l="center",autoFocus:a=!1,component:n="div",children:c,dense:d=!1,disableGutters:i=!1,divider:p=!1,focusVisibleClassName:u,selected:y=!1,className:b,...x}=r,v=m.useContext(ve),g=m.useMemo(()=>({dense:d||v.dense||!1,alignItems:l,disableGutters:i}),[l,v.dense,d,i]),h=m.useRef(null);bt(()=>{a&&h.current&&h.current.focus()},[a]);const C={...r,alignItems:l,dense:g.dense,disableGutters:i,divider:p,selected:y},w=Et(C),M=ht(h,s);return o.jsx(ve.Provider,{value:g,children:o.jsx(Wt,{ref:M,href:x.href||x.to,component:(x.href||x.to)&&n==="div"?"button":n,focusVisibleClassName:R(w.focusVisible,u),ownerState:C,className:R(w.root,b),...x,classes:w,children:c})})}),Vt=e=>{const{classes:t,inset:s,primary:r,secondary:l,dense:a}=e;return L({root:["root",s&&"inset",a&&"dense",r&&l&&"multiline"],primary:["primary"],secondary:["secondary"]},Ft,t)},_t=j("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[{[`& .${ce.primary}`]:t.primary},{[`& .${ce.secondary}`]:t.secondary},t.root,s.inset&&t.inset,s.primary&&s.secondary&&t.multiline,s.dense&&t.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${Ie.root}:where(& .${ce.primary})`]:{display:"block"},[`.${Ie.root}:where(& .${ce.secondary})`]:{display:"block"},variants:[{props:({ownerState:e})=>e.primary&&e.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:e})=>e.inset,style:{paddingLeft:56}}]}),Le=m.forwardRef(function(t,s){const r=$({props:t,name:"MuiListItemText"}),{children:l,className:a,disableTypography:n=!1,inset:c=!1,primary:d,primaryTypographyProps:i,secondary:p,secondaryTypographyProps:u,slots:y={},slotProps:b={},...x}=r,{dense:v}=m.useContext(ve);let g=d??l,h=p;const C={...r,disableTypography:n,inset:c,primary:!!g,secondary:!!h,dense:v},w=Vt(C),M={slots:y,slotProps:{primary:i,secondary:u,...b}},[H,F]=k("root",{className:R(w.root,a),elementType:_t,externalForwardedProps:{...M,...x},ownerState:C,ref:s}),[G,A]=k("primary",{className:w.primary,elementType:f,externalForwardedProps:M,ownerState:C}),[P,T]=k("secondary",{className:w.secondary,elementType:f,externalForwardedProps:M,ownerState:C});return g!=null&&g.type!==f&&!n&&(g=o.jsx(G,{variant:v?"body2":"body1",component:A!=null&&A.variant?void 0:"span",...A,children:g})),h!=null&&h.type!==f&&!n&&(h=o.jsx(P,{variant:"body2",color:"textSecondary",...T,children:h})),o.jsxs(H,{...F,children:[g,h]})}),Gt=Te(o.jsx("path",{d:"M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"})),Jt=Te(o.jsx("path",{d:"M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"})),Ye=m.createContext();function Kt(e){return E("MuiTable",e)}W("MuiTable",["root","stickyHeader"]);const qt=e=>{const{classes:t,stickyHeader:s}=e;return L({root:["root",s&&"stickyHeader"]},Kt,t)},Qt=j("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.stickyHeader&&t.stickyHeader]}})(N(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:t})=>t.stickyHeader,style:{borderCollapse:"separate"}}]}))),Fe="table",Yt=m.forwardRef(function(t,s){const r=$({props:t,name:"MuiTable"}),{className:l,component:a=Fe,padding:n="normal",size:c="medium",stickyHeader:d=!1,...i}=r,p={...r,component:a,padding:n,size:c,stickyHeader:d},u=qt(p),y=m.useMemo(()=>({padding:n,size:c,stickyHeader:d}),[n,c,d]);return o.jsx(Ye.Provider,{value:y,children:o.jsx(Qt,{as:a,role:a===Fe?null:"table",ref:s,className:R(u.root,l),ownerState:p,...i})})}),re=m.createContext();function Xt(e){return E("MuiTableBody",e)}W("MuiTableBody",["root"]);const Zt=e=>{const{classes:t}=e;return L({root:["root"]},Xt,t)},eo=j("tbody",{name:"MuiTableBody",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-row-group"}),to={variant:"body"},Ne="tbody",oo=m.forwardRef(function(t,s){const r=$({props:t,name:"MuiTableBody"}),{className:l,component:a=Ne,...n}=r,c={...r,component:a},d=Zt(c);return o.jsx(re.Provider,{value:to,children:o.jsx(eo,{className:R(d.root,l),as:a,ref:s,role:a===Ne?null:"rowgroup",ownerState:c,...n})})});function so(e){return E("MuiTableCell",e)}const no=W("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),ro=e=>{const{classes:t,variant:s,align:r,padding:l,size:a,stickyHeader:n}=e,c={root:["root",s,n&&"stickyHeader",r!=="inherit"&&`align${D(r)}`,l!=="normal"&&`padding${D(l)}`,`size${D(a)}`]};return L(c,so,t)},ao=j("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,t[s.variant],t[`size${D(s.size)}`],s.padding!=="normal"&&t[`padding${D(s.padding)}`],s.align!=="inherit"&&t[`align${D(s.align)}`],s.stickyHeader&&t.stickyHeader]}})(N(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?ft(_(e.palette.divider,1),.88):vt(_(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${no.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:t})=>t.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),S=m.forwardRef(function(t,s){const r=$({props:t,name:"MuiTableCell"}),{align:l="inherit",className:a,component:n,padding:c,scope:d,size:i,sortDirection:p,variant:u,...y}=r,b=m.useContext(Ye),x=m.useContext(re),v=x&&x.variant==="head";let g;n?g=n:g=v?"th":"td";let h=d;g==="td"?h=void 0:!h&&v&&(h="col");const C=u||x&&x.variant,w={...r,align:l,component:g,padding:c||(b&&b.padding?b.padding:"normal"),size:i||(b&&b.size?b.size:"medium"),sortDirection:p,stickyHeader:C==="head"&&b&&b.stickyHeader,variant:C},M=ro(w);let H=null;return p&&(H=p==="asc"?"ascending":"descending"),o.jsx(ao,{as:g,ref:s,className:R(M.root,a),"aria-sort":H,scope:h,ownerState:w,...y})});function lo(e){return E("MuiTableContainer",e)}W("MuiTableContainer",["root"]);const io=e=>{const{classes:t}=e;return L({root:["root"]},lo,t)},co=j("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(e,t)=>t.root})({width:"100%",overflowX:"auto"}),po=m.forwardRef(function(t,s){const r=$({props:t,name:"MuiTableContainer"}),{className:l,component:a="div",...n}=r,c={...r,component:a},d=io(c);return o.jsx(co,{ref:s,as:a,className:R(d.root,l),ownerState:c,...n})});function uo(e){return E("MuiTableFooter",e)}W("MuiTableFooter",["root"]);const xo=e=>{const{classes:t}=e;return L({root:["root"]},uo,t)},mo=j("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-footer-group"}),go={variant:"footer"},He="tfoot",bo=m.forwardRef(function(t,s){const r=$({props:t,name:"MuiTableFooter"}),{className:l,component:a=He,...n}=r,c={...r,component:a},d=xo(c);return o.jsx(re.Provider,{value:go,children:o.jsx(mo,{as:a,className:R(d.root,l),ref:s,role:a===He?null:"rowgroup",ownerState:c,...n})})});function ho(e){return E("MuiTableHead",e)}W("MuiTableHead",["root"]);const yo=e=>{const{classes:t}=e;return L({root:["root"]},ho,t)},fo=j("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-header-group"}),vo={variant:"head"},Ae="thead",Co=m.forwardRef(function(t,s){const r=$({props:t,name:"MuiTableHead"}),{className:l,component:a=Ae,...n}=r,c={...r,component:a},d=yo(c);return o.jsx(re.Provider,{value:vo,children:o.jsx(fo,{as:a,className:R(d.root,l),ref:s,role:a===Ae?null:"rowgroup",ownerState:c,...n})})}),jo=m.forwardRef(function(t,s){const{backIconButtonProps:r,count:l,disabled:a=!1,getItemAriaLabel:n,nextIconButtonProps:c,onPageChange:d,page:i,rowsPerPage:p,showFirstButton:u,showLastButton:y,slots:b={},slotProps:x={},...v}=t,g=Ct(),h=O=>{d(O,0)},C=O=>{d(O,i-1)},w=O=>{d(O,i+1)},M=O=>{d(O,Math.max(0,Math.ceil(l/p)-1))},H=b.firstButton??K,F=b.lastButton??K,G=b.nextButton??K,A=b.previousButton??K,P=b.firstButtonIcon??Gt,T=b.lastButtonIcon??Jt,B=b.nextButtonIcon??zt,ae=b.previousButtonIcon??Ot,le=g?F:H,ue=g?G:A,ie=g?A:G,xe=g?H:F,z=g?x.lastButton:x.firstButton,me=g?x.nextButton:x.previousButton,ge=g?x.previousButton:x.nextButton,be=g?x.firstButton:x.lastButton;return o.jsxs("div",{ref:s,...v,children:[u&&o.jsx(le,{onClick:h,disabled:a||i===0,"aria-label":n("first",i),title:n("first",i),...z,children:g?o.jsx(T,{...x.lastButtonIcon}):o.jsx(P,{...x.firstButtonIcon})}),o.jsx(ue,{onClick:C,disabled:a||i===0,color:"inherit","aria-label":n("previous",i),title:n("previous",i),...me??r,children:g?o.jsx(B,{...x.nextButtonIcon}):o.jsx(ae,{...x.previousButtonIcon})}),o.jsx(ie,{onClick:w,disabled:a||(l!==-1?i>=Math.ceil(l/p)-1:!1),color:"inherit","aria-label":n("next",i),title:n("next",i),...ge??c,children:g?o.jsx(ae,{...x.previousButtonIcon}):o.jsx(B,{...x.nextButtonIcon})}),y&&o.jsx(xe,{onClick:M,disabled:a||i>=Math.ceil(l/p)-1,"aria-label":n("last",i),title:n("last",i),...be,children:g?o.jsx(P,{...x.firstButtonIcon}):o.jsx(T,{...x.lastButtonIcon})})]})});function To(e){return E("MuiTablePagination",e)}const ee=W("MuiTablePagination",["root","toolbar","spacer","selectLabel","selectRoot","select","selectIcon","input","menuItem","displayedRows","actions"]);var ze;const wo=j(S,{name:"MuiTablePagination",slot:"Root",overridesResolver:(e,t)=>t.root})(N(({theme:e})=>({overflow:"auto",color:(e.vars||e).palette.text.primary,fontSize:e.typography.pxToRem(14),"&:last-child":{padding:0}}))),So=j(Ut,{name:"MuiTablePagination",slot:"Toolbar",overridesResolver:(e,t)=>({[`& .${ee.actions}`]:t.actions,...t.toolbar})})(N(({theme:e})=>({minHeight:52,paddingRight:2,[`${e.breakpoints.up("xs")} and (orientation: landscape)`]:{minHeight:52},[e.breakpoints.up("sm")]:{minHeight:52,paddingRight:2},[`& .${ee.actions}`]:{flexShrink:0,marginLeft:20}}))),Ro=j("div",{name:"MuiTablePagination",slot:"Spacer",overridesResolver:(e,t)=>t.spacer})({flex:"1 1 100%"}),Po=j("p",{name:"MuiTablePagination",slot:"SelectLabel",overridesResolver:(e,t)=>t.selectLabel})(N(({theme:e})=>({...e.typography.body2,flexShrink:0}))),Io=j(Tt,{name:"MuiTablePagination",slot:"Select",overridesResolver:(e,t)=>({[`& .${ee.selectIcon}`]:t.selectIcon,[`& .${ee.select}`]:t.select,...t.input,...t.selectRoot})})({color:"inherit",fontSize:"inherit",flexShrink:0,marginRight:32,marginLeft:8,[`& .${ee.select}`]:{paddingLeft:8,paddingRight:24,textAlign:"right",textAlignLast:"right"}}),Bo=j(Ce,{name:"MuiTablePagination",slot:"MenuItem",overridesResolver:(e,t)=>t.menuItem})({}),ko=j("p",{name:"MuiTablePagination",slot:"DisplayedRows",overridesResolver:(e,t)=>t.displayedRows})(N(({theme:e})=>({...e.typography.body2,flexShrink:0})));function Mo({from:e,to:t,count:s}){return`${e}–${t} of ${s!==-1?s:`more than ${t}`}`}function $o(e){return`Go to ${e} page`}const Lo=e=>{const{classes:t}=e;return L({root:["root"],toolbar:["toolbar"],spacer:["spacer"],selectLabel:["selectLabel"],select:["select"],input:["input"],selectIcon:["selectIcon"],menuItem:["menuItem"],displayedRows:["displayedRows"],actions:["actions"]},To,t)},Xe=m.forwardRef(function(t,s){const r=$({props:t,name:"MuiTablePagination"}),{ActionsComponent:l=jo,backIconButtonProps:a,colSpan:n,component:c=S,count:d,disabled:i=!1,getItemAriaLabel:p=$o,labelDisplayedRows:u=Mo,labelRowsPerPage:y="Rows per page:",nextIconButtonProps:b,onPageChange:x,onRowsPerPageChange:v,page:g,rowsPerPage:h,rowsPerPageOptions:C=[10,25,50,100],SelectProps:w={},showFirstButton:M=!1,showLastButton:H=!1,slotProps:F={},slots:G={},...A}=r,P=r,T=Lo(P),B=(F==null?void 0:F.select)??w,ae=B.native?"option":Bo;let le;(c===S||c==="td")&&(le=n||1e3);const ue=Be(B.id),ie=Be(B.labelId),xe=()=>d===-1?(g+1)*h:h===-1?d:Math.min(d,(g+1)*h),z={slots:G,slotProps:F},[me,ge]=k("root",{ref:s,className:T.root,elementType:wo,externalForwardedProps:{...z,component:c,...A},ownerState:P,additionalProps:{colSpan:le}}),[be,O]=k("toolbar",{className:T.toolbar,elementType:So,externalForwardedProps:z,ownerState:P}),[at,lt]=k("spacer",{className:T.spacer,elementType:Ro,externalForwardedProps:z,ownerState:P}),[it,ct]=k("selectLabel",{className:T.selectLabel,elementType:Po,externalForwardedProps:z,ownerState:P,additionalProps:{id:ie}}),[dt,pt]=k("select",{className:T.select,elementType:Io,externalForwardedProps:z,ownerState:P}),[ut,xt]=k("menuItem",{className:T.menuItem,elementType:ae,externalForwardedProps:z,ownerState:P}),[mt,gt]=k("displayedRows",{className:T.displayedRows,elementType:ko,externalForwardedProps:z,ownerState:P});return o.jsx(me,{...ge,children:o.jsxs(be,{...O,children:[o.jsx(at,{...lt}),C.length>1&&o.jsx(it,{...ct,children:y}),C.length>1&&o.jsx(dt,{variant:"standard",...!B.variant&&{input:ze||(ze=o.jsx(jt,{}))},value:h,onChange:v,id:ue,labelId:ie,...B,classes:{...B.classes,root:R(T.input,T.selectRoot,(B.classes||{}).root),select:R(T.select,(B.classes||{}).select),icon:R(T.selectIcon,(B.classes||{}).icon)},disabled:i,...pt,children:C.map(U=>m.createElement(ut,{...xt,key:U.label?U.label:U,value:U.value?U.value:U},U.label?U.label:U))}),o.jsx(mt,{...gt,children:u({from:d===0?0:g*h+1,to:xe(),count:d===-1?-1:d,page:g})}),o.jsx(l,{className:T.actions,backIconButtonProps:a,count:d,nextIconButtonProps:b,onPageChange:x,page:g,rowsPerPage:h,showFirstButton:M,showLastButton:H,slotProps:F.actions,slots:G.actions,getItemAriaLabel:p,disabled:i})]})})});function Fo(e){return E("MuiTableRow",e)}const Oe=W("MuiTableRow",["root","selected","hover","head","footer"]),No=e=>{const{classes:t,selected:s,hover:r,head:l,footer:a}=e;return L({root:["root",s&&"selected",r&&"hover",l&&"head",a&&"footer"]},Fo,t)},Ho=j("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.head&&t.head,s.footer&&t.footer]}})(N(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${Oe.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${Oe.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:_(e.palette.primary.main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:_(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity)}}}))),Ue="tr",J=m.forwardRef(function(t,s){const r=$({props:t,name:"MuiTableRow"}),{className:l,component:a=Ue,hover:n=!1,selected:c=!1,...d}=r,i=m.useContext(re),p={...r,component:a,hover:n,selected:c,head:i&&i.variant==="head",footer:i&&i.variant==="footer"},u=No(p);return o.jsx(Ho,{as:a,ref:s,className:R(u.root,l),role:a===Ue?null:"row",ownerState:p,...d})}),Ao=Te(o.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}));function zo(e){return E("MuiTableSortLabel",e)}const ye=W("MuiTableSortLabel",["root","active","icon","iconDirectionDesc","iconDirectionAsc","directionDesc","directionAsc"]),Oo=e=>{const{classes:t,direction:s,active:r}=e,l={root:["root",r&&"active",`direction${D(s)}`],icon:["icon",`iconDirection${D(s)}`]};return L(l,zo,t)},Uo=j(_e,{name:"MuiTableSortLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.active&&t.active]}})(N(({theme:e})=>({cursor:"pointer",display:"inline-flex",justifyContent:"flex-start",flexDirection:"inherit",alignItems:"center","&:focus":{color:(e.vars||e).palette.text.secondary},"&:hover":{color:(e.vars||e).palette.text.secondary,[`& .${ye.icon}`]:{opacity:.5}},[`&.${ye.active}`]:{color:(e.vars||e).palette.text.primary,[`& .${ye.icon}`]:{opacity:1,color:(e.vars||e).palette.text.secondary}}}))),Do=j("span",{name:"MuiTableSortLabel",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.icon,t[`iconDirection${D(s.direction)}`]]}})(N(({theme:e})=>({fontSize:18,marginRight:4,marginLeft:4,opacity:0,transition:e.transitions.create(["opacity","transform"],{duration:e.transitions.duration.shorter}),userSelect:"none",variants:[{props:{direction:"desc"},style:{transform:"rotate(0deg)"}},{props:{direction:"asc"},style:{transform:"rotate(180deg)"}}]}))),Eo=m.forwardRef(function(t,s){const r=$({props:t,name:"MuiTableSortLabel"}),{active:l=!1,children:a,className:n,direction:c="asc",hideSortIcon:d=!1,IconComponent:i=Ao,slots:p={},slotProps:u={},...y}=r,b={...r,active:l,direction:c,hideSortIcon:d,IconComponent:i},x=Oo(b),v={slots:p,slotProps:u},[g,h]=k("root",{elementType:Uo,externalForwardedProps:v,ownerState:b,className:R(x.root,n),ref:s}),[C,w]=k("icon",{elementType:Do,externalForwardedProps:v,ownerState:b,className:x.icon});return o.jsxs(g,{disableRipple:!0,component:"span",...h,...y,children:[a,d&&!l?null:o.jsx(C,{as:i,...w})]})}),Q={xs:.5,sm:1},fe={xs:1,md:1.5},Wo={xs:1.5,md:2},je={"top-left":Y([3,0,0,1]),"top-right":Y([0,3,1,0]),"mid-left":Y([2,0,0,2]),"mid-right":Y([0,2,2,0]),"no-radius":Y([0,0,0,0])},te=e=>({position:"relative",border:"none",bgcolor:"color-mix(in srgb, var(--mui-palette-divider) 80%, transparent 20%)",...je[e]}),Z={checkboxCell:je["mid-left"],checkbox:e=>({color:e?ke("text-primary","primary-main",30):void 0}),row:(e,t)=>({"& td, & th":{border:0},position:"relative",bgcolor:e?ke("action-hover","primary-light",80):t%2===0?"color-mix(in srgb, var(--mui-palette-action-hover), transparent)":"action.hover"}),rowCellFull:{py:8,borderRadius:2},rowCell:e=>({py:3,...e?je["mid-right"]:{}})},Vo=Me.array(Me.number().int()),Ze=()=>{const{data:e,isFetching:t}=Bt({types:["table","view"]}),{searchParams:s,updateSearchParams:r}=pe(),l=s.get("table")??null,a=m.useCallback(i=>{if(!e)return 0;const p=e.findIndex(({name:u})=>u===i);return p!==-1?p:0},[e]),[n,c]=m.useState(0),d=i=>{e&&r({table:e[a(i.target.value)].name,hiddenColumns:null,orderBy:null,order:null})};return m.useEffect(()=>{e&&c(a(l??e[0].name))},[l,e,a]),{data:e,selected:e&&e.length>0?e[n]:null,handleChange:d,isFetching:t}},et=()=>{const{searchParams:e,updateSearchParams:t}=pe(),s=e.get("hiddenColumns")??null,r=m.useMemo(()=>{if(!s)return[];const{data:n,error:c}=Qe(()=>JSON.parse(s));if(c)return[];const d=Vo.safeParse(n);return d.success?Array.from(new Set(d.data)):[]},[s]),l=m.useCallback(n=>()=>{const c=r.length?[]:Array.from({length:n},(d,i)=>i);t({hiddenColumns:JSON.stringify(c)},{skipTransition:!0})},[r,t]),a=m.useCallback(n=>()=>{const c=Lt(r,n);t({hiddenColumns:JSON.stringify(c)},{skipTransition:!0})},[r,t]);return{hiddenColumns:r,createToggleAllColumns:l,createToggleHandler:a}},Re=()=>{const{selected:e,isFetching:t}=Ze(),{data:s,isFetching:r}=kt({types:["table","view"]}),l=r||!s||t||!e,{hiddenColumns:a}=et(),n=m.useMemo(()=>{if(!s||!e)return null;const d=s.find(({table:u})=>u===e.name);if(!d)return null;const{columns:i}=d;return i.map(u=>({...u,hidden:a.includes(u.cid)})).toSorted((u,y)=>u.cid-y.cid)},[s,e,a]),c=m.useMemo(()=>n?n.filter(p=>!p.hidden).map(({hidden:p,...u})=>{const y=u.pk>=1,b=u.type!=="text"&&!y?"right":"left";return{...u,align:b}}).toSorted((p,u)=>p.pk!==u.pk?u.pk-p.pk:p.type==="text"&&u.type!=="text"?-1:p.type!=="text"&&u.type==="text"?1:p.cid-u.cid):null,[n]);return{isFetching:l,selectedTable:e,columnsForSelect:n,columnsForTable:c}},tt=e=>{const{searchParams:t,updateSearchParams:s}=pe(),r=m.useMemo(()=>{if(!e)return 0;const n=t.get("orderBy")??null;if(!n)return 0;const c=parseInt(n,10);return!Number.isInteger(c)||c<0||c>=e?0:c},[t,e]),l=m.useMemo(()=>{const n=t.get("order")??null;return n&&["asc","desc"].includes(n)?n:"asc"},[t]),a=m.useCallback(n=>()=>{const c=n,d=r===n&&l==="asc"?"desc":"asc";s({orderBy:c.toString(),order:d},{skipTransition:!0})},[r,l,s]);return{orderBy:r,order:l,createToggleHandler:a}},De={edge:"start",tabIndex:-1,disableRipple:!0,size:"small",sx:{py:0}},ot={bgcolor:"FilledInput.disabledBg","&:hover":{bgcolor:"FilledInput.hoverBg"},borderRadius:1,height:1,width:"auto",aspectRatio:1},_o=()=>o.jsx(we,{title:o.jsx(f,{variant:"body2",children:"篩選欄位"}),arrow:!0,children:o.jsxs("span",{style:{position:"relative"},children:[o.jsx(K,{loading:!0,centerRipple:!1,size:"small",sx:ot,children:o.jsx(qe,{fontSize:"small"})}),o.jsx(I,{sx:{position:"absolute",top:0,bgcolor:"FilledInput.disabledBg",borderRadius:1,height:1,width:"auto",aspectRatio:1}})]})}),Go=({columns:e})=>{const[t,s]=m.useState(null),r=i=>s(p=>p?null:i.currentTarget),l=()=>s(null),{createToggleAllColumns:a,createToggleHandler:n}=et(),c=e.every(i=>!i.hidden),d=e.every(i=>i.hidden);return o.jsxs(o.Fragment,{children:[o.jsx(we,{title:o.jsx(f,{variant:"body2",children:"篩選欄位"}),arrow:!0,children:o.jsx("span",{children:o.jsx(K,{onClick:r,centerRipple:!1,size:"small",sx:ot,children:o.jsx(qe,{fontSize:"small"})})})}),o.jsx(wt,{open:!!t,anchorEl:t,onClose:l,elevation:3,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{sx:{maxHeight:350}}},children:o.jsxs(St,{dense:!0,children:[o.jsx(he,{children:o.jsx(f,{variant:"body2",sx:{color:"text.secondary"},children:"篩選欄位"})}),o.jsx(he,{disablePadding:!0,children:o.jsxs($e,{role:void 0,onClick:a(e.length),dense:!0,children:[o.jsx(q,{...De,checked:c,indeterminate:!c&&!d}),o.jsx(Le,{primary:"顯示所有"})]})}),o.jsx(Se,{sx:{my:.5}}),e.map(i=>o.jsx(he,{disablePadding:!0,children:o.jsxs($e,{role:void 0,onClick:n(i.cid),dense:!0,children:[o.jsx(q,{...De,checked:!i.hidden}),o.jsx(Le,{sx:{display:"flex",width:1,gap:Q,justifyContent:"space-between",my:.5},primary:i.name,secondary:i.type.toUpperCase()})]})},i.cid))]})})]})},Jo=()=>{const{columnsForSelect:e,isFetching:t}=Re();return t?o.jsx(_o,{}):o.jsx(Go,{columns:e??[]})},st={borderRadius:1,overflow:"hidden","&::before":{borderBottom:0},"&:hover:not(.Mui-disabled, .Mui-error):before":{borderBottom:0},"& input":{p:Q},"& div[role='combobox']":{p:Q}},nt={sx:{width:"18rem"},size:"small",variant:"filled"},Ko=()=>o.jsxs(I,{sx:{position:"relative"},children:[o.jsx(Ge,{...nt,disabled:!0,slotProps:{input:{sx:st}}}),o.jsx(I,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center",color:"text.secondary"},children:o.jsx(Rt,{color:"inherit",size:16})})]}),qo=()=>{const{data:e,selected:t,handleChange:s,isFetching:r}=Ze();return!e||!t||r?o.jsx(Ko,{}):o.jsxs(Ge,{select:!0,value:t.name,onChange:s,...nt,slotProps:{select:{IconComponent:Ke,MenuProps:{slotProps:{paper:{sx:{maxHeight:350}}},elevation:3}},input:{sx:{...st,"& #tables-ias":{color:"text.secondary",m:0}},startAdornment:o.jsx(Nt,{position:"start",id:"tables-ias",children:o.jsx(f,{variant:"caption",color:"inherit",sx:{p:.5,borderRadius:1,bgcolor:"divider",textTransform:"uppercase"},children:t.type})})}},children:[o.jsxs(Ce,{dense:!0,onClickCapture:l=>l.stopPropagation(),children:[o.jsx(Ht,{fontSize:"small",sx:{mr:.5}})," 新增資料表"]}),o.jsx(Se,{}),e.map(({name:l},a)=>o.jsx(Ce,{value:l,dense:!0,children:l},a))]})},Ee={p:.5,borderRadius:1,bgcolor:"divider"},We={textTransform:"uppercase",lineHeight:1,color:"text.secondary"},Qo=({isPk:e,type:t})=>o.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:Q,color:"text.secondary"},children:[e&&o.jsx(f,{variant:"caption",sx:{...Ee,...We},children:"PK"}),o.jsx(I,{sx:Ee,children:o.jsx(f,{variant:"caption",sx:{...We,...Je},children:t})})]}),Yo=({columns:e})=>{const{order:t,orderBy:s,createToggleHandler:r}=tt((e==null?void 0:e.length)??0),l=Math.random()>.5,a=Math.random()>.5,n=!l&&!a;return o.jsxs(J,{children:[o.jsx(S,{padding:"checkbox",sx:te("top-left"),children:o.jsx(q,{color:"default",indeterminate:a,checked:l,size:"small",sx:{color:n?void 0:"color-mix(in srgb, var(--mui-palette-text-primary) 30%, var(--mui-palette-primary-main) 70%)"}})}),e.map((c,d)=>{const{cid:i,name:p,type:u,align:y}=c,b=c.pk>=1,x=s===d,v=x&&t==="desc"?1:-1,g=y==="right"?"flex-end":"flex-start",h=d===e.length-1;return o.jsx(S,{sx:{minWidth:"10rem",...te(h?"top-right":"no-radius")},children:o.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:g},children:[o.jsx(Eo,{active:x,direction:x?t:"asc",IconComponent:At,slotProps:{icon:{sx:{transform:`scaleY(${v})`}}},onClick:r(d),children:o.jsx(f,{variant:"body2",children:p})}),o.jsx(Qo,{isPk:b,type:u})]})},i)})]})},Xo=e=>{if(e==null)return"";if(typeof e=="string"||typeof e=="number")return e;const{data:t,error:s}=Qe(()=>String(e));if(s)throw new Error(`無法將資料轉換為有效格式: ${s.message}`);return t},Zo=e=>{const t={};for(const s in e)t[s]=Xo(e[s]);return t},es=async({table:e,page:t=0,limit:s=7,orderBy:r,order:l="asc"})=>{const a=Mt(),n=`SELECT COUNT(*) as total FROM ${e}`,c=await a.exec(n);if(!c||!c.length)throw new Error(`無法獲取 ${e} 表的資料總數，可能是表名錯誤或表不存在`);const d=c[0].total,i=Number(d);if(!Number.isInteger(i)||i<0)throw new Error(`無法解析 ${e} 表的總行數為有效整數`);t<0&&(t=0);const p=t*s,u=Math.ceil(i/s),y=t+1<u?t+1:null;let b=`SELECT * FROM ${e}`;r&&(b+=` ORDER BY ${String(r)} ${l.toUpperCase()}`),b+=` LIMIT ${s} OFFSET ${p}`;const v=(await a.exec(b)).map(Zo);return{table:e,rows:v,nextPage:y,totalPages:u,totalRows:i}},ne=7,ts=({totalPages:e})=>{const{searchParams:t,updateSearchParams:s}=pe();return{page:m.useMemo(()=>{const a=t.get("page")??null;if(!a)return 0;const n=parseInt(a,10);return!Number.isInteger(n)||n<0||n>=e?0:n},[t,e]),handlePageChange:(a,n)=>{s({page:n.toString()},{skipTransition:!0})}}},os=1*60*1e3,Pe=({table:e,columns:t})=>{const[s,r]=m.useState(0),{page:l,handlePageChange:a}=ts({totalPages:s}),{orderBy:n,order:c}=tt(t.length),d=t[n].name,i={table:e,order:c,orderBy:d,page:l,limit:ne},{data:p,isFetched:u}=$t({queryKey:["getRows",i],queryFn:()=>es(i),staleTime:os,enabled:t.length>0});return m.useEffect(()=>{p&&r(p.totalPages)},[p]),{isFetching:!u,data:p,page:l,handlePageChange:a}},ss=({rows:e,columns:t})=>({sortedRows:m.useMemo(()=>{if(!e)return[];const r=t.map(({name:a})=>a);return e.map(a=>r.map((n,c)=>({column:n,value:a[n],align:t[c].align})))},[t,e])}),V=Z,Ve=({checked:e,...t})=>o.jsx(S,{padding:"checkbox",sx:V.checkboxCell,children:o.jsx(q,{color:"default",size:"small",sx:V.checkbox(e??!1),checked:e,...t})}),ns=e=>{const{columns:t}=e,{data:s,isFetching:r}=Pe(e),{sortedRows:l}=ss({rows:(s==null?void 0:s.rows)??null,columns:t});return r||!s?o.jsx(o.Fragment,{children:[...Array(ne)].map((a,n)=>o.jsxs(J,{sx:V.row(!1,n),children:[o.jsx(Ve,{disabled:!0}),t.map((c,d)=>o.jsx(S,{sx:V.rowCell(d===t.length-1),children:o.jsx(se,{animation:"wave",variant:"rounded",sx:{width:1,maxWidth:"none"},children:o.jsx(f,{children:"載入中..."})})},d))]},n))}):l.length?o.jsx(o.Fragment,{children:l.map((a,n)=>o.jsxs(J,{sx:V.row(!1,n),children:[o.jsx(Ve,{checked:!1}),a.map(({value:d,align:i},p)=>o.jsx(S,{align:i,sx:V.rowCell(p===t.length-1),children:o.jsx(f,{sx:Je,children:d})},p))]},`data${n}`))}):o.jsx(J,{sx:V.row(!1,1),children:o.jsx(S,{sx:V.rowCellFull,colSpan:t.length+1,children:o.jsx(f,{sx:{color:"text.secondary",textAlign:"center"},children:"該資料表 / 檢視表目前沒有任何資料"})})})},rs=()=>o.jsxs(J,{children:[o.jsx(S,{padding:"checkbox",sx:te("top-left"),children:o.jsx(q,{disabled:!0,size:"small"})}),o.jsx(S,{sx:te("no-radius"),children:o.jsx(se,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:o.jsx(f,{variant:"body2",children:"載入中. . ."})})}),[...Array(4)].map((e,t)=>o.jsx(S,{sx:te(t===3?"top-right":"no-radius"),children:o.jsx(I,{sx:{display:"flex",justifyContent:"flex-end"},children:o.jsx(se,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:o.jsx(f,{variant:"body2",children:"載入中. . ."})})})},t))]}),as=()=>o.jsx(o.Fragment,{children:[...Array(ne)].map((e,t)=>o.jsxs(J,{sx:Z.row(!1,t),children:[o.jsx(S,{padding:"checkbox",sx:Z.checkboxCell,children:o.jsx(q,{disabled:!0,size:"small"})}),o.jsx(S,{sx:Z.rowCell(!1),children:o.jsx(se,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:o.jsx(f,{children:"載入中. . ."})})}),[...Array(4)].map((s,r)=>o.jsx(S,{sx:Z.rowCell(r===3),children:o.jsx(I,{sx:{display:"flex",justifyContent:"flex-end"},children:o.jsx(se,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:o.jsx(f,{children:"載入中. . ."})})})},r))]},t))}),ls=()=>o.jsx(Xe,{colSpan:6,count:0,rowsPerPage:10,rowsPerPageOptions:[10],page:0,showFirstButton:!0,showLastButton:!0,slotProps:{select:{inputProps:{"aria-label":"rows per page"}}},onPageChange:()=>{},disabled:!0,sx:{border:0}}),is=e=>{const{columns:t}=e,{data:s,isFetching:r,page:l,handlePageChange:a}=Pe(e);return o.jsx(Xe,{colSpan:t.length+1,count:(s==null?void 0:s.totalRows)??0,rowsPerPage:ne,rowsPerPageOptions:[ne],page:l,showFirstButton:!0,showLastButton:!0,slotProps:{select:{inputProps:{"aria-label":"rows per page"}}},onPageChange:a,disabled:r,sx:{border:0}})},cs=()=>{const{isFetching:e,selectedTable:t,columnsForTable:s}=Re(),r=e||!t||!s;return o.jsx(po,{sx:{mt:Wo},children:o.jsxs(Yt,{sx:{borderSpacing:"0 0.3rem",borderCollapse:"separate"},children:[o.jsx(Co,{sx:{position:"relative"},children:r?o.jsx(rs,{}):o.jsx(Yo,{columns:s})}),o.jsx(oo,{children:r?o.jsx(as,{}):o.jsx(ns,{table:t.name,columns:s})}),o.jsx(bo,{children:o.jsx(J,{children:r?o.jsx(ls,{}):o.jsx(is,{table:t.name,columns:s})})})]})})},de=e=>({"--temporary-color":e,bgcolor:"color-mix(in srgb, var(--temporary-color) 30%, transparent 70%)","&:hover":{bgcolor:"color-mix(in srgb, var(--temporary-color) 40%, transparent 60%)"},color:"color-mix(in srgb, var(--temporary-color) 40%, var(--mui-palette-text-primary) 60%)",px:1.5}),rt=()=>o.jsxs(o.Fragment,{children:[o.jsx(f,{sx:{color:"text.secondary"},children:"已選取 0 個:"}),o.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:Q},children:[o.jsx(oe,{sx:de("var(--mui-palette-primary-main)"),loading:!0,children:"覆蓋欄位"}),o.jsx(oe,{sx:de("var(--mui-palette-error-main)"),loading:!0,children:"刪除紀錄"})]})]}),ds=e=>{const{isFetching:t,data:s}=Pe(e);if(t||!s)return o.jsx(rt,{});const{totalRows:r}=s;return o.jsxs(o.Fragment,{children:[o.jsxs(f,{sx:{color:"text.secondary"},children:["已選取 ",0," 個 / ",r," 個:"]}),o.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:Q},children:[o.jsx(we,{title:o.jsx(f,{variant:"body2",children:"以指定值覆蓋選取資料的某個欄位"}),arrow:!0,children:o.jsx(oe,{sx:de("var(--mui-palette-primary-main)"),children:"覆蓋欄位"})}),o.jsx(oe,{sx:de("var(--mui-palette-error-main)"),children:"刪除紀錄"})]})]})},ps=()=>{const{isFetching:e,selectedTable:t,columnsForTable:s}=Re();return e||!t||!s?o.jsx(rt,{}):o.jsx(ds,{table:t.name,columns:s})},us=e=>({"--temporary-color":e,bgcolor:"color-mix(in srgb, var(--temporary-color) 90%, var(--mui-palette-text-primary) 10%)","&:hover":{bgcolor:"color-mix(in srgb, var(--temporary-color) 80%, var(--mui-palette-text-primary) 20%)"},color:"color-mix(in srgb, var(--temporary-color) 5%, var(--mui-palette-background-paper) 95%)",px:1.5}),Os=()=>o.jsxs(Pt,{children:[o.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:fe},children:[o.jsxs(I,{sx:{display:"flex",alignItems:"stretch",gap:fe},children:[o.jsx(qo,{}),o.jsx(Jo,{})]}),o.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:fe},children:[o.jsx(ps,{}),o.jsx(Se,{flexItem:!0,orientation:"vertical"}),o.jsx(oe,{sx:us("var(--mui-palette-primary-main)"),endIcon:o.jsx(Ke,{}),children:"標準化"})]})]}),o.jsx(cs,{})]});export{Os as default};
