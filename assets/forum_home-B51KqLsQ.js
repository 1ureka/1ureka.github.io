import{o as _,j as e,n as t,S as h,B as d,v as x,r as f,p as r,E as z,F as m,D}from"./routes-DrAjfNKu.js";import{u as $,a as L,A as W,S as E}from"./ScrollArea-qgW0i3DD.js";import{A as O,a as M,b as H,c as N,d as U,e as V}from"./AttachFileRounded-CG6p2BB3.js";import{N as q}from"./NewPost-DcvTP9y8.js";import{u as b,a as y,b as G,C as J}from"./post-z4iZayPq.js";import{D as c}from"./ExpandMoreRounded-6eRjgqL_.js";import{S as u}from"./Skeleton-DPYLBMSB.js";import{T as K}from"./TopicPicker-Df3CS_yw.js";import{C as p}from"./Badge-DvMt8Xz0.js";import{C as w}from"./CommentRounded-35HeqZhQ.js";import{T as Q,V as C,P as v}from"./PersonPinCircleRounded-DXgtwkrL.js";import{L as X,P as Y,T as Z,S as ee,a as se}from"./PostHeader-DrrTNijz.js";import"./RefreshRounded-Hlj_ZRjd.js";import"./ForumRounded-zIbb3rD6.js";import"./SQLiteClient-CXu3MqOl.js";import"./DarkModeRounded-BCapfBw4.js";import"./Toolbar-BTNXBn7q.js";import"./ErrorRounded-r8tdl1IX.js";import"./OpenInNewRounded-CzT1U-0h.js";import"./index-mSkvzYyn.js";import"./NotificationsRounded-BiDZSXSt.js";import"./MenuItem-pp2hSLjf.js";import"./useMutation-DIYCy1FX.js";import"./MoreHorizRounded-7w8-xxPn.js";import"./ArrowOutwardRounded-xnp3h7PT.js";import"./formatters-C9bWSe0O.js";import"./Motion-B3nGRyEo.js";import"./proxy-IROFmvxx.js";import"./AddRounded-CrOqoNRF.js";import"./PublishRounded-DtImITZT.js";import"./EmojiMenu-DgpoECrb.js";import"./array-l11GhOAf.js";import"./with-selector-CEzK_xNF.js";import"./fuse-DsgKF4xb.js";import"./ClearRounded-DCDYFKYM.js";const g=_(e.jsx("path",{d:"M16.01 11H5c-.55 0-1 .45-1 1s.45 1 1 1h11.01v1.79c0 .45.54.67.85.35l2.78-2.79c.19-.2.19-.51 0-.71l-2.78-2.79c-.31-.32-.85-.09-.85.35z"})),I=()=>e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"rounded",animation:"wave",children:e.jsx(t,{variant:"subtitle1",component:"h3",children:"正在載入..."})}),e.jsx(u,{variant:"rounded",animation:"wave",children:e.jsx(t,{variant:"body2",component:"p",sx:{color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:"正在載入內容中. . ."})}),e.jsx(d,{endIcon:e.jsx(g,{}),sx:{width:"fit-content"},loading:!0,children:"查看更多"})]}),oe=({postId:o})=>{const{data:s,isFetching:i}=y({postId:o});return i||!s?e.jsx(I,{}):e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"subtitle1",component:"h3",children:s.title}),e.jsx(t,{variant:"body2",component:"p",sx:{color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.content}),e.jsx(d,{endIcon:e.jsx(g,{}),sx:{width:"fit-content"},href:`${x.forum_post}?postId=${s.id}`,children:"查看更多"})]})},F=({length:o})=>{const{data:s,isFetching:i}=b({limit:o,order:"desc",orderBy:"viewCount"});return e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"h6",component:"h2",sx:{mb:1.5},children:"本週熱門討論 🔥"}),i||!s?[...Array(o)].map((n,a)=>e.jsxs(h,{sx:{gap:.5,my:a<2?1:0},children:[e.jsx(I,{}),a<2&&e.jsx(c,{})]},a)):s.map((n,a)=>e.jsxs(h,{sx:{gap:.5,my:a<2?1:0},children:[e.jsx(oe,{postId:n}),a<2&&e.jsx(c,{})]},n))]})},re=()=>e.jsx(p,{label:e.jsx(z,{size:"1rem",sx:{mx:2,color:"divider"}})}),te=({length:o})=>{const{data:s,isFetching:i}=G(),n=s?s.slice(0,o):null,[a,j]=f.useState(null),P=l=>j(l.currentTarget),B=()=>j(null),R=l=>{if(l===null){window.location.href=x.forum_posts;return}window.location.href=`${x.forum_posts}?topic=${l}`};return e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:1,mt:1},children:[i||!n?[...Array(o)].map((l,T)=>e.jsx(re,{},T)):n.map(({name:l})=>e.jsx(p,{label:l,clickable:!0,component:"a",href:`${x.forum_posts}?topic=${l}`},l)),e.jsx(p,{label:"...",clickable:!0,disabled:i,onClick:P}),e.jsx(K,{open:!!a,anchorEl:a,onClose:B,type:"query",onConfirm:R})]})},A=({length:o})=>e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"h6",component:"h2",children:"你可能會喜歡"}),e.jsx(te,{length:o}),e.jsx(d,{sx:{mt:1},endIcon:e.jsx(g,{}),href:x.forum_posts,children:"更多主題"})]}),k=({length:o})=>{const{data:s,isFetching:i}=$({limit:o,orderBy:"followerCount",order:"desc",isUnfollowed:!0}),n=s?s.pages[0]?s.pages[0].users:[]:[];return e.jsxs(e.Fragment,{children:[e.jsx(t,{variant:"h6",component:"h2",sx:{mb:1.5},children:"推薦追蹤"}),e.jsx(r,{sx:{display:"grid",gridTemplateColumns:"auto 1fr auto",alignItems:"center",gap:2},children:i||!n?[...Array(o)].map((a,j)=>e.jsx(O,{},j)):n.map(a=>e.jsx(M,{...a},a.id))})]})},ie=()=>e.jsxs(e.Fragment,{children:[e.jsx(m,{sx:{p:3,borderRadius:3,border:"1px solid",borderColor:"divider"},elevation:1,children:e.jsx(F,{length:3})}),e.jsx(m,{sx:{p:3,borderRadius:3,border:"1px solid",borderColor:"divider"},elevation:1,children:e.jsx(A,{length:5})}),e.jsx(m,{sx:{p:3,borderRadius:3,border:"1px solid",borderColor:"divider"},elevation:1,children:e.jsx(k,{length:5})})]}),ne=()=>e.jsxs(m,{sx:{borderRadius:3,border:"1px solid",borderColor:"divider"},elevation:1,children:[e.jsx(r,{sx:{p:3},children:e.jsx(F,{length:3})}),e.jsx(c,{}),e.jsxs(r,{sx:{p:3,position:"relative"},children:[e.jsx(r,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),e.jsx(A,{length:5})]}),e.jsx(c,{}),e.jsx(r,{sx:{p:3},children:e.jsx(k,{length:5})})]}),S=()=>e.jsxs(e.Fragment,{children:[e.jsxs(r,{sx:{p:1.5,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},children:[e.jsx(X,{}),e.jsx(u,{variant:"rounded",animation:"wave",children:e.jsx(t,{variant:"h6",component:"h3",sx:{textAlign:"start"},children:"正在載入標題..."})}),e.jsx(t,{variant:"body2",component:"p",sx:{textAlign:"start",opacity:0},children:"正在載入內容..."}),e.jsx(r,{sx:{display:"flex",gap:1.5,mt:2},children:new Array(3).fill(null).map((o,s)=>e.jsx(u,{variant:"rounded",animation:"wave",children:e.jsx(p,{label:"loading...",size:"small"})},s))})]}),e.jsx(c,{flexItem:!0}),e.jsxs(r,{sx:{p:1.5,py:1,display:"flex",gap:1.5,alignItems:"center",position:"relative",color:"text.secondary"},children:[e.jsx(r,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),e.jsx(d,{color:"inherit",startIcon:e.jsx(Q,{}),size:"small",loading:!0,children:e.jsx(t,{variant:"caption",component:"span",children:"100 個讚"})}),e.jsx(d,{color:"inherit",startIcon:e.jsx(w,{}),size:"small",loading:!0,children:e.jsx(t,{variant:"caption",component:"span",children:"100 則回覆"})}),e.jsx(d,{color:"inherit",startIcon:e.jsx(C,{}),size:"small",loading:!0,children:e.jsx(t,{variant:"caption",component:"span",children:"1000 次瀏覽"})})]}),e.jsx(c,{flexItem:!0})]}),ae=({postId:o})=>{const{data:s,isFetching:i}=y({postId:o});if(i||!s)return e.jsx(S,{});const n=()=>{window.location.href=`${x.forum_post}?postId=${s.id}`};return e.jsxs(e.Fragment,{children:[e.jsxs(r,{sx:{p:1.5,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:n,children:[e.jsx(Y,{post:s}),e.jsx(t,{variant:"h6",component:"h3",sx:{textAlign:"start",display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:s.title}),e.jsx(t,{variant:"body2",component:"p",sx:{color:"text.secondary",textAlign:"start",display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre-line"},children:s.content}),e.jsxs(r,{sx:{display:"flex",gap:1.5,mt:2,alignItems:"center"},children:[e.jsx(Z,{post:s,displayCount:3}),(s.isFromFollowing||s.isSelf)&&e.jsxs(e.Fragment,{children:[e.jsx(r,{sx:{flex:1}}),s.isFromFollowing&&e.jsx(p,{size:"small",label:"來自追蹤者",variant:"outlined",icon:e.jsx(v,{})}),s.isSelf&&e.jsx(p,{size:"small",label:"我的貼文",variant:"outlined",icon:e.jsx(v,{})})]})]})]}),e.jsx(c,{flexItem:!0}),e.jsxs(r,{sx:{p:1.5,py:1,display:"flex",gap:1.5,alignItems:"center",position:"relative",color:"text.secondary"},children:[e.jsx(r,{sx:{position:"absolute",inset:0,bgcolor:"divider",opacity:.35}}),s.isSelf?e.jsx(ee,{post:s}):e.jsx(se,{postId:s.id,likeCount:s.likeCount}),e.jsx(d,{color:"inherit",startIcon:e.jsx(w,{}),size:"small",href:`${x.forum_post}?postId=${s.id}`,children:e.jsxs(t,{variant:"caption",component:"span",children:[s.commentCount," 則回覆"]})}),e.jsx(d,{startIcon:e.jsx(C,{}),disabled:!0,size:"small",sx:{"button&.Mui-disabled":{color:"text.secondary",opacity:.8}},children:e.jsxs(t,{variant:"caption",component:"span",children:[s.viewCount," 次瀏覽"]})})]}),e.jsx(c,{flexItem:!0})]})},le=()=>{const{data:o,isFetching:s}=b({limit:5,orderBy:"createdAt",order:"desc",prioritizeFollowers:!0});return s||!o?e.jsx(h,{sx:{alignItems:"stretch",mb:1.5},children:[...Array(5)].map((i,n)=>e.jsx(S,{},n))}):e.jsx(h,{sx:{alignItems:"stretch",mb:1.5},children:o.map(i=>e.jsx(ae,{postId:i},i))})};function de(){const{isMd:o}=L();return e.jsxs(W,{children:[e.jsx(H,{}),e.jsxs(E,{children:[o?e.jsx(N,{}):e.jsx(U,{}),e.jsxs(J,{maxWidth:!1,sx:{position:"relative",my:10,display:"flex",gap:4,maxWidth:1400,flexDirection:{xs:"column-reverse",md:"row"},px:0},children:[e.jsx(r,{sx:{flex:1},children:e.jsxs(m,{sx:{py:3,borderRadius:3,border:"1px solid",borderColor:"divider"},elevation:1,children:[e.jsx(q,{}),e.jsx(c,{}),e.jsx(le,{}),e.jsx(r,{sx:{mx:1.5},children:e.jsx(d,{variant:"outlined",color:"primary",fullWidth:!0,href:`${x.forum_posts}?followPrior=true&orderBy=createdAt&orderDesc=true`,endIcon:e.jsx(g,{}),children:"查看更多"})})]})}),e.jsx(h,{sx:{gap:{xs:1,md:4},maxWidth:{xs:1,md:400},width:{xs:1,md:"30vw"}},children:o?e.jsx(ie,{}):e.jsx(ne,{})})]}),e.jsx(V,{})]})]})}D.createRoot(document.getElementById("root")).render(e.jsx(f.StrictMode,{children:e.jsx(de,{})}));
