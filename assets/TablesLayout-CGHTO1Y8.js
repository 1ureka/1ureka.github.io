import{r as b,u as te,an as ve,a6 as ht,a0 as gt,j as t,s as k,c as N,d as oe,x as Ue,am as bt,m as H,F as le,O as R,n as v,aR as Fe,o as Te,g as Re,a as ke,a7 as ft,I as q,Q as Me,ai as yt,aS as vt,b as je,aT as J,aC as $e,v as He,p as P,z as jt,P as We,a8 as qe,B as ee,t as Be,S as Ct}from"./Toast-6ncYA_Ld.js";import{a as Ve}from"./ArrowDropDownRounded-a6cIAduy.js";import{A as St}from"./AddRounded-fKGh7lB_.js";import{u as se}from"./url-BKoQkXLc.js";import{e as wt,g as Pt,a as It}from"./main-BtIibAsk.js";import{c as Tt}from"./RestartAltRounded-COnKimLj.js";import{a as Rt,l as ie,M as Ce}from"./MenuItem-BLYGv0hx.js";import{D as ue}from"./Divider-vP51gHCL.js";import{I as kt}from"./ExpandMoreRounded-BeFfyJ0G.js";import{F as _e}from"./FilterAltRounded-tqDL8B4X.js";import{f as Bt,T as S,u as Ge,e as Ke,c as Qe,a as O,b as Je,d as Lt}from"./utils-CUE9f39D.js";import{z as Ae}from"./index-mSkvzYyn.js";import{t as Ft}from"./array-l11GhOAf.js";import{t as Ye,u as Xe}from"./tryCatch-CD0ybv0K.js";import{T as Le}from"./DarkModeRounded-BFg7OYNl.js";import{g as Mt,l as Y,L as _}from"./ListItem-hyH6F2mu.js";import{C as K}from"./Checkbox-1o3yFfn6.js";import{u as $t}from"./ErrorOutlineRounded-BWvTI3f4.js";import{S as X}from"./Skeleton-DjBj6yfl.js";import{a as At,K as zt}from"./KeyboardArrowRight-Co1J_ioS.js";import{T as Ot}from"./Toolbar-BcNpOrAE.js";import{S as Nt}from"./SortRounded-CeU0TTi9.js";import"./SQLiteClient-CQZ5EZ1X.js";import"./routes-Dr3OAPvi.js";import"./DataExplorationRounded-tAuyK-5K.js";import"./RefreshRounded-BcOkXO49.js";import"./NotificationsRounded-BBOwe-i5.js";import"./fuse-BXhxvJKY.js";import"./useMutation-2Qc-kFMN.js";import"./dayjs.min-CkW5XOTE.js";import"./Badge-D6o4y19V.js";import"./DownloadRounded-CB3mGnoq.js";import"./SwitchBase-UlEzF0FU.js";const Dt=(e,o)=>{const{ownerState:s}=e;return[o.root,s.dense&&o.dense,s.alignItems==="flex-start"&&o.alignItemsFlexStart,s.divider&&o.divider,!s.disableGutters&&o.gutters]},Et=e=>{const{alignItems:o,classes:s,dense:n,disabled:r,disableGutters:i,divider:a,selected:d}=e,l=oe({root:["root",n&&"dense",!i&&"gutters",a&&"divider",r&&"disabled",o==="flex-start"&&"alignItemsFlexStart",d&&"selected"]},Mt,s);return{...s,...l}},Ut=k(Ue,{shouldForwardProp:e=>bt(e)||e==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:Dt})(H(({theme:e})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Y.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:le(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${Y.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:le(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${Y.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:le(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:le(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${Y.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${Y.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},variants:[{props:({ownerState:o})=>o.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:o})=>!o.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:o})=>o.dense,style:{paddingTop:4,paddingBottom:4}}]}))),Se=b.forwardRef(function(o,s){const n=te({props:o,name:"MuiListItemButton"}),{alignItems:r="center",autoFocus:i=!1,component:a="div",children:d,dense:u=!1,disableGutters:l=!1,divider:c=!1,focusVisibleClassName:h,selected:f=!1,className:g,...p}=n,x=b.useContext(ve),m=b.useMemo(()=>({dense:u||x.dense||!1,alignItems:r,disableGutters:l}),[r,x.dense,u,l]),y=b.useRef(null);ht(()=>{i&&y.current&&y.current.focus()},[i]);const j={...n,alignItems:r,dense:m.dense,disableGutters:l,divider:c,selected:f},w=Et(j),L=gt(y,s);return t.jsx(ve.Provider,{value:m,children:t.jsx(Ut,{ref:L,href:p.href||p.to,component:(p.href||p.to)&&a==="div"?"button":a,focusVisibleClassName:N(w.focusVisible,h),ownerState:j,className:N(w.root,g),...p,classes:w,children:d})})}),Ht=e=>{const{classes:o,inset:s,primary:n,secondary:r,dense:i}=e;return oe({root:["root",s&&"inset",i&&"dense",n&&r&&"multiline"],primary:["primary"],secondary:["secondary"]},Rt,o)},Wt=k("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:s}=e;return[{[`& .${ie.primary}`]:o.primary},{[`& .${ie.secondary}`]:o.secondary},o.root,s.inset&&o.inset,s.primary&&s.secondary&&o.multiline,s.dense&&o.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${Fe.root}:where(& .${ie.primary})`]:{display:"block"},[`.${Fe.root}:where(& .${ie.secondary})`]:{display:"block"},variants:[{props:({ownerState:e})=>e.primary&&e.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:e})=>e.inset,style:{paddingLeft:56}}]}),ce=b.forwardRef(function(o,s){const n=te({props:o,name:"MuiListItemText"}),{children:r,className:i,disableTypography:a=!1,inset:d=!1,primary:u,primaryTypographyProps:l,secondary:c,secondaryTypographyProps:h,slots:f={},slotProps:g={},...p}=n,{dense:x}=b.useContext(ve);let m=u??r,y=c;const j={...n,disableTypography:a,inset:d,primary:!!m,secondary:!!y,dense:x},w=Ht(j),L={slots:f,slotProps:{primary:l,secondary:h,...g}},[W,B]=R("root",{className:N(w.root,i),elementType:Wt,externalForwardedProps:{...L,...p},ownerState:j,ref:s}),[D,F]=R("primary",{className:w.primary,elementType:v,externalForwardedProps:L,ownerState:j}),[I,C]=R("secondary",{className:w.secondary,elementType:v,externalForwardedProps:L,ownerState:j});return m!=null&&m.type!==v&&!a&&(m=t.jsx(D,{variant:x?"body2":"body1",component:F!=null&&F.variant?void 0:"span",...F,children:m})),y!=null&&y.type!==v&&!a&&(y=t.jsx(I,{variant:"body2",color:"textSecondary",...C,children:y})),t.jsxs(W,{...B,children:[m,y]})}),qt=Te(t.jsx("path",{d:"M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"})),Vt=Te(t.jsx("path",{d:"M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}));function _t(e){return Re("MuiTableFooter",e)}ke("MuiTableFooter",["root"]);const Gt=e=>{const{classes:o}=e;return oe({root:["root"]},_t,o)},Kt=k("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(e,o)=>o.root})({display:"table-footer-group"}),Qt={variant:"footer"},ze="tfoot",Ze=b.forwardRef(function(o,s){const n=te({props:o,name:"MuiTableFooter"}),{className:r,component:i=ze,...a}=n,d={...n,component:i},u=Gt(d);return t.jsx(Bt.Provider,{value:Qt,children:t.jsx(Kt,{as:i,className:N(u.root,r),ref:s,role:i===ze?null:"rowgroup",ownerState:d,...a})})}),Jt=b.forwardRef(function(o,s){const{backIconButtonProps:n,count:r,disabled:i=!1,getItemAriaLabel:a,nextIconButtonProps:d,onPageChange:u,page:l,rowsPerPage:c,showFirstButton:h,showLastButton:f,slots:g={},slotProps:p={},...x}=o,m=ft(),y=$=>{u($,0)},j=$=>{u($,l-1)},w=$=>{u($,l+1)},L=$=>{u($,Math.max(0,Math.ceil(r/c)-1))},W=g.firstButton??q,B=g.lastButton??q,D=g.nextButton??q,F=g.previousButton??q,I=g.firstButtonIcon??qt,C=g.lastButtonIcon??Vt,T=g.nextButtonIcon??At,ne=g.previousButtonIcon??zt,re=m?B:W,xe=m?D:F,ae=m?F:D,me=m?W:B,M=m?p.lastButton:p.firstButton,he=m?p.nextButton:p.previousButton,ge=m?p.previousButton:p.nextButton,be=m?p.firstButton:p.lastButton;return t.jsxs("div",{ref:s,...x,children:[h&&t.jsx(re,{onClick:y,disabled:i||l===0,"aria-label":a("first",l),title:a("first",l),...M,children:m?t.jsx(C,{...p.lastButtonIcon}):t.jsx(I,{...p.firstButtonIcon})}),t.jsx(xe,{onClick:j,disabled:i||l===0,color:"inherit","aria-label":a("previous",l),title:a("previous",l),...he??n,children:m?t.jsx(T,{...p.nextButtonIcon}):t.jsx(ne,{...p.previousButtonIcon})}),t.jsx(ae,{onClick:w,disabled:i||(r!==-1?l>=Math.ceil(r/c)-1:!1),color:"inherit","aria-label":a("next",l),title:a("next",l),...ge??d,children:m?t.jsx(ne,{...p.previousButtonIcon}):t.jsx(T,{...p.nextButtonIcon})}),f&&t.jsx(me,{onClick:L,disabled:i||l>=Math.ceil(r/c)-1,"aria-label":a("last",l),title:a("last",l),...be,children:m?t.jsx(I,{...p.firstButtonIcon}):t.jsx(C,{...p.lastButtonIcon})})]})});function Yt(e){return Re("MuiTablePagination",e)}const Z=ke("MuiTablePagination",["root","toolbar","spacer","selectLabel","selectRoot","select","selectIcon","input","menuItem","displayedRows","actions"]);var Oe;const Xt=k(S,{name:"MuiTablePagination",slot:"Root",overridesResolver:(e,o)=>o.root})(H(({theme:e})=>({overflow:"auto",color:(e.vars||e).palette.text.primary,fontSize:e.typography.pxToRem(14),"&:last-child":{padding:0}}))),Zt=k(Ot,{name:"MuiTablePagination",slot:"Toolbar",overridesResolver:(e,o)=>({[`& .${Z.actions}`]:o.actions,...o.toolbar})})(H(({theme:e})=>({minHeight:52,paddingRight:2,[`${e.breakpoints.up("xs")} and (orientation: landscape)`]:{minHeight:52},[e.breakpoints.up("sm")]:{minHeight:52,paddingRight:2},[`& .${Z.actions}`]:{flexShrink:0,marginLeft:20}}))),eo=k("div",{name:"MuiTablePagination",slot:"Spacer",overridesResolver:(e,o)=>o.spacer})({flex:"1 1 100%"}),to=k("p",{name:"MuiTablePagination",slot:"SelectLabel",overridesResolver:(e,o)=>o.selectLabel})(H(({theme:e})=>({...e.typography.body2,flexShrink:0}))),oo=k(vt,{name:"MuiTablePagination",slot:"Select",overridesResolver:(e,o)=>({[`& .${Z.selectIcon}`]:o.selectIcon,[`& .${Z.select}`]:o.select,...o.input,...o.selectRoot})})({color:"inherit",fontSize:"inherit",flexShrink:0,marginRight:32,marginLeft:8,[`& .${Z.select}`]:{paddingLeft:8,paddingRight:24,textAlign:"right",textAlignLast:"right"}}),so=k(Ce,{name:"MuiTablePagination",slot:"MenuItem",overridesResolver:(e,o)=>o.menuItem})({}),no=k("p",{name:"MuiTablePagination",slot:"DisplayedRows",overridesResolver:(e,o)=>o.displayedRows})(H(({theme:e})=>({...e.typography.body2,flexShrink:0})));function ro({from:e,to:o,count:s}){return`${e}–${o} of ${s!==-1?s:`more than ${o}`}`}function ao(e){return`Go to ${e} page`}const lo=e=>{const{classes:o}=e;return oe({root:["root"],toolbar:["toolbar"],spacer:["spacer"],selectLabel:["selectLabel"],select:["select"],input:["input"],selectIcon:["selectIcon"],menuItem:["menuItem"],displayedRows:["displayedRows"],actions:["actions"]},Yt,o)},we=b.forwardRef(function(o,s){const n=te({props:o,name:"MuiTablePagination"}),{ActionsComponent:r=Jt,backIconButtonProps:i,colSpan:a,component:d=S,count:u,disabled:l=!1,getItemAriaLabel:c=ao,labelDisplayedRows:h=ro,labelRowsPerPage:f="Rows per page:",nextIconButtonProps:g,onPageChange:p,onRowsPerPageChange:x,page:m,rowsPerPage:y,rowsPerPageOptions:j=[10,25,50,100],SelectProps:w={},showFirstButton:L=!1,showLastButton:W=!1,slotProps:B={},slots:D={},...F}=n,I=n,C=lo(I),T=(B==null?void 0:B.select)??w,ne=T.native?"option":so;let re;(d===S||d==="td")&&(re=a||1e3);const xe=Me(T.id),ae=Me(T.labelId),me=()=>u===-1?(m+1)*y:y===-1?u:Math.min(u,(m+1)*y),M={slots:D,slotProps:B},[he,ge]=R("root",{ref:s,className:C.root,elementType:Xt,externalForwardedProps:{...M,component:d,...F},ownerState:I,additionalProps:{colSpan:re}}),[be,$]=R("toolbar",{className:C.toolbar,elementType:Zt,externalForwardedProps:M,ownerState:I}),[rt,at]=R("spacer",{className:C.spacer,elementType:eo,externalForwardedProps:M,ownerState:I}),[lt,it]=R("selectLabel",{className:C.selectLabel,elementType:to,externalForwardedProps:M,ownerState:I,additionalProps:{id:ae}}),[ct,dt]=R("select",{className:C.select,elementType:oo,externalForwardedProps:M,ownerState:I}),[ut,pt]=R("menuItem",{className:C.menuItem,elementType:ne,externalForwardedProps:M,ownerState:I}),[xt,mt]=R("displayedRows",{className:C.displayedRows,elementType:no,externalForwardedProps:M,ownerState:I});return t.jsx(he,{...ge,children:t.jsxs(be,{...$,children:[t.jsx(rt,{...at}),j.length>1&&t.jsx(lt,{...it,children:f}),j.length>1&&t.jsx(ct,{variant:"standard",...!T.variant&&{input:Oe||(Oe=t.jsx(yt,{}))},value:y,onChange:x,id:xe,labelId:ae,...T,classes:{...T.classes,root:N(C.input,C.selectRoot,(T.classes||{}).root),select:N(C.select,(T.classes||{}).select),icon:N(C.selectIcon,(T.classes||{}).icon)},disabled:l,...dt,children:j.map(A=>b.createElement(ut,{...pt,key:A.label?A.label:A,value:A.value?A.value:A},A.label?A.label:A))}),t.jsx(xt,{...mt,children:h({from:u===0?0:m*y+1,to:me(),count:u===-1?-1:u,page:m})}),t.jsx(r,{className:C.actions,backIconButtonProps:i,count:u,nextIconButtonProps:g,onPageChange:p,page:m,rowsPerPage:y,showFirstButton:L,showLastButton:W,slotProps:B.actions,slots:D.actions,getItemAriaLabel:c,disabled:l})]})})}),io=Te(t.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}));function co(e){return Re("MuiTableSortLabel",e)}const fe=ke("MuiTableSortLabel",["root","active","icon","iconDirectionDesc","iconDirectionAsc","directionDesc","directionAsc"]),uo=e=>{const{classes:o,direction:s,active:n}=e,r={root:["root",n&&"active",`direction${je(s)}`],icon:["icon",`iconDirection${je(s)}`]};return oe(r,co,o)},po=k(Ue,{name:"MuiTableSortLabel",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:s}=e;return[o.root,s.active&&o.active]}})(H(({theme:e})=>({cursor:"pointer",display:"inline-flex",justifyContent:"flex-start",flexDirection:"inherit",alignItems:"center","&:focus":{color:(e.vars||e).palette.text.secondary},"&:hover":{color:(e.vars||e).palette.text.secondary,[`& .${fe.icon}`]:{opacity:.5}},[`&.${fe.active}`]:{color:(e.vars||e).palette.text.primary,[`& .${fe.icon}`]:{opacity:1,color:(e.vars||e).palette.text.secondary}}}))),xo=k("span",{name:"MuiTableSortLabel",slot:"Icon",overridesResolver:(e,o)=>{const{ownerState:s}=e;return[o.icon,o[`iconDirection${je(s.direction)}`]]}})(H(({theme:e})=>({fontSize:18,marginRight:4,marginLeft:4,opacity:0,transition:e.transitions.create(["opacity","transform"],{duration:e.transitions.duration.shorter}),userSelect:"none",variants:[{props:{direction:"desc"},style:{transform:"rotate(0deg)"}},{props:{direction:"asc"},style:{transform:"rotate(180deg)"}}]}))),mo=b.forwardRef(function(o,s){const n=te({props:o,name:"MuiTableSortLabel"}),{active:r=!1,children:i,className:a,direction:d="asc",hideSortIcon:u=!1,IconComponent:l=io,slots:c={},slotProps:h={},...f}=n,g={...n,active:r,direction:d,hideSortIcon:u,IconComponent:l},p=uo(g),x={slots:c,slotProps:h},[m,y]=R("root",{elementType:po,externalForwardedProps:x,ownerState:g,className:N(p.root,a),ref:s}),[j,w]=R("icon",{elementType:xo,externalForwardedProps:x,ownerState:g,className:p.icon});return t.jsxs(m,{disableRipple:!0,component:"span",...y,...f,children:[i,u&&!r?null:t.jsx(j,{as:l,...w})]})}),U={xs:.5,sm:1},ye={xs:1,md:1.5},ho={xs:1.5,md:2},Pe={"top-left":J([3,0,0,1]),"top-right":J([0,3,1,0]),"mid-left":J([2,0,0,2]),"mid-right":J([0,2,2,0]),"no-radius":J([0,0,0,0])},G=e=>({position:"relative",border:"none",bgcolor:"color-mix(in srgb, var(--mui-palette-divider) 80%, transparent 20%)",...Pe[e]}),V={checkboxCell:Pe["mid-left"],checkbox:e=>({color:e?$e("text-primary","primary-main",30):void 0}),row:(e,o)=>({"& td, & th":{border:0},position:"relative",bgcolor:e?$e("action-hover","primary-light",80):o%2===0?"color-mix(in srgb, var(--mui-palette-action-hover), transparent)":"action.hover"}),rowCellFull:{py:8,borderRadius:2},rowCell:e=>({py:3,...e?Pe["mid-right"]:{}})},go=()=>{const e=Tt((l,c)=>({selectAll:!1,checked:new Set,unchecked:new Set,toggleRow:h=>{const{selectAll:f,checked:g,unchecked:p}=c();if(f){const x=new Set(p);x.has(h)?x.delete(h):x.add(h),l({unchecked:x})}else{const x=new Set(g);x.has(h)?x.delete(h):x.add(h),l({checked:x})}},toggleAll:()=>{const{selectAll:h,unchecked:f}=c();let g=!0;h&&f.size===0&&(g=!1),l({selectAll:g,checked:new Set,unchecked:new Set})},reset:()=>{l({selectAll:!1,checked:new Set,unchecked:new Set})},getSelectedIds:()=>[...c().checked],getExcludedIds:()=>[...c().unchecked]})),o=l=>e(c=>c.selectAll?!c.unchecked.has(l):c.checked.has(l)),s=l=>e(c=>c.selectAll?c.unchecked.size===0:l<=0?!1:c.checked.size===l),n=l=>e(c=>c.selectAll?c.unchecked.size>0&&c.unchecked.size<l:c.checked.size>0&&c.checked.size<l);return{useRowSelection:l=>({checked:o(l),toggle:()=>e.getState().toggleRow(l)}),useAllSelections:l=>{const c=s(l),h=n(l);return{checked:c,indeterminate:h,toggle:()=>e.getState().toggleAll()}},useSelectedCount:l=>e(c=>{if(!c.selectAll)return Math.min(c.checked.size,l);const h=l-c.unchecked.size;return h<0?0:h}),useSubmit:()=>()=>{const{selectAll:l,getSelectedIds:c,getExcludedIds:h}=e.getState();return l?{selectAll:!0,excludeIds:h()}:{selectAll:!1,includeIds:c()}},useReset:()=>e.getState().reset}},{useRowSelection:bo,useAllSelections:fo,useSelectedCount:yo,useReset:vo}=go(),et=()=>{const{data:e,isFetching:o}=wt({types:["table","view"]}),{searchParams:s}=se(),n=b.useMemo(()=>{if(!e)return null;const r=s.get("table");return e.find(a=>a.name===r)??e[0]},[e,s]);return{options:e,selectedOption:n,isFetching:o}},jo=()=>{const{updateSearchParams:e}=se(),{options:o,selectedOption:s,isFetching:n}=et(),r=vo();return{options:o,selectedOption:s,handleChange:a=>{if(!o)return;const{name:d}=o.find(u=>u.name===a.target.value)??o[0];r(),e({table:d,hiddenColumns:null,orderBy:null,order:null,page:null})},isFetching:n}},tt={borderRadius:1,overflow:"hidden","&::before":{borderBottom:0},"&:hover:not(.Mui-disabled, .Mui-error):before":{borderBottom:0},"& input":{p:U},"& div[role='combobox']":{p:U}},ot={sx:{width:"18rem"},size:"small",variant:"filled"},Co=()=>t.jsxs(P,{sx:{position:"relative"},children:[t.jsx(He,{...ot,disabled:!0,slotProps:{input:{sx:tt}}}),t.jsx(P,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center",color:"text.secondary"},children:t.jsx(jt,{color:"inherit",size:16})})]}),So=()=>{const{options:e,selectedOption:o,handleChange:s,isFetching:n}=jo();return!e||!o||n?t.jsx(Co,{}):t.jsxs(He,{select:!0,value:o.name,onChange:s,...ot,slotProps:{select:{IconComponent:Ve,MenuProps:{slotProps:{paper:{sx:{maxHeight:350}}},elevation:3}},input:{sx:{...tt,"& #tables-ias":{color:"text.secondary",m:0}},startAdornment:t.jsx(kt,{position:"start",id:"tables-ias",children:t.jsx(v,{variant:"caption",color:"inherit",sx:{p:.5,borderRadius:1,bgcolor:"divider",textTransform:"uppercase"},children:o.type})})}},children:[t.jsxs(Ce,{dense:!0,onClickCapture:r=>r.stopPropagation(),children:[t.jsx(St,{fontSize:"small",sx:{mr:.5}})," 新增資料表"]}),t.jsx(ue,{}),e.map(({name:r},i)=>t.jsx(Ce,{value:r,dense:!0,children:r},i))]})},wo=e=>{if(e==null)return"";if(typeof e=="string"||typeof e=="number")return e;const{data:o,error:s}=Ye(()=>String(e));if(s)throw new Error(`無法將資料轉換為有效格式: ${s.message}`);return o},Po=e=>{const o={};for(const s in e)o[s]=wo(e[s]);return o},Ie=async({table:e,page:o=0,limit:s=7,orderBy:n,order:r="asc"})=>{const i=Pt(),a=`SELECT COUNT(*) as total FROM ${e}`,d=await i.exec(a);if(!d||!d.length)throw new Error(`無法獲取 ${e} 表的資料總數，可能是表名錯誤或表不存在`);const u=d[0].total,l=Number(u);if(!Number.isInteger(l)||l<0)throw new Error(`無法解析 ${e} 表的總行數為有效整數`);o<0&&(o=0);const c=o*s,h=Math.ceil(l/s),f=o+1<h?o+1:null;let g=`SELECT * FROM ${e}`;n&&(g+=` ORDER BY ${String(n)} ${r.toUpperCase()}`),g+=` LIMIT ${s} OFFSET ${c}`;const x=(await i.exec(g)).map(Po);return{table:e,rows:x,nextPage:f,totalPages:h,totalRows:l}},Io=1*60*1e3,To=e=>{const{data:o,isFetching:s}=It({types:["table","view"]});return{columns:b.useMemo(()=>{if(!o||!e)return null;const r=o.find(i=>i.table===e);return(r==null?void 0:r.columns)??null},[o,e]),isFetching:s}},Ro=e=>{const{data:o,isFetching:s}=Xe({queryKey:["getTotalRows",e],queryFn:()=>Ie({table:e,limit:1,page:0}),staleTime:Io,enabled:e!==null});return{totalPages:(o==null?void 0:o.totalPages)??null,totalRows:(o==null?void 0:o.totalRows)??null,isFetching:s}},ko=Ae.array(Ae.number().int()),Bo=e=>{const{searchParams:o,updateSearchParams:s}=se(),n=b.useMemo(()=>{const a=o.get("hiddenColumns")??null;if(!a)return[];const{data:d,error:u}=Ye(()=>JSON.parse(a));if(u)return[];const l=ko.safeParse(d);return l.success?Array.from(new Set(l.data)):[]},[o]),r=b.useCallback(()=>{const a=n.length?[]:[...e];s({hiddenColumns:JSON.stringify(a)},{skipTransition:!0})},[n,s,e]),i=b.useCallback(a=>()=>{const d=Ft(n,a);s({hiddenColumns:JSON.stringify(d)},{skipTransition:!0})},[n,s]);return{hiddenColumns:n,toggleAllColumns:r,createColumnToggler:i}},Lo=e=>{const{searchParams:o,updateSearchParams:s}=se(),n=b.useMemo(()=>{const a=o.get("orderBy")??null;if(!a)return 0;const d=parseInt(a,10);return!Number.isInteger(d)||d<0||d>=e?0:d},[o,e]),r=b.useMemo(()=>{const a=o.get("order")??null;return a&&["asc","desc"].includes(a)?a:"asc"},[o]),i=b.useCallback(a=>()=>{const d=a,u=n===d&&r==="asc"?"desc":"asc";s({orderBy:d.toString(),order:u},{skipTransition:!0})},[n,r,s]);return{orderByIndex:n,order:r,createOrderToggler:i}},Fo=e=>{const{searchParams:o,updateSearchParams:s}=se(),n=b.useMemo(()=>{const i=o.get("page")??null;if(!i)return 0;const a=parseInt(i,10);return!Number.isInteger(a)||a<0||a>=e?0:a},[o,e]),r=b.useCallback((i,a)=>{a<0||a>=e||s({page:a.toString()},{skipTransition:!0})},[s,e]);return{page:n,handlePageChange:r}},pe=()=>{const{selectedOption:e,isFetching:o}=et(),s=b.useMemo(()=>(e==null?void 0:e.name)??null,[e]),{columns:n,isFetching:r}=To(s),{totalPages:i,totalRows:a,isFetching:d}=Ro(s),u=b.useMemo(()=>!s||!n||!i||!a?null:{table:s,columns:n,cids:n.map(l=>l.cid),totalPages:i,totalRows:a},[s,n,i,a]);return{isFetching:o||r||d,tableControlParams:u}},Q=e=>{const{hiddenColumns:o,toggleAllColumns:s,createColumnToggler:n}=Bo(e.cids),r=b.useMemo(()=>e.columns.map(f=>({...f,hidden:o.includes(f.cid)})),[e,o]),i=b.useMemo(()=>r.sort((f,g)=>f.cid-g.cid),[r]),a=b.useMemo(()=>r.filter(p=>!p.hidden).map(({hidden:p,...x})=>{const m=x.pk>=1,y=x.type!=="text"&&!m?"right":"left";return{...x,align:y}}).toSorted((p,x)=>p.pk!==x.pk?x.pk-p.pk:p.type==="text"&&x.type!=="text"?-1:p.type!=="text"&&x.type==="text"?1:p.cid-x.cid),[r]),{orderByIndex:d,order:u,createOrderToggler:l}=Lo(a.length),{page:c,handlePageChange:h}=Fo(e.totalPages);return{selectableColumns:i,tableColumns:a,toggleAllColumns:s,createColumnToggler:n,orderByIndex:d,order:u,createOrderToggler:l,page:c,totalPages:e.totalPages,totalRows:e.totalRows,handlePageChange:h}},Ne={edge:"start",tabIndex:-1,disableRipple:!0,size:"small",sx:{py:0}},st={bgcolor:"FilledInput.disabledBg","&:hover":{bgcolor:"FilledInput.hoverBg"},borderRadius:1,height:1,width:"auto",aspectRatio:1},Mo=()=>t.jsx(Le,{title:t.jsx(v,{variant:"body2",children:"篩選欄位"}),arrow:!0,children:t.jsxs("span",{style:{position:"relative"},children:[t.jsx(q,{loading:!0,centerRipple:!1,size:"small",sx:st,children:t.jsx(_e,{fontSize:"small"})}),t.jsx(P,{sx:{position:"absolute",top:0,bgcolor:"FilledInput.disabledBg",borderRadius:1,height:1,width:"auto",aspectRatio:1}})]})}),$o=()=>{const{isFetching:e,tableControlParams:o}=pe();return e||!o?t.jsx(Mo,{}):t.jsx(Ao,{params:o})},Ao=({params:e})=>{const{anchorEl:o,handleClose:s,handleOpen:n}=Ge(),{selectableColumns:r,toggleAllColumns:i,createColumnToggler:a}=Q(e),d=r.every(l=>!l.hidden),u=r.some(l=>!l.hidden)&&!d;return t.jsxs(t.Fragment,{children:[t.jsx(Le,{title:t.jsx(v,{variant:"body2",children:"篩選欄位"}),arrow:!0,children:t.jsx("span",{children:t.jsx(q,{onClick:n,centerRipple:!1,size:"small",sx:st,children:t.jsx(_e,{fontSize:"small"})})})}),t.jsx(We,{open:!!o,anchorEl:o,onClose:s,elevation:3,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{sx:{maxHeight:350}}},children:t.jsxs(qe,{dense:!0,children:[t.jsx(_,{children:t.jsx(v,{variant:"body2",sx:{color:"text.secondary"},children:"篩選欄位"})}),t.jsx(_,{disablePadding:!0,children:t.jsxs(Se,{role:void 0,onClick:i,dense:!0,children:[t.jsx(K,{...Ne,checked:d,indeterminate:u}),t.jsx(ce,{primary:"顯示所有"})]})}),t.jsx(ue,{sx:{my:.5}}),r.map(({cid:l,hidden:c,name:h,type:f})=>t.jsx(_,{disablePadding:!0,children:t.jsxs(Se,{role:void 0,onClick:a(l),dense:!0,children:[t.jsx(K,{...Ne,checked:!c}),t.jsx(ce,{sx:{display:"flex",width:1,gap:U,justifyContent:"space-between",my:.5},primary:h,secondary:f.toUpperCase()})]})},l))]})})]})},de=e=>({"--temporary-color":e,bgcolor:"color-mix(in srgb, var(--temporary-color) 30%, transparent 70%)","&:hover":{bgcolor:"color-mix(in srgb, var(--temporary-color) 40%, transparent 60%)"},color:"color-mix(in srgb, var(--temporary-color) 40%, var(--mui-palette-text-primary) 60%)",px:1.5}),zo=()=>t.jsxs(t.Fragment,{children:[t.jsx(v,{sx:{color:"text.secondary"},children:"已選取 0 個:"}),t.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:U},children:[t.jsx(ee,{sx:de("var(--mui-palette-primary-main)"),loading:!0,children:"覆蓋欄位"}),t.jsx(ee,{sx:de("var(--mui-palette-error-main)"),loading:!0,children:"刪除紀錄"})]})]}),Oo=()=>{const{isFetching:e,tableControlParams:o}=pe();return e||!o?t.jsx(zo,{}):t.jsx(No,{params:o})},No=({params:e})=>{const{totalRows:o}=Q(e),s=yo(o);return t.jsxs(t.Fragment,{children:[t.jsxs(v,{sx:{color:"text.secondary"},children:["已選取 ",s," 個 / ",o," 個:"]}),t.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:U},children:[t.jsx(Le,{title:t.jsx(v,{variant:"body2",children:"以指定值覆蓋選取資料的某個欄位"}),arrow:!0,children:t.jsx("span",{children:t.jsx(ee,{sx:de("var(--mui-palette-primary-main)"),disabled:s<=0,children:"覆蓋欄位"})})}),t.jsx(ee,{sx:de("var(--mui-palette-error-main)"),disabled:s<=0,children:"刪除紀錄"})]})]})},Do=e=>({"--temporary-color":e,bgcolor:"color-mix(in srgb, var(--temporary-color) 90%, var(--mui-palette-text-primary) 10%)","&:hover":{bgcolor:"color-mix(in srgb, var(--temporary-color) 80%, var(--mui-palette-text-primary) 20%)"},color:"color-mix(in srgb, var(--temporary-color) 5%, var(--mui-palette-background-paper) 95%)",px:1.5}),Eo=["date","json_array","json_object","integer","real","boolean","uuid"],Uo=({params:e})=>{const{selectableColumns:o}=Q(e),s=b.useMemo(()=>o.filter(({type:n})=>Eo.includes(n)),[o]);return t.jsxs(qe,{dense:!0,children:[t.jsx(_,{children:t.jsx(v,{variant:"body2",sx:{color:"text.secondary"},children:"可標準化的欄位"})}),t.jsx(ue,{sx:{my:.5}}),s.map(({cid:n,name:r,type:i})=>t.jsx(_,{disablePadding:!0,children:t.jsx(Se,{role:void 0,dense:!0,children:t.jsx(ce,{sx:{display:"flex",width:1,gap:U,justifyContent:"space-between",my:.5},primary:r,secondary:i.toUpperCase()})})},n)),s.length<=0&&t.jsx(_,{children:t.jsx(ce,{sx:{textAlign:"center"},primary:"無可標準化的欄位"})})]})},Ho=()=>{const{anchorEl:e,handleClose:o,handleOpen:s}=Ge(),{isFetching:n,tableControlParams:r}=pe();return t.jsxs(t.Fragment,{children:[t.jsx(ee,{sx:Do("var(--mui-palette-primary-main)"),endIcon:t.jsx(Ve,{}),onClick:s,loading:n,children:"標準化"}),r&&t.jsx(We,{open:!!e,anchorEl:e,onClose:o,elevation:3,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},slotProps:{paper:{sx:{maxHeight:350}}},children:t.jsx(Uo,{params:r})})]})},Wo=1e3*60*1,E=7,qo=e=>{const o=$t(),{data:s,isFetched:n}=Xe({queryKey:["getRows",e],queryFn:()=>Ie(e),staleTime:Wo,enabled:e!==null});if(e!==null&&e.page!==void 0){const r={...e,page:e.page+1};o.prefetchQuery({queryKey:["getRows",r],queryFn:()=>Ie(r)})}return{isFetching:!n,data:s}},Vo=e=>{var u;const{tableColumns:o,page:s,order:n,orderByIndex:r}=Q(e),{data:i,isFetching:a}=qo({table:e.table,limit:E,page:s,orderBy:((u=o[r])==null?void 0:u.name)??void 0,order:n});return{rows:b.useMemo(()=>!i||a?null:i.rows.map(l=>({id:JSON.stringify(l),values:o.map(c=>({value:l[c.name],align:c.align}))})),[o,i,a]),columns:o,isFetching:a}},_o=()=>t.jsxs(Ke,{sx:{borderSpacing:"0 0.3rem",borderCollapse:"separate"},children:[t.jsx(Qe,{sx:{position:"relative"},children:t.jsxs(O,{children:[t.jsx(S,{padding:"checkbox",sx:G("top-left"),children:t.jsx(K,{disabled:!0,size:"small"})}),t.jsx(S,{sx:G("no-radius"),children:t.jsx(X,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:t.jsx(v,{variant:"body2",children:"載入中. . ."})})}),[...Array(4)].map((e,o)=>t.jsx(S,{sx:G(o===3?"top-right":"no-radius"),children:t.jsx(P,{sx:{display:"flex",justifyContent:"flex-end"},children:t.jsx(X,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:t.jsx(v,{variant:"body2",children:"載入中. . ."})})})},o))]})}),t.jsx(Je,{children:[...Array(E)].map((e,o)=>t.jsxs(O,{sx:V.row(!1,o),children:[t.jsx(S,{padding:"checkbox",sx:V.checkboxCell,children:t.jsx(K,{disabled:!0,size:"small"})}),t.jsx(S,{sx:V.rowCell(!1),children:t.jsx(X,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:t.jsx(v,{children:"載入中. . ."})})}),[...Array(4)].map((s,n)=>t.jsx(S,{sx:V.rowCell(n===3),children:t.jsx(P,{sx:{display:"flex",justifyContent:"flex-end"},children:t.jsx(X,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:t.jsx(v,{children:"載入中. . ."})})})},n))]},o))}),t.jsx(Ze,{children:t.jsx(O,{children:t.jsx(we,{colSpan:6,count:0,rowsPerPage:10,rowsPerPageOptions:[10],page:0,showFirstButton:!0,showLastButton:!0,slotProps:{select:{inputProps:{"aria-label":"rows per page"}}},onPageChange:()=>{},disabled:!0,sx:{border:0}})})})]}),De={p:.5,borderRadius:1,bgcolor:"divider"},Ee={textTransform:"uppercase",lineHeight:1,color:"text.secondary"},Go=({isPk:e,type:o})=>t.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:U,color:"text.secondary"},children:[e&&t.jsx(v,{variant:"caption",sx:{...De,...Ee},children:"PK"}),t.jsx(P,{sx:De,children:t.jsx(v,{variant:"caption",sx:{...Ee,...Be},children:o})})]}),Ko=e=>{const{checked:o,indeterminate:s,toggle:n}=fo(e.totalRows),r=b.useMemo(()=>!o&&!s,[o,s]);return{toggleCheckedAll:n,checked:o,unchecked:r,indeterminate:s}},Qo=({params:e})=>{const{tableColumns:o,orderByIndex:s,order:n,createOrderToggler:r}=Q(e),{toggleCheckedAll:i,checked:a,unchecked:d,indeterminate:u}=Ko(e);return t.jsxs(O,{children:[t.jsx(S,{padding:"checkbox",sx:G("top-left"),children:t.jsx(K,{color:"default",onChange:i,indeterminate:u,checked:a,size:"small",sx:{color:d?void 0:"color-mix(in srgb, var(--mui-palette-text-primary) 30%, var(--mui-palette-primary-main) 70%)"}})}),o.map((l,c)=>{const{cid:h,name:f,type:g,align:p}=l,x=l.pk>=1,m=s===c,y=m&&n==="desc"?1:-1,j=p==="right"?"flex-end":"flex-start",w=c===o.length-1;return t.jsx(S,{sx:{minWidth:"10rem",...G(w?"top-right":"no-radius")},children:t.jsxs(P,{sx:{display:"flex",alignItems:"center",justifyContent:j},children:[t.jsx(mo,{active:m,direction:m?n:"asc",IconComponent:Nt,slotProps:{icon:{sx:{transform:`scaleY(${y})`}}},onClick:r(c),children:t.jsx(v,{variant:"body2",children:f})}),t.jsx(Go,{isPk:x,type:g})]})},h)}),o.length===0&&t.jsx(S,{sx:G("top-right"),colSpan:1})]})},z=V,nt=({checked:e,...o})=>t.jsx(S,{padding:"checkbox",sx:z.checkboxCell,children:t.jsx(K,{color:"default",size:"small",sx:z.checkbox(e??!1),checked:e,...o})}),Jo=({id:e,values:o,index:s})=>{const{checked:n,toggle:r}=bo(e);return t.jsxs(O,{sx:z.row(n,s),children:[t.jsx(nt,{checked:n,onChange:r}),o.map(({value:i,align:a},d)=>t.jsx(S,{align:a,sx:z.rowCell(d===o.length-1),children:t.jsx(v,{sx:Be,children:i})},d))]})},Yo=({params:e})=>{const{rows:o,columns:s,isFetching:n}=Vo(e),r=s.length+1;return s.length===0?t.jsx(O,{sx:z.row(!1,1),children:t.jsx(S,{sx:z.rowCellFull,colSpan:2,children:t.jsx(v,{sx:{color:"text.secondary",textAlign:"center"},children:"至少要選取一個欄位才能顯示資料"})})}):n||!o?t.jsx(t.Fragment,{children:[...Array(E)].map((i,a)=>t.jsxs(O,{sx:V.row(!1,a),children:[t.jsx(nt,{checked:!1,disabled:!0}),s.map(({align:d},u)=>t.jsx(S,{sx:z.rowCell(u===s.length-1),children:t.jsx(P,{sx:{display:"flex",justifyContent:d==="right"?"flex-end":"flex-start"},children:t.jsx(X,{variant:"rounded",animation:"wave",sx:{maxWidth:"none",width:.5},children:t.jsx(v,{sx:Be,children:"載入中. . ."})})})},u))]},a))}):o.length?t.jsx(t.Fragment,{children:o.map((i,a)=>t.jsx(Jo,{...i,index:a},i.id))}):t.jsx(O,{sx:z.row(!1,1),children:t.jsx(S,{sx:z.rowCellFull,colSpan:r,children:t.jsx(v,{sx:{color:"text.secondary",textAlign:"center"},children:"該資料表 / 檢視表目前沒有任何資料"})})})},Xo=({params:e})=>{const{tableColumns:o,totalRows:s,page:n,handlePageChange:r}=Q(e);return o.length===0?t.jsx(we,{colSpan:2,count:0,rowsPerPage:E,rowsPerPageOptions:[E],page:0,showFirstButton:!0,showLastButton:!0,onPageChange:r,sx:{border:0}}):t.jsx(we,{colSpan:o.length+1,count:s??0,rowsPerPage:E,rowsPerPageOptions:[E],page:n,showFirstButton:!0,showLastButton:!0,onPageChange:r,sx:{border:0}})},Zo=({params:e})=>t.jsxs(Ke,{sx:{borderSpacing:"0 0.3rem",borderCollapse:"separate"},children:[t.jsx(Qe,{sx:{position:"relative"},children:t.jsx(Qo,{params:e})}),t.jsx(Je,{children:t.jsx(Yo,{params:e})}),t.jsx(Ze,{children:t.jsx(O,{children:t.jsx(Xo,{params:e})})})]}),es=()=>{const{isFetching:e,tableControlParams:o}=pe();return t.jsx(Lt,{sx:{mt:ho},children:e||!o?t.jsx(_o,{}):t.jsx(Zo,{params:o})})},$s=()=>t.jsxs(Ct,{children:[t.jsxs(P,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:ye},children:[t.jsxs(P,{sx:{display:"flex",alignItems:"stretch",gap:ye},children:[t.jsx(So,{}),t.jsx($o,{})]}),t.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:ye},children:[t.jsx(Oo,{}),t.jsx(ue,{flexItem:!0,orientation:"vertical"}),t.jsx(Ho,{})]})]}),t.jsx(es,{})]});export{$s as default};
