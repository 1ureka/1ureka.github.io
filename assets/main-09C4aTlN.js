const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LargeTiles-CprOfB4Y.js","assets/routes-Cw1nLV0F.js","assets/routes-Uzu4JJaw.css","assets/ArrowDropDownRounded-BAt1itUd.js","assets/TileText-B0mbKDw0.js","assets/DarkModeRounded-Clg7DWY8.js","assets/StripedBackground-CTaPO6y5.js","assets/url-DAbm-tM2.js","assets/Skeleton-bPXVEAmt.js","assets/MenuItem-BDIMR49-.js","assets/Badge-Dp5AIEt8.js","assets/ArrowOutwardRounded-DXLqWmks.js","assets/style-BWVnP3OF.js","assets/DatasetRounded-CeqaCVwN.js","assets/with-selector-BPNQAtbJ.js","assets/style-Dl9Bm5cW.css","assets/formatters-C9bWSe0O.js","assets/Switch-BEtXNuNs.js","assets/SwitchBase-hSk2M1ad.js","assets/RefreshRounded-6kGQgtWX.js","assets/SQLiteClient-DOBCMCEk.js","assets/DataExplorationRounded-CHRqmRc2.js","assets/NotificationsRounded-Byg1fMqP.js","assets/fuse-BvmEoKng.js","assets/useMutation-BSojgXSC.js","assets/dayjs.min-DUORdx6y.js","assets/ExpandMoreRounded-mZFs3VO1.js","assets/DownloadRounded-DVxLaAop.js","assets/SmallTiles-Z1gzIOGx.js","assets/OpenInNewRounded-70c1xh0x.js","assets/Sidebar-BdUJCCZu.js","assets/TreeViewTransition-C6vChZbG.js","assets/useThemeProps-Dxy72zGK.js","assets/MoreHorizRounded-6kfDBxKn.js","assets/Checkbox-DesAMF7P.js","assets/proxy-CeruI1X4.js","assets/FlowChart-BmBVhISs.js","assets/Motion-BCeF_-Kd.js","assets/TablesLayout-wNAzKwTi.js","assets/FilterAltRounded-B8qF2Vc5.js","assets/index-mSkvzYyn.js","assets/array-l11GhOAf.js","assets/AddRounded-DG4svljF.js","assets/SortRounded-CKieKDLt.js","assets/KeyboardArrowRight-DElJtHet.js","assets/Toolbar-BQWJSfdC.js"])))=>i.map(i=>d[i]);
import{n as g,j as e,s as L,y as Q,m as Ne,az as de,a as Ke,g as We,r as x,u as Ue,a7 as Ze,c as Ge,d as Ye,l as h,f as we,i as A,R as ue,aA as Je,o as d,S as v,B as k,v as p,T as Xe,C as et,h as tt,z as st,w as z,t as he,E as Ie,I as N,p as nt,P as ke,M as rt,ao as ot,F as $,D as at}from"./routes-Cw1nLV0F.js";import{u as Re,R as ct,E as it,Q as lt,b as dt,c as ut}from"./RefreshRounded-6kGQgtWX.js";import{S as ht,f as pt,t as xt,u as R}from"./SQLiteClient-DOBCMCEk.js";import{u as S}from"./url-DAbm-tM2.js";import{D as ee,V as mt}from"./DataExplorationRounded-CHRqmRc2.js";import{A as bt,W as ft,a as Ee}from"./ArrowDropDownRounded-BAt1itUd.js";import{D as gt,N as yt}from"./NotificationsRounded-Byg1fMqP.js";import{u as te}from"./fuse-BvmEoKng.js";import{u as Me,D as jt}from"./useMutation-BSojgXSC.js";import{d as vt}from"./dayjs.min-DUORdx6y.js";import{M as C}from"./MenuItem-BDIMR49-.js";import{I as se,S as Te,D as Fe,E as Ct}from"./ExpandMoreRounded-mZFs3VO1.js";import{C as St,B as wt}from"./Badge-Dp5AIEt8.js";import{T as K,D as It}from"./DarkModeRounded-Clg7DWY8.js";import{D as kt}from"./DownloadRounded-DVxLaAop.js";const Rt=g(e.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})),Et=L(Q)(Ne(({theme:t})=>({display:"flex",marginLeft:`calc(${t.spacing(1)} * 0.5)`,marginRight:`calc(${t.spacing(1)} * 0.5)`,...t.palette.mode==="light"?{backgroundColor:t.palette.grey[100],color:t.palette.grey[700]}:{backgroundColor:t.palette.grey[700],color:t.palette.grey[100]},borderRadius:2,"&:hover, &:focus":{...t.palette.mode==="light"?{backgroundColor:t.palette.grey[200]}:{backgroundColor:t.palette.grey[600]}},"&:active":{boxShadow:t.shadows[0],...t.palette.mode==="light"?{backgroundColor:de(t.palette.grey[200],.12)}:{backgroundColor:de(t.palette.grey[600],.12)}}}))),Mt=L(Rt)({width:24,height:16});function Tt(t){const{slots:s={},slotProps:n={},...r}=t,c=t;return e.jsx("li",{children:e.jsx(Et,{focusRipple:!0,...r,ownerState:c,children:e.jsx(Mt,{as:s.CollapsedIcon,ownerState:c,...n.collapsedIcon})})})}function Ft(t){return We("MuiBreadcrumbs",t)}const Pt=Ke("MuiBreadcrumbs",["root","ol","li","separator"]),_t=t=>{const{classes:s}=t;return Ye({root:["root"],li:["li"],ol:["ol"],separator:["separator"]},Ft,s)},Bt=L(h,{name:"MuiBreadcrumbs",slot:"Root",overridesResolver:(t,s)=>[{[`& .${Pt.li}`]:s.li},s.root]})({}),At=L("ol",{name:"MuiBreadcrumbs",slot:"Ol",overridesResolver:(t,s)=>s.ol})({display:"flex",flexWrap:"wrap",alignItems:"center",padding:0,margin:0,listStyle:"none"}),Lt=L("li",{name:"MuiBreadcrumbs",slot:"Separator",overridesResolver:(t,s)=>s.separator})({display:"flex",userSelect:"none",marginLeft:8,marginRight:8});function zt(t,s,n,r){return t.reduce((c,i,o)=>(o<t.length-1?c=c.concat(i,e.jsx(Lt,{"aria-hidden":!0,className:s,ownerState:r,children:n},`separator-${o}`)):c.push(i),c),[])}const Dt=x.forwardRef(function(s,n){const r=Ue({props:s,name:"MuiBreadcrumbs"}),{children:c,className:i,component:o="nav",slots:a={},slotProps:u={},expandText:l="Show path",itemsAfterCollapse:b=1,itemsBeforeCollapse:m=1,maxItems:f=8,separator:j="/",...y}=r,[M,U]=x.useState(!1),T={...r,component:o,expanded:M,expandText:l,itemsAfterCollapse:b,itemsBeforeCollapse:m,maxItems:f,separator:j},H=_t(T),Ve=Ze({elementType:a.CollapsedIcon,externalSlotProps:u.collapsedIcon,ownerState:T}),ie=x.useRef(null),Qe=w=>{const G=()=>{U(!0);const le=ie.current.querySelector("a[href],button,[tabindex]");le&&le.focus()};return m+b>=w.length?w:[...w.slice(0,m),e.jsx(Tt,{"aria-label":l,slots:{CollapsedIcon:a.CollapsedIcon},slotProps:{collapsedIcon:Ve},onClick:G},"ellipsis"),...w.slice(w.length-b,w.length)]},Z=x.Children.toArray(c).filter(w=>x.isValidElement(w)).map((w,G)=>e.jsx("li",{className:H.li,children:w},`child-${G}`));return e.jsx(Bt,{ref:n,component:o,color:"textSecondary",className:Ge(H.root,i),ownerState:T,...y,children:e.jsx(At,{className:H.ol,ref:ie,ownerState:T,children:zt(M||f&&Z.length<=f?Z:Qe(Z),H.separator,j,T)})})}),Ht=we(),q=we({cssVariables:{colorSchemeSelector:".mode-%s"},typography:{fontFamily:'Comfortaa, "jf openhuninn"'},colorSchemes:{light:{palette:{primary:{main:"#66cccc",dark:"#45a1a1"},secondary:{main:"#66cccc90",dark:"color-mix(in srgb, #66cccc 50%, var(--mui-palette-text-primary) 50%)"}}},dark:{palette:{primary:{main:"#66cccc",dark:"#2d8686"},secondary:{main:"#66cccc90",dark:"color-mix(in srgb, #66cccc 50%, var(--mui-palette-text-primary) 50%)"},background:{default:"#222",paper:"#222"}}}},breakpoints:{values:{...Ht.breakpoints.values,sm:700,ml:1440}},components:{MuiInputBase:{defaultProps:{sx:{"&.Mui-disabled::before":{borderBottomStyle:"solid"}}}}},spacing:"0.5rem"}),Pe=()=>{const t=A(q.breakpoints.up("lg")),s=A(q.breakpoints.up("md")),n=A(q.breakpoints.up("sm"));return x.useEffect(()=>{t?document.documentElement.style.fontSize="16px":s&&(document.documentElement.style.fontSize="14px")},[t,s,n]),{isLg:t,isMd:s,isSm:n}},pe=t=>{let s;const n=new Set,r=(l,b)=>{const m=typeof l=="function"?l(s):l;if(!Object.is(m,s)){const f=s;s=b??(typeof m!="object"||m===null)?m:Object.assign({},s,m),n.forEach(j=>j(s,f))}},c=()=>s,a={setState:r,getState:c,getInitialState:()=>u,subscribe:l=>(n.add(l),()=>n.delete(l))},u=s=t(r,c,a);return a},Ot=t=>t?pe(t):pe,$t=t=>t;function qt(t,s=$t){const n=ue.useSyncExternalStore(t.subscribe,()=>s(t.getState()),()=>s(t.getInitialState()));return ue.useDebugValue(n),n}const xe=t=>{const s=Ot(t),n=r=>qt(s,r);return Object.assign(n,s),n},Vt=t=>t?xe(t):xe,_e=Vt(t=>({client:null,setClient:s=>t({client:s}),resetClient:()=>t({client:null})})),I=()=>{const{client:t}=_e.getState();if(!t)throw new Error("SQLite client is not initialized.");return t},Be={forum:pt},Qt=t=>Je(Be).includes(t);function Nt(){const{searchParams:t}=S(),s=_e(r=>r.setClient),n=Re();x.useEffect(()=>{let r=t.get("db");if((r===null||r.trim()==="")&&(r="forum"),!Qt(r))throw new Error(`要求資料庫 "${r}" 不存在`);const c=new ht({dbPath:Be[r],storageKey:`sqlite-db-${r}`});s(c),n.resetQueries({queryKey:[]})},[s,t,n])}const Ae=72;function me({error:t,resetErrorBoundary:s}){Pe();const n=t.name==="ScreenWidthError",c=t instanceof Error?t.name:"UnknownError",i=c==="AbortError"||c==="NetworkError"||c==="TypeError"||n;return e.jsxs(d,{sx:{position:"fixed",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:{xs:2,sm:4},bgcolor:"background.default"},children:[e.jsx(d,{sx:{position:"absolute",inset:0,bgcolor:"primary.main",opacity:.1,pointerEvents:"none"}}),e.jsx(d,{sx:{position:"absolute",inset:0,pointerEvents:"none",overflow:"hidden",display:"flex",justifyContent:"center"},children:e.jsxs(d,{sx:{position:"absolute",maskImage:"radial-gradient(circle at 50% 25%, #0008 0%, #0008 100%)",pointerEvents:"none",bgcolor:"primary.main",fill:"var(--mui-palette-background-paper)",fillOpacity:.2,width:1,minWidth:1200,height:1},children:[e.jsxs("svg",{style:{scale:"1 -1"},width:"100%",height:"200",viewBox:"0 0 1920 300",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none",children:[e.jsx("path",{d:"M0,160 C160,180 320,140 480,160 C640,180 800,120 960,150 C1120,180 1280,130 1440,160 C1600,190 1760,150 1920,170 L1920,300 L0,300 Z"}),e.jsx("path",{d:"M0,190 C120,210 240,160 360,190 C480,220 600,140 720,180 C840,220 960,130 1080,180 C1200,230 1320,160 1440,200 C1560,240 1740,180 1920,210 L1920,300 L0,300 Z"}),e.jsx("path",{d:"M0,230 C160,250 320,190 480,230 C640,270 800,180 960,220 C1120,260 1280,170 1440,210 C1600,250 1760,200 1920,230 L1920,300 L0,300 Z"})]}),e.jsxs("svg",{style:{position:"absolute",inset:"auto 0 0 0"},width:"100%",height:"200",viewBox:"0 0 1920 300",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none",children:[e.jsx("path",{d:"M0,160 C160,180 320,140 480,160 C640,180 800,120 960,150 C1120,180 1280,130 1440,160 C1600,190 1760,150 1920,170 L1920,300 L0,300 Z"}),e.jsx("path",{d:"M0,190 C120,210 240,160 360,190 C480,220 600,140 720,180 C840,220 960,130 1080,180 C1200,230 1320,160 1440,200 C1560,240 1740,180 1920,210 L1920,300 L0,300 Z"}),e.jsx("path",{d:"M0,230 C160,250 320,190 480,230 C640,270 800,180 960,220 C1120,260 1280,170 1440,210 C1600,250 1760,200 1920,230 L1920,300 L0,300 Z"})]})]})}),e.jsx(d,{sx:{position:"relative",zIndex:1,display:"grid",placeItems:"center"},children:e.jsxs(v,{sx:{gap:5,alignItems:"center"},children:[e.jsxs(d,{sx:{display:"flex",gap:1,alignItems:"center",translate:"-2.5%"},children:[e.jsx(ee,{sx:{fontSize:"4rem",color:"secondary.dark"}}),e.jsx(h,{variant:"h3",component:"h1",sx:{fontFamily:'"timemachine-wa"',color:"secondary.dark"},children:"資料樣板"})]}),e.jsxs(v,{sx:{gap:1,alignItems:"center"},children:[e.jsx(h,{variant:"h5",component:"h3",children:"發生錯誤"}),e.jsx(h,{variant:"body1",sx:{color:"text.secondary"},children:(t==null?void 0:t.message)||"未知錯誤"})]}),i&&e.jsx(h,{variant:"body1",sx:{color:"text.secondary"},children:"* 該錯誤無法透過重新載入修正"}),e.jsxs(d,{sx:{display:"flex",gap:2,mt:2,color:"text.secondary"},children:[!i&&e.jsx(k,{variant:"outlined",color:"inherit",disableElevation:!0,href:p.datahub_home,startIcon:e.jsx(bt,{}),children:"返回首頁"}),!i&&s&&e.jsx(k,{variant:"text",color:"inherit",onClick:()=>s(),startIcon:e.jsx(ct,{}),children:"重新載入"}),i&&e.jsx(k,{variant:"outlined",color:"inherit",startIcon:e.jsx(it,{}),href:p.home,children:"返回作品集首頁"})]})]})})]})}const Kt=new lt;function Wt({children:t}){return e.jsxs(Xe,{theme:q,children:[e.jsx(et,{}),e.jsx(tt,{}),e.jsx(dt,{client:Kt,children:e.jsx(ut,{fallbackRender:s=>e.jsx(me,{...s}),children:e.jsx(ft,{minWidth:700,render:s=>e.jsx(me,{error:s}),children:t})})})]})}const Ut=g(e.jsx("path",{d:"M20 19.59V8.83c0-.53-.21-1.04-.59-1.41l-4.83-4.83c-.37-.38-.88-.59-1.41-.59H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c.45 0 .85-.15 1.19-.4l-4.43-4.43c-.86.56-1.89.88-3 .82-2.37-.11-4.4-1.96-4.72-4.31-.44-3.35 2.45-6.18 5.83-5.61 1.95.33 3.57 1.85 4 3.78.33 1.46.01 2.82-.7 3.9zM9 13c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3-3 1.34-3 3"}));function Zt(t,s=.9){if(!Array.isArray(t)||t.length===0)return null;if(s<0||s>1)throw new Error("Ratio must be between 0 and 1");const n=t.reduce((o,a)=>(o[a]=(o[a]||0)+1,o),{});let r=t[0],c=0;for(const[o,a]of st(n))a>c&&(r=o,c=a);return c/t.length>=s?r:null}const Gt=async(t="database.sqlite")=>I().downloadDatabase(t),Yt=async()=>await I().getDatabaseSize(),Le=async t=>{const s=I(),n=[];return await Promise.all(t.map(async r=>{(await s.exec(`
      SELECT name FROM sqlite_master WHERE type = $type AND name NOT LIKE 'sqlite_%' ORDER BY rowid;
      `,{$type:r})).forEach(o=>{typeof o.name=="string"&&n.push({type:r,name:o.name})})})),n.toSorted((r,c)=>r.type.localeCompare(c.type))},Jt=async t=>{const s=I(),n={},r=await Le(t);return await Promise.all(r.map(async({name:c})=>{const i=`SELECT COUNT(*) as count FROM ${c};`,o=await s.exec(i);o.length>0?n[c]=Number(o[0].count??0):n[c]=0})),n},Xt=t=>{if(t==null)return"empty";if(typeof t=="number"&&Number.isInteger(t))return"integer";if(typeof t=="number")return"real";if(typeof t!="string")return"unknown";if(t.trim()==="")return"empty";if(/^[0-9a-f]{8}-[0-9a-f]{4}/.test(t))return"uuid";if(["true","false","0","1"].includes(t.toLowerCase()))return"boolean";if(vt(t).isValid())return"date";const n=xt(()=>JSON.parse(t));if(n.error)return"text";const r=n.data;return Array.isArray(r)?"json_array":typeof r=="object"&&r!==null?"json_object":"text"},es=async(t,s,n)=>{const r=I(),c=`SELECT "${s}" FROM "${t}" LIMIT 20;`,i=await r.exec(c);if(i.length===0)return n;const o=i.map(u=>Xt(u[s])).filter(u=>u!=="empty"),a=Zt(o,.9);return!a||a==="unknown"?n:a},ts=async t=>{const s=I(),n=`PRAGMA table_info(${t});`,r=await s.exec(n);if(r.length===0)return null;const i=(await Promise.all(r.map(o=>es(t,o.name,o.type)))).map(o=>o.toLowerCase());return r.map((o,a)=>({...o,type:i[a]}))},ss=async t=>{const s=I(),n=`PRAGMA foreign_key_list(${t});`;return await s.exec(n)},ns=async t=>{const s=I(),n=`PRAGMA index_list(${t});`,r=await s.exec(n);return await Promise.all(r.map(async i=>{const o=`PRAGMA index_info(${i.name});`,a=await s.exec(o);return{...i,columns:a}}))},E=1*60*1e3,rs=()=>Me({mutationFn:Gt,onSuccess:()=>console.log("下載資料庫成功"),onError:t=>console.error("下載資料庫失敗:",t)}),wn=()=>R({queryKey:["dbBytes"],queryFn:()=>Yt(),staleTime:E}),W=({types:t})=>R({queryKey:["objects",t],queryFn:()=>Le(t),staleTime:E}),os=({types:t})=>R({queryKey:["rowCounts",t],queryFn:()=>Jt(t),staleTime:E}),ne=({types:t})=>{const{data:s=[],isFetching:n}=W({types:t}),{data:r,isFetching:c}=R({queryKey:["tableInfos",s],queryFn:async()=>(await Promise.all(s.map(async({name:o,type:a})=>({table:o,type:a,columns:await ts(o)})))).filter(o=>o.columns!==null),enabled:s.length>0,staleTime:E});return{data:r,isFetching:n||c}},as=()=>{const{data:t=[],isFetching:s}=ne({types:["table","view"]});return{data:x.useMemo(()=>t.length?t.flatMap(({table:r,type:c,columns:i})=>i.map(o=>({...o,id:`${r}.${o.name}`,from:{table:r,type:c}}))):[],[t]),isFetching:s}},cs=({types:t})=>{const{data:s=[],isFetching:n}=W({types:t}),{data:r,isFetching:c}=R({queryKey:["foreignKeys",s],queryFn:async()=>(await Promise.all(s.map(async({name:o,type:a})=>({table:o,type:a,keys:await ss(o)})))).filter(o=>o.keys.length>0),enabled:s.length>0,staleTime:E});return{data:r,isFetching:n||c}},is=({types:t})=>{const{data:s=[],isFetching:n}=W({types:t}),{data:r,isFetching:c}=R({queryKey:["indexes",s],queryFn:async()=>(await Promise.all(s.map(async({name:o,type:a})=>({table:o,type:a,indexes:await ns(o)})))).filter(o=>o.indexes.length>0),enabled:s.length>0,staleTime:E});return{data:r,isFetching:n||c}},In=()=>{const{data:t=[],isFetching:s}=ne({types:["table","view"]}),{data:n=[],isFetching:r}=cs({types:["table","view"]}),c=x.useMemo(()=>{if(t.length===0||n.length===0)return[];const o={};return n.forEach(({keys:a})=>{a.forEach(({table:u,to:l})=>{o[u]||(o[u]=new Set),o[u].add(l)})}),t.toSorted((a,u)=>a.type.localeCompare(u.type)).map(({table:a,type:u,columns:l},b)=>{const m=n.find(({table:y})=>y===a)||null,f=l.map(y=>{var M;return{fieldName:y.name,fieldType:y.type,nullable:y.pk>=1?"pk":y.notnull===0?"yes":"no",isSource:((M=o[a])==null?void 0:M.has(y.name))||!1,isTarget:(m==null?void 0:m.keys.some(U=>U.from===y.name))||!1}}),j=b%7;return{tableName:a,tableType:u,hueIndex:j,fields:f}})},[t,n]),i=x.useMemo(()=>{if(t.length===0||n.length===0)return[];const o=[];return n.forEach(({table:a,keys:u})=>{u.forEach(({from:l,to:b,table:m})=>{const f=b,j=m===a?`${l}_self`:l;o.push({id:`${m}.${j}->${a}.${f}`,source:m,target:a,sourceHandle:f,targetHandle:j})})}),o},[t,n]);return{nodes:c,edges:i,isFetching:s||r}},kn=()=>{const{data:t=[],isFetching:s}=ne({types:["table","view"]}),{data:n=[],isFetching:r}=is({types:["table","view"]});return{data:x.useMemo(()=>{if(t.length===0||n.length===0)return{};const i={};return t.toSorted((o,a)=>o.type.localeCompare(a.type)).forEach(({table:o,columns:a,type:u},l)=>{i[o]={columns:a,indexes:[],type:u,hueIndex:l%7}}),n.forEach(({table:o,indexes:a})=>{i[o]&&i[o].indexes.push(...a)}),i},[t,n]),isFetching:s||r}},ze=t=>["db","table","column"].includes(t),re=()=>{const{searchParams:t,updateSearchParams:s}=S(),n=t.get("searchTopic")??"table";return{searchTopic:ze(n)?n:"table",updateSearchParams:s}},De=()=>{const{searchParams:t,updateSearchParams:s}=S(),n=t.get("searchQuery")??"";return{searchQuery:n,handleQueryChange:c=>{c!==n&&(c.length>99||s({searchQuery:c},{skipTransition:!0}))}}},ls=[{primary:"論壇資料庫",secondary:"來自論壇樣板",id:"forum",type:"資料庫"},{primary:"相簿資料庫",secondary:"來自相簿樣板",id:"photos",type:"資料庫"}],ds=t=>{const s=te(ls,["primary","secondary"]);return{results:x.useMemo(()=>s(t),[s,t]),isFetching:!1}},us=t=>{const{data:s,isFetching:n}=W({types:["table","view"]}),{data:r,isFetching:c}=os({types:["table","view"]}),i=n||c,o=x.useMemo(()=>!r||!s?[]:s.map(({name:l,type:b})=>{const m=r[l]||0;return{id:l,primary:l,secondary:`該${{table:"資料",view:"檢視"}[b]}表有 ${m} 筆紀錄`,type:b}}),[r,s]),a=te(o,["primary","secondary"]);return{results:x.useMemo(()=>a(t),[a,t]),isFetching:i}},hs=t=>{const{data:s,isFetching:n}=as(),r=x.useMemo(()=>!s||s.length<=0?[]:s.map(({id:o,name:a,type:u,from:l})=>({id:o,primary:a,secondary:`來自${{table:"資料",view:"檢視"}[l.type]}表 "${l.table}"`,type:u})),[s]),c=te(r,["primary","secondary"]);return{results:x.useMemo(()=>c(t),[c,t]),isFetching:n}},He=()=>{const{searchTopic:t,updateSearchParams:s}=re();return{searchTopic:t,handleSelect:r=>{const c=r.target.value;c!==t&&ze(c)&&s({searchTopic:c})}}},ps=()=>{const{searchTopic:t,handleSelect:s}=He();return e.jsxs(z,{select:!0,value:t,onChange:s,size:"small",variant:"outlined",sx:{bgcolor:"background.paper",backgroundImage:"linear-gradient(#fff1, #fff1)",borderRadius:1},slotProps:{input:{sx:{"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"secondary.main"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"divider"}}}},children:[e.jsx(C,{value:"db",dense:!0,children:"資料庫"}),e.jsx(C,{value:"table",dense:!0,children:"資料表"}),e.jsx(C,{value:"column",dense:!0,children:"欄位"})]})},xs={borderRadius:2,overflow:"hidden","&::before":{borderBottom:0},"&:hover:not(.Mui-disabled, .Mui-error):before":{borderBottom:0},"& input":{p:1},"& div[role='combobox']":{p:1}},ms=()=>{const{searchTopic:t,handleSelect:s}=He();return e.jsxs(z,{select:!0,value:t,onChange:s,variant:"filled",sx:{bgcolor:"background.paper",backgroundImage:"linear-gradient(#fff1, #fff1)",borderRadius:1},slotProps:{select:{IconComponent:Ee,MenuProps:{elevation:3}},input:{sx:{...xs,"& #tables-ias":{color:"text.secondary",m:0}},startAdornment:e.jsx(se,{position:"start",id:"tables-ias",children:e.jsx(Ut,{sx:{color:"text.secondary"}})})}},children:[e.jsx(C,{value:"db",dense:!0,children:"資料庫"}),e.jsx(C,{value:"table",dense:!0,children:"資料表"}),e.jsx(C,{value:"column",dense:!0,children:"欄位"})]})},bs=t=>`在 "${{db:"資料庫",table:"所有資料表",column:"所有表格欄位"}[t]}" 中尋找...`,fs=()=>{const{searchTopic:t}=re(),{searchQuery:s,handleQueryChange:n}=De();return e.jsx(z,{value:s,onChange:r=>n(r.target.value),variant:"standard",placeholder:bs(t),sx:{flex:1},slotProps:{input:{sx:{"&::before":{borderBottom:0},"&:hover:not(.Mui-disabled, .Mui-error):before":{borderBottom:0}},startAdornment:e.jsx(se,{position:"start",sx:{mr:1.5},children:e.jsx(Te,{})})}}})},gs=g(e.jsx("path",{d:"M4 20h16c1.1 0 2-.9 2-2s-.9-2-2-2H4c-1.1 0-2 .9-2 2s.9 2 2 2m0-3h2v2H4zM2 6c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2s-.9-2-2-2H4c-1.1 0-2 .9-2 2m4 1H4V5h2zm-2 7h16c1.1 0 2-.9 2-2s-.9-2-2-2H4c-1.1 0-2 .9-2 2s.9 2 2 2m0-3h2v2H4z"})),ys=g(e.jsx("path",{d:"M3 5v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2m8 14H6c-.55 0-1-.45-1-1v-5h5c.55 0 1 .45 1 1zm-1-8H5V6c0-.55.45-1 1-1h5v5c0 .55-.45 1-1 1m8 8h-5v-5c0-.55.45-1 1-1h5v5c0 .55-.45 1-1 1m1-8h-5c-.55 0-1-.45-1-1V5h5c.55 0 1 .45 1 1z"})),Oe=g(e.jsx("path",{d:"M20.29 10.29 16.7 6.7c-.62-.62-1.7-.18-1.7.71V10H8c-2.76 0-5 2.24-5 5v3c0 .55.45 1 1 1s1-.45 1-1v-3c0-1.65 1.35-3 3-3h7v2.59c0 .89 1.08 1.34 1.71.71l3.59-3.59c.38-.39.38-1.03-.01-1.42"})),be="all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",fe="color-mix(in srgb, var(--mui-palette-primary-main) 70%, var(--mui-palette-text-primary) 30%)",Y="medium",J={fontSize:48,mr:1,bgcolor:"action.hover",borderRadius:1.5,color:"action.active",p:1},js={db:e.jsx(gs,{fontSize:Y,sx:J}),table:e.jsx(ys,{fontSize:Y,sx:J}),column:e.jsx(mt,{fontSize:Y,sx:J})},vs=x.memo(({id:t,variant:s,primary:n,secondary:r,type:c})=>{const{update:i}=S();let o=null;return s==="db"?o=()=>i(p.datahub_home,a=>({db:t,searchTopic:a.searchTopic??null,searchQuery:a.searchQuery??null})):s==="table"?o=()=>i(p.datahub_tables,a=>({db:a.db??null,table:t,searchTopic:a.searchTopic??null,searchQuery:a.searchQuery??null})):s==="column"?o=()=>i(p.datahub_tables,a=>({db:a.db??null,table:t.split(".")[0],searchTopic:a.searchTopic??null,searchQuery:a.searchQuery??null})):o=()=>{},e.jsxs(k,{onClick:o,color:"inherit",sx:{display:"grid",gap:2.5,alignItems:"center",gridTemplateColumns:"auto 1fr auto auto",borderRadius:2,textTransform:"none",lineHeight:void 0,"&:hover .hover-icon":{opacity:1},"&:hover":{bgcolor:"action.hover"},transition:be,p:1},children:[e.jsx(d,{sx:{display:"grid",placeItems:"center"},children:js[s]}),e.jsxs(v,{sx:{gap:.5,textAlign:"left"},children:[e.jsx(h,{variant:"subtitle1",sx:he,children:n.map(({text:a,highlight:u},l)=>e.jsx(h,{variant:"subtitle1",component:"span",sx:{color:u?fe:void 0},children:a},l))}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary",...he},children:r.map(({text:a,highlight:u},l)=>e.jsx(h,{variant:"body2",component:"span",sx:{color:u?fe:void 0},children:a},l))})]}),e.jsx(d,{className:"hover-icon",sx:{display:"grid",placeItems:"center",opacity:0,transition:be},children:e.jsx(Oe,{sx:{color:"text.secondary",scale:"-1"}})}),e.jsx(St,{variant:"filled",label:c,sx:{textTransform:"uppercase"}})]})}),Cs=()=>e.jsx(d,{sx:{display:"grid",placeItems:"center",flex:1,p:2},children:e.jsx(Ie,{size:24})}),Ss=(t,s)=>{const n={db:{label:"資料庫",example:"論壇"},table:{label:"資料表",example:"users, posts"},column:{label:"資料欄位",example:"email, createdAt"}};return s?`找不到符合的${n[t].label}：${s}
    請確認拼字是否正確，或嘗試其他關鍵字。`:`輸入關鍵字以搜尋${n[t].label}，例如「${n[t].example}」`},oe=t=>{const s=t==="db"?ds:t==="table"?us:hs;return({q:n})=>{const{results:r,isFetching:c}=s(n);return c?e.jsx(Cs,{}):!r||r.length===0?e.jsx(d,{sx:{display:"grid",placeItems:"center",flex:1,p:2},children:e.jsx(h,{variant:"body2",color:"text.secondary",textAlign:"center",children:Ss(t,n)})}):e.jsx(e.Fragment,{children:r.map(({item:i,highlights:o})=>e.jsx(vs,{id:i.id,variant:t,primary:o.primary,secondary:o.secondary,type:i.type},i.id))})}},ws=oe("db"),Is=oe("table"),ks=oe("column"),Rs=()=>{const{searchTopic:t}=re(),{searchQuery:s}=De();return e.jsxs(v,{sx:{p:1.5,flex:1},children:[t==="db"&&e.jsx(ws,{q:s}),t==="table"&&e.jsx(Is,{q:s}),t==="column"&&e.jsx(ks,{q:s})]})},ae=g(e.jsx("path",{d:"M14 10.5v.5h-3v-.5c0-.83-.67-1.5-1.5-1.5h-1V7h1c.83 0 1.5-.67 1.5-1.5v-3c0-.83-.67-1.5-1.5-1.5h-4C4.67 1 4 1.67 4 2.5v3C4 6.33 4.67 7 5.5 7h1v2h-1C4.67 9 4 9.67 4 10.5v3c0 .83.67 1.5 1.5 1.5h1v2h-1c-.83 0-1.5.67-1.5 1.5v3c0 .83.67 1.5 1.5 1.5h4c.83 0 1.5-.67 1.5-1.5v-3c0-.83-.67-1.5-1.5-1.5h-1v-2h1c.83 0 1.5-.67 1.5-1.5V13h3v.5c0 .83.67 1.5 1.5 1.5h4c.83 0 1.5-.67 1.5-1.5v-3c0-.83-.67-1.5-1.5-1.5h-4c-.83 0-1.5.67-1.5 1.5"})),ce=g(e.jsx("path",{d:"M20 4H4c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2m0 14H4V8h16zm-8-2c0-.55.45-1 1-1h4c.55 0 1 .45 1 1s-.45 1-1 1h-4c-.55 0-1-.45-1-1M6.79 9.71c.39-.39 1.02-.39 1.41 0l2.59 2.59c.39.39.39 1.02 0 1.41L8.2 16.3c-.39.39-1.02.39-1.41 0a.996.996 0 0 1 0-1.41L8.67 13l-1.88-1.88a.996.996 0 0 1 0-1.41"})),ge="all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",ye=({icon:t,title:s,description:n,onClick:r})=>e.jsxs(Q,{onClick:r,sx:{display:"grid",gridTemplateColumns:"auto 1fr auto",placeItems:"stretch",gap:1,borderRadius:2,bgcolor:"action.hover","&:hover .hover-icon":{opacity:1},"&:hover":{bgcolor:"action.selected"},transition:ge,p:1,py:1.5},children:[e.jsx(v,{sx:{justifyContent:"flex-start",color:"color-mix(in srgb, var(--mui-palette-primary-main) 50%, var(--mui-palette-text-secondary) 50%)"},children:t}),e.jsxs(v,{sx:{gap:.5,textAlign:"left"},children:[e.jsx(h,{variant:"subtitle1",children:s}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:n})]}),e.jsx(v,{className:"hover-icon",sx:{justifyContent:"flex-end",opacity:.5,transition:ge},children:e.jsx(Oe,{sx:{color:"text.secondary",scale:"-1"}})})]}),Es=()=>{const{update:t,updateSearchParams:s}=S();return e.jsx(d,{sx:{p:1.5,pt:0},children:e.jsxs(v,{sx:{gap:1},children:[e.jsx(Fe,{}),e.jsx(h,{variant:"subtitle2",sx:{color:"text.secondary"},children:"延伸功能"}),e.jsxs(d,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:1.5},children:[e.jsx(ye,{icon:e.jsx(ae,{color:"inherit"}),title:"資料庫結構",description:"了解資料庫結構與關聯",onClick:()=>t(p.datahub_schema,n=>({db:n.db??null}))}),e.jsx(ye,{icon:e.jsx(ce,{color:"inherit"}),title:"SQL 查詢",description:"自行撰寫 SQL 查詢，或使用範本",onClick:()=>{console.log("還沒做完"),s({search:"false"},{skipTransition:!0})}})]})]})})},Ms=t=>{const{searchParams:s,updateSearchParams:n}=S(),r=s.get("search")==="true",c=()=>n({search:"false"},{skipTransition:!0});return e.jsxs(gt,{...t,open:r,onClose:c,maxWidth:"sm",fullWidth:!0,slotProps:{paper:{elevation:0,sx:{borderRadius:2}}},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1.5,p:1.5,position:"relative"},children:[e.jsx(ms,{}),e.jsx(fs,{}),e.jsx(k,{onClick:c,color:"inherit",sx:{bgcolor:"FilledInput.bg","&:hover":{bgcolor:"FilledInput.disabledBg"},borderRadius:1.5,p:.5,px:1.5,minWidth:0},children:e.jsx(h,{variant:"caption",sx:{textTransform:"lowercase"},children:"esc"})})]}),e.jsx(Fe,{}),e.jsxs(v,{sx:{height:"60dvh",overflowY:"auto",overflowX:"hidden"},children:[e.jsx(Rs,{}),e.jsx(Es,{})]})]})},Ts=()=>{const{updateSearchParams:t}=S(),s=()=>t({search:"true"},{skipTransition:!0});return e.jsxs(e.Fragment,{children:[e.jsxs(d,{sx:{position:"relative"},children:[e.jsx(z,{variant:"outlined",label:"搜尋",size:"small",disabled:!0,sx:{width:"20vw",maxWidth:"22rem",bgcolor:"background.paper",backgroundImage:"linear-gradient(#fff1, #fff1)",borderRadius:1},slotProps:{input:{sx:{"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"secondary.main"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"divider"},"&.Mui-disabled .MuiOutlinedInput-notchedOutline":{borderColor:"divider"}},endAdornment:e.jsx(se,{position:"end",children:e.jsx(N,{edge:"end",disabled:!0,children:e.jsx(Te,{})})})}}}),e.jsx(d,{sx:{position:"absolute",inset:0,cursor:"pointer"},onClick:s})]}),e.jsx(Ms,{})]})},Fs=()=>{const[t,s]=x.useState(null),n=c=>s(c.currentTarget),r=()=>s(null);return e.jsxs(e.Fragment,{children:[e.jsx(K,{title:"切換主題",arrow:!0,children:e.jsx(N,{onClick:n,children:e.jsx(It,{})})}),e.jsx(Ps,{open:!!t,anchorEl:t,onClose:r,anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"}})]})},Ps=({onClose:t,...s})=>{const{mode:n,setMode:r}=nt(),c=i=>()=>{r(i),t()};return e.jsx(ke,{anchorOrigin:{horizontal:"right",vertical:"top"},onClose:t,...s,children:e.jsxs(rt,{dense:!0,children:[e.jsx(C,{onClick:c("light"),selected:n==="light",children:"淺色"}),e.jsx(C,{onClick:c("dark"),selected:n==="dark",children:"暗色"}),e.jsx(C,{onClick:c("system"),selected:n==="system",children:"跟隨系統"})]})})},_s=()=>{const t=A(s=>s.breakpoints.up("md"));return e.jsxs(Q,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1,textAlign:"left",borderRadius:1,p:.5,px:1.5,"&:hover":{bgcolor:"action.hover"}},children:[e.jsx(d,{sx:{width:"2.8rem",aspectRatio:1,borderRadius:1,bgcolor:"primary.main",display:"grid",placeItems:"center"},children:e.jsx(h,{variant:"h6",component:"span",sx:{color:"primary.contrastText"},children:"1"})}),e.jsxs(d,{sx:{pr:{xs:0,md:1}},children:[e.jsx(h,{variant:"subtitle1",component:"h6",children:"1ureka"}),t&&e.jsx(h,{variant:"body2",component:"p",color:"text.secondary",children:"資料庫管理員"})]}),e.jsx(d,{sx:{color:"text.secondary"},children:e.jsx(Ee,{color:"inherit"})})]})},F={display:"flex",flexDirection:"row",alignItems:"center"},Bs=()=>{const t=A(s=>s.breakpoints.up("md"));return e.jsxs(d,{component:"header",sx:{position:"relative",gap:3,justifyContent:"space-between",px:3.5,bgcolor:"background.paper",height:Ae,...F},children:[e.jsx(d,{sx:{position:"absolute",inset:0,bgcolor:"primary.main",opacity:.1,pointerEvents:"none"}}),e.jsxs(d,{sx:{gap:6,...F},children:[e.jsxs(d,{sx:{gap:1,...F},children:[e.jsx(ee,{sx:{fontSize:"3em",color:"primary.main"}}),t&&e.jsx(h,{variant:"h4",component:"h1",sx:{fontFamily:'"timemachine-wa"',color:"secondary.dark"},children:"資料樣板"})]}),e.jsxs(d,{sx:{gap:.5,...F},children:[e.jsx(ps,{}),e.jsx(Ts,{})]})]}),e.jsxs(d,{sx:{gap:2,...F},children:[e.jsx(Fs,{}),e.jsx(K,{title:"通知",arrow:!0,children:e.jsx(N,{children:e.jsx(wt,{variant:"dot",badgeContent:1,color:"error",children:e.jsx(yt,{})})})}),e.jsx(_s,{})]})]})},$e=g(e.jsx("path",{d:"M4 13h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1m0 8h6c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1m10 0h6c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1M13 4v4c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1"})),qe=g(e.jsx("path",{d:"M4 14h2c.55 0 1-.45 1-1v-2c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v2c0 .55.45 1 1 1m0 5h2c.55 0 1-.45 1-1v-2c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v2c0 .55.45 1 1 1M4 9h2c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v2c0 .55.45 1 1 1m5 5h11c.55 0 1-.45 1-1v-2c0-.55-.45-1-1-1H9c-.55 0-1 .45-1 1v2c0 .55.45 1 1 1m0 5h11c.55 0 1-.45 1-1v-2c0-.55-.45-1-1-1H9c-.55 0-1 .45-1 1v2c0 .55.45 1 1 1M8 6v2c0 .55.45 1 1 1h11c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1H9c-.55 0-1 .45-1 1"})),As=g(e.jsx("path",{d:"M5 10h10c.55 0 1 .45 1 1s-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1m0-4h10c.55 0 1 .45 1 1s-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1m0 8h6c.55 0 1 .45 1 1s-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1m9 .88v4.23c0 .39.42.63.76.43l3.53-2.12c.32-.19.32-.66 0-.86l-3.53-2.12c-.34-.19-.76.05-.76.44"})),Ls=g(e.jsx("path",{d:"M17.7 15.89 13.82 12l3.89-3.89c.39-.39.39-1.02 0-1.41a.996.996 0 0 0-1.41 0l-4.59 4.59c-.39.39-.39 1.02 0 1.41l4.59 4.59c.39.39 1.02.39 1.41 0 .38-.38.38-1.02-.01-1.4M7 6c.55 0 1 .45 1 1v10c0 .55-.45 1-1 1s-1-.45-1-1V7c0-.55.45-1 1-1"})),P=({title:t,active:s,onClick:n,children:r})=>e.jsx(K,{title:t,arrow:!0,placement:"right",children:e.jsx(N,{color:"inherit",centerRipple:!1,onClick:n,sx:{borderRadius:1,aspectRatio:1,bgcolor:s?"#fffc":void 0,boxShadow:s?1:void 0,color:s?"primary.dark":void 0,"&:hover":{bgcolor:s?"#fffe":void 0},transition:"all 0.2s ease-in-out"},children:r})}),_=({title:t,description:s,icon:n,active:r,onClick:c})=>e.jsx(Q,{onClick:c,sx:{borderRadius:1,bgcolor:r?"#fffc":void 0,boxShadow:r?1:void 0,"&:hover":{bgcolor:r?"#fffe":"#fff1"},transition:"all 0.2s ease-in-out"},children:e.jsxs(d,{sx:{display:"flex",gap:2,alignItems:"center",p:2,width:1},children:[e.jsx(d,{children:n}),e.jsxs(d,{sx:{flex:1,textAlign:"left"},children:[e.jsx(h,{variant:"h6",component:"h6",sx:{color:r?"primary.dark":"#fffc"},children:t}),s&&e.jsx(h,{variant:"body2",component:"p",sx:{color:r?"primary.dark":"#fffc",opacity:.8},children:s})]})]})}),zs=({open:t,onClose:s})=>{const{searchParams:n,updateSearchParams:r,update:c,pathname:i}=S(),o=u=>()=>{r({db:u})},a=u=>()=>{c(u,l=>({db:l.db??"forum"})),s()};return e.jsxs(jt,{anchor:"left",open:t,onClose:s,sx:{"& .MuiDrawer-paper":{width:450,maxWidth:"100vw",bgcolor:"primary.dark",p:3,display:"flex",flexDirection:"column",gap:2}},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2,mb:2},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ee,{sx:{fontSize:"3em",color:"#fffc"}}),e.jsx(h,{variant:"h4",component:"h1",sx:{fontFamily:'"timemachine-wa"',color:"#fffc"},children:"資料樣板"})]}),e.jsx(z,{className:"mode-dark",select:!0,label:"資料庫",variant:"outlined",slotProps:{select:{IconComponent:Ct}},value:n.get("db")||"forum",children:e.jsx(C,{value:"forum",dense:!0,children:e.jsx(h,{variant:"body2",sx:{color:"text.primary"},onClick:o("forum"),children:"論壇資料庫"})})})]}),e.jsx(_,{title:"概覽",description:"快速掌握資料庫狀態與視覺化圖表",icon:e.jsx($e,{sx:{color:i.get()===p.datahub_home?"primary.dark":"#fffc",fontSize:"3.5rem"}}),active:i.get()===p.datahub_home,onClick:a(p.datahub_home)}),e.jsx(_,{title:"資料庫結構",description:"圖像化呈現資料表間的關聯",icon:e.jsx(ae,{sx:{color:i.get()===p.datahub_schema?"primary.dark":"#fffc",fontSize:"3.5rem"}}),active:i.get()===p.datahub_schema,onClick:a(p.datahub_schema)}),e.jsx(_,{title:"表格檢視",description:"檢視、編輯與標準化資料表內容",icon:e.jsx(qe,{sx:{color:i.get()===p.datahub_tables?"primary.dark":"#fffc",fontSize:"3.5rem"}}),active:i.get()===p.datahub_tables,onClick:a(p.datahub_tables)}),e.jsx(_,{title:"撰寫查詢",description:"手動撰寫 SQL 以進行自定義查詢",icon:e.jsx(ce,{sx:{color:"#fffc",fontSize:"3.5rem"}}),onClick:s}),e.jsx(d,{sx:{flex:1}}),e.jsx(_,{title:"收起側邊欄",icon:e.jsx(Ls,{sx:{color:"#fffc",fontSize:"2rem"}}),onClick:s})]})},Ds=()=>{const[t,s]=x.useState(!1),n=()=>s(!t),{update:r,pathname:c}=S(),i=o=>()=>{r(o,a=>({db:a.db??"forum"}))};return e.jsxs(v,{sx:{position:"relative",bgcolor:"primary.dark",p:2,py:4,color:"#fffc",height:1,gap:2},children:[e.jsx(P,{title:"概覽",active:c.get()===p.datahub_home,onClick:i(p.datahub_home),children:e.jsx($e,{})}),e.jsx(P,{title:"資料庫結構",active:c.get()===p.datahub_schema,onClick:i(p.datahub_schema),children:e.jsx(ae,{})}),e.jsx(P,{title:"表格檢視",active:c.get()===p.datahub_tables,onClick:i(p.datahub_tables),children:e.jsx(qe,{})}),e.jsx(P,{title:"撰寫查詢",children:e.jsx(ce,{})}),e.jsx(d,{sx:{flex:1}}),e.jsx(P,{title:"展開面板",onClick:n,children:e.jsx(As,{})}),e.jsx(zs,{open:t,onClose:n})]})},Hs=g(e.jsx("path",{d:"M19 13H5c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-4c0-1.1-.9-2-2-2M7 19c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2M19 3H5c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M7 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"})),Os=()=>e.jsx(d,{sx:{position:"absolute",inset:0,pointerEvents:"none",overflow:"hidden",display:"flex",justifyContent:"center"},children:e.jsx(d,{sx:{position:"relative",maskImage:"radial-gradient(circle at 50% 25%, #0003 0%, #000a 100%)",bgcolor:"primary.main",fill:"var(--mui-palette-background-paper)",fillOpacity:.375,width:1,minWidth:1200,height:1},children:e.jsxs("svg",{style:{scale:"1.01 -1"},width:"100%",height:"200",viewBox:"0 0 1920 300",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none",children:[e.jsx("path",{d:"M0,160 C160,180 320,140 480,160 C640,180 800,120 960,150 C1120,180 1280,130 1440,160 C1600,190 1760,150 1920,170 L1920,300 L0,300 Z"}),e.jsx("path",{d:"M0,190 C120,210 240,160 360,190 C480,220 600,140 720,180 C840,220 960,130 1080,180 C1200,230 1320,160 1440,200 C1560,240 1740,180 1920,210 L1920,300 L0,300 Z"}),e.jsx("path",{d:"M0,230 C160,250 320,190 480,230 C640,270 800,180 960,220 C1120,260 1280,170 1440,210 C1600,250 1760,200 1920,230 L1920,300 L0,300 Z"})]})})}),$s=g(e.jsx("path",{d:"M12 5V3.21c0-.45-.54-.67-.85-.35l-2.8 2.79c-.2.2-.2.51 0 .71l2.79 2.79c.32.31.86.09.86-.36V7c3.31 0 6 2.69 6 6 0 2.72-1.83 5.02-4.31 5.75-.42.12-.69.52-.69.95 0 .65.62 1.16 1.25.97C17.57 19.7 20 16.64 20 13c0-4.42-3.58-8-8-8m-6 8c0-1.34.44-2.58 1.19-3.59.3-.4.26-.95-.09-1.31-.42-.42-1.14-.38-1.5.1-1 1.34-1.6 3-1.6 4.8 0 3.64 2.43 6.7 5.75 7.67.63.19 1.25-.32 1.25-.97 0-.43-.27-.83-.69-.95C7.83 18.02 6 15.72 6 13"})),qs=g(e.jsx("path",{d:"M10 16h4c.55 0 1-.45 1-1v-5h1.59c.89 0 1.34-1.08.71-1.71L12.71 3.7a.996.996 0 0 0-1.41 0L6.71 8.29c-.63.63-.19 1.71.7 1.71H9v5c0 .55.45 1 1 1m-4 2h12c.55 0 1 .45 1 1s-.45 1-1 1H6c-.55 0-1-.45-1-1s.45-1 1-1"})),Vs=()=>I().reset(),Qs=()=>{const t=Re();return Me({mutationFn:Vs,onSuccess:()=>{t.resetQueries({queryKey:[]})},onError:s=>{console.error("重置資料庫失敗:",s),t.resetQueries({queryKey:[]})}})},je={outlined:{variant:"outlined",color:"inherit"},main:{variant:"contained",color:"inherit"},danger:{variant:"contained",color:"error"}},X=({variant:t,sx:s,children:n,...r})=>e.jsx(k,{variant:je[t].variant,color:je[t].color,sx:{scale:"1.001","&:hover":{scale:"1.05"},"&:active":{scale:"0.95"},transition:"all 0.2s ease",...s},...r,children:n}),Ns=()=>{const{status:t,mutate:s}=Qs(),{status:n,mutate:r}=rs(),[c,i]=x.useState(null),o=l=>{t!=="pending"&&i(l.currentTarget)},a=()=>{s(),i(null)},u=()=>{i(null)};return e.jsxs(d,{sx:{display:"flex",gap:1.5,color:"text.primary"},children:[e.jsx(X,{startIcon:e.jsx(kt,{}),variant:"outlined",children:"匯入"}),e.jsx(X,{startIcon:e.jsx(qs,{}),variant:"main",disableElevation:!0,sx:{bgcolor:"background.paper"},loading:n==="pending",onClick:()=>{n!=="pending"&&r("sqlite3.db")},children:"匯出"}),e.jsx(K,{title:e.jsx(h,{variant:"body2",children:"從伺服器複製一份副本取代目前資料"}),placement:"bottom",arrow:!0,children:e.jsx("span",{children:e.jsx(X,{startIcon:e.jsx($s,{}),variant:"danger",disableElevation:!0,sx:{cursor:"help",pr:2.5},loading:t==="pending",onClick:o,children:"重置"})})}),e.jsx(ke,{open:!!c,anchorEl:c,onClose:u,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},elevation:3,children:e.jsxs(d,{sx:{p:2,maxWidth:300},children:[e.jsx(h,{variant:"subtitle1",sx:{mb:1},children:"確認重置資料庫"}),e.jsx(h,{variant:"body2",sx:{mb:2,color:"text.secondary"},children:"此操作將從伺服器複製一份新的資料庫，並覆蓋所有本地修改。為避免資料庫不一致，請先關閉所有本網站的分頁再繼續。確定要繼續嗎？"}),e.jsxs(d,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(k,{variant:"outlined",size:"small",onClick:u,color:"inherit",children:"取消"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:a,disabled:t==="pending",disableElevation:!0,children:"確認重置"})]})]})})]})},B={color:"text.secondary"},O={...B,borderRadius:1,bgcolor:"divider",p:.7},Ks=()=>e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(h,{variant:"body2",sx:O,children:"⇧ Shift"}),e.jsx(h,{variant:"body2",sx:B,children:" + "}),e.jsx(h,{variant:"body2",sx:O,children:"LMB"}),e.jsx(h,{variant:"body2",sx:B,children:"可選取方框範圍內的所有項目，"}),e.jsx(h,{variant:"body2",sx:O,children:"⌘ / Ctrl"}),e.jsx(h,{variant:"body2",sx:B,children:" + "}),e.jsx(h,{variant:"body2",sx:O,children:"LMB"}),e.jsx(h,{variant:"body2",sx:B,children:"可多選個別項目。"})]}),ve={[p.datahub_home]:"概覽",[p.datahub_schema]:"結構圖",[p.datahub_tables]:"表格檢視"},Ws={[p.datahub_home]:e.jsx(Ns,{}),[p.datahub_schema]:e.jsx(Ks,{}),[p.datahub_tables]:null},Us=()=>{const[t,s]=x.useState(null),n=b=>s(m=>m?null:b.currentTarget),r=()=>s(null),{updateSearchParams:c,searchParams:i,pathname:o}=S(),a=b=>()=>{c({db:b}),s(null)};if(!(o.get()in ve))throw new Error(`頁面不存在: ${o.get()}`);const u=ve[o.get()],l=Ws[o.get()];return e.jsxs(d,{sx:{position:"relative",p:5,overflow:"hidden",borderRadius:4,borderTopLeftRadius:0,borderTopRightRadius:0},children:[e.jsx(Os,{}),e.jsxs(d,{sx:{position:"relative",display:"flex",justifyContent:"space-between",alignItems:"flex-end"},children:[e.jsxs(d,{children:[e.jsxs(d,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(Hs,{fontSize:"small",sx:{color:"text.secondary"}}),e.jsxs(Dt,{children:[e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:"資料庫"}),e.jsx(h,{variant:"body2",sx:{"&:hover":{textDecoration:"underline"},cursor:"pointer",color:"text.primary"},onClick:n,children:"論壇資料庫"})]}),e.jsx(ot,{open:!!t,anchorEl:t,onClose:r,children:e.jsx(C,{onClick:r,selected:(i.get("db")||"forum")==="forum",children:e.jsx(h,{variant:"body2",sx:{color:"text.primary"},onClick:a("forum"),children:"論壇資料庫"})})})]}),e.jsx(h,{variant:"h4",component:"h2",sx:{pt:1.5},children:u})]}),l]})]})},Zs="modulepreload",Gs=function(t){return"/"+t},Ce={},D=function(s,n,r){let c=Promise.resolve();if(n&&n.length>0){let o=function(l){return Promise.all(l.map(b=>Promise.resolve(b).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),u=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));c=o(n.map(l=>{if(l=Gs(l),l in Ce)return;Ce[l]=!0;const b=l.endsWith(".css"),m=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${m}`))return;const f=document.createElement("link");if(f.rel=b?"stylesheet":Zs,b||(f.as="script"),f.crossOrigin="",f.href=l,u&&f.setAttribute("nonce",u),document.head.appendChild(f),b)return new Promise((j,y)=>{f.addEventListener("load",j),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return c.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return s().catch(i)})},Rn={xs:4,md:6,xl:8},Ys={xs:3,md:4,xl:5},Js={xs:1,md:2,xl:3},En={xs:0,md:0,xl:0},Mn={color:"background.paper",bgcolor:"primary.main",borderRadius:1,p:1,fontSize:"3rem"},Tn="all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",Xs=x.lazy(()=>D(()=>import("./LargeTiles-CprOfB4Y.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27])).then(t=>({default:t.LargeTiles}))),en=x.lazy(()=>D(()=>import("./SmallTiles-Z1gzIOGx.js"),__vite__mapDeps([28,1,2,29,4,5,16,7,26,8,19,20,21,3,22,23,24,25,9,10,27])).then(t=>({default:t.SmallTiles}))),tn=x.lazy(()=>D(()=>import("./Sidebar-BdUJCCZu.js"),__vite__mapDeps([30,1,2,31,32,33,34,18,35,21,13,5,19,20,7,3,22,23,24,25,9,26,10,27]))),sn=x.lazy(()=>D(()=>import("./FlowChart-BmBVhISs.js"),__vite__mapDeps([36,1,2,37,35,12,13,14,15,5,26,19,20,7,21,3,22,23,24,25,9,10,27]))),nn=x.lazy(()=>D(()=>import("./TablesLayout-wNAzKwTi.js"),__vite__mapDeps([38,1,2,3,39,7,20,19,40,41,5,34,18,9,26,42,43,8,44,45,21,22,23,24,25,10,27]))),V={borderRadius:4,boxShadow:"none",flex:1},Se={[p.datahub_home]:()=>e.jsxs($,{sx:{...V,p:Ys},children:[e.jsx("title",{children:"資料樣板"}),e.jsx(en,{}),e.jsx(Xs,{})]}),[p.datahub_schema]:()=>e.jsxs($,{sx:{...V,position:"relative",overflow:"hidden",display:"flex",alignItems:"stretch"},children:[e.jsx("title",{children:"資料樣板 | 結構圖"}),e.jsx(tn,{}),e.jsx(sn,{})]}),[p.datahub_tables]:()=>e.jsxs($,{sx:{...V,p:Js},children:[e.jsx("title",{children:"資料樣板 | 表格檢視"}),e.jsx(nn,{})]})},rn=()=>e.jsx($,{sx:{...V,position:"relative",display:"grid",placeItems:"stretch"},children:e.jsx(d,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center"},children:e.jsx(Ie,{})})}),on=()=>{const{pathname:t}=S();if(!(t.get()in Se))throw new Error(`頁面不存在: ${t.get()}`);const s=Se[t.get()];return e.jsx(x.Suspense,{fallback:e.jsx(rn,{}),children:s()})},an=()=>(Nt(),null);function cn(){return Pe(),e.jsxs(Wt,{children:[e.jsx(an,{}),e.jsx(Bs,{}),e.jsxs(d,{component:"main",sx:{position:"relative",display:"flex",height:`calc(100dvh - ${Ae}px)`},children:[e.jsx(d,{sx:{position:"absolute",inset:0,bgcolor:"primary.main",opacity:.2,pointerEvents:"none"}}),e.jsx(Ds,{}),e.jsx(d,{sx:{position:"relative",flex:1,height:1,overflow:"auto"},id:"scroll-area",children:e.jsxs(v,{sx:{minHeight:1,gap:3,px:2,pb:3},children:[e.jsx(Us,{}),e.jsx(on,{})]})})]})]})}at.createRoot(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(cn,{})}));export{$s as R,ne as a,In as b,Tn as c,wn as d,W as e,kn as f,I as g,Rn as l,Ys as m,En as n,Js as s,Mn as t,os as u};
