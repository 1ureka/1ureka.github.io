import{r as p,u as k,as as _,a9 as $e,a3 as Me,j as o,s as R,c as S,d as I,y as ue,ap as Pe,m as H,J as $,V as z,l as j,aT as q,g as P,a as B,b as w,aL as Be,aM as He,n as Le,v as me,o as T,F as ze,I as xe,P as Ne,ab as Fe,t as Oe,S as Ae,B as V}from"./routes-BRMzLzhC.js";import{a as ye}from"./ArrowDropDownRounded-BSlKz95K.js";import{A as Ue}from"./AddRounded-D2B9ruhM.js";import{e as De,a as Ee}from"./main-U4_zgZ7Z.js";import{u as K}from"./url-C1_3EFte.js";import{t as Ve}from"./SQLiteClient-C_VbyDMl.js";import{t as We}from"./array-l11GhOAf.js";import{z as Q}from"./index-mSkvzYyn.js";import{a as Ge,l as U,M as Z}from"./MenuItem-DskW67TL.js";import{D as X,I as Je}from"./ExpandMoreRounded-BbOiXDeA.js";import{g as _e,l as L,F as be,L as W}from"./FilterAltRounded-DXMp0Z-i.js";import{T as Y}from"./DarkModeRounded-BJHMDOZl.js";import{C as D}from"./Checkbox-BjwpSCoL.js";import{S as Ke}from"./SortRounded-DkenSCWu.js";import{S as ee}from"./Skeleton-DmNN_5c3.js";import"./RefreshRounded-Drv__rWw.js";import"./DataExplorationRounded-BFD3P8t1.js";import"./NotificationsRounded-BdP4iNma.js";import"./fuse-BJGioBBs.js";import"./useMutation-C7FRCs_y.js";import"./dayjs.min-DPYsBUGm.js";import"./Badge-tZBuEgUU.js";import"./DownloadRounded-DRyNRHxh.js";import"./SwitchBase-DF4bq7IZ.js";const Xe=(e,t)=>{const{ownerState:s}=e;return[t.root,s.dense&&t.dense,s.alignItems==="flex-start"&&t.alignItemsFlexStart,s.divider&&t.divider,!s.disableGutters&&t.gutters]},Ye=e=>{const{alignItems:t,classes:s,dense:r,disabled:i,disableGutters:n,divider:a,selected:c}=e,l=I({root:["root",r&&"dense",!n&&"gutters",a&&"divider",i&&"disabled",t==="flex-start"&&"alignItemsFlexStart",c&&"selected"]},_e,s);return{...s,...l}},qe=R(ue,{shouldForwardProp:e=>Pe(e)||e==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:Xe})(H(({theme:e})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${L.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:$(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${L.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:$(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${L.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:$(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:$(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${L.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${L.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},variants:[{props:({ownerState:t})=>t.divider,style:{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:t})=>!t.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:t})=>t.dense,style:{paddingTop:4,paddingBottom:4}}]}))),te=p.forwardRef(function(t,s){const r=k({props:t,name:"MuiListItemButton"}),{alignItems:i="center",autoFocus:n=!1,component:a="div",children:c,dense:d=!1,disableGutters:l=!1,divider:u=!1,focusVisibleClassName:m,selected:v=!1,className:x,...b}=r,f=p.useContext(_),y=p.useMemo(()=>({dense:d||f.dense||!1,alignItems:i,disableGutters:l}),[i,f.dense,d,l]),g=p.useRef(null);$e(()=>{n&&g.current&&g.current.focus()},[n]);const h={...r,alignItems:i,dense:y.dense,disableGutters:l,divider:u,selected:v},C=Ye(h),M=Me(g,s);return o.jsx(_.Provider,{value:y,children:o.jsx(qe,{ref:M,href:b.href||b.to,component:(b.href||b.to)&&a==="div"?"button":a,focusVisibleClassName:S(C.focusVisible,m),ownerState:h,className:S(C.root,x),...b,classes:C,children:c})})}),Qe=e=>{const{classes:t,inset:s,primary:r,secondary:i,dense:n}=e;return I({root:["root",s&&"inset",n&&"dense",r&&i&&"multiline"],primary:["primary"],secondary:["secondary"]},Ge,t)},Ze=R("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[{[`& .${U.primary}`]:t.primary},{[`& .${U.secondary}`]:t.secondary},t.root,s.inset&&t.inset,s.primary&&s.secondary&&t.multiline,s.dense&&t.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${q.root}:where(& .${U.primary})`]:{display:"block"},[`.${q.root}:where(& .${U.secondary})`]:{display:"block"},variants:[{props:({ownerState:e})=>e.primary&&e.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:e})=>e.inset,style:{paddingLeft:56}}]}),oe=p.forwardRef(function(t,s){const r=k({props:t,name:"MuiListItemText"}),{children:i,className:n,disableTypography:a=!1,inset:c=!1,primary:d,primaryTypographyProps:l,secondary:u,secondaryTypographyProps:m,slots:v={},slotProps:x={},...b}=r,{dense:f}=p.useContext(_);let y=d??i,g=u;const h={...r,disableTypography:a,inset:c,primary:!!y,secondary:!!g,dense:f},C=Qe(h),M={slots:v,slotProps:{primary:l,secondary:m,...x}},[O,Re]=z("root",{className:S(C.root,n),elementType:Ze,externalForwardedProps:{...M,...b},ownerState:h,ref:s}),[we,A]=z("primary",{className:C.primary,elementType:j,externalForwardedProps:M,ownerState:h}),[ke,Ie]=z("secondary",{className:C.secondary,elementType:j,externalForwardedProps:M,ownerState:h});return y!=null&&y.type!==j&&!a&&(y=o.jsx(we,{variant:f?"body2":"body1",component:A!=null&&A.variant?void 0:"span",...A,children:y})),g!=null&&g.type!==j&&!a&&(g=o.jsx(ke,{variant:"body2",color:"textSecondary",...Ie,children:g})),o.jsxs(O,{...Re,children:[y,g]})}),ge=p.createContext();function et(e){return P("MuiTable",e)}B("MuiTable",["root","stickyHeader"]);const tt=e=>{const{classes:t,stickyHeader:s}=e;return I({root:["root",s&&"stickyHeader"]},et,t)},ot=R("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.stickyHeader&&t.stickyHeader]}})(H(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:t})=>t.stickyHeader,style:{borderCollapse:"separate"}}]}))),se="table",st=p.forwardRef(function(t,s){const r=k({props:t,name:"MuiTable"}),{className:i,component:n=se,padding:a="normal",size:c="medium",stickyHeader:d=!1,...l}=r,u={...r,component:n,padding:a,size:c,stickyHeader:d},m=tt(u),v=p.useMemo(()=>({padding:a,size:c,stickyHeader:d}),[a,c,d]);return o.jsx(ge.Provider,{value:v,children:o.jsx(ot,{as:n,role:n===se?null:"table",ref:s,className:S(m.root,i),ownerState:u,...l})})}),E=p.createContext();function rt(e){return P("MuiTableBody",e)}B("MuiTableBody",["root"]);const at=e=>{const{classes:t}=e;return I({root:["root"]},rt,t)},nt=R("tbody",{name:"MuiTableBody",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-row-group"}),it={variant:"body"},re="tbody",lt=p.forwardRef(function(t,s){const r=k({props:t,name:"MuiTableBody"}),{className:i,component:n=re,...a}=r,c={...r,component:n},d=at(c);return o.jsx(E.Provider,{value:it,children:o.jsx(nt,{className:S(d.root,i),as:n,ref:s,role:n===re?null:"rowgroup",ownerState:c,...a})})});function ct(e){return P("MuiTableCell",e)}const dt=B("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),pt=e=>{const{classes:t,variant:s,align:r,padding:i,size:n,stickyHeader:a}=e,c={root:["root",s,a&&"stickyHeader",r!=="inherit"&&`align${w(r)}`,i!=="normal"&&`padding${w(i)}`,`size${w(n)}`]};return I(c,ct,t)},ut=R("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,t[s.variant],t[`size${w(s.size)}`],s.padding!=="normal"&&t[`padding${w(s.padding)}`],s.align!=="inherit"&&t[`align${w(s.align)}`],s.stickyHeader&&t.stickyHeader]}})(H(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?Be($(e.palette.divider,1),.88):He($(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${dt.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:t})=>t.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),N=p.forwardRef(function(t,s){const r=k({props:t,name:"MuiTableCell"}),{align:i="inherit",className:n,component:a,padding:c,scope:d,size:l,sortDirection:u,variant:m,...v}=r,x=p.useContext(ge),b=p.useContext(E),f=b&&b.variant==="head";let y;a?y=a:y=f?"th":"td";let g=d;y==="td"?g=void 0:!g&&f&&(g="col");const h=m||b&&b.variant,C={...r,align:i,component:y,padding:c||(x&&x.padding?x.padding:"normal"),size:l||(x&&x.size?x.size:"medium"),sortDirection:u,stickyHeader:h==="head"&&x&&x.stickyHeader,variant:h},M=pt(C);let O=null;return u&&(O=u==="asc"?"ascending":"descending"),o.jsx(ut,{as:y,ref:s,className:S(M.root,n),"aria-sort":O,scope:g,ownerState:C,...v})});function mt(e){return P("MuiTableContainer",e)}B("MuiTableContainer",["root"]);const xt=e=>{const{classes:t}=e;return I({root:["root"]},mt,t)},yt=R("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(e,t)=>t.root})({width:"100%",overflowX:"auto"}),bt=p.forwardRef(function(t,s){const r=k({props:t,name:"MuiTableContainer"}),{className:i,component:n="div",...a}=r,c={...r,component:n},d=xt(c);return o.jsx(yt,{ref:s,as:n,className:S(d.root,i),ownerState:c,...a})});function gt(e){return P("MuiTableHead",e)}B("MuiTableHead",["root"]);const ft=e=>{const{classes:t}=e;return I({root:["root"]},gt,t)},vt=R("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-header-group"}),ht={variant:"head"},ae="thead",Ct=p.forwardRef(function(t,s){const r=k({props:t,name:"MuiTableHead"}),{className:i,component:n=ae,...a}=r,c={...r,component:n},d=ft(c);return o.jsx(E.Provider,{value:ht,children:o.jsx(vt,{as:n,className:S(d.root,i),ref:s,role:n===ae?null:"rowgroup",ownerState:c,...a})})});function jt(e){return P("MuiTableRow",e)}const ne=B("MuiTableRow",["root","selected","hover","head","footer"]),Tt=e=>{const{classes:t,selected:s,hover:r,head:i,footer:n}=e;return I({root:["root",s&&"selected",r&&"hover",i&&"head",n&&"footer"]},jt,t)},St=R("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.head&&t.head,s.footer&&t.footer]}})(H(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${ne.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${ne.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:$(e.palette.primary.main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:$(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity)}}}))),ie="tr",fe=p.forwardRef(function(t,s){const r=k({props:t,name:"MuiTableRow"}),{className:i,component:n=ie,hover:a=!1,selected:c=!1,...d}=r,l=p.useContext(E),u={...r,component:n,hover:a,selected:c,head:l&&l.variant==="head",footer:l&&l.variant==="footer"},m=Tt(u);return o.jsx(St,{as:n,ref:s,className:S(m.root,i),role:n===ie?null:"row",ownerState:u,...d})}),Rt=Le(o.jsx("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"}));function wt(e){return P("MuiTableSortLabel",e)}const G=B("MuiTableSortLabel",["root","active","icon","iconDirectionDesc","iconDirectionAsc","directionDesc","directionAsc"]),kt=e=>{const{classes:t,direction:s,active:r}=e,i={root:["root",r&&"active",`direction${w(s)}`],icon:["icon",`iconDirection${w(s)}`]};return I(i,wt,t)},It=R(ue,{name:"MuiTableSortLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.active&&t.active]}})(H(({theme:e})=>({cursor:"pointer",display:"inline-flex",justifyContent:"flex-start",flexDirection:"inherit",alignItems:"center","&:focus":{color:(e.vars||e).palette.text.secondary},"&:hover":{color:(e.vars||e).palette.text.secondary,[`& .${G.icon}`]:{opacity:.5}},[`&.${G.active}`]:{color:(e.vars||e).palette.text.primary,[`& .${G.icon}`]:{opacity:1,color:(e.vars||e).palette.text.secondary}}}))),$t=R("span",{name:"MuiTableSortLabel",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.icon,t[`iconDirection${w(s.direction)}`]]}})(H(({theme:e})=>({fontSize:18,marginRight:4,marginLeft:4,opacity:0,transition:e.transitions.create(["opacity","transform"],{duration:e.transitions.duration.shorter}),userSelect:"none",variants:[{props:{direction:"desc"},style:{transform:"rotate(0deg)"}},{props:{direction:"asc"},style:{transform:"rotate(180deg)"}}]}))),Mt=p.forwardRef(function(t,s){const r=k({props:t,name:"MuiTableSortLabel"}),{active:i=!1,children:n,className:a,direction:c="asc",hideSortIcon:d=!1,IconComponent:l=Rt,slots:u={},slotProps:m={},...v}=r,x={...r,active:i,direction:c,hideSortIcon:d,IconComponent:l},b=kt(x),f={slots:u,slotProps:m},[y,g]=z("root",{elementType:It,externalForwardedProps:f,ownerState:x,className:S(b.root,a),ref:s}),[h,C]=z("icon",{elementType:$t,externalForwardedProps:f,ownerState:x,className:b.icon});return o.jsxs(y,{disableRipple:!0,component:"span",...g,...v,children:[n,d&&!i?null:o.jsx(h,{as:l,...C})]})}),F={xs:.5,sm:1},J={xs:1,md:1.5},Pt={xs:1.5,md:2},Bt=Q.array(Q.number().int()),ve=()=>{const{data:e,isFetching:t}=De({types:["table","view"]}),{searchParams:s,updateSearchParams:r}=K(),i=s.get("table")??null,n=p.useCallback(l=>{if(!e)return 0;const u=e.findIndex(({name:m})=>m===l);return u!==-1?u:0},[e]),[a,c]=p.useState(0),d=l=>{e&&r({table:e[n(l.target.value)].name,hiddenColumns:null,orderBy:null,order:null})};return p.useEffect(()=>{e&&c(n(i??e[0].name))},[i,e,n]),{data:e,selected:e&&e.length>0?e[a]:null,handleChange:d,isFetching:t}},he=()=>{const{searchParams:e,updateSearchParams:t}=K(),s=e.get("hiddenColumns")??null,r=p.useMemo(()=>{if(!s)return[];const{data:a,error:c}=Ve(()=>JSON.parse(s));if(c)return[];const d=Bt.safeParse(a);return d.success?Array.from(new Set(d.data)):[]},[s]),i=p.useCallback(a=>()=>{const c=r.length?[]:Array.from({length:a},(d,l)=>l);t({hiddenColumns:JSON.stringify(c)},{skipTransition:!0})},[r,t]),n=p.useCallback(a=>()=>{const c=We(r,a);t({hiddenColumns:JSON.stringify(c)},{skipTransition:!0})},[r,t]);return{hiddenColumns:r,createToggleAllColumns:i,createToggleHandler:n}},Ce=()=>{const{selected:e,isFetching:t}=ve(),{data:s,isFetching:r}=Ee({types:["table","view"]}),i=r||!s||t||!e,{hiddenColumns:n}=he(),a=p.useMemo(()=>{if(!s||!e)return null;const d=s.find(({table:m})=>m===e.name);if(!d)return null;const{columns:l}=d;return l.map(m=>({...m,hidden:n.includes(m.cid)})).toSorted((m,v)=>m.cid-v.cid)},[s,e,n]),c=p.useMemo(()=>a?a.filter(l=>!l.hidden).toSorted((l,u)=>l.pk!==u.pk?u.pk-l.pk:l.type==="text"&&u.type!=="text"?-1:l.type!=="text"&&u.type==="text"?1:l.cid-u.cid):null,[a]);return{isFetching:i,columnsForSelect:a,columnsForTable:c}},Ht=e=>{const{searchParams:t,updateSearchParams:s}=K(),r=p.useMemo(()=>{if(!e)return 0;const a=t.get("orderBy")??null;if(!a)return 0;const c=parseInt(a,10);return!Number.isInteger(c)||c<0||c>=e?0:c},[t,e]),i=p.useMemo(()=>{const a=t.get("order")??null;return a&&["asc","desc"].includes(a)?a:"asc"},[t]),n=p.useCallback(a=>()=>{const c=a,d=r===a&&i==="asc"?"desc":"asc";s({orderBy:c.toString(),order:d},{skipTransition:!0})},[r,i,s]);return{orderBy:r,order:i,createToggleHandler:n}},je={borderRadius:1,overflow:"hidden","&::before":{borderBottom:0},"&:hover:not(.Mui-disabled, .Mui-error):before":{borderBottom:0},"& input":{p:F},"& div[role='combobox']":{p:F}},Te={sx:{width:"18rem"},size:"small",variant:"filled"},Lt=()=>o.jsxs(T,{sx:{position:"relative"},children:[o.jsx(me,{...Te,disabled:!0,slotProps:{input:{sx:je}}}),o.jsx(T,{sx:{position:"absolute",inset:0,display:"grid",placeItems:"center",color:"text.secondary"},children:o.jsx(ze,{color:"inherit",size:16})})]}),zt=()=>{const{data:e,selected:t,handleChange:s,isFetching:r}=ve();return!e||!t||r?o.jsx(Lt,{}):o.jsxs(me,{select:!0,value:t.name,onChange:s,...Te,slotProps:{select:{IconComponent:ye,MenuProps:{slotProps:{paper:{sx:{maxHeight:350}}},elevation:3}},input:{sx:{...je,"& #tables-ias":{color:"text.secondary",m:0}},startAdornment:o.jsx(Je,{position:"start",id:"tables-ias",children:o.jsx(j,{variant:"caption",color:"inherit",sx:{p:.5,borderRadius:1,bgcolor:"divider",textTransform:"uppercase"},children:t.type})})}},children:[o.jsxs(Z,{dense:!0,onClickCapture:i=>i.stopPropagation(),children:[o.jsx(Ue,{fontSize:"small",sx:{mr:.5}})," 新增資料表"]}),o.jsx(X,{}),e.map(({name:i},n)=>o.jsx(Z,{value:i,dense:!0,children:i},n))]})},le={edge:"start",tabIndex:-1,disableRipple:!0,size:"small",sx:{py:0}},Se={bgcolor:"FilledInput.disabledBg","&:hover":{bgcolor:"FilledInput.hoverBg"},borderRadius:1,height:1,width:"auto",aspectRatio:1},Nt=()=>o.jsx(Y,{title:"篩選欄位",arrow:!0,children:o.jsxs("span",{style:{position:"relative"},children:[o.jsx(xe,{loading:!0,centerRipple:!1,size:"small",sx:Se,children:o.jsx(be,{fontSize:"small"})}),o.jsx(T,{sx:{position:"absolute",top:0,bgcolor:"FilledInput.disabledBg",borderRadius:1,height:1,width:"auto",aspectRatio:1}})]})}),Ft=({columns:e})=>{const[t,s]=p.useState(null),r=l=>s(u=>u?null:l.currentTarget),i=()=>s(null),{createToggleAllColumns:n,createToggleHandler:a}=he(),c=e.every(l=>!l.hidden),d=e.every(l=>l.hidden);return o.jsxs(o.Fragment,{children:[o.jsx(Y,{title:"篩選欄位",arrow:!0,children:o.jsx("span",{children:o.jsx(xe,{onClick:r,centerRipple:!1,size:"small",sx:Se,children:o.jsx(be,{fontSize:"small"})})})}),o.jsx(Ne,{open:!!t,anchorEl:t,onClose:i,elevation:3,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},slotProps:{paper:{sx:{maxHeight:350}}},children:o.jsxs(Fe,{dense:!0,children:[o.jsx(W,{children:o.jsx(j,{variant:"body2",sx:{color:"text.secondary"},children:"篩選欄位"})}),o.jsx(W,{disablePadding:!0,children:o.jsxs(te,{role:void 0,onClick:n(e.length),dense:!0,children:[o.jsx(D,{...le,checked:c,indeterminate:!c&&!d}),o.jsx(oe,{primary:"顯示所有"})]})}),o.jsx(X,{sx:{my:.5}}),e.map(l=>o.jsx(W,{disablePadding:!0,children:o.jsxs(te,{role:void 0,onClick:a(l.cid),dense:!0,children:[o.jsx(D,{...le,checked:!l.hidden}),o.jsx(oe,{sx:{display:"flex",width:1,gap:F,justifyContent:"space-between",my:.5},primary:l.name,secondary:l.type.toUpperCase()})]})},l.cid))]})})]})},Ot=()=>{const{columnsForSelect:e,isFetching:t}=Ce();return t?o.jsx(Nt,{}):o.jsx(Ft,{columns:e??[]})},At=()=>o.jsxs(fe,{children:[o.jsx(N,{padding:"checkbox",sx:{border:"none"},children:o.jsx(D,{disabled:!0,size:"small"})}),o.jsx(N,{sx:{border:"none"},children:o.jsx(ee,{variant:"rounded",animation:"wave",children:o.jsx(j,{variant:"body2",children:"載入中. . ."})})}),[...Array(4)].map((e,t)=>o.jsx(N,{sx:{border:"none"},children:o.jsx(T,{sx:{display:"flex",justifyContent:"flex-end"},children:o.jsx(ee,{variant:"rounded",animation:"wave",children:o.jsx(j,{variant:"body2",children:"載入中. . ."})})})},t))]}),ce={p:.5,borderRadius:1,bgcolor:"divider"},de={textTransform:"uppercase",lineHeight:1,color:"text.secondary"},Ut=({isPk:e,type:t})=>o.jsxs(T,{sx:{display:"flex",alignItems:"center",gap:F,color:"text.secondary"},children:[e&&o.jsx(j,{variant:"caption",sx:{...ce,...de},children:"PK"}),o.jsx(T,{sx:ce,children:o.jsx(j,{variant:"caption",sx:{...de,...Oe},children:t})})]}),Dt=()=>o.jsx(T,{component:"tr","aria-hidden":"true",sx:{position:"absolute",inset:0,borderRadius:3,borderBottomRightRadius:"calc(1 * var(--mui-shape-borderRadius))",borderBottomLeftRadius:"calc(1 * var(--mui-shape-borderRadius))",bgcolor:"divider",opacity:.8,pointerEvents:"none"}}),Et=()=>{const{columnsForTable:e,isFetching:t}=Ce(),{order:s,orderBy:r,createToggleHandler:i}=Ht((e==null?void 0:e.length)??0),n=Math.random()>.5,a=Math.random()>.5,c=!n&&!a;return o.jsxs(Ct,{sx:{position:"relative"},children:[o.jsx(Dt,{}),t||!e?o.jsx(At,{}):o.jsxs(fe,{children:[o.jsx(N,{padding:"checkbox",sx:{border:"none"},children:o.jsx(D,{color:"default",indeterminate:a,checked:n,size:"small",sx:{color:c?void 0:"color-mix(in srgb, var(--mui-palette-text-primary) 30%, var(--mui-palette-primary-main) 70%)"}})}),e.map((d,l)=>{const{cid:u,name:m,type:v}=d,x=d.pk>=1,b=v!=="text"&&!x?"flex-end":void 0,f=r===l,y=f&&s==="desc"?1:-1;return o.jsx(N,{sx:{border:"none",minWidth:"10rem"},children:o.jsxs(T,{sx:{display:"flex",alignItems:"center",justifyContent:b},children:[o.jsx(Mt,{active:f,direction:f?s:"asc",IconComponent:Ke,slotProps:{icon:{sx:{transform:`scaleY(${y})`}}},onClick:i(l),children:o.jsx(j,{variant:"body2",children:m})}),o.jsx(Ut,{isPk:x,type:v})]})},u)})]})]})},pe=e=>({"--temporary-color":e,bgcolor:"color-mix(in srgb, var(--temporary-color) 30%, transparent 70%)","&:hover":{bgcolor:"color-mix(in srgb, var(--temporary-color) 40%, transparent 60%)"},color:"color-mix(in srgb, var(--temporary-color) 40%, var(--mui-palette-text-primary) 60%)",px:1.5}),Vt=e=>({"--temporary-color":e,bgcolor:"color-mix(in srgb, var(--temporary-color) 90%, var(--mui-palette-text-primary) 10%)","&:hover":{bgcolor:"color-mix(in srgb, var(--temporary-color) 80%, var(--mui-palette-text-primary) 20%)"},color:"color-mix(in srgb, var(--temporary-color) 5%, var(--mui-palette-background-paper) 95%)",px:1.5}),yo=()=>o.jsxs(Ae,{children:[o.jsxs(T,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:J},children:[o.jsxs(T,{sx:{display:"flex",alignItems:"stretch",gap:J},children:[o.jsx(zt,{}),o.jsx(Ot,{})]}),o.jsxs(T,{sx:{display:"flex",alignItems:"center",gap:J},children:[o.jsx(j,{sx:{color:"text.secondary"},children:"已選取 0 個:"}),o.jsxs(T,{sx:{display:"flex",alignItems:"center",gap:F},children:[o.jsx(Y,{title:"以指定值覆蓋選取資料的某個欄位",arrow:!0,children:o.jsx(V,{sx:pe("var(--mui-palette-primary-main)"),children:"覆蓋欄位"})}),o.jsx(V,{sx:pe("var(--mui-palette-error-main)"),children:"刪除紀錄"})]}),o.jsx(X,{flexItem:!0,orientation:"vertical"}),o.jsx(V,{sx:Vt("var(--mui-palette-primary-main)"),endIcon:o.jsx(ye,{}),children:"標準化"})]})]}),o.jsx(bt,{sx:{mt:Pt},children:o.jsxs(st,{children:[o.jsx(Et,{}),o.jsx(lt,{})]})})]});export{yo as default};
