import{o as V,j as e,r as m,p as o,t as y,n as v,x as H,z as L}from"./Toast-6ncYA_Ld.js";import{u as k,T as M,a as P,b as D,c as U,d as B,e as F,f as W,V as T,I as q,F as O,S as _,U as G,g as K}from"./TreeViewTransition-Di8HjRGL.js";import{V as w}from"./DataExplorationRounded-tAuyK-5K.js";import{M as Q}from"./MoreHorizRounded-QCoZH2Hn.js";import{D as X}from"./DatasetRounded-BTkDwVEg.js";import{T as A}from"./DarkModeRounded-BFg7OYNl.js";import{f as J}from"./main-DO3ZNPea.js";import{t as Y}from"./routes-Dr3OAPvi.js";import"./useThemeProps-BCMH5FQv.js";import"./Checkbox-1o3yFfn6.js";import"./SwitchBase-UlEzF0FU.js";import"./proxy-DHR4684q.js";import"./ErrorOutlineRounded-BWvTI3f4.js";import"./react-DEqm7Ayw.js";import"./SQLiteClient-CQZ5EZ1X.js";import"./tryCatch-CD0ybv0K.js";import"./url-BKoQkXLc.js";import"./RefreshRounded-BcOkXO49.js";import"./ArrowDropDownRounded-a6cIAduy.js";import"./NotificationsRounded-BBOwe-i5.js";import"./fuse-BXhxvJKY.js";import"./useMutation-2Qc-kFMN.js";import"./dayjs.min-CkW5XOTE.js";import"./MenuItem-BLYGv0hx.js";import"./ExpandMoreRounded-BeFfyJ0G.js";import"./Badge-D6o4y19V.js";import"./Divider-vP51gHCL.js";import"./DownloadRounded-CB3mGnoq.js";const Z=V(e.jsx("path",{d:"M19 7H9c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2m0 3c0 .55-.45 1-1 1h-8c-.55 0-1-.45-1-1s.45-1 1-1h8c.55 0 1 .45 1 1m-6 5v-2h2v2zm2 2v2h-2v-2zm-4-2H9v-2h2zm6-2h2v2h-2zm-8 4h2v2H9zm8 2v-2h2v2zM6 17H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v1h-2V5H5v10h1z"})),f=4,u={position:"absolute",color:"text.secondary",display:"grid",placeItems:"center"},N={table:l=>e.jsx(o,{sx:u,children:e.jsx(X,{sx:{color:"primary.main",filter:`hue-rotate(${(l??0)*20}deg)`}})}),columns:()=>e.jsx(o,{sx:u,children:e.jsx(w,{})}),column:()=>e.jsx(o,{sx:{...u,opacity:.5},children:e.jsx(w,{})}),indexes:()=>e.jsx(o,{sx:u,children:e.jsx(O,{})}),index:()=>e.jsx(o,{sx:{...u,opacity:.5},children:e.jsx(q,{})}),key:()=>e.jsx(o,{sx:{...u,opacity:.5},children:e.jsx(T,{})}),pk:()=>e.jsx(o,{sx:{...u,color:"info.main"},children:e.jsx(T,{})})},ee=m.forwardRef(function(x,d){const{id:a,itemId:h,label:t,disabled:r,children:c,type:n,hueIndex:j,subtitle:i,caption:p,...b}=x,{getRootProps:I,getContentProps:$,getIconContainerProps:R,getLabelProps:S,getGroupTransitionProps:z,status:C}=k({id:a,itemId:h,children:c,label:t,disabled:r,rootRef:d});return e.jsx(M,{itemId:h,children:e.jsxs(P,{...I(b),children:[e.jsxs(D,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:.5,pl:f/2,pr:1.5,borderRadius:0,boxShadow:"-1px 0 0 var(--mui-palette-divider)"},...$(),children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center"},children:[!["column","index","pk","key"].includes(n)&&e.jsx(o,{sx:{display:"grid",placeItems:"center",p:f/2},children:e.jsx(U,{sx:{position:"absolute"},...R(),children:e.jsx(B,{status:C})})}),e.jsx(o,{sx:{display:"grid",placeItems:"center",p:f/2},children:N[n](j)}),e.jsx(F,{...S(),sx:{lineHeight:1,pl:f/3,translate:"0 0.07rem",width:"auto",...y}}),i&&e.jsx(o,{sx:{p:.5,bgcolor:"divider",borderRadius:1,ml:1,translate:"0 0.07rem"},children:e.jsx(v,{variant:"caption",sx:{color:"text.secondary",textTransform:"uppercase",lineHeight:1,...y},children:i})})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",position:"relative"},children:[p&&e.jsx(v,{variant:"body2",sx:{mr:1,color:"text.secondary",lineHeight:1,translate:"0 0.07rem",textTransform:"uppercase",fontFamily:'"jf openhuninn"',...y},children:p}),["table","columns","indexes"].includes(n)&&e.jsx(A,{title:e.jsx(v,{variant:"body2",children:"正被其他網站樣板使用中，無法編輯"}),arrow:!0,placement:"right",children:e.jsx(H,{sx:{display:"grid",placeItems:"center",p:f/2,borderRadius:1,"&:hover":{bgcolor:"action.hover"},"&:active":{bgcolor:"action.selected"}},onClick:E=>E.stopPropagation(),children:e.jsx(Q,{sx:{color:"text.secondary",position:"absolute"}})})})]})]}),c&&e.jsx(W,{...z(),style:{paddingLeft:`calc(var(--mui-spacing) * ${f})`,boxShadow:"-1px 0 0 var(--mui-palette-divider)"}})]})})}),g=m.memo(ee),s=",_,";function te(){const{data:l,isFetching:x}=J(),[d,a]=m.useState([]),h=(t,r,c)=>{if(c)if(r.endsWith(s+"table")){const n=[r],j=r.split(s)[0],i=["columns","indexes"].map(p=>`${j}${s}${p}`);a([...n,...i])}else a([...d,r]);else a(d.filter(n=>n!==r))};return m.useEffect(()=>{if(x||!l)return;const t=Object.keys(l)[0],r=`${t}${s}table`,c=`${t}${s}columns`,n=`${t}${s}indexes`;a([r,c,n])},[l,x]),x?e.jsx(o,{sx:{display:"grid",placeItems:"center",height:1},children:e.jsx(L,{})}):e.jsx(_,{slots:{expandIcon:K,collapseIcon:G},sx:{ml:-4/2},expandedItems:d,onItemExpansionToggle:h,children:Y(l).map(([t,{columns:r,indexes:c,type:n,hueIndex:j}])=>e.jsxs(g,{type:"table",itemId:`${t}${s}table`,label:t,hueIndex:j,subtitle:n,children:[e.jsx(g,{type:"columns",itemId:`${t}${s}columns`,label:"欄位",children:r.map(({name:i,type:p,pk:b})=>e.jsx(g,{itemId:`${t}${s}column${s}${i}`,type:b>=1?"pk":i.toLowerCase().includes("id")?"key":"column",label:i,caption:p},`${t}${s}column${s}${i}`))}),e.jsxs(g,{type:"indexes",itemId:`${t}${s}indexes`,label:"索引",children:[c.length===0&&e.jsx(g,{type:"index",itemId:`${t}${s}no${s}index`,label:"無索引"}),c.map(({name:i,unique:p,columns:b})=>e.jsx(g,{itemId:`${t}${s}index${s}${i}`,type:"index",label:b.toSorted((I,$)=>I.seqno-$.seqno).map(({name:I})=>I).join(" → "),caption:p===1?"UNIQUE":void 0},`${t}${s}index${s}${i}`))]})]},t))})}const Ee=()=>{const[l,x]=m.useState(350),d=m.useRef(null),a=m.useRef(!1),h=()=>{a.current=!0,document.body.style.cursor="ew-resize",document.body.style.userSelect="none"},t=()=>{a.current=!1,document.body.style.cursor="default",document.body.style.userSelect=""},r=c=>{if(!a.current||!d.current)return;const n=c.clientX-d.current.getBoundingClientRect().left;n>=200&&n<=800&&x(n)};return m.useEffect(()=>(window.addEventListener("mousemove",r),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",t)}),[]),e.jsxs(o,{ref:d,sx:{width:l,borderRight:1,minHeight:650,borderColor:"divider",position:"relative"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",p:1},children:[e.jsx(Z,{className:"mode-light",sx:{fontSize:"3rem",mr:1.5,bgcolor:"primary.main",borderRadius:1,borderTopLeftRadius:"calc(var(--mui-shape-borderRadius) * 2.5)",color:"background.default",p:1,opacity:.8}}),e.jsx(v,{variant:"h6",sx:y,children:"資料表 & 檢視表"})]}),e.jsx(o,{sx:{position:"absolute",right:0,top:0,bottom:0,width:"1rem",translate:"90% 0",cursor:"ew-resize",zIndex:10,"&:hover":{bgcolor:"action.hover"},"&:active":{bgcolor:"action.selected"}},onMouseDown:h}),e.jsx(te,{})]})};export{Ee as default};
