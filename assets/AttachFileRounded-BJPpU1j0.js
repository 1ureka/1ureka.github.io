import{g as pe,a as he,r as p,u as oe,j as e,s as T,c as J,d as ne,m as P,x as me,b as ue,am as ct,e as dt,an as ut,p as l,o as y,n as d,z as re,S as I,v as D,I as R,B as g,l as se,q as Y,P as ae,M as xt,t as Te}from"./Toast-6ncYA_Ld.js";import{F as Le}from"./ForumRounded-A_Eulgqu.js";import{r as C}from"./routes-Dr3OAPvi.js";import{o as pt,d as De,g as U,e as V,p as ht,q as mt,i as k,S as fe,r as ft,a as gt,F as Oe,C as ge,T as jt,s as vt}from"./post-BBXU2v-h.js";import{I as yt,S as Pe,E as Ce}from"./ExpandMoreRounded-BeFfyJ0G.js";import{T as q,D as bt}from"./DarkModeRounded-BFg7OYNl.js";import{T as _e}from"./Toolbar-BcNpOrAE.js";import{C as It,P as qe,L as X}from"./CopyAllRounded-DJ_kYQgJ.js";import{e as ze,g as H,s as j}from"./ScrollArea-jG24aTiZ.js";import{A as Be}from"./Avatar-DGNt0orT.js";import{S as B}from"./Skeleton-DjBj6yfl.js";import{O as Ct}from"./OpenInNewRounded-BlaOd_6C.js";import{z as O}from"./index-mSkvzYyn.js";import{D as je,N as ve}from"./NotificationsRounded-BBOwe-i5.js";import{D as E}from"./Divider-vP51gHCL.js";import{g as wt,M as ie}from"./MenuItem-BLYGv0hx.js";import{u as L}from"./tryCatch-CD0ybv0K.js";import{u as F}from"./ErrorOutlineRounded-BWvTI3f4.js";import{u as W}from"./useMutation-2Qc-kFMN.js";import{M as He,C as we}from"./MoreHorizRounded-QCoZH2Hn.js";import{A as St}from"./ArrowOutwardRounded-D_ye905W.js";import{f as Et}from"./formatters-C9bWSe0O.js";import{C as K,B as We}from"./Badge-D6o4y19V.js";import{E as Rt}from"./ErrorRounded-Co923Na-.js";function kt(t){return pe("MuiBottomNavigation",t)}he("MuiBottomNavigation",["root"]);const $t=t=>{const{classes:s}=t;return ne({root:["root"]},kt,s)},Nt=T("div",{name:"MuiBottomNavigation",slot:"Root",overridesResolver:(t,s)=>s.root})(P(({theme:t})=>({display:"flex",justifyContent:"center",height:56,backgroundColor:(t.vars||t).palette.background.paper}))),At=p.forwardRef(function(s,o){const n=oe({props:s,name:"MuiBottomNavigation"}),{children:a,className:r,component:i="div",onChange:c,showLabels:u=!1,value:x,...m}=n,v={...n,component:i,showLabels:u},b=$t(v);return e.jsx(Nt,{as:i,className:J(b.root,r),ref:o,ownerState:v,...m,children:p.Children.map(a,(f,w)=>{if(!p.isValidElement(f))return null;const S=f.props.value===void 0?w:f.props.value;return p.cloneElement(f,{selected:S===x,showLabel:f.props.showLabel!==void 0?f.props.showLabel:u,value:S,onChange:c})})})});function Ft(t){return pe("MuiBottomNavigationAction",t)}const Ue=he("MuiBottomNavigationAction",["root","iconOnly","selected","label"]),Mt=t=>{const{classes:s,showLabel:o,selected:n}=t;return ne({root:["root",!o&&!n&&"iconOnly",n&&"selected"],label:["label",!o&&!n&&"iconOnly",n&&"selected"]},Ft,s)},Tt=T(me,{name:"MuiBottomNavigationAction",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,!o.showLabel&&!o.selected&&s.iconOnly]}})(P(({theme:t})=>({transition:t.transitions.create(["color","padding-top"],{duration:t.transitions.duration.short}),padding:"0px 12px",minWidth:80,maxWidth:168,color:(t.vars||t).palette.text.secondary,flexDirection:"column",flex:"1",[`&.${Ue.selected}`]:{color:(t.vars||t).palette.primary.main},variants:[{props:({showLabel:s,selected:o})=>!s&&!o,style:{paddingTop:14}},{props:({showLabel:s,selected:o,label:n})=>!s&&!o&&!n,style:{paddingTop:0}}]}))),Lt=T("span",{name:"MuiBottomNavigationAction",slot:"Label",overridesResolver:(t,s)=>s.label})(P(({theme:t})=>({fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(12),opacity:1,transition:"font-size 0.2s, opacity 0.2s",transitionDelay:"0.1s",[`&.${Ue.selected}`]:{fontSize:t.typography.pxToRem(14)},variants:[{props:({showLabel:s,selected:o})=>!s&&!o,style:{opacity:0,transitionDelay:"0s"}}]}))),_=p.forwardRef(function(s,o){const n=oe({props:s,name:"MuiBottomNavigationAction"}),{className:a,icon:r,label:i,onChange:c,onClick:u,selected:x,showLabel:m,value:v,...b}=n,f=n,w=Mt(f),S=G=>{c&&c(G,v),u&&u(G)};return e.jsxs(Tt,{ref:o,className:J(w.root,a),focusRipple:!0,onClick:S,ownerState:f,...b,children:[r,e.jsx(Lt,{className:w.label,ownerState:f,children:i})]})});function Dt(t){return pe("MuiFab",t)}const Se=he("MuiFab",["root","primary","secondary","extended","circular","focusVisible","disabled","colorInherit","sizeSmall","sizeMedium","sizeLarge","info","error","warning","success"]),Ot=t=>{const{color:s,variant:o,classes:n,size:a}=t,r={root:["root",o,`size${ue(a)}`,s==="inherit"?"colorInherit":s]},i=ne(r,Dt,n);return{...n,...i}},Pt=T(me,{name:"MuiFab",slot:"Root",shouldForwardProp:t=>ct(t)||t==="classes",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,s[o.variant],s[`size${ue(o.size)}`],o.color==="inherit"&&s.colorInherit,s[ue(o.size)],s[o.color]]}})(P(({theme:t})=>{var s,o;return{...t.typography.button,minHeight:36,transition:t.transitions.create(["background-color","box-shadow","border-color"],{duration:t.transitions.duration.short}),borderRadius:"50%",padding:0,minWidth:0,width:56,height:56,zIndex:(t.vars||t).zIndex.fab,boxShadow:(t.vars||t).shadows[6],"&:active":{boxShadow:(t.vars||t).shadows[12]},color:t.vars?t.vars.palette.grey[900]:(o=(s=t.palette).getContrastText)==null?void 0:o.call(s,t.palette.grey[300]),backgroundColor:(t.vars||t).palette.grey[300],"&:hover":{backgroundColor:(t.vars||t).palette.grey.A100,"@media (hover: none)":{backgroundColor:(t.vars||t).palette.grey[300]},textDecoration:"none"},[`&.${Se.focusVisible}`]:{boxShadow:(t.vars||t).shadows[6]},variants:[{props:{size:"small"},style:{width:40,height:40}},{props:{size:"medium"},style:{width:48,height:48}},{props:{variant:"extended"},style:{borderRadius:48/2,padding:"0 16px",width:"auto",minHeight:"auto",minWidth:48,height:48}},{props:{variant:"extended",size:"small"},style:{width:"auto",padding:"0 8px",borderRadius:34/2,minWidth:34,height:34}},{props:{variant:"extended",size:"medium"},style:{width:"auto",padding:"0 16px",borderRadius:40/2,minWidth:40,height:40}},{props:{color:"inherit"},style:{color:"inherit"}}]}}),P(({theme:t})=>({variants:[...Object.entries(t.palette).filter(dt(["dark","contrastText"])).map(([s])=>({props:{color:s},style:{color:(t.vars||t).palette[s].contrastText,backgroundColor:(t.vars||t).palette[s].main,"&:hover":{backgroundColor:(t.vars||t).palette[s].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[s].main}}}}))]})),P(({theme:t})=>({[`&.${Se.disabled}`]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}))),_t=p.forwardRef(function(s,o){const n=oe({props:s,name:"MuiFab"}),{children:a,className:r,color:i="default",component:c="button",disabled:u=!1,disableFocusRipple:x=!1,focusVisibleClassName:m,size:v="large",variant:b="circular",...f}=n,w={...n,color:i,component:c,disabled:u,disableFocusRipple:x,size:v,variant:b},S=Ot(w);return e.jsx(Pt,{className:J(S.root,r),component:c,disabled:u,focusRipple:!x,focusVisibleClassName:J(S.focusVisible,m),ownerState:w,ref:o,...f,classes:S,children:a})}),qt=t=>{const{alignItems:s,classes:o}=t;return ne({root:["root",s==="flex-start"&&"alignItemsFlexStart"]},wt,o)},zt=T("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,o.alignItems==="flex-start"&&s.alignItemsFlexStart]}})(P(({theme:t})=>({minWidth:56,color:(t.vars||t).palette.action.active,flexShrink:0,display:"inline-flex",variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}))),le=p.forwardRef(function(s,o){const n=oe({props:s,name:"MuiListItemIcon"}),{className:a,...r}=n,i=p.useContext(ut),c={...n,alignItems:i.alignItems},u=qt(c);return e.jsx(zt,{className:J(u.root,a),ownerState:c,ref:o,...r})}),Fo=()=>e.jsxs(l,{sx:{position:"absolute",inset:0,pointerEvents:"none"},children:[e.jsx(l,{sx:{bgcolor:"secondary.main",height:"34vh"}}),e.jsx(l,{sx:{height:"100px",backgroundColor:"secondary.main",maskImage:`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='white' fill-rule='evenodd' d='M0,0H200V100H0Z M0,0C0,0 100,100 200,0L200,100L0,100Z'/%3E%3C/svg%3E")`,maskRepeat:"repeat-x",maskPosition:"center bottom",maskSize:"auto 100px"}})]}),Bt=y([e.jsx("path",{d:"M10.67 13.02c-.22-.01-.44-.02-.67-.02-2.42 0-4.68.67-6.61 1.82-.88.52-1.39 1.5-1.39 2.53V19c0 .55.45 1 1 1h8.26c-.79-1.13-1.26-2.51-1.26-4 0-1.07.25-2.07.67-2.98"},"0"),e.jsx("circle",{cx:"10",cy:"8",r:"4"},"1"),e.jsx("path",{d:"M20.75 16c0-.22-.03-.42-.06-.63l.84-.73c.18-.16.22-.42.1-.63l-.59-1.02c-.12-.21-.37-.3-.59-.22l-1.06.36q-.48-.405-1.08-.63l-.22-1.09c-.05-.23-.25-.4-.49-.4h-1.18c-.24 0-.44.17-.49.4l-.22 1.09q-.6.225-1.08.63l-1.06-.36c-.23-.08-.47.02-.59.22l-.59 1.02c-.12.21-.08.47.1.63l.84.73c-.03.21-.06.41-.06.63s.03.42.06.63l-.84.73c-.18.16-.22.42-.1.63l.59 1.02c.12.21.37.3.59.22l1.06-.36q.48.405 1.08.63l.22 1.09c.05.23.25.4.49.4h1.18c.24 0 .44-.17.49-.4l.22-1.09q.6-.225 1.08-.63l1.06.36c.23.08.47-.02.59-.22l.59-1.02c.12-.21.08-.47-.1-.63l-.84-.73c.03-.21.06-.41.06-.63M17 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"},"2")]),Ht=y([e.jsx("path",{d:"M5 5h6c.55 0 1-.45 1-1s-.45-1-1-1H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h6c.55 0 1-.45 1-1s-.45-1-1-1H5z"},"0"),e.jsx("path",{d:"m20.65 11.65-2.79-2.79c-.32-.32-.86-.1-.86.35V11h-7c-.55 0-1 .45-1 1s.45 1 1 1h7v1.79c0 .45.54.67.85.35l2.79-2.79c.2-.19.2-.51.01-.7"},"1")]),Ee=y(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"})),Ve=y(e.jsx("path",{d:"M10.3 7.7c-.39.39-.39 1.01 0 1.4l1.9 1.9H3c-.55 0-1 .45-1 1s.45 1 1 1h9.2l-1.9 1.9c-.39.39-.39 1.01 0 1.4s1.01.39 1.4 0l3.59-3.59c.39-.39.39-1.02 0-1.41L11.7 7.7a.984.984 0 0 0-1.4 0M20 19h-7c-.55 0-1 .45-1 1s.45 1 1 1h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-7c-.55 0-1 .45-1 1s.45 1 1 1h7z"})),Wt=t=>e.jsx(B,{variant:"circular",width:"2rem",height:"2rem",animation:"wave",...t}),Ke=({name:t,sx:s,...o})=>e.jsx(Be,{sx:{bgcolor:"primary.main",width:"2rem",height:"2rem",...s},...o,children:e.jsx(d,{sx:{translate:"0px 5%"},children:t.slice(0,1).toUpperCase()})}),Ut=({showProgress:t})=>e.jsxs(e.Fragment,{children:[e.jsx(B,{variant:"circular",sx:{position:"absolute",bottom:0,width:1,height:"auto",aspectRatio:1},animation:"wave"}),t&&e.jsx(l,{sx:{position:"absolute",bottom:0,width:1,height:"auto",aspectRatio:1,display:"grid",placeItems:"center"},children:e.jsx(re,{})})]}),Mo=({size:t=6,borderSize:s=.8})=>{const o=new URLSearchParams(window.location.search),{data:n,isFetching:a}=ze(o.get("user"));return e.jsxs(l,{sx:{display:"flex",justifyContent:"center",position:"relative",width:`${t}rem`,alignSelf:"flex-end",m:2},children:[e.jsx(l,{sx:{position:"absolute",bottom:0,width:1,height:"auto",aspectRatio:1},children:e.jsx(l,{sx:{borderRadius:"50%",position:"absolute",inset:`${-s}rem`,bgcolor:"background.paper",backgroundImage:"var(--Paper-overlay)"}})}),!a&&n?e.jsx(Be,{sx:{position:"absolute",bottom:0,width:1,height:"auto",aspectRatio:1,bgcolor:"primary.main",boxShadow:3},children:e.jsx(d,{variant:"h3",component:"span",sx:{translate:"0px 5%",color:"white"},children:n.name.charAt(0).toUpperCase()})}):e.jsx(Ut,{showProgress:a})]})},Vt=y(e.jsx("path",{d:"M14.9 3H9.1c-.53 0-1.04.21-1.42.59l-4.1 4.1C3.21 8.06 3 8.57 3 9.1v5.8c0 .53.21 1.04.59 1.41l4.1 4.1c.37.38.88.59 1.41.59h5.8c.53 0 1.04-.21 1.41-.59l4.1-4.1c.38-.37.59-.88.59-1.41V9.1c0-.53-.21-1.04-.59-1.41l-4.1-4.1c-.37-.38-.88-.59-1.41-.59m.64 12.54c-.39.39-1.02.39-1.41 0L12 13.41l-2.12 2.12c-.39.39-1.02.39-1.41 0a.996.996 0 0 1 0-1.41L10.59 12 8.46 9.88a.996.996 0 0 1 0-1.41c.39-.39 1.02-.39 1.41 0L12 10.59l2.12-2.12c.39-.39 1.02-.39 1.41 0s.39 1.02 0 1.41L13.41 12l2.12 2.12c.4.39.4 1.03.01 1.42"})),xe={xs:4,sm:6},Qe=4,$=2,M=1,Kt=y(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m1 14H8c-.55 0-1-.45-1-1s.45-1 1-1h5c.55 0 1 .45 1 1s-.45 1-1 1m3-4H8c-.55 0-1-.45-1-1s.45-1 1-1h8c.55 0 1 .45 1 1s-.45 1-1 1m0-4H8c-.55 0-1-.45-1-1s.45-1 1-1h8c.55 0 1 .45 1 1s-.45 1-1 1"})),Qt=O.object({email:O.string().trim().email("請輸入有效的電子郵件地址").max(100,"電子郵件地址過長"),username:O.string().trim().min(4,"使用者名稱至少 4 個字元").max(20,"使用者名稱最多 20 個字元").regex(/^[a-zA-Z0-9 ]+$/,"使用者名稱只能包含英文字母與數字"),description:O.string().trim().max(40,"個人簡介不可超過 40 個字元")}),Re=({user:t})=>{const{mutateAsync:s,isPending:o}=pt(),n=De({defaultValues:{email:t.email,username:t.name,description:t.description},validators:{onBlur:Qt},onSubmit:async({value:r})=>{if(o)return;const{email:i,username:c,description:u}=r,x=await s({userId:t.id,email:i,username:c.trim(),description:u.trim()});if(x.error)return console.error(x.error);if(x.authenticated)return console.log("已成功更新個人資料！")},onSubmitInvalid:()=>{console.error("請檢查表單是否填寫正確")}}),a=async r=>{if(r.preventDefault(),!n.state.canSubmit)return console.error("請檢查表單是否填寫正確");n.handleSubmit()};return e.jsxs(I,{sx:{gap:$},component:"form",onSubmit:a,children:[e.jsxs(l,{sx:{display:"flex",gap:M,alignItems:"center",color:"text.secondary",mb:M},children:[e.jsx(Kt,{}),e.jsx(d,{variant:"h6",sx:{color:"text.primary"},children:"基本資料"})]}),e.jsx(n.Field,{name:"email",children:r=>e.jsx(D,{name:r.name,type:"email",fullWidth:!0,size:"small",variant:"outlined",label:"電子郵件",error:V(r.state.meta.errors),helperText:U(r.state.meta.errors),value:r.state.value,onChange:i=>r.handleChange(i.target.value),onBlur:r.handleBlur})}),e.jsx(n.Field,{name:"username",children:r=>e.jsx(D,{name:r.name,type:"text",fullWidth:!0,size:"small",variant:"outlined",label:"使用者名稱",error:V(r.state.meta.errors),helperText:U(r.state.meta.errors),value:r.state.value,onChange:i=>r.handleChange(i.target.value),onBlur:r.handleBlur})}),e.jsxs(l,{sx:{display:"flex",gap:M,alignItems:"center"},children:[e.jsx(D,{label:"個人檔案網址",value:`${window.location.origin}${C.forum_users}?user=${name}`,variant:"outlined",sx:{flex:1},disabled:!0,size:"small"}),e.jsx(q,{arrow:!0,placement:"top",title:"複製個人檔案網址到剪貼簿",children:e.jsx(R,{onClick:()=>{const i=`${window.location.origin}${C.forum_users}?user=${t.name}`;navigator.clipboard.writeText(i).then(()=>{console.log("已複製個人檔案網址到剪貼簿！")})},children:e.jsx(It,{fontSize:"small"})})}),e.jsx(q,{arrow:!0,placement:"top",title:"在新視窗中開啟個人檔案網址",children:e.jsx(R,{href:`${C.forum_users}?user=${t.name}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Ct,{fontSize:"small"})})})]}),e.jsx(n.Field,{name:"description",children:r=>e.jsx(D,{name:r.name,type:"text",fullWidth:!0,size:"small",variant:"outlined",label:"個人簡介",placeholder:"(職稱、學校、公司等)",multiline:!0,maxRows:3,error:V(r.state.meta.errors),helperText:U(r.state.meta.errors),value:r.state.value,onChange:i=>r.handleChange(i.target.value),onBlur:r.handleBlur})}),e.jsxs(l,{sx:{display:"flex",gap:M,alignItems:"center"},children:[e.jsx(g,{variant:"outlined",sx:{flex:1},onClick:()=>n.reset(),loading:o,children:"重設表單"}),e.jsx(g,{variant:"contained",sx:{flex:1},disableElevation:!0,type:"submit",loading:o,children:"儲存變更"})]})]})},Jt=y(e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2M9 8V6c0-1.66 1.34-3 3-3s3 1.34 3 3v2z"})),Yt=O.object({currentPassword:O.string().trim().min(1,"密碼不能為空"),newPassword:O.string().trim().min(1,"密碼不能為空")}),ke=({userId:t})=>{const{mutateAsync:s,isPending:o}=ht(),n=De({defaultValues:{currentPassword:"",newPassword:""},validators:{onSubmit:Yt},onSubmit:async({value:r})=>{if(o)return;const{currentPassword:i,newPassword:c}=r,u=await s({userId:t,currentPassword:i,newPassword:c});if(u.error)return console.error(u.error);if(u.authenticated)return console.log("已成功更密碼！")},onSubmitInvalid:()=>{console.error("請檢查表單是否填寫正確")}}),a=async r=>{if(r.preventDefault(),!n.state.canSubmit)return console.error("請檢查表單是否填寫正確");n.handleSubmit()};return e.jsxs(I,{sx:{gap:$},component:"form",onSubmit:a,children:[e.jsxs(l,{sx:{display:"flex",gap:M,alignItems:"center",color:"text.secondary",mb:M},children:[e.jsx(Jt,{}),e.jsx(d,{variant:"h6",sx:{color:"text.primary"},children:"修改密碼"})]}),e.jsxs(l,{sx:{display:"flex",gap:M,alignItems:"center"},children:[e.jsx(n.Field,{name:"currentPassword",children:r=>e.jsx(D,{name:r.name,label:"舊密碼",type:"password",variant:"outlined",fullWidth:!0,size:"small",error:V(r.state.meta.errors),helperText:U(r.state.meta.errors),value:r.state.value,onChange:i=>r.handleChange(i.target.value),onBlur:r.handleBlur})}),e.jsx(n.Field,{name:"newPassword",children:r=>e.jsx(D,{name:r.name,label:"新密碼",type:"password",variant:"outlined",fullWidth:!0,size:"small",error:V(r.state.meta.errors),helperText:U(r.state.meta.errors),value:r.state.value,onChange:i=>r.handleChange(i.target.value),onBlur:r.handleBlur})})]}),e.jsx(n.Subscribe,{selector:r=>r.isDirty,children:r=>e.jsx(g,{variant:"contained",type:"submit",disabled:!r,loading:o,disableElevation:!0,sx:{flex:1},children:o?"修改中...":"送出變更"})})]})},$e=()=>e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:Qe,width:1},children:[e.jsx(qe,{className:"mode-light",sx:{fontSize:"3rem",bgcolor:"primary.main",borderRadius:1,color:"background.default",p:1}}),e.jsxs(I,{sx:{gap:M},children:[e.jsx(d,{variant:"h5",children:"帳戶設定"}),e.jsx(d,{variant:"body2",sx:{opacity:.8},children:"在這裡你可以更新個人資料、修改密碼或刪除帳號。"})]})]}),Ne=({userId:t})=>{const[s,o]=p.useState(!1),{mutate:n,isPending:a}=mt(),r=()=>{n({userId:t})};return e.jsxs(l,{children:[e.jsx(g,{variant:"contained",color:"error",fullWidth:!0,disableElevation:!0,startIcon:e.jsx(Vt,{}),onClick:()=>o(!0),children:"刪除帳號"}),e.jsx(d,{variant:"body2",sx:{color:"text.secondary",mt:1},children:"刪除帳號將會永久刪除所有相關資料，無法復原。"}),e.jsx(je,{open:s,onClose:()=>!a&&o(!1),maxWidth:"sm",fullWidth:!0,children:e.jsxs(I,{sx:{p:xe,gap:$},children:[e.jsx(d,{variant:"h6",color:"error",children:"確認刪除帳號"}),e.jsx(d,{variant:"body1",children:"你確定要刪除此帳號嗎？此操作將會永久移除你的所有資料，且無法復原。"}),e.jsxs(l,{sx:{display:"flex",gap:Qe,justifyContent:"flex-end",mt:2},children:[e.jsx(g,{variant:"outlined",onClick:()=>!a&&o(!1),loading:a,children:"取消"}),e.jsx(g,{variant:"contained",color:"error",onClick:r,loading:a,children:a?"刪除中...":"確認刪除"})]})]})})]})},Gt=({onClose:t,user:s,...o})=>{const n=se(a=>a.breakpoints.up("md"));return e.jsx(je,{onClose:t,maxWidth:"lg",fullWidth:!0,...o,children:e.jsxs(I,{sx:{p:xe,gap:$},children:[e.jsx(l,{sx:{position:"absolute",inset:"0 0 auto auto",zIndex:1},children:e.jsx(R,{onClick:a=>t&&t(a,"backdropClick"),sx:{m:$},children:e.jsx(Y,{})})}),n?e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsx(E,{flexItem:!0,sx:{mt:$}}),e.jsxs(l,{sx:{display:"flex",gap:xe,width:1,alignItems:"stretch"},children:[e.jsx(I,{sx:{gap:$,flex:1},children:e.jsx(Re,{user:s})}),e.jsxs(I,{sx:{gap:$,flex:1,justifyContent:"space-between"},children:[e.jsxs(l,{children:[e.jsx(ke,{userId:s.id}),e.jsx(E,{flexItem:!0,sx:{mt:$}})]}),e.jsx(Ne,{userId:s.id})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsx(E,{flexItem:!0,sx:{mt:$}}),e.jsx(Re,{user:s}),e.jsx(E,{flexItem:!0}),e.jsx(ke,{userId:s.id}),e.jsx(E,{flexItem:!0,sx:{mb:$}}),e.jsx(Ne,{userId:s.id})]})]})})},Je=({onItemClick:t,user:s})=>{const{mutate:o,isPending:n}=ft(),a=()=>{o(),t()},[r,i]=p.useState(!1),c=()=>i(!0),u=()=>{i(!1),t()};return e.jsxs(xt,{dense:!0,children:[e.jsxs(ie,{href:`${C.forum_users}?user=${s.name}`,component:"a",children:[e.jsx(le,{children:e.jsx(qe,{})}),"個人檔案"]}),e.jsxs(ie,{onClick:c,className:"account-settings-button",children:[e.jsx(le,{children:e.jsx(Bt,{})}),"設定"]}),e.jsx(Gt,{open:r,user:{email:"",...s},onClose:u}),e.jsx(E,{}),e.jsxs(ie,{onClick:a,disabled:n,children:[e.jsx(le,{children:e.jsx(Ht,{})}),n?"登出中...":"登出"]})]})},Zt=()=>{const{user:t,loading:s,authenticated:o}=k(),[n,a]=p.useState(null),r=c=>a(n?null:c.currentTarget),i=()=>a(null);return s?e.jsx(g,{variant:"outlined",color:"inherit",startIcon:e.jsx(Ee,{}),disabled:!0,loading:s,children:"Loading"}):e.jsxs(e.Fragment,{children:[o?e.jsx(g,{variant:"outlined",color:"inherit",startIcon:e.jsx(Ee,{}),onClick:r,sx:{textTransform:"none",borderRadius:2},children:t.name}):e.jsx(g,{variant:"outlined",color:"inherit",startIcon:e.jsx(Ve,{}),href:C.forum_login,sx:{borderRadius:2},children:"登入"}),o&&e.jsx(ae,{anchorEl:n,anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"},open:!!n,onClose:i,keepMounted:!0,children:e.jsx(Je,{onItemClick:i,user:t})})]})},Xt=T("div")(({theme:t})=>({height:30,width:6,backgroundColor:t.palette.divider,borderRadius:3,position:"absolute",left:8,top:"calc(50% - 15px)",...t.applyStyles("dark",{backgroundColor:t.palette.divider})})),es=()=>{const{user:t,loading:s,authenticated:o}=k(),[n,a]=p.useState(!1),r=()=>a(!0),i=()=>a(!1);return s?e.jsx(_,{showLabel:!0,label:"帳戶",icon:e.jsx(re,{size:"2rem"})}):e.jsxs(e.Fragment,{children:[o?e.jsx(_,{showLabel:!0,label:t.name,onClick:r,icon:e.jsx(Ke,{name:t.name,sx:{color:"primary.contrastText"}})}):e.jsx(_,{showLabel:!0,label:"登入",icon:e.jsx(Ve,{}),href:C.forum_login}),o&&e.jsxs(fe,{anchor:"right",open:n,onClose:i,onOpen:r,slotProps:{paper:{sx:{width:240}}},keepMounted:!0,children:[e.jsx(Xt,{}),e.jsxs(l,{sx:{p:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(d,{variant:"h6",children:"帳戶"}),e.jsx(R,{onClick:i,children:e.jsx(Y,{})})]}),e.jsx(Je,{onItemClick:i,user:t})]})]})},ts=C.forum_search,ss="?all=",os=()=>{const[t,s]=p.useState(""),o=r=>s(r.target.value),n=ts+ss+t,a=({key:r})=>{if(r==="Enter"){if(!t.trim())return console.error("請輸入搜尋內容");window.location.href=n}};return e.jsx(D,{variant:"filled",label:"搜尋",placeholder:"使用者 / 貼文",size:"small",sx:{minWidth:150,width:1,maxWidth:800},value:t,onChange:o,onKeyDown:a,slotProps:{input:{endAdornment:e.jsx(q,{title:t.trim()?"搜尋":"請輸入搜尋內容",arrow:!0,children:e.jsx(yt,{position:"end",children:e.jsx(R,{edge:"end",href:n,disabled:!t.trim(),children:e.jsx(Pe,{})})})})}}})},ce={reply_post:(t,s)=>`${t} 回覆了你的貼文「${s}」`,reply_comment:(t,s)=>`${t} 回覆了你的留言「${s.slice(0,20)}...」`,follow_user:t=>`${t} 開始追蹤你`},de={reply_post:"有一個新留言",reply_comment:"有一個新留言",follow_user:"有一個新追蹤者"},ns=async()=>{const t=await H({server:!0});if(!t.authenticated)return 0;const s=t.user.id,n=await j.exec(`
      SELECT COUNT(*) as unreadCount
      FROM user_notifications
      WHERE receiverId = $userId AND isRead = 0 AND isDeleted = 0
    `,{$userId:s});if(n.length===0)return 0;const{unreadCount:a}=n[0];return typeof a!="number"?0:a},rs=async({page:t=0,limit:s=20,priority:o,filterBy:n,order:a="desc",isRead:r,isDeleted:i=!1}={})=>{const c=await H({server:!0});if(!c.authenticated)return{notifications:[],nextPage:null,totalPages:0};const u=c.user.id,x=["un.receiverId = $userId"],m={$userId:u};if(r!==void 0&&(x.push("un.isRead = $isRead"),m.$isRead=r?1:0),x.push("un.isDeleted = $isDeleted"),m.$isDeleted=i?1:0,n&&n.length>0){const h=n.map((A,N)=>`$filterType${N}`);x.push(`un.type IN (${h.join(", ")})`),n.forEach((A,N)=>{m[`$filterType${N}`]=A})}const v=x.length>0?`WHERE ${x.join(" AND ")}`:"",b=`
      SELECT COUNT(*) as total
      FROM user_notifications un
      ${v}
    `,f=await j.exec(b,m);if(f.length===0)return{notifications:[],nextPage:null,totalPages:0};const{total:w}=f[0];if(typeof w!="number")return{notifications:[],nextPage:null,totalPages:0};const S=Math.ceil(w/s),G=t+1<S?t+1:null;let Ie=`un.isRead ASC, un.createdAt ${a.toUpperCase()}`;o&&o.length>0&&(Ie=`un.isRead ASC, (CASE ${o.map((A,N)=>`WHEN un.type = '${A}' THEN ${N}`).join(" ")} ELSE ${o.length} END), un.createdAt ${a.toUpperCase()}`),m.$limit=s,m.$offset=t*s;const lt=`
      SELECT
        un.type,
        un.sourceId,
        un.receiverId,
        un.actorId,
        u.name as actorName,
        un.createdAt,
        un.isRead,
        un.isDeleted,
        CASE
          WHEN un.type = 'reply_post' THEN
            (SELECT p.id FROM comments c JOIN posts p ON c.postId = p.id WHERE c.id = un.sourceId)
          WHEN un.type = 'reply_comment' THEN
            (SELECT c2.postId FROM comments c2 WHERE c2.id = un.sourceId)
          ELSE NULL
        END as postId,
        CASE
          WHEN un.type = 'reply_post' THEN
            (SELECT p.title FROM comments c JOIN posts p ON c.postId = p.id WHERE c.id = un.sourceId)
          ELSE NULL
        END as postTitle,
        CASE
          WHEN un.type = 'reply_comment' THEN
            (SELECT c1.id FROM comments c2 JOIN comments c1 ON c2.parentId = c1.id WHERE c2.id = un.sourceId)
          ELSE NULL
        END as commentId,
        CASE
          WHEN un.type = 'reply_comment' THEN
            (SELECT c1.content FROM comments c2 JOIN comments c1 ON c2.parentId = c1.id WHERE c2.id = un.sourceId)
          ELSE NULL
        END as commentContent
      FROM user_notifications un
      JOIN users u ON un.actorId = u.id
      ${v}
      ORDER BY ${Ie}
      LIMIT $limit OFFSET $offset
    `;return{notifications:(await j.exec(lt,m)).map(h=>{let A="通知",N="",Z={};return h.type==="reply_post"?(A=de.reply_post,N=ce.reply_post(h.actorName,h.postTitle||""),Z={postId:h.postId,postTitle:h.postTitle}):h.type==="reply_comment"?(A=de.reply_comment,N=ce.reply_comment(h.actorName,h.commentContent||""),Z={postId:h.postId,commentId:h.commentId,commentContent:h.commentContent}):h.type==="follow_user"&&(A=de.follow_user,N=ce.follow_user(h.actorName)),{id:`${h.type}-${h.sourceId}`,type:h.type,sourceId:h.sourceId,actorId:h.actorId,actorName:h.actorName,createdAt:new Date(h.createdAt),isRead:!!h.isRead,isDeleted:!!h.isDeleted,title:A,message:N,extraData:Object.keys(Z).length>0?Z:void 0}}),nextPage:G,totalPages:S}},as=async({type:t,sourceId:s})=>{const o=await H({server:!0});if(!o.authenticated)return{error:"未登入或授權失效"};const n=o.user.id;return(await j.exec(`
      SELECT 1 FROM user_notifications
      WHERE receiverId = $userId AND type = $type AND sourceId = $sourceId
    `,{$userId:n,$type:t,$sourceId:s})).length===0?{error:"通知不存在或無權限標記"}:(await j.exec(`
      INSERT INTO notification_states (userId, type, sourceId, readAt, isDeleted)
      VALUES ($userId, $type, $sourceId, CURRENT_TIMESTAMP, 0)
      ON CONFLICT (userId, type, sourceId)
      DO UPDATE SET readAt = CURRENT_TIMESTAMP
      WHERE userId = $userId AND type = $type AND sourceId = $sourceId
    `,{$userId:n,$type:t,$sourceId:s}),{})},is=async()=>{const t=await H({server:!0});if(!t.authenticated)return{error:"未登入或授權失效"};const s=t.user.id,n=await j.exec(`
      SELECT type, sourceId
      FROM user_notifications
      WHERE receiverId = $userId AND isRead = 0 AND isDeleted = 0
    `,{$userId:s});if(n.length===0)return{};const r=`
      INSERT OR REPLACE INTO notification_states
      (userId, type, sourceId, readAt, isDeleted)
      VALUES ${n.map(i=>`(${s}, '${i.type}', ${i.sourceId}, CURRENT_TIMESTAMP, 0)`).join(", ")}
    `;return await j.exec(r,{}),{}},ls=async({type:t,sourceId:s})=>{const o=await H({server:!0});if(!o.authenticated)return{error:"未登入或授權失效"};const n=o.user.id;return(await j.exec(`
      SELECT 1 FROM user_notifications
      WHERE receiverId = $userId AND type = $type AND sourceId = $sourceId
    `,{$userId:n,$type:t,$sourceId:s})).length===0?{error:"通知不存在或無權限刪除"}:(await j.exec(`
      INSERT INTO notification_states (userId, type, sourceId, readAt, isDeleted)
      VALUES ($userId, $type, $sourceId, CURRENT_TIMESTAMP, 1)
      ON CONFLICT (userId, type, sourceId)
      DO UPDATE SET isDeleted = 1
      WHERE userId = $userId AND type = $type AND sourceId = $sourceId
    `,{$userId:n,$type:t,$sourceId:s}),{})},cs=async()=>{const t=await H({server:!0});if(!t.authenticated)return{error:"未登入或授權失效"};const s=t.user.id,n=await j.exec(`
      SELECT type, sourceId
      FROM user_notifications
      WHERE receiverId = $userId AND isDeleted = 0
    `,{$userId:s});if(n.length===0)return{};const r=`
      INSERT OR REPLACE INTO notification_states
      (userId, type, sourceId, readAt, isDeleted)
      VALUES ${n.map(i=>`(${s}, '${i.type}', ${i.sourceId}, CURRENT_TIMESTAMP, 1)`).join(", ")}
    `;return await j.exec(r,{}),{}},Ye=1e3*60*1,ds=t=>L({queryKey:["notifications",t],queryFn:()=>rs(t),staleTime:Ye}),Ge=()=>L({queryKey:["notificationCounts"],queryFn:ns,staleTime:Ye}),Ze=()=>{const t=F();return W({mutationFn:as,onError:s=>console.error(`已讀通知失敗: ${s}`),onSuccess:({error:s})=>{if(s)return console.error(`已讀通知失敗: ${s}`);console.log("成功標記為已讀"),t.invalidateQueries({queryKey:["notifications"]}),t.invalidateQueries({queryKey:["notificationCounts"]})}})},us=()=>{const t=F();return W({mutationFn:is,onError:s=>console.error(`已讀所有通知失敗: ${s}`),onSuccess:({error:s})=>{if(s)return console.error(`已讀所有通知失敗: ${s}`);console.log("成功已讀所有通知"),t.invalidateQueries({queryKey:["notifications"]}),t.invalidateQueries({queryKey:["notificationCounts"]})}})},xs=()=>{const t=F();return W({mutationFn:ls,onError:s=>console.error(`刪除通知失敗: ${s}`),onSuccess:({error:s})=>{if(s)return console.error(`刪除通知失敗: ${s}`);console.log("成功刪除通知"),t.invalidateQueries({queryKey:["notifications"]}),t.invalidateQueries({queryKey:["notificationCounts"]})}})},ps=()=>{const t=F();return W({mutationFn:cs,onError:s=>console.error(`刪除所有通知失敗: ${s}`),onSuccess:({error:s})=>{if(s)return console.error(`刪除所有通知失敗: ${s}`);console.log("成功刪除所有通知"),t.invalidateQueries({queryKey:["notifications"]}),t.invalidateQueries({queryKey:["notificationCounts"]})}})},Xe=y(e.jsx("path",{d:"M18.05 19.29c-.39.39-1.02.39-1.41 0l-2.12-2.12a.996.996 0 0 1 0-1.41c.39-.39 1.02-.39 1.41 0l1.41 1.41 3.54-3.54c.39-.39 1.02-.39 1.41 0s.39 1.02 0 1.41zM12 17c0-3.87 3.13-7 7-7 1.08 0 2.09.25 3 .68V4c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v18l4-4h6c0-.17.01-.33.03-.5-.02-.17-.03-.33-.03-.5"})),hs=y(e.jsx("path",{d:"M6 13h12c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1s.45 1 1 1m-2 4h12c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1m3-9c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H8c-.55 0-1 .45-1 1"})),ms=y(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2zM9 9h6c.55 0 1 .45 1 1v8c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1v-8c0-.55.45-1 1-1m6.5-5-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z"})),fs=({type:t,sourceId:s})=>{const{authenticated:o,loading:n}=k(),[a,r]=p.useState(null),i=S=>r(S.currentTarget),c=()=>r(null),{mutateAsync:u,isPending:x}=Ze(),{mutateAsync:m,isPending:v}=xs(),b=x||v,f=async()=>{await u({type:t,sourceId:s}),c()},w=async()=>{await m({type:t,sourceId:s}),c()};return e.jsxs(e.Fragment,{children:[e.jsx(R,{onClick:i,disabled:!o,loading:n,children:e.jsx(He,{fontSize:"small"})}),e.jsx(ae,{anchorEl:a,open:!!a,onClose:c,anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"},elevation:3,children:e.jsxs(I,{sx:{gap:.5,p:.5,color:"color-mix(in srgb, transparent 30%, var(--mui-palette-text-primary) 70%)"},children:[e.jsx(g,{color:"inherit",startIcon:e.jsx(Xe,{}),onClick:f,loading:b,children:"標記為已讀"}),e.jsx(g,{color:"error",startIcon:e.jsx(ms,{}),onClick:w,loading:b,children:"刪除該通知"})]})})]})},Ae=({forAlign:t=!1})=>e.jsx(l,{sx:{width:"0.7rem",aspectRatio:"1/1",display:"grid",placeItems:"center",position:"relative"},children:!t&&e.jsx(l,{sx:{position:"absolute",inset:1,borderRadius:"50%",bgcolor:"primary.main"}})}),gs=t=>{const{title:s,message:o,isRead:n,createdAt:a,actorName:r,extraData:i,type:c,sourceId:u}=t,{mutateAsync:x,isPending:m}=Ze(),v=async()=>{n||await x({type:c,sourceId:u}),c==="follow_user"?window.location.href=`${C.forum_users}?user=${r}`:window.location.href=`${C.forum_post}?postId=${i==null?void 0:i.postId}`};return e.jsxs(I,{sx:{position:"relative",gap:.25},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1,position:"relative"},children:[!n&&e.jsx(Ae,{}),e.jsx(d,{variant:"subtitle1",children:s}),e.jsx(l,{sx:{flex:1}}),e.jsx(d,{variant:"body2",sx:{color:"text.secondary"},children:Et(a)}),e.jsx(fs,{...t})]}),e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[!n&&e.jsx(Ae,{forAlign:!0}),e.jsx(d,{variant:"body1",sx:{color:"text.secondary",...Te},children:o}),e.jsx(l,{sx:{flex:1}}),e.jsx(g,{variant:"text",size:"small",onClick:v,startIcon:e.jsx(St,{}),loading:m,children:"前往"})]})]})},js=()=>{const{authenticated:t,loading:s}=k(),[o,n]=p.useState(null),a=f=>n(f.currentTarget),r=()=>n(null),{mutateAsync:i,isPending:c}=us(),{mutateAsync:u,isPending:x}=ps(),m=c||x,v=async()=>{await i(),r()},b=async()=>{await u(),r()};return e.jsxs(e.Fragment,{children:[e.jsx(R,{onClick:a,size:"small",disabled:!t,loading:s,children:e.jsx(He,{})}),e.jsx(ae,{anchorEl:o,open:!!o,onClose:r,anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"},elevation:3,children:e.jsxs(I,{sx:{gap:.5,p:.5,color:"color-mix(in srgb, transparent 30%, var(--mui-palette-text-primary) 70%)"},children:[e.jsx(g,{color:"inherit",startIcon:e.jsx(Xe,{}),onClick:v,loading:m,children:"已讀所有"}),e.jsx(g,{color:"error",startIcon:e.jsx(hs,{}),onClick:b,loading:m,children:"清除所有"})]})})]})},vs=["all","unread","comment","follow"],ys={all:"所有",unread:"未讀",comment:"來自留言",follow:"來自關注"},bs=({filter:t})=>{let s;(t==="unread"||t==="all")&&(s=void 0),t==="comment"&&(s=["reply_post","reply_comment"]),t==="follow"&&(s=["follow_user"]);const o=t==="unread"?!1:void 0,{data:n,isFetching:a}=ds({limit:30,filterBy:s,isRead:o});if(a||n===void 0)return e.jsx(l,{sx:{p:6},children:e.jsx(re,{size:24})});const{notifications:r}=n;return r.length<=0?e.jsx(l,{sx:{p:6},children:e.jsx(d,{variant:"body2",sx:{color:"text.secondary"},children:"目前沒有通知"})}):e.jsx(I,{sx:{width:1,gap:1.5},children:r.map(i=>e.jsx(gs,{...i},i.id))})},et=({sx:t,...s})=>{const{authenticated:o}=k(),[n,a]=p.useState("all");return e.jsxs(I,{sx:t,...s,children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,pb:1.5},children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ve,{className:"mode-light",sx:{fontSize:"2rem",bgcolor:"primary.main",borderRadius:1,color:"background.default",p:1}}),e.jsx(d,{variant:"h6",children:"通知"})]}),e.jsx(js,{})]}),e.jsx(l,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",p:2,pt:0},children:vs.map(r=>e.jsx(K,{color:n===r?"primary":"default",variant:n===r?"filled":"outlined",onClick:()=>a(r),label:ys[r]},r))}),e.jsx(E,{}),e.jsx(l,{sx:{display:"grid",placeItems:"center",maxHeight:350,overflowY:"auto",overflowX:"hidden",p:2},children:o?e.jsx(bs,{filter:n}):e.jsx(l,{sx:{p:6},children:e.jsx(d,{variant:"body2",sx:{color:"text.secondary"},children:"請先登入以查看通知"})})})]})},Is=()=>{const{data:t,isFetching:s}=Ge(),[o,n]=p.useState(null),a=()=>n(null),r=i=>n(o?null:i.currentTarget);return e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"通知",arrow:!0,children:e.jsx("span",{children:e.jsx(R,{onClick:r,loading:s,children:e.jsx(We,{badgeContent:t??0,color:"primary",children:e.jsx(ve,{fontSize:"small"})})})})}),e.jsx(ae,{anchorEl:o,open:!!o,onClose:a,anchorOrigin:{horizontal:"center",vertical:"bottom"},transformOrigin:{horizontal:"center",vertical:"top"},elevation:3,slotProps:{paper:{sx:{borderRadius:2}}},children:e.jsx(et,{sx:{width:360}})})]})},Cs=T("div")(({theme:t})=>({height:30,width:6,backgroundColor:t.palette.divider,borderRadius:3,position:"absolute",right:8,top:"calc(50% - 15px)",...t.applyStyles("dark",{backgroundColor:t.palette.divider})})),ws=()=>{const{data:t,isFetching:s}=Ge(),[o,n]=p.useState(!1),a=()=>n(!1),r=()=>n(!0);return e.jsxs(e.Fragment,{children:[e.jsx(_,{showLabel:!0,label:"通知",onClick:r,disabled:s,icon:e.jsx(We,{badgeContent:t??0,color:"primary",children:e.jsx(ve,{})})}),e.jsxs(fe,{anchor:"left",open:o,onClose:a,onOpen:r,children:[e.jsx(Cs,{}),e.jsx(l,{sx:{pt:3,pr:3,display:"flex",alignItems:"center",justifyContent:"flex-end"},children:e.jsx(R,{onClick:a,children:e.jsx(Y,{})})}),e.jsx(et,{})]})]})},Ss=y(e.jsx("path",{d:"M17 20H5c-.55 0-1-.45-1-1V7c0-.55-.45-1-1-1s-1 .45-1 1v13c0 1.1.9 2 2 2h13c.55 0 1-.45 1-1s-.45-1-1-1m3-18H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 10-2.5-1.5L15 12V4h5z"})),Es=async({postId:t,userId:s})=>{const o=`
      SELECT 1 as liked
      FROM post_interactions
      WHERE postId = $postId
        AND userId = $userId
        AND type = 'like'
      LIMIT 1
    `,n=`
      SELECT COALESCE(likeCount, 0) as likeCount
      FROM post_interaction_counts
      WHERE postId = $postId
    `,a=await j.exec(o,{$postId:t,$userId:s}),r=await j.exec(n,{$postId:t}),i=a.length>0;return!r[0]||!Number.isInteger(r[0].likeCount)?null:{liked:i,likeCount:r[0].likeCount}},Rs=async({postId:t,userId:s})=>({fav:(await j.exec(`
      SELECT 1 as fav
      FROM post_interactions
      WHERE postId = $postId
        AND userId = $userId
        AND type = 'favorite'
      LIMIT 1
    `,{$postId:t,$userId:s})).length>0}),ks=async({postId:t,userId:s,type:o,value:n})=>{n?await j.exec(`
        INSERT OR IGNORE INTO post_interactions (userId, postId, type)
        VALUES ($userId, $postId, $type)
      `,{$userId:s,$postId:t,$type:o}):await j.exec(`
        DELETE FROM post_interactions
        WHERE userId = $userId
          AND postId = $postId
          AND type = $type
      `,{$userId:s,$postId:t,$type:o})},$s=async({userId:t})=>(await j.exec(`
    SELECT postId
    FROM post_interactions
    WHERE userId = $userId
      AND type = 'favorite'
    ORDER BY createdAt DESC
  `,{$userId:t})).map(n=>n.postId),ye=0,tt=(t,s,o)=>{const n=F(),a=p.useRef(0);return W({mutationFn:r=>{if(s===void 0)throw new Error("未登錄");return ks({postId:t,userId:s,type:o,value:r})},onMutate:()=>(a.current++,a.current),onSettled:(r,i,c,u)=>{if(u===a.current){const x=o==="like"?["likeStatus",t,s]:["favoriteStatus",t,s];n.invalidateQueries({queryKey:x})}},onError:()=>{console.error(`${o==="like"?"按讚":"收藏"}操作失敗`)}})},To=t=>{const s=F(),{user:o,authenticated:n,loading:a}=k(),{data:r}=L({staleTime:ye,queryKey:["likeStatus",t,o==null?void 0:o.id],enabled:!a&&n&&(o==null?void 0:o.id)!==void 0,queryFn:async()=>Es({postId:t,userId:o.id})}),i=!n||a||r===void 0||r===null,c=(r==null?void 0:r.liked)??!1,u=(r==null?void 0:r.likeCount)??null,{mutate:x}=tt(t,o==null?void 0:o.id,"like");return{liked:c,likeCount:u,handleLike:async()=>{i||(await s.cancelQueries({queryKey:["likeStatus",t,o.id]}),s.setQueryData(["likeStatus",t,o.id],v=>{const b=!v.liked;return x(b),{liked:b,likeCount:v.likeCount+(b?1:-1)}}))},disabled:i}},st=t=>{const s=F(),{user:o,authenticated:n,loading:a}=k(),{data:r,isLoading:i}=L({staleTime:ye,queryKey:["favoriteStatus",t,o==null?void 0:o.id],enabled:!a&&n&&(o==null?void 0:o.id)!==void 0,queryFn:async()=>Rs({postId:t,userId:o.id})}),c=a||i,u=!n||a||r===void 0||r===null,x=(r==null?void 0:r.fav)??!1,{mutate:m}=tt(t,o==null?void 0:o.id,"favorite");return{isFavorited:x,handleFavorite:async()=>{u||(await s.cancelQueries({queryKey:["favoriteStatus",t,o.id]}),s.setQueryData(["favoriteStatus",t,o.id],b=>{const f=!b.fav;return m(f),{fav:f}}))},disabled:u,loading:c}},Ns=()=>{const{user:t,authenticated:s,loading:o}=k(),{data:n,isFetching:a}=L({staleTime:ye,queryKey:["favoritePosts",t==null?void 0:t.id],queryFn:()=>$s({userId:t.id}),enabled:!o&&s&&(t==null?void 0:t.id)!==void 0});return{data:n,loading:o||a||n===void 0}},As=async({userId:t})=>{const o=await j.exec(`
      SELECT u.id, u.name, u.description
      FROM user_interactions ui
      JOIN users u ON ui.followeeId = u.id
      WHERE ui.followerId = $userId
        AND ui.type = 'follow'
      ORDER BY ui.createdAt DESC
    `,{$userId:t});return!o||o.length===0?null:o.map(n=>({id:n.id,name:n.name,description:n.description}))},Fs=async({userId:t})=>{const o=await j.exec(`
      SELECT u.id, u.name, u.description
      FROM user_interactions ui
      JOIN users u ON ui.followerId = u.id
      WHERE ui.followeeId = $userId
        AND ui.type = 'follow'
      ORDER BY ui.createdAt DESC
    `,{$userId:t});return!o||o.length===0?null:o.map(n=>({id:n.id,name:n.name,description:n.description}))},Ms=async({followerId:t,followeeId:s,value:o})=>{if(t===s)throw new Error("使用者不能追蹤自己");const n=new Date().toISOString();o?await j.exec(`
          INSERT OR IGNORE INTO user_interactions (followerId, followeeId, type, createdAt)
          VALUES ($followerId, $followeeId, 'follow', $createdAt)
        `,{$followerId:t,$followeeId:s,$createdAt:n}):await j.exec(`
          DELETE FROM user_interactions
          WHERE followerId = $followerId
            AND followeeId = $followeeId
            AND type = 'follow'
        `,{$followerId:t,$followeeId:s})},Ts=async({targetId:t,userId:s})=>({follow:(await j.exec(`
      SELECT 1 as follow
      FROM user_interactions
      WHERE followerId = $userId
        AND followeeId = $targetId
        AND type = 'follow'
      LIMIT 1
    `,{$userId:s,$targetId:t})).length>0}),be=0,Ls=(t,s)=>{const o=F(),n=p.useRef(0);return W({mutationFn:a=>{if(s===void 0)throw new Error("未登錄");return Ms({followerId:s,followeeId:t,value:a})},onMutate:()=>(n.current++,n.current),onSettled:(a,r,i,c)=>{if(c===n.current){const u=["userFollow",t,s];o.invalidateQueries({queryKey:u})}},onError:()=>{console.error("追蹤操作失敗")}})},ot=t=>{const s=F(),{user:o,authenticated:n,loading:a}=k(),{data:r,isFetching:i}=L({staleTime:be,queryKey:["userFollow",t,o==null?void 0:o.id],enabled:!a&&n&&(o==null?void 0:o.id)!==void 0,queryFn:async()=>Ts({targetId:t,userId:o.id})}),c=a||i,u=!n||r===void 0||t===(o==null?void 0:o.id),x=(r==null?void 0:r.follow)??!1,m=t===(o==null?void 0:o.id),{mutate:v}=Ls(t,o==null?void 0:o.id);return{isFollowed:x,handleFollow:async()=>{u||(await s.cancelQueries({queryKey:["userFollow",t,o.id]}),s.setQueryData(["userFollow",t,o.id],f=>{const w=!f.follow;return v(w),{follow:w}}))},disabled:u,loading:c,isSelf:m}},Lo=({userId:t})=>L({queryKey:["userFollowers",t],queryFn:()=>Fs({userId:t}),staleTime:be}),Ds=({userId:t})=>L({queryKey:["userFollowing",t],queryFn:()=>As({userId:t}),staleTime:be}),nt=()=>e.jsxs(l,{sx:{p:1.5,outline:"1px solid",outlineColor:"divider",borderRadius:1},children:[e.jsx(l,{sx:{display:"flex",gap:1.5,mb:2,alignItems:"center"},children:e.jsx(B,{variant:"rounded",animation:"wave",children:e.jsx(d,{variant:"body2",children:"by loading..."})})}),e.jsx(B,{variant:"rounded",animation:"wave",children:e.jsx(d,{variant:"subtitle1",component:"h6",sx:{textAlign:"start"},children:"正在載入標題..."})})]}),Os=({postId:t,action:s})=>{const{data:o,isFetching:n}=gt({postId:t});if(n||!o)return e.jsx(nt,{});const a=()=>{window.location.href=`${C.forum_post}?postId=${o.id}`};return e.jsxs(l,{sx:{p:1.5,outline:"1px solid",outlineColor:"divider",borderRadius:1,cursor:"pointer","&:hover":{bgcolor:"action.hover"}},onClick:a,children:[e.jsxs(l,{sx:{display:"flex",gap:1.5,mb:2,alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(d,{variant:"body2",component:"a",href:`${C.forum_users}?user=${o.userName}`,sx:{color:"text.secondary",textDecoration:"none","&:hover":{textDecoration:"underline",color:"text.primary"}},children:["by ",o.userName]}),e.jsx(l,{sx:{color:"text.secondary"},children:s})]}),e.jsx(d,{variant:"subtitle1",component:"h6",sx:{textAlign:"start",display:"-webkit-box",WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",width:.7},children:o.title})]})},Ps=y(e.jsx("path",{d:"M10 20h4c0 1.1-.9 2-2 2s-2-.9-2-2m4-11c0 2.61 1.67 4.83 4 5.66V17h1c.55 0 1 .45 1 1s-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1h1v-7c0-2.79 1.91-5.14 4.5-5.8v-.7c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5v.7c.71.18 1.36.49 1.95.9C14.54 6.14 14 7.51 14 9m9-1h-2V6c0-.55-.45-1-1-1s-1 .45-1 1v2h-2c-.55 0-1 .45-1 1s.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1v-2h2c.55 0 1-.45 1-1s-.45-1-1-1"})),_s=y(e.jsx("path",{d:"M14 11c0 .55-.45 1-1 1H4c-.55 0-1-.45-1-1s.45-1 1-1h9c.55 0 1 .45 1 1M3 7c0 .55.45 1 1 1h9c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1m7 8c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1h5c.55 0 1-.45 1-1m8.01-2.13.71-.71c.39-.39 1.02-.39 1.41 0l.71.71c.39.39.39 1.02 0 1.41l-.71.71zm-.71.71-5.16 5.16c-.09.09-.14.21-.14.35v1.41c0 .28.22.5.5.5h1.41c.13 0 .26-.05.35-.15l5.16-5.16z"})),Q={variant:"contained",color:"primary",size:"large",startIcon:e.jsx(Ps,{})},z={borderRadius:99,transition:"all 0.2s ease",boxShadow:3,scale:"1.001"},qs=({targetId:t})=>{const{isFollowed:s,handleFollow:o,disabled:n,loading:a,isSelf:r}=ot(t);return r?e.jsx(g,{variant:"contained",color:"primary",size:"large",startIcon:e.jsx(_s,{}),sx:{...z,"&:hover":{bgcolor:"primary.main",scale:"1.05",boxShadow:3},"&:active":{scale:"0.95"}},onClick:()=>{const i=document.querySelector(".account-settings-button");i&&i.click()},children:"編輯個人資料"}):n?e.jsx(g,{...Q,disabled:!0,sx:z,children:"追蹤"}):a?e.jsx(g,{...Q,loading:!0,sx:z,children:"追蹤"}):e.jsx(g,{...Q,onClick:o,sx:{...z,"&:hover":{bgcolor:"primary.main",scale:"1.05",boxShadow:3},"&:active":{scale:"0.95"}},children:s?"已追蹤":"追蹤"})},Do=()=>{const t=new URLSearchParams(window.location.search),{data:s,isFetching:o}=ze(t.get("user"));return!o&&s===null?e.jsx(g,{...Q,disabled:!0,sx:z,children:"追蹤"}):o||!s?e.jsx(g,{...Q,loading:!0,sx:z,children:"追蹤"}):e.jsx(qs,{targetId:s.id})},zs=({targetId:t})=>{const{isFollowed:s,handleFollow:o,disabled:n,loading:a}=ot(t);return a?e.jsx(K,{variant:"outlined",clickable:!0,disabled:!0,label:e.jsx(re,{size:"1rem"})}):n?e.jsx(K,{variant:"outlined",label:"追蹤",clickable:!0,disabled:!0}):e.jsx(K,{variant:"outlined",label:s?"已追蹤":"追蹤",clickable:!0,onClick:o,color:s?"primary":"default"})},Bs=()=>e.jsxs(e.Fragment,{children:[e.jsx(Wt,{}),e.jsxs(l,{children:[e.jsx(B,{variant:"rounded",animation:"wave",children:e.jsx(d,{variant:"subtitle1",sx:{textWrap:"nowrap",color:"text.primary",cursor:"pointer",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"作者名稱"})}),e.jsx(B,{variant:"text",animation:"wave",children:e.jsx(d,{variant:"body2",component:"p",sx:{color:"text.secondary"},children:"作者描述載入中..."})})]}),e.jsx(K,{variant:"outlined",label:"追蹤",clickable:!0,disabled:!0})]}),Hs=({id:t,name:s,description:o,ellipsis:n})=>e.jsxs(e.Fragment,{children:[e.jsx(Ke,{name:s}),e.jsxs(l,{children:[e.jsx(d,{variant:"subtitle1",sx:{textWrap:"nowrap",color:"text.primary",cursor:"pointer",textDecoration:"none","&:hover":{textDecoration:"underline"}},component:"a",href:`${C.forum_users}?user=${s}`,children:s}),e.jsx(d,{variant:"body2",component:"p",sx:{color:"text.secondary",...n&&Te},children:o||"這個使用者很懶，什麼都沒寫"})]}),e.jsx(zs,{targetId:t})]}),rt=y(e.jsx("path",{d:"M21 6c0 .55-.45 1-1 1h-1v1c0 .55-.45 1-1 1s-1-.45-1-1V7h-1c-.55 0-1-.45-1-1s.45-1 1-1h1V4c0-.55.45-1 1-1s1 .45 1 1v1h1c.55 0 1 .45 1 1m-2 13.48c0 .72-.73 1.2-1.39.92L12 18l-5.61 2.4c-.66.29-1.39-.2-1.39-.92V5c0-1.1.9-2 2-2h7c-.63.84-1 1.87-1 3 0 2.76 2.24 5 5 5 .34 0 .68-.03 1-.1z"})),at=y(e.jsx("path",{d:"M21 6c0 .55-.45 1-1 1h-4c-.55 0-1-.45-1-1s.45-1 1-1h4c.55 0 1 .45 1 1m-2 4.9c-.32.07-.66.1-1 .1-2.76 0-5-2.24-5-5 0-1.13.37-2.16 1-3H7c-1.1 0-2 .9-2 2v14.48c0 .72.73 1.2 1.39.92L12 18l5.61 2.4c.66.28 1.39-.2 1.39-.92z"})),Oo=({postId:t})=>{const s=se(r=>r.breakpoints.down("sm")),{isFavorited:o,handleFavorite:n,disabled:a}=st(t);return e.jsx(g,{color:o?"primary":"inherit",startIcon:o?e.jsx(at,{}):e.jsx(rt,{}),size:"small",onClick:n,disabled:a,children:e.jsx(d,{variant:"caption",component:"span",children:s?o?"取消":"收藏":o?"取消收藏":"收藏該貼文"})})},Ws=({postId:t})=>{const{isFavorited:s,handleFavorite:o,disabled:n,loading:a}=st(t),r=i=>{i.preventDefault(),i.stopPropagation(),o()};return e.jsx(g,{size:"small",color:"inherit",startIcon:s?e.jsx(at,{}):e.jsx(rt,{}),onClick:r,disabled:n,loading:a,variant:s?"text":"outlined",children:s?"取消收藏":"收藏該貼文"})},Fe={position:"relative",display:"grid",gridTemplateColumns:{xs:"auto 1fr auto",sm:"auto 1fr auto auto 1fr auto"},alignItems:"center",gap:2,"& > *:nth-of-type(6n - 3)":{"&::after":{content:'""',position:"absolute",display:{xs:"none",sm:"block"},inset:0,pointerEvents:"none",borderRight:"1px solid",borderColor:"divider",mr:-1,my:-2.1}}},Us=({userId:t})=>{const{data:s,isFetching:o}=Ds({userId:t});return o?e.jsx(l,{sx:Fe,children:[...Array(4)].map((n,a)=>e.jsx(Bs,{},a))}):!s||s.length===0?e.jsx(l,{children:e.jsx(d,{variant:"subtitle2",color:"text.secondary",align:"center",children:"你還沒追蹤任何使用者"})}):e.jsx(l,{sx:Fe,children:s.map(n=>e.jsx(Hs,{...n,ellipsis:!0},n.id))})},Me={display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},gap:1,"& > *:nth-of-type(4n+2), & > *:nth-of-type(4n+3)":{bgcolor:{xs:"",md:"action.hover"}}},Vs=()=>{const{data:t,loading:s}=Ns();return s?e.jsx(l,{sx:Me,children:[...Array(4)].map((o,n)=>e.jsx(nt,{},n))}):!t||t.length===0?e.jsx(l,{sx:{m:3},children:e.jsx(d,{variant:"subtitle2",color:"text.secondary",align:"center",children:"你尚未收藏任何貼文"})}):e.jsx(l,{sx:Me,children:t.map(o=>e.jsx(l,{sx:{position:"relative"},children:e.jsx(Os,{postId:o,action:e.jsx(Ws,{postId:o})})},o))})},it=()=>{const{user:t}=k(),[s,o]=p.useState(!0),[n,a]=p.useState(!0),r=()=>o(!s),i=()=>a(!n);return e.jsxs(I,{children:[e.jsxs(l,{sx:{bgcolor:"action.hover",cursor:"pointer"},onClick:r,children:[e.jsx(E,{}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:3,py:1},children:[e.jsx(d,{variant:"subtitle1",children:"追蹤的使用者"}),e.jsx(Ce,{sx:{transform:s?"rotate(180deg)":"",transition:"all 0.2s ease"}})]}),e.jsx(E,{})]}),e.jsx(we,{in:s,children:e.jsx(l,{sx:{px:3,py:2},children:t?e.jsx(Us,{userId:t.id}):e.jsx(l,{children:e.jsx(d,{variant:"subtitle2",color:"error",align:"center",children:"出了點問題，請稍後再試"})})})}),e.jsxs(l,{sx:{bgcolor:"action.hover",cursor:"pointer"},onClick:i,children:[e.jsx(E,{}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:3,py:1},children:[e.jsx(d,{variant:"subtitle1",children:"收藏的貼文"}),e.jsx(Ce,{sx:{transform:n?"rotate(180deg)":"",transition:"all 0.2s ease"}})]}),e.jsx(E,{})]}),e.jsx(we,{in:n,children:e.jsx(l,{sx:{px:3,py:2},children:e.jsx(Vs,{})})})]})},Ks=()=>{const{authenticated:t,loading:s}=k(),[o,n]=p.useState(!1),a=()=>n(!0),r=()=>n(!1);return e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"收藏與追蹤",arrow:!0,children:e.jsx("span",{children:e.jsx(R,{onClick:a,disabled:!t,loading:s,children:e.jsx(Oe,{fontSize:"small"})})})}),e.jsxs(je,{open:o,onClose:r,maxWidth:"md",fullWidth:!0,children:[e.jsxs(l,{sx:{position:"relative",display:"flex",gap:1,alignItems:"center",p:2,bgcolor:"background.paper",borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(l,{sx:{position:"absolute",inset:0,bgcolor:"action.hover"}}),e.jsx(Ss,{className:"mode-light",sx:{fontSize:48,mr:1,bgcolor:"primary.main",borderRadius:1,color:"background.default",p:1}}),e.jsx(d,{variant:"h6",component:"h2",sx:{color:"text.primary"},children:"收藏與追蹤"}),e.jsx(l,{sx:{flex:1}}),e.jsx(q,{title:"關閉",arrow:!0,children:e.jsx(R,{onClick:r,children:e.jsx(Y,{})})})]}),e.jsx(it,{})]})]})},Qs=T("div")(({theme:t})=>({height:6,width:30,backgroundColor:t.palette.divider,borderRadius:3,position:"absolute",top:8,left:"calc(50% - 15px)",...t.applyStyles("dark",{backgroundColor:t.palette.divider})})),Js=()=>{const{authenticated:t,loading:s}=k(),[o,n]=p.useState(!1),a=()=>n(!0),r=()=>n(!1);return e.jsxs(e.Fragment,{children:[e.jsx(_,{showLabel:!0,label:s?"載入中...":"收藏",icon:e.jsx(Oe,{}),disabled:!t||s,onClick:a}),e.jsxs(fe,{anchor:"bottom",open:o,onClose:r,onOpen:a,children:[e.jsx(Qs,{}),e.jsxs(l,{sx:{p:2},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(d,{variant:"h6",component:"h2",children:"收藏與追蹤"}),e.jsx(R,{onClick:r,children:e.jsx(Y,{})})]}),e.jsx(it,{})]})]})]})},Ys=()=>e.jsx(q,{title:"返回首頁",arrow:!0,children:e.jsxs(me,{href:C.forum_home,sx:{display:"flex",gap:1.5,alignItems:"center",justifyContent:"center",borderRadius:1,p:1,"&:hover":{bgcolor:"divider"},"&:active":{scale:"0.95"},transition:"all 0.2s ease-in-out"},children:[e.jsx(Le,{fontSize:"large",color:"primary"}),e.jsx(d,{variant:"h4",component:"h1",sx:{fontFamily:'"timemachine-wa"'},children:"論壇樣板"})]})}),Gs={position:"sticky",top:0,zIndex:"appBar",bgcolor:"secondary.main",borderBottom:"solid 1px #fff2",boxShadow:3,".top &":{boxShadow:"none"},transition:"all 0.2s ease-in-out"},Po=({sx:t,...s})=>e.jsx(_e,{className:"mode-dark",disableGutters:!0,sx:{...Gs,...t},...s,children:e.jsxs(ge,{sx:{display:"flex",alignItems:"center",gap:1,color:"text.primary"},maxWidth:!1,children:[e.jsx(l,{sx:{display:"flex",justifyContent:"flex-start",flex:{xs:void 0,md:1}},children:e.jsx(Ys,{})}),e.jsx(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",flex:1},children:e.jsx(os,{})}),e.jsxs(l,{sx:{display:"flex",gap:1,alignItems:"center",justifyContent:"flex-end",flex:1},children:[e.jsx(jt,{}),e.jsx(Ks,{}),e.jsx(Is,{}),e.jsx(Zt,{})]})]})}),Zs=y(e.jsx("path",{d:"M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1"})),Xs={position:"sticky",top:0,zIndex:"appBar",bgcolor:"secondary.main",borderBottom:"solid 1px #fff2",boxShadow:3,".top &":{boxShadow:"none"},transition:"all 0.2s ease-in-out"},eo={position:"fixed",inset:"auto 0 0 0",zIndex:"appBar",bgcolor:"secondary.main",borderTop:"solid 1px #fff2",boxShadow:3},_o=({sx:t,...s})=>{const[o,n]=p.useState(!1),a=()=>n(!0),r=()=>n(!1),i=p.useRef(null);return p.useEffect(()=>{if(!i.current)return;const c=document.getElementById("scroll-area");if(!c)return;const u=i.current.clientHeight;return c.style.paddingBottom=`${u}px`,()=>{c.style.paddingBottom="0px"}},[i]),e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"mode-dark",disableGutters:!0,sx:{...Xs,...t},...s,children:e.jsxs(ge,{sx:{display:"flex",alignItems:"center",gap:1,color:"text.primary"},maxWidth:"xl",children:[e.jsxs(l,{sx:{display:"flex",gap:1,alignItems:"center",flex:1},children:[e.jsx(Le,{fontSize:"large",color:"primary"}),e.jsx(d,{variant:"h4",component:"h1",sx:{mr:1,fontFamily:'"timemachine-wa"'},children:"論壇樣板"})]}),e.jsx(g,{href:C.forum_search,startIcon:e.jsx(Pe,{}),variant:"outlined",color:"inherit",size:"large",children:"搜尋"})]})}),e.jsxs(At,{className:"mode-dark",value:2,showLabels:!0,sx:eo,ref:i,children:[e.jsx(ws,{}),e.jsx(_,{label:"主題",icon:e.jsx(bt,{}),onClick:a}),e.jsx(_,{sx:{cursor:"default",minWidth:"auto"},disableRipple:!0,label:e.jsx(_t,{color:"primary",size:"large",href:C.forum_home,component:"a",sx:{position:"absolute",transform:"translate(-50%, -80%) scale(1.2)",cursor:"pointer",display:"grid",placeItems:"center","&:hover":{bgcolor:"primary.light"}},children:e.jsxs(l,{children:[e.jsx(Zs,{}),e.jsx(d,{variant:"caption",component:"h5",children:"首頁"})]})})}),e.jsx(Js,{}),e.jsx(es,{})]}),e.jsx(vt,{open:o,onClose:r,onOpen:a})]})},to=y([e.jsx("path",{d:"M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-4.99-5.58-5.34C6.54 2.58 3.3 5.38 3.03 9h2.02c.24-2.12 1.92-3.8 4.06-3.98C11.65 4.8 14 6.95 14 9.5c0 2.49-2.01 4.5-4.5 4.5-.17 0-.33-.03-.5-.05v2.02l.01.01c1.8.13 3.47-.47 4.72-1.55l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0s.41-1.08 0-1.49z"},"0"),e.jsx("path",{d:"M6.12 11.17 4 13.29l-2.12-2.12c-.2-.2-.51-.2-.71 0s-.2.51 0 .71L3.29 14l-2.12 2.12c-.2.2-.2.51 0 .71s.51.2.71 0L4 14.71l2.12 2.12c.2.2.51.2.71 0s.2-.51 0-.71L4.71 14l2.12-2.12c.2-.2.2-.51 0-.71-.2-.19-.51-.19-.71 0"},"1")]),so=y(e.jsx("path",{d:"M8.65 5.82C9.36 4.72 10.6 4 12 4c2.21 0 4 1.79 4 4 0 1.4-.72 2.64-1.82 3.35zM20 17.17c-.02-1.1-.63-2.11-1.61-2.62-.54-.28-1.13-.54-1.77-.76zm.49 3.32L3.51 3.51a.996.996 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41l8.18 8.18c-1.82.23-3.41.8-4.7 1.46C4.6 15.08 4 16.11 4 17.22V20h13.17l1.9 1.9c.39.39 1.02.39 1.41 0 .4-.39.4-1.02.01-1.41"})),oo=y(e.jsx("path",{d:"M3 5v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2m13.3 11.29c-.39.39-1.02.39-1.41 0L12 13.41 9.11 16.3c-.39.39-1.02.39-1.41 0a.996.996 0 0 1 0-1.41L10.59 12 7.7 9.11a.996.996 0 0 1 0-1.41c.39-.39 1.02-.39 1.41 0L12 10.59l2.89-2.88c.39-.39 1.02-.39 1.41 0s.39 1.02 0 1.41L13.41 12l2.89 2.88c.38.39.38 1.03 0 1.41"})),ee={display:"flex",alignItems:"center",gap:1},te=t=>({gap:1,flex:1,borderRight:t?0:1,borderColor:"divider",px:3}),qo=()=>{const t=se(a=>a.breakpoints.between("xs","md")),s=se(a=>a.breakpoints.down("sm")),[o,n]=p.useState(!1);if(o)throw new Error("測試目的的錯誤，請忽略");return e.jsx(l,{component:"footer",sx:{position:"relative",mt:"auto",py:3,bgcolor:"background.paper",borderTop:1,borderColor:"divider","&::before":{bgcolor:"action.hover",content:'""',position:"absolute",inset:0,pointerEvents:"none"}},children:e.jsxs(ge,{maxWidth:"lg",sx:{position:"relative"},children:[e.jsxs(I,{sx:{display:"flex",gap:3,alignItems:"center"},children:[e.jsxs(I,{sx:{alignItems:"center"},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"相關連結"}),e.jsx(d,{variant:"body2",sx:{color:"text.secondary"},children:"故意引發錯誤或使用錯誤參數，用於展示網站對於真實錯誤的處理能力。"})]}),e.jsx(E,{orientation:"horizontal",flexItem:!0,variant:"middle"}),e.jsxs(l,{sx:{display:"grid",width:1,rowGap:2,gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"1fr 1fr 1fr 1fr"}},children:[e.jsxs(I,{sx:te(s),children:[e.jsxs(X,{href:"#",variant:"body2",color:"primary",sx:ee,underline:"hover",onClick:()=>n(!0),children:[e.jsx(Rt,{fontSize:"small"}),"觸發錯誤"]}),e.jsx(d,{variant:"caption",sx:{color:"text.secondary"},children:"測試任意頁面發生錯誤時的情境"})]}),e.jsxs(I,{sx:te(t),children:[e.jsxs(X,{href:"/this/is/a/not/exist/route",variant:"body2",color:"primary",sx:ee,underline:"hover",children:[e.jsx(to,{fontSize:"small"}),"404 錯誤"]}),e.jsx(d,{variant:"caption",sx:{color:"text.secondary"},children:"測試要求資源不存在的情境"})]}),e.jsxs(I,{sx:te(s),children:[e.jsxs(X,{href:`${C.forum_users}?user=I_think_this_wont_be_an_username`,variant:"body2",color:"primary",sx:ee,underline:"hover",children:[e.jsx(so,{fontSize:"small"}),"使用者不存在"]}),e.jsx(d,{variant:"caption",sx:{color:"text.secondary"},children:"測試使用者頁面，但所要求的使用者不存在的情況"})]}),e.jsxs(I,{sx:te(!0),children:[e.jsxs(X,{href:`${C.forum_post}?postId=-99`,variant:"body2",color:"primary",sx:ee,underline:"hover",children:[e.jsx(oo,{fontSize:"small"}),"貼文不存在"]}),e.jsx(d,{variant:"caption",sx:{color:"text.secondary"},children:"測試單個貼文頁面，但所要求的貼文不存在的情況"})]})]})]}),e.jsxs(d,{variant:"caption",sx:{mt:2,textAlign:"center",display:"block",color:"text.secondary"},children:["© ",new Date().getFullYear()," 論壇樣板 by 1ureka"]})]})})},zo=y(e.jsx("path",{d:"M16.5 6.75v10.58c0 2.09-1.53 3.95-3.61 4.15-2.39.23-4.39-1.64-4.39-3.98V5.14c0-1.31.94-2.5 2.24-2.63 1.5-.15 2.76 1.02 2.76 2.49v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6.75c0-.41-.34-.75-.75-.75s-.75.34-.75.75v8.61c0 1.31.94 2.5 2.24 2.63 1.5.15 2.76-1.02 2.76-2.49V5.17c0-2.09-1.53-3.95-3.61-4.15C9.01.79 7 2.66 7 5v12.27c0 2.87 2.1 5.44 4.96 5.71 3.29.3 6.04-2.26 6.04-5.48V6.75c0-.41-.34-.75-.75-.75s-.75.34-.75.75"}));export{Bs as A,rt as B,_s as E,Oo as F,Zs as H,Mo as P,Ke as U,Hs as a,Fo as b,Po as c,_o as d,qo as e,zo as f,Ds as g,Do as h,To as i,Lo as u};
